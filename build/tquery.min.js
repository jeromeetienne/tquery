// tquery.js - https://github.com/jeromeetienne/tquery - MIT License
var tQuery=function(a,b){if(a instanceof THREE.Mesh&&tQuery.Mesh)return new tQuery.Mesh(a);if(a instanceof THREE.DirectionalLight&&tQuery.DirectionalLight)return new tQuery.DirectionalLight(a);if(a instanceof THREE.AmbientLight&&tQuery.AmbientLight)return new tQuery.AmbientLight(a);if(a instanceof THREE.Light&&tQuery.Light)return new tQuery.Light(a);if(a instanceof THREE.Object3D&&tQuery.Object3D)return new tQuery.Object3D(a);if(a instanceof THREE.Geometry&&tQuery.Geometry)return new tQuery.Geometry(a);
if(a instanceof THREE.Material&&tQuery.Material)return new tQuery.Material(a);if("string"===typeof a&&tQuery.Object3D)return new tQuery.Object3D(a,b);console.assert(!1,"unsupported type")};tQuery.VERSION="0.0.1";tQuery.data=function(a,b,c){console.assert(a,"invalid parameters");console.assert("string"===typeof b,"invalid parameters");a._tqData=a._tqData||{};c&&(a._tqData[b]=c);return a._tqData[b]};
tQuery.removeData=function(a,b){b instanceof Array?b.forEach(function(b){tQuery.removeData(a,b)}):(console.assert("string"===typeof b),delete a._tqData[b])};tQuery.each=function(a,b){for(var c=0;c<a.length;c++)if(!1===b(a[c]))return!1;return!0};tQuery.inherit=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.parent=b.prototype;a.prototype.constructor=a};
tQuery.extend=function(a,b){var c={};b&&Object.keys(b).forEach(function(a){c[a]=b[a]});a&&Object.keys(a).forEach(function(b){c[b]=a[b]});return c};tQuery.pluginsOn=function(a,b){b=b||a.prototype||a;a.register=function(a,d){if(b[a])throw Error("Conflict! Already method called: "+a);b[a]=d};a.unregister=function(a){if(!1===b.hasOwnProperty(a))throw Error("Plugin not found: "+a);delete b[a]};a.registered=function(a){return!0===b.hasOwnProperty(a)}};tQuery.pluginsInstanceOn=function(a){return tQuery.pluginsOn(a)};
tQuery.pluginsStaticOn=function(a){return tQuery.pluginsOn(a.klass)};tQuery.pluginsOn(tQuery,tQuery);
tQuery.mixinAttributes=function(a,b){a.prototype.attr=function(a,d){a instanceof Object&&void 0===d?Object.keys(a).forEach(function(b){this.attr(b,a[b])}.bind(this)):"string"===typeof a?console.assert(-1!==Object.keys(b).indexOf(a),"invalid property name:"+a):console.assert(!1,"invalid parameter");if(void 0!==d)return d=(0,b[a])(d),this.each(function(b){b[a]=d}),this;if(0!==this.length)return this.get(0)[a]};Object.keys(b).forEach(function(b){a.prototype[b]=function(a){return this.attr(b,a)}}.bind(this))};
tQuery.Flow=function(){var a,b=[],c=setTimeout(function(){c=null;a._next()},0);return a={destroy:function(){c&&clearTimeout(c)},par:function(c,e){(e||!(b[b.length-1]instanceof Array))&&b.push([]);b[b.length-1].push(c);return a},seq:function(b){return a.par(b,!0)},_next:function(c,e){var f=[],g=[],h=b.shift()||[],i=h.length,j=1==i;h&&h.forEach(function(b,h){b(function(b,c){f[h]=b;g[h]=c;0==--i&&a._next(j?f[0]:f,j?g[0]:g)},c,e)})}}};
tQuery.MicroeventMixin=function(a){a.bind=function(a,c){void 0===this._events&&(this._events={});this._events[a]=this._events[a]||[];this._events[a].push(c);return c};a.unbind=function(a,c){void 0===this._events&&(this._events={});!1!==a in this._events&&this._events[a].splice(this._events[a].indexOf(c),1)};a.trigger=function(a){void 0===this._events&&(this._events={});if(void 0!==this._events[a])for(var c=this._events[a].slice(),d=0;d<c.length;d++)c[d].apply(this,Array.prototype.slice.call(arguments,
1))}};tQuery.convert={};tQuery.convert.toThreeColor=function(a){if(1===arguments.length&&"number"===typeof a)return new THREE.Color(a);if(1===arguments.length&&a instanceof THREE.Color)return a;console.assert(!1,"invalid parameter")};tQuery.convert.toNumber=function(a){if(1===arguments.length&&"number"===typeof a)return a;console.assert(!1,"invalid parameter")};tQuery.convert.identity=function(a){return a};
tQuery.convert.toBool=function(a){if(1===arguments.length&&"boolean"===typeof a)return a;console.assert(!1,"invalid parameter")};tQuery.Node=function(a){this._lists=a instanceof Array?a:a?[a]:[];this.length=this._lists.length};tQuery.Node.prototype.get=function(a){if(void 0===a)return this._lists;console.assert(this._lists[a],"element not defined");return this._lists[a]};tQuery.Node.prototype.each=function(a){return tQuery.each(this._lists,a)};
tQuery.Node.prototype.back=function(a){if(void 0===a)return this._back;this._back=a;return this};tQuery.Node.prototype.data=function(a,b){if(b)return this.each(function(c){tQuery.data(c,a,b)}),this;if(0<this.length)return tQuery.data(this.get(0),a);console.assert(0===this.length)};tQuery.Node.prototype.removeData=function(a){this.each(function(b){tQuery.removeData(b,a)});return this};
tQuery.Object3D=function(a,b){"string"===typeof a&&(a=tQuery.Object3D._select(a,b));tQuery.Object3D.parent.constructor.call(this,a);this._lists.forEach(function(a){console.assert(a instanceof THREE.Object3D)})};tQuery.inherit(tQuery.Object3D,tQuery.Node);tQuery.pluginsInstanceOn(tQuery.Object3D);tQuery.Object3D.prototype.geometry=function(){var a=[];this.each(function(b){a.push(b.geometry)});return(new tQuery.Geometry(a)).back(this)};
tQuery.Object3D.prototype.material=function(){var a=[];this.each(function(b){a.push(b.material)});return new tQuery.Material(a)};tQuery.Object3D.prototype.addTo=function(a){console.assert(a instanceof tQuery.World||a instanceof tQuery.Object3D);this.each(function(b){a.add(b)}.bind(this));return this};tQuery.Object3D.prototype.removeFrom=function(a){console.assert(a instanceof tQuery.World||a instanceof tQuery.Object3D);this.each(function(b){a.remove(b)}.bind(this));return this};
tQuery.Object3D.prototype.add=function(a){console.assert(a instanceof tQuery.Object3D);this.each(function(b){a.each(function(a){b.add(a)})}.bind(this));return this};tQuery.Object3D.prototype.remove=function(a){console.assert(a instanceof tQuery.Object3D);this.each(function(b){a.each(function(a){b.remove(a)})}.bind(this));return this};
tQuery.Object3D.prototype.id=function(a){console.assert(1>=this.length,"tQuery.Object3D.id used on multi-elements");if(void 0!==a){if(0<this.length){var b=this.get(0);b._tqId=a}return this}if(0<this.length)return b=this.get(0),b._tqId};tQuery.Object3D.prototype.addClass=function(a){this.each(function(b){b._tqClasses=b._tqClasses||"";tQuery.Object3D._hasClassOne(b,a)||(b._tqClasses+=" "+a)}.bind(this));return this};
tQuery.Object3D.prototype.removeClass=function(a){this.each(function(b){tQuery.Object3D._removeClassOne(b,a)}.bind(this));return this};tQuery.Object3D.prototype.hasClass=function(a){return this.each(function(b){b._tqClasses=b._tqClasses||"";return tQuery.Object3D._hasClassOne(b,a)?!1:!0}.bind(this))?!1:!0};tQuery.Object3D._hasClassOne=function(a,b){return void 0===a._tqClasses?!1:a._tqClasses.match(RegExp("(^| |\t)+("+b+")($| |\t)+"))?!0:!1};
tQuery.Object3D._removeClassOne=function(a,b){void 0!==a._tqClasses&&(a._tqClasses=a._tqClasses.replace(RegExp("(^| |\t)("+b+")($| |\t)")," "))};tQuery.Object3D._select=function(a,b){var b=b||tQuery.world.scene(),c=a.split(" ").filter(function(a){return 0<a.length}),d=[];b.children.forEach(function(a){a=this._crawls(a,c);d=d.concat(a)}.bind(this));return d};
tQuery.Object3D._crawls=function(a,b){var c=[];console.assert(1<=b.length);var d=this._selectItemMatch(a,b[0])?b.slice(1):b;if(0===d.length)return[a];a.children.forEach(function(a){a=this._crawls(a,d);c=c.concat(a)}.bind(this));return c};tQuery.Object3D._selectableGeometries=Object.keys(THREE).filter(function(a){return a.match(/.+Geometry$/)}).map(function(a){return a.replace(/Geometry$/,"").toLowerCase()});
tQuery.Object3D._selectableLights=Object.keys(THREE).filter(function(a){return a.match(/.+Light$/)}).map(function(a){return a.replace(/Light$/,"").toLowerCase()});tQuery.Object3D._selectableClasses=["mesh","light"];
tQuery.Object3D._selectItemMatch=function(a,b){console.assert(a instanceof THREE.Object3D);console.assert("string"===typeof b);var c=b.match(RegExp("([^.#]+|.[^.#]+|#[^.#]+)","g"));return tQuery.each(c,function(b){var c=b.charAt(0),f=b.slice(1);if("."===c)return tQuery.Object3D._hasClassOne(a,f)?!0:!1;if("#"===c)return a._tqId===f?!0:!1;if("*"===b)return!0;if(-1!==this._selectableGeometries.indexOf(b))return c=a.geometry,b=b.charAt(0).toUpperCase()+b.slice(1)+"Geometry",c instanceof THREE[b];if(-1!==
this._selectableLights.indexOf(b))return b=b.charAt(0).toUpperCase()+b.slice(1)+"Light",a instanceof THREE[b];if(-1!==this._selectableClasses.indexOf(b))return b=b.charAt(0).toUpperCase()+b.slice(1),a instanceof THREE[b];console.assert(!1,"invalid selector: "+b);return!0}.bind(this))?!0:!1};tQuery.Geometry=function(a){tQuery.Geometry.parent.constructor.call(this,a);this._lists.forEach(function(a){console.assert(a instanceof THREE.Geometry)})};tQuery.inherit(tQuery.Geometry,tQuery.Node);tQuery.pluginsInstanceOn(tQuery.Geometry);
tQuery.Material=function(a){tQuery.Material.parent.constructor.call(this,a);this._lists.forEach(function(a){console.assert(a instanceof THREE.Material)})};tQuery.inherit(tQuery.Material,tQuery.Node);tQuery.pluginsInstanceOn(tQuery.Material);tQuery.mixinAttributes(tQuery.Material,{opacity:tQuery.convert.toNumber,transparent:tQuery.convert.toBool});tQuery.Light=function(a){tQuery.Light.parent.constructor.call(this,a);this._lists.forEach(function(a){console.assert(a instanceof THREE.Light)})};
tQuery.inherit(tQuery.Light,tQuery.Object3D);tQuery.pluginsInstanceOn(tQuery.Light);tQuery.mixinAttributes(tQuery.Light,{color:tQuery.convert.toThreeColor});tQuery.Mesh=function(a){tQuery.Mesh.parent.constructor.call(this,a);this._lists.forEach(function(a){console.assert(a instanceof THREE.Mesh)})};tQuery.inherit(tQuery.Mesh,tQuery.Object3D);tQuery.pluginsInstanceOn(tQuery.Mesh);
tQuery.Mesh.prototype.material=function(a){var b=tQuery.Mesh.parent;if(void 0==a)return b.material.call(this);this.each(function(b){b.material=a});return this};
tQuery.World=function(){tQuery.world=this;this._scene=new THREE.Scene;if(this._hasWebGL)this._renderer=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}),this._renderer.setClearColorHex(12303291,1);else throw this._addGetWebGLMessage(),Error("WebGL required and not available");this._renderer.setSize(window.innerWidth,window.innerHeight);this._camera=new THREE.PerspectiveCamera(35,window.innerWidth/window.innerHeight,0.01,1E4);this._camera.position.set(0,0,3);this._scene.add(this._camera);
this._loop=new tQuery.Loop(this)};tQuery.pluginsInstanceOn(tQuery.World);tQuery.MicroeventMixin(tQuery.World.prototype);tQuery.World.prototype.destroy=function(){this.trigger("destroy");this._loop.destroy();var a=this._renderer.domElement.parentElement;a&&a.removeChild(this._renderer.domElement);tQuery.world===this&&(tQuery.world=null)};tQuery.World.prototype._hasWebGL=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(a){return!1}}();
tQuery.World.prototype._addGetWebGLMessage=function(a){var a=a||document.body,b=document.createElement("div");b.style.fontFamily="monospace";b.style.fontSize="13px";b.style.textAlign="center";b.style.background="#eee";b.style.color="#000";b.style.padding="1em";b.style.width="475px";b.style.margin="5em auto 0";b.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/">here</a>.':
'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/">here</a>.';a.appendChild(b)};tQuery.World.prototype.add=function(a){a instanceof tQuery.Object3D?a.each(function(a){this._scene.add(a)}.bind(this)):a instanceof THREE.Object3D?this._scene.add(a):console.assert(!1,"invalid type");return this};
tQuery.World.prototype.remove=function(a){a instanceof tQuery.Object3D?a.each(function(a){this._scene.remove(a)}.bind(this)):a instanceof THREE.Object3D?this._scene.remove(a):console.assert(!1,"invalid type");return this};tQuery.World.prototype.appendTo=function(a){a.appendChild(this._renderer.domElement);this._renderer.setSize(a.offsetWidth,a.offsetHeight);return this};tQuery.World.prototype.start=function(){this._loop.start();return this};
tQuery.World.prototype.stop=function(){this._loop.stop();return this};tQuery.World.prototype.fullpage=function(){var a=document.body;a.style.margin="0";a.style.padding="0";a.style.overflow="hidden";return this.appendTo(a)};tQuery.World.prototype.loop=function(){return this._loop};tQuery.World.prototype.renderer=function(){return this._renderer};tQuery.World.prototype.camera=function(){return this._camera};tQuery.World.prototype.scene=function(){return this._scene};tQuery.World.prototype.get=function(){return this._scene};
tQuery.World.prototype.render=function(){this._renderer.render(this._scene,this._camera)};tQuery.Loop=function(a){this._world=a;this._hooks=[];this._lastTime=null;this._world&&this.hookOnRender(function(){this._world.render()}.bind(this))};tQuery.pluginsInstanceOn(tQuery.Loop);tQuery.Loop.prototype.destroy=function(){this.stop();tQuery.loop===this&&(tQuery.loop=null)};
tQuery.Loop.prototype.start=function(){this._timerId&&this.stop();this._timerId=requestAnimationFrame(this._onAnimationFrame.bind(this));return this};tQuery.Loop.prototype.stop=function(){cancelAnimationFrame(this._timerId);this._timerId=null;return this};
tQuery.Loop.prototype._onAnimationFrame=function(a){this._timerId=requestAnimationFrame(this._onAnimationFrame.bind(this));a/=1E3;this._lastTime||(this._lastTime=a-1/60);var b=a-this._lastTime;this._lastTime=a;for(var c=0;c<=this._hooks.length;c++)if(void 0!==this._hooks[c])for(var d=this._hooks[c].slice(0),e=0;e<d.length;e++)d[e](b,a)};tQuery.Loop.prototype.PRE_RENDER=20;tQuery.Loop.prototype.ON_RENDER=50;tQuery.Loop.prototype.POST_RENDER=80;
tQuery.Loop.prototype.hook=function(a,b){"function"===typeof a&&(b=a,a=this.PRE_RENDER);this._hooks[a]=this._hooks[a]||[];console.assert(-1===this._hooks[a].indexOf(b));this._hooks[a].push(b);return this};tQuery.Loop.prototype.unhook=function(a,b){"function"===typeof a&&(b=a,a=this.PRE_RENDER);var c=this._hooks[a].indexOf(b);console.assert(-1!==c);this._hooks[a].splice(c,1);0===this._hooks[a].length&&delete this._hooks[a];return this};
tQuery.Loop.prototype.hookPreRender=function(a){return this.hook(this.PRE_RENDER,a)};tQuery.Loop.prototype.hookOnRender=function(a){return this.hook(this.ON_RENDER,a)};tQuery.Loop.prototype.hookPostRender=function(a){return this.hook(this.POST_RENDER,a)};tQuery.Loop.prototype.unhookPreRender=function(a){return this.unhook(this.PRE_RENDER,a)};tQuery.Loop.prototype.unhookOnRender=function(a){return this.unhook(this.ON_RENDER,a)};
tQuery.Loop.prototype.unhookPostRender=function(a){return this.unhook(this.POST_RENDER,a)};tQuery.register("createWorld",function(){return new tQuery.World});tQuery.register("createLoop",function(a){return new tQuery.Loop(a)});tQuery.register("createDirectionalLight",function(){var a=new THREE.DirectionalLight(16777215*Math.random());a.position.set(Math.random()-0.5,Math.random()-0.5,Math.random()-0.5).normalize();return tQuery(a)});
tQuery.register("createAmbientLight",function(){var a=new THREE.AmbientLight(16777215);return tQuery(a)});tQuery.register("defaultObject3DMaterial",new THREE.MeshNormalMaterial);tQuery.Geometry.prototype.toMesh=function(a){var b=[];this.each(function(c){a=a||tQuery.defaultObject3DMaterial;c=new THREE.Mesh(c,a);b.push(c)});return new tQuery.Mesh(b)};tQuery.register("createCube",function(){return this._createMesh(THREE.CubeGeometry,[1,1,1],arguments)});
tQuery.register("createTorus",function(){return this._createMesh(THREE.TorusGeometry,[0.35,0.15],arguments)});tQuery.register("createSphere",function(){return this._createMesh(THREE.SphereGeometry,[0.5,32,16],arguments)});tQuery.register("createPlane",function(){return this._createMesh(THREE.PlaneGeometry,[1,1,16,16],arguments)});tQuery.register("createCylinder",function(){return this._createMesh(THREE.CylinderGeometry,[0.5,0.5,1,16,4],arguments)});
tQuery.register("_createMesh",function(a,b,c){var c=Array.prototype.slice.call(c),d=tQuery.defaultObject3DMaterial;c.length&&c[c.length-1]instanceof THREE.Material&&(d=c.pop());0===c.length&&(c=b.slice());c.unshift(a);a=function(a,b,c,d,i,j,k,l,m){console.assert(9>=arguments.length);return new a(b,c,d,i,j,k,l,m)}.apply(this,c);a.dynamic=!0;d=new THREE.Mesh(a,d);return tQuery(d)});tQuery.register("createAxis",function(){var a=new THREE.AxisHelper;a.scale.multiplyScalar(0.025);return tQuery(a)});
tQuery.AmbientLight=function(a){tQuery.AmbientLight.parent.constructor.call(this,a);this._lists.forEach(function(a){console.assert(a instanceof THREE.AmbientLight)})};tQuery.inherit(tQuery.AmbientLight,tQuery.Light);tQuery.pluginsInstanceOn(tQuery.AmbientLight);tQuery.DirectionalLight=function(a){tQuery.DirectionalLight.parent.constructor.call(this,a);this._lists.forEach(function(a){console.assert(a instanceof THREE.DirectionalLight)})};tQuery.inherit(tQuery.DirectionalLight,tQuery.Light);tQuery.pluginsInstanceOn(tQuery.DirectionalLight);
tQuery.mixinAttributes(tQuery.DirectionalLight,{intensity:tQuery.convert.toNumber,distance:tQuery.convert.toNumber});tQuery.PointLight=function(a){tQuery.PointLight.parent.constructor.call(this,a);this._lists.forEach(function(a){console.assert(a instanceof THREE.PointLight)})};tQuery.inherit(tQuery.PointLight,tQuery.Light);tQuery.pluginsInstanceOn(tQuery.PointLight);tQuery.mixinAttributes(tQuery.PointLight,{intensity:tQuery.convert.toNumber,distance:tQuery.convert.toNumber});
(function(){var a=function(a){this._loop=a||tQuery.world.loop();this._controls=new THREEx.DragPanControls(tQuery.world.camera());this._$onRender=this._onRender.bind(this);this._loop.hookPreRender(this._$onRender)};a.prototype.destroy=function(){this._loop.unhookPreRender(this._$onRender)};a.prototype._onRender=function(){this._controls.update()};tQuery.register("DragPanControls",a);tQuery.register("createDragPanControls",function(a){return new tQuery.DragPanControls(a)})})();
(function(){tQuery.Geometry.register("computeAll",function(){this.each(function(a){a.computeBoundingBox();a.computeCentroids();a.computeFaceNormals();a.computeVertexNormals()});return this});tQuery.Geometry.register("scaleBy",function(a){"number"===typeof a&&1===arguments.length?a=new THREE.Vector3(a,a,a):"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Geometry.vector3 parameter error");this.each(function(b){for(var c=
0;c<b.vertices.length;c++)b.vertices[c].position.multiplySelf(a);b.__dirtyVertices=!0;b.computeBoundingBox()});return this});tQuery.Geometry.register("size",function(){console.assert(1>=this.length);if(0!==this.length){var a=this.get(0),b=new THREE.Vector3;b.x=a.boundingBox.max.x-a.boundingBox.min.x;b.y=a.boundingBox.max.y-a.boundingBox.min.y;b.z=a.boundingBox.max.z-a.boundingBox.min.z;return b}});tQuery.Geometry.register("normalize",function(){this.each(function(a){var a=tQuery(a),b=a.size();b.x>=
b.y&&b.x>=b.z?a.zoom(1/b.x):b.y>=b.x&&b.y>=b.z?a.zoom(1/b.y):a.zoom(1/b.z)});return this});tQuery.Geometry.register("middlePoint",function(){console.assert(1>=this.length);if(0!==this.length){var a=this.get(0),b=new THREE.Vector3;b.x=(a.boundingBox.max.x+a.boundingBox.min.x)/2;b.y=(a.boundingBox.max.y+a.boundingBox.min.y)/2;b.z=(a.boundingBox.max.z+a.boundingBox.min.z)/2;return b}});tQuery.Geometry.register("translate",function(a){"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],
arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Geometry.translate parameter error");this.each(function(b){for(var c=0;c<b.vertices.length;c++)b.vertices[c].position.addSelf(a);b.__dirtyVertices=!0;b.computeBoundingBox()});return this});tQuery.Geometry.register("rotate",function(a,b){"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Geometry.rotate parameter error");var b=b||"XYZ",
c=new THREE.Matrix4;c.setRotationFromEuler(a,b);this.each(function(a){a.applyMatrix(c);a.__dirtyVertices=!0;a.computeBoundingBox()});return this});tQuery.Geometry.register("center",function(a,b,c){this.each(function(d){var d=tQuery(d),e=d.middlePoint().negate();a&&(e.x=0);b&&(e.y=0);c&&(e.z=0);return d.translate(e)});return this});tQuery.Geometry.register("translateX",function(a){return this.translate(a,0,0)});tQuery.Geometry.register("translateY",function(a){return this.translate(0,a,0)});tQuery.Geometry.register("translateZ",
function(a){return this.translate(0,0,a)});tQuery.Geometry.register("rotateX",function(a){return this.rotate(a,0,0)});tQuery.Geometry.register("rotateY",function(a){return this.rotate(0,a,0)});tQuery.Geometry.register("rotateZ",function(a){return this.rotate(0,0,a)});tQuery.Geometry.register("scaleXBy",function(a){return this.scaleBy(a,1,1)});tQuery.Geometry.register("scaleYBy",function(a){return this.scaleBy(1,a,1)});tQuery.Geometry.register("scaleZBy",function(a){return this.scaleBy(1,1,a)});tQuery.Geometry.register("zoom",
function(a){return this.scaleBy(a)});tQuery.Geometry.register("zoomX",function(a){return this.zoom(a,1,1)});tQuery.Geometry.register("zoomY",function(a){return this.zoom(1,a,1)});tQuery.Geometry.register("zoomZ",function(a){return this.zoom(1,1,a)})})();
(function(){tQuery.Object3D.register("scale",function(a){"number"===typeof a&&1===arguments.length?a=new THREE.Vector3(a,a,a):"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Geometry.scale parameter error");this.each(function(b){b.scale.copy(a)});return this});tQuery.Object3D.register("position",function(a){"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));
console.assert(a instanceof THREE.Vector3,"Object3D.position parameter error");this.each(function(b){b.position.copy(a)});return this});tQuery.Object3D.register("rotation",function(a){"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Object3D.rotation parameter error");this.each(function(b){b.rotation.copy(a)});return this});tQuery.Object3D.register("translate",function(a){"number"===typeof a&&3===arguments.length&&
(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Object3D.translate parameter error");this.each(function(b){b.position.addSelf(a)});return this});tQuery.Object3D.register("rotate",function(a){"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Object3D.rotate parameter error");this.each(function(b){b.rotation.addSelf(a)});return this});tQuery.Object3D.register("scaleBy",
function(a){"number"===typeof a&&1===arguments.length?a=new THREE.Vector3(a,a,a):"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Object3D.rotate parameter error");this.each(function(b){b.scale.multiplySelf(a)});return this});tQuery.Object3D.register("translateX",function(a){return this.translate(a,0,0)});tQuery.Object3D.register("translateY",function(a){return this.translate(0,a,0)});tQuery.Object3D.register("translateZ",
function(a){return this.translate(0,0,a)});tQuery.Object3D.register("rotateX",function(a){return this.rotate(a,0,0)});tQuery.Object3D.register("rotateY",function(a){return this.rotate(0,a,0)});tQuery.Object3D.register("rotateZ",function(a){return this.rotate(0,0,a)});tQuery.Object3D.register("scaleXBy",function(a){return this.scaleBy(a,1,1)});tQuery.Object3D.register("scaleYBy",function(a){return this.scaleBy(1,a,1)});tQuery.Object3D.register("scaleZBy",function(a){return this.scaleBy(1,1,a)});tQuery.Object3D.register("zoom",
function(a){return this.scaleBy(a)});tQuery.Object3D.register("zoomX",function(a){return this.zoom(a,1,1)});tQuery.Object3D.register("zoomY",function(a){return this.zoom(1,a,1)});tQuery.Object3D.register("zoomZ",function(a){return this.zoom(1,1,a)})})();var THREEx=THREEx||{};
THREEx.DomEvent=function(a,b){this._camera=a||null;this._domElement=b||document;this._projector=new THREE.Projector;this._selected=null;this._boundObjs=[];var c=this;this._$onClick=function(){c._onClick.apply(c,arguments)};this._$onDblClick=function(){c._onDblClick.apply(c,arguments)};this._$onMouseMove=function(){c._onMouseMove.apply(c,arguments)};this._$onMouseDown=function(){c._onMouseDown.apply(c,arguments)};this._$onMouseUp=function(){c._onMouseUp.apply(c,arguments)};this._$onTouchMove=function(){c._onTouchMove.apply(c,
arguments)};this._$onTouchStart=function(){c._onTouchStart.apply(c,arguments)};this._$onTouchEnd=function(){c._onTouchEnd.apply(c,arguments)};this._domElement.addEventListener("click",this._$onClick,!1);this._domElement.addEventListener("dblclick",this._$onDblClick,!1);this._domElement.addEventListener("mousemove",this._$onMouseMove,!1);this._domElement.addEventListener("mousedown",this._$onMouseDown,!1);this._domElement.addEventListener("mouseup",this._$onMouseUp,!1);this._domElement.addEventListener("touchmove",
this._$onTouchMove,!1);this._domElement.addEventListener("touchstart",this._$onTouchStart,!1);this._domElement.addEventListener("touchend",this._$onTouchEnd,!1)};
THREEx.DomEvent.prototype.destroy=function(){this._domElement.removeEventListener("click",this._$onClick,!1);this._domElement.removeEventListener("dblclick",this._$onDblClick,!1);this._domElement.removeEventListener("mousemove",this._$onMouseMove,!1);this._domElement.removeEventListener("mousedown",this._$onMouseDown,!1);this._domElement.removeEventListener("mouseup",this._$onMouseUp,!1);this._domElement.removeEventListener("touchmove",this._$onTouchMove,!1);this._domElement.removeEventListener("touchstart",
this._$onTouchStart,!1);this._domElement.removeEventListener("touchend",this._$onTouchEnd,!1)};THREEx.DomEvent.eventNames="click,dblclick,mouseover,mouseout,mousedown,mouseup".split(",");THREEx.DomEvent.prototype._objectCtxInit=function(a){a._3xDomEvent={}};THREEx.DomEvent.prototype._objectCtxDeinit=function(a){delete a._3xDomEvent};THREEx.DomEvent.prototype._objectCtxIsInit=function(a){return a._3xDomEvent?!0:!1};THREEx.DomEvent.prototype._objectCtxGet=function(a){return a._3xDomEvent};
THREEx.DomEvent.prototype.camera=function(a){a&&(this._camera=a);return this._camera};THREEx.DomEvent.prototype.bind=function(a,b,c,d){console.assert(-1!==THREEx.DomEvent.eventNames.indexOf(b),"not available events:"+b);this._objectCtxIsInit(a)||this._objectCtxInit(a);var e=this._objectCtxGet(a);e[b+"Handlers"]||(e[b+"Handlers"]=[]);e[b+"Handlers"].push({callback:c,useCapture:d});this._boundObjs.push(a)};
THREEx.DomEvent.prototype.unbind=function(a,b,c){console.assert(-1!==THREEx.DomEvent.eventNames.indexOf(b),"not available events:"+b);this._objectCtxIsInit(a)||this._objectCtxInit(a);var d=this._objectCtxGet(a);d[b+"Handlers"]||(d[b+"Handlers"]=[]);b=d[b+"Handlers"];for(d=0;d<b.length;d++){var e=b[d];if(c==e.callback&&useCapture==e.useCapture){b.splice(d,1);break}}a=this._boundObjs.indexOf(a);console.assert(-1!==a);this._boundObjs.splice(a,1)};
THREEx.DomEvent.prototype._bound=function(a,b){var c=this._objectCtxGet(b);return!c?!1:c[a+"Handlers"]?!0:!1};
THREEx.DomEvent.prototype._onMove=function(a,b,c){a=new THREE.Vector3(a,b,1);this._projector.unprojectVector(a,this._camera);a=(new THREE.Ray(this._camera.position,a.subSelf(this._camera.position).normalize())).intersectObjects(this._boundObjs);b=this._selected;if(0<a.length){var d=a[0].object;this._selected=d;var e,f;b!=d&&(e=this._bound("mouseover",d),f=b&&this._bound("mouseout",b))}else f=b&&this._bound("mouseout",b),this._selected=null;e&&this._notify("mouseover",d,c);f&&this._notify("mouseout",
b,c)};THREEx.DomEvent.prototype._onEvent=function(a,b,c,d){b=new THREE.Vector3(b,c,1);this._projector.unprojectVector(b,this._camera);b.subSelf(this._camera.position).normalize();b=(new THREE.Ray(this._camera.position,b)).intersectObjects(this._boundObjs);0!==b.length&&(b=b[0].object,this._objectCtxGet(b)&&this._notify(a,b,d))};
THREEx.DomEvent.prototype._notify=function(a,b,c){var d=this._objectCtxGet(b),e=d?d[a+"Handlers"]:null;if(!d||!e||0===e.length)b.parent&&this._notify(a,b.parent);else{e=d[a+"Handlers"];for(d=0;d<e.length;d++){var f=e[d],g=!0;f.callback({type:a,target:b,origDomEvent:c,stopPropagation:function(){g=!1}});g&&!1===f.useCapture&&b.parent&&this._notify(a,b.parent)}}};THREEx.DomEvent.prototype._onMouseDown=function(a){return this._onMouseEvent("mousedown",a)};
THREEx.DomEvent.prototype._onMouseUp=function(a){return this._onMouseEvent("mouseup",a)};THREEx.DomEvent.prototype._onMouseEvent=function(a,b){return this._onEvent(a,2*+(b.clientX/window.innerWidth)-1,2*-(b.clientY/window.innerHeight)+1,b)};THREEx.DomEvent.prototype._onMouseMove=function(a){return this._onMove(2*+(a.clientX/window.innerWidth)-1,2*-(a.clientY/window.innerHeight)+1,a)};THREEx.DomEvent.prototype._onClick=function(a){return this._onMouseEvent("click",a)};
THREEx.DomEvent.prototype._onDblClick=function(a){return this._onMouseEvent("dblclick",a)};THREEx.DomEvent.prototype._onTouchStart=function(a){return this._onTouchEvent("mousedown",a)};THREEx.DomEvent.prototype._onTouchEnd=function(a){return this._onTouchEvent("mouseup",a)};THREEx.DomEvent.prototype._onTouchMove=function(a){if(1==a.touches.length)return a.preventDefault(),this._onMove("mousemove",2*+(a.touches[0].pageX/window.innerWidth)-1,2*-(a.touches[0].pageY/window.innerHeight)+1,a)};
THREEx.DomEvent.prototype._onTouchEvent=function(a,b){if(1==b.touches.length)return b.preventDefault(),this._onEvent(a,2*+(b.touches[0].pageX/window.innerWidth)-1,2*-(b.touches[0].pageY/window.innerHeight)+1,b)}(function(){var a=new THREEx.DomEvent;tQuery.Object3D.register("on",function(b,c){a.camera(tQuery.world.camera());this.each(function(d){a.bind(d,b,c,!1)});return this});tQuery.Object3D.register("off",function(b,c){this.each(function(d){a.unbind(d,b,c,!1)});return this})})();
tQuery.Mesh.register("linkify",function(a){var b=tQuery(this.get(0)),c=b.geometry().computeAll().size(),d=c.y/10,e=c.y/20,f=tQuery.createCube(c.x,d,c.z).translateY(-c.y/2-e-d/2);f.get(0).visible=!1;b.add(f);b.on("click",function(){window.open(a,"_blank")});b.on("mouseover",function(){f.get(0).visible=!0;document.body.style.cursor="pointer"});b.on("mouseout",function(){f.get(0).visible=!1;document.body.style.cursor="default"})});
tQuery.register("createText",function(a,b){var b=tQuery.extend(b,{size:1,height:0.4,curveSegments:4,weight:"bold",font:"droid serif"}),c=new THREE.TextGeometry(a,b);c.computeBoundingBox();var d=new THREE.Vector3;d.x=(c.boundingBox.max.x-c.boundingBox.min.x)/2;d.y=(c.boundingBox.max.y-c.boundingBox.min.y)/2;d.z=(c.boundingBox.max.z-c.boundingBox.min.z)/2;c.vertices.forEach(function(a){a.position.subSelf(d)});var e=new THREE.MeshNormalMaterial,c=new THREE.Mesh(c,e);return tQuery(c)});
