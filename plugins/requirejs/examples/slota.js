/*
 RequireJS 2.0.5 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/
var requirejs,require,define;
(function(Y){function w(b){return I.call(b)==="[object Function]"}function D(b){return I.call(b)==="[object Array]"}function o(b,c){if(b){var d;for(d=0;d<b.length;d+=1)if(b[d]&&c(b[d],d,b))break}}function M(b,c){if(b){var d;for(d=b.length-1;d>-1;d-=1)if(b[d]&&c(b[d],d,b))break}}function x(b,c){for(var d in b)if(b.hasOwnProperty(d)&&c(b[d],d))break}function J(b,c,d,g){c&&x(c,function(c,j){if(d||!E.call(b,j))g&&typeof c!=="string"?(b[j]||(b[j]={}),J(b[j],c,d,g)):b[j]=c});return b}function t(b,c){return function(){return c.apply(b,
arguments)}}function Z(b){if(!b)return b;var c=Y;o(b.split("."),function(b){c=c[b]});return c}function $(b,c,d){return function(){var g=ga.call(arguments,0),f;if(d&&w(f=g[g.length-1]))f.__requireJsBuild=!0;g.push(c);return b.apply(null,g)}}function aa(b,c,d){o([["toUrl"],["undef"],["defined","requireDefined"],["specified","requireSpecified"]],function(g){var f=g[1]||g[0];b[g[0]]=c?$(c[f],d):function(){var b=y[N];return b[f].apply(b,arguments)}})}function F(b,c,d,g){c=Error(c+"\nhttp://requirejs.org/docs/errors.html#"+
b);c.requireType=b;c.requireModules=g;if(d)c.originalError=d;return c}function ha(){if(G&&G.readyState==="interactive")return G;M(document.getElementsByTagName("script"),function(b){if(b.readyState==="interactive")return G=b});return G}var j,p,u,A,s,B,G,H,ba,ca,ia=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,ja=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,da=/\.js$/,ka=/^\.\//;p=Object.prototype;var I=p.toString,E=p.hasOwnProperty;p=Array.prototype;var ga=p.slice,la=p.splice,v=!!(typeof window!==
"undefined"&&navigator&&document),ea=!v&&typeof importScripts!=="undefined",ma=v&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,N="_",R=typeof opera!=="undefined"&&opera.toString()==="[object Opera]",y={},r={},O=[],K=!1;if(typeof define==="undefined"){if(typeof requirejs!=="undefined"){if(w(requirejs))return;r=requirejs;requirejs=void 0}typeof require!=="undefined"&&!w(require)&&(r=require,require=void 0);j=requirejs=function(b,c,d,g){var f,o=N;!D(b)&&typeof b!=="string"&&
(f=b,D(c)?(b=c,c=d,d=g):b=[]);if(f&&f.context)o=f.context;(g=y[o])||(g=y[o]=j.s.newContext(o));f&&g.configure(f);return g.require(b,c,d)};j.config=function(b){return j(b)};require||(require=j);j.version="2.0.5";j.jsExtRegExp=/^\/|:|\?|\.js$/;j.isBrowser=v;p=j.s={contexts:y,newContext:function(b){function c(a,e,k){var m,b,n,c,f,d,h,g=e&&e.split("/");m=g;var j=l.map,i=j&&j["*"];if(a&&a.charAt(0)===".")if(e){m=l.pkgs[e]?g=[e]:g.slice(0,g.length-1);e=a=m.concat(a.split("/"));for(m=0;e[m];m+=1)if(b=e[m],
b===".")e.splice(m,1),m-=1;else if(b==="..")if(m===1&&(e[2]===".."||e[0]===".."))break;else m>0&&(e.splice(m-1,2),m-=2);m=l.pkgs[e=a[0]];a=a.join("/");m&&a===e+"/"+m.main&&(a=e)}else a.indexOf("./")===0&&(a=a.substring(2));if(k&&(g||i)&&j){e=a.split("/");for(m=e.length;m>0;m-=1){n=e.slice(0,m).join("/");if(g)for(b=g.length;b>0;b-=1)if(k=j[g.slice(0,b).join("/")])if(k=k[n]){c=k;f=m;break}if(c)break;!d&&i&&i[n]&&(d=i[n],h=m)}!c&&d&&(c=d,f=h);c&&(e.splice(0,f,c),a=e.join("/"))}return a}function d(a){v&&
o(document.getElementsByTagName("script"),function(e){if(e.getAttribute("data-requiremodule")===a&&e.getAttribute("data-requirecontext")===h.contextName)return e.parentNode.removeChild(e),!0})}function g(a){var e=l.paths[a];if(e&&D(e)&&e.length>1)return d(a),e.shift(),h.undef(a),h.require([a]),!0}function f(a,e,k,m){var b,n,f=a?a.indexOf("!"):-1,d=null,g=e?e.name:null,j=a,l=!0,i="";a||(l=!1,a="_@r"+(M+=1));f!==-1&&(d=a.substring(0,f),a=a.substring(f+1,a.length));d&&(d=c(d,g,m),n=q[d]);a&&(d?i=n&&
n.normalize?n.normalize(a,function(a){return c(a,g,m)}):c(a,g,m):(i=c(a,g,m),b=h.nameToUrl(i)));a=d&&!n&&!k?"_unnormalized"+(N+=1):"";return{prefix:d,name:i,parentMap:e,unnormalized:!!a,url:b,originalName:j,isDefine:l,id:(d?d+"!"+i:i)+a}}function p(a){var e=a.id,k=i[e];k||(k=i[e]=new h.Module(a));return k}function r(a,e,k){var b=a.id,c=i[b];if(E.call(q,b)&&(!c||c.defineEmitComplete))e==="defined"&&k(q[b]);else p(a).on(e,k)}function z(a,e){var k=a.requireModules,b=!1;if(e)e(a);else if(o(k,function(e){if(e=
i[e])e.error=a,e.events.error&&(b=!0,e.emit("error",a))}),!b)j.onError(a)}function s(){O.length&&(la.apply(C,[C.length-1,0].concat(O)),O=[])}function u(a,e,k){a=a&&a.map;e=$(k||h.require,a,e);aa(e,h,a);e.isBrowser=v;return e}function y(a){delete i[a];o(L,function(e,k){if(e.map.id===a)return L.splice(k,1),e.defined||(h.waitCount-=1),!0})}function A(a,e){var k=a.map.id,b=a.depMaps,c;if(a.inited){if(e[k])return a;e[k]=!0;o(b,function(a){if(a=i[a.id])return!a.inited||!a.enabled?(c=null,delete e[k],!0):
c=A(a,J({},e))});return c}}function B(a,e,k){var b=a.map.id,c=a.depMaps;if(a.inited&&a.map.isDefine){if(e[b])return q[b];e[b]=a;o(c,function(c){var c=c.id,d=i[c];!P[c]&&d&&(!d.inited||!d.enabled?k[b]=!0:(d=B(d,e,k),k[c]||a.defineDepById(c,d)))});a.check(!0);return q[b]}}function H(a){a.check()}function S(){var a,e,b,c,f=(b=l.waitSeconds*1E3)&&h.startTime+b<(new Date).getTime(),n=[],j=!1,fa=!0;if(!T){T=!0;x(i,function(b){a=b.map;e=a.id;if(b.enabled&&!b.error)if(!b.inited&&f)g(e)?j=c=!0:(n.push(e),
d(e));else if(!b.inited&&b.fetched&&a.isDefine&&(j=!0,!a.prefix))return fa=!1});if(f&&n.length)return b=F("timeout","Load timeout for modules: "+n,null,n),b.contextName=h.contextName,z(b);fa&&(o(L,function(a){if(!a.defined){var a=A(a,{}),e={};a&&(B(a,e,{}),x(e,H))}}),x(i,H));if((!f||c)&&j)if((v||ea)&&!U)U=setTimeout(function(){U=0;S()},50);T=!1}}function V(a){p(f(a[0],null,!0)).init(a[1],a[2])}function I(a){var a=a.currentTarget||a.srcElement,e=h.onScriptLoad;a.detachEvent&&!R?a.detachEvent("onreadystatechange",
e):a.removeEventListener("load",e,!1);e=h.onScriptError;a.detachEvent&&!R||a.removeEventListener("error",e,!1);return{node:a,id:a&&a.getAttribute("data-requiremodule")}}var T,W,h,P,U,l={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{}},i={},X={},C=[],q={},Q={},M=1,N=1,L=[];P={require:function(a){return u(a)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports=q[a.map.id]={}},module:function(a){return a.module={id:a.map.id,uri:a.map.url,config:function(){return l.config&&l.config[a.map.id]||
{}},exports:q[a.map.id]}}};W=function(a){this.events=X[a.id]||{};this.map=a;this.shim=l.shim[a.id];this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};W.prototype={init:function(a,e,b,c){c=c||{};if(!this.inited){this.factory=e;if(b)this.on("error",b);else this.events.error&&(b=t(this,function(a){this.emit("error",a)}));this.depMaps=a&&a.slice(0);this.depMaps.rjsSkipMap=a.rjsSkipMap;this.errback=b;this.inited=!0;this.ignore=c.ignore;c.enabled||this.enabled?this.enable():
this.check()}},defineDepById:function(a,e){var b;o(this.depMaps,function(e,c){if(e.id===a)return b=c,!0});return this.defineDep(b,e)},defineDep:function(a,e){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=e)},fetch:function(){if(!this.fetched){this.fetched=!0;h.startTime=(new Date).getTime();var a=this.map;if(this.shim)u(this,!0)(this.shim.deps||[],t(this,function(){return a.prefix?this.callPlugin():this.load()}));else return a.prefix?this.callPlugin():this.load()}},
load:function(){var a=this.map.url;Q[a]||(Q[a]=!0,h.load(this.map.id,a))},check:function(a){if(this.enabled&&!this.enabling){var e,b,c=this.map.id;b=this.depExports;var d=this.exports,n=this.factory;if(this.inited)if(this.error)this.emit("error",this.error);else{if(!this.defining){this.defining=!0;if(this.depCount<1&&!this.defined){if(w(n)){if(this.events.error)try{d=h.execCb(c,n,b,d)}catch(f){e=f}else d=h.execCb(c,n,b,d);if(this.map.isDefine)if((b=this.module)&&b.exports!==void 0&&b.exports!==this.exports)d=
b.exports;else if(d===void 0&&this.usingExports)d=this.exports;if(e)return e.requireMap=this.map,e.requireModules=[this.map.id],e.requireType="define",z(this.error=e)}else d=n;this.exports=d;if(this.map.isDefine&&!this.ignore&&(q[c]=d,j.onResourceLoad))j.onResourceLoad(h,this.map,this.depMaps);delete i[c];this.defined=!0;h.waitCount-=1;h.waitCount===0&&(L=[])}this.defining=!1;if(!a&&this.defined&&!this.defineEmitted)this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0}}else this.fetch()}},
callPlugin:function(){var a=this.map,e=a.id,b=f(a.prefix,null,!1,!0);r(b,"defined",t(this,function(b){var d;d=this.map.name;var k=this.map.parentMap?this.map.parentMap.name:null;if(this.map.unnormalized){if(b.normalize&&(d=b.normalize(d,function(a){return c(a,k,!0)})||""),b=f(a.prefix+"!"+d,this.map.parentMap,!1,!0),r(b,"defined",t(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),b=i[b.id]){if(this.events.error)b.on("error",t(this,function(a){this.emit("error",a)}));
b.enable()}}else d=t(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),d.error=t(this,function(a){this.inited=!0;this.error=a;a.requireModules=[e];x(i,function(a){a.map.id.indexOf(e+"_unnormalized")===0&&y(a.map.id)});z(a)}),d.fromText=function(a,b){var e=K;e&&(K=!1);p(f(a));j.exec(b);e&&(K=!0);h.completeLoad(a)},b.load(a.name,u(a.parentMap,!0,function(a,b,e){a.rjsSkipMap=!0;return h.require(a,b,e)}),d,l)}));h.enable(b,this);this.pluginMaps[b.id]=b},enable:function(){this.enabled=
!0;if(!this.waitPushed)L.push(this),h.waitCount+=1,this.waitPushed=!0;this.enabling=!0;o(this.depMaps,t(this,function(a,b){var c,d;if(typeof a==="string"){a=f(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.depMaps.rjsSkipMap);this.depMaps[b]=a;if(c=P[a.id]){this.depExports[b]=c(this);return}this.depCount+=1;r(a,"defined",t(this,function(a){this.defineDep(b,a);this.check()}));this.errback&&r(a,"error",this.errback)}c=a.id;d=i[c];!P[c]&&d&&!d.enabled&&h.enable(a,this)}));x(this.pluginMaps,
t(this,function(a){var b=i[a.id];b&&!b.enabled&&h.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]);c.push(b)},emit:function(a,b){o(this.events[a],function(a){a(b)});a==="error"&&delete this.events[a]}};return h={config:l,contextName:b,registry:i,defined:q,urlFetched:Q,waitCount:0,defQueue:C,Module:W,makeModuleMap:f,configure:function(a){a.baseUrl&&a.baseUrl.charAt(a.baseUrl.length-1)!=="/"&&(a.baseUrl+="/");var b=l.pkgs,c=l.shim,d=l.paths,
g=l.map;J(l,a,!0);l.paths=J(d,a.paths,!0);if(a.map)l.map=J(g||{},a.map,!0,!0);if(a.shim)x(a.shim,function(a,b){D(a)&&(a={deps:a});if(a.exports&&!a.exports.__buildReady)a.exports=h.makeShimExports(a.exports);c[b]=a}),l.shim=c;if(a.packages)o(a.packages,function(a){a=typeof a==="string"?{name:a}:a;b[a.name]={name:a.name,location:a.location||a.name,main:(a.main||"main").replace(ka,"").replace(da,"")}}),l.pkgs=b;x(i,function(a,b){if(!a.inited&&!a.map.unnormalized)a.map=f(b)});if(a.deps||a.callback)h.require(a.deps||
[],a.callback)},makeShimExports:function(a){var b;return typeof a==="string"?(b=function(){return Z(a)},b.exports=a,b):function(){return a.apply(Y,arguments)}},requireDefined:function(a,b){var c=f(a,b,!1,!0).id;return E.call(q,c)},requireSpecified:function(a,b){a=f(a,b,!1,!0).id;return E.call(q,a)||E.call(i,a)},require:function(a,e,c,d){var g;if(typeof a==="string"){if(w(e))return z(F("requireargs","Invalid require call"),c);if(j.get)return j.get(h,a,e);a=f(a,e,!1,!0);a=a.id;return!E.call(q,a)?z(F("notloaded",
'Module name "'+a+'" has not been loaded yet for context: '+b)):q[a]}c&&!w(c)&&(d=c,c=void 0);e&&!w(e)&&(d=e,e=void 0);for(s();C.length;)if(g=C.shift(),g[0]===null)return z(F("mismatch","Mismatched anonymous define() module: "+g[g.length-1]));else V(g);p(f(null,d)).init(a,e,c,{enabled:!0});S();return h.require},undef:function(a){s();var b=f(a,null,!0),c=i[a];delete q[a];delete Q[b.url];delete X[a];if(c){if(c.events.defined)X[a]=c.events;y(a)}},enable:function(a){i[a.id]&&p(a).enable()},completeLoad:function(a){var b,
c,d=l.shim[a]||{},f=d.exports&&d.exports.exports;for(s();C.length;){c=C.shift();if(c[0]===null){c[0]=a;if(b)break;b=!0}else c[0]===a&&(b=!0);V(c)}c=i[a];if(!b&&!q[a]&&c&&!c.inited)if(l.enforceDefine&&(!f||!Z(f)))if(g(a))return;else return z(F("nodefine","No define call for "+a,null,[a]));else V([a,d.deps||[],d.exports]);S()},toUrl:function(a,b){var d=a.lastIndexOf("."),f=null;d!==-1&&(f=a.substring(d,a.length),a=a.substring(0,d));return h.nameToUrl(c(a,b&&b.id,!0),f)},nameToUrl:function(a,b){var c,
d,f,g,h,i;if(j.jsExtRegExp.test(a))g=a+(b||"");else{c=l.paths;d=l.pkgs;g=a.split("/");for(h=g.length;h>0;h-=1)if(i=g.slice(0,h).join("/"),f=d[i],i=c[i]){D(i)&&(i=i[0]);g.splice(0,h,i);break}else if(f){c=a===f.name?f.location+"/"+f.main:f.location;g.splice(0,h,c);break}g=g.join("/");g+=b||(/\?/.test(g)?"":".js");g=(g.charAt(0)==="/"||g.match(/^[\w\+\.\-]+:/)?"":l.baseUrl)+g}return l.urlArgs?g+((g.indexOf("?")===-1?"?":"&")+l.urlArgs):g},load:function(a,b){j.load(h,a,b)},execCb:function(a,b,c,d){return b.apply(d,
c)},onScriptLoad:function(a){if(a.type==="load"||ma.test((a.currentTarget||a.srcElement).readyState))G=null,a=I(a),h.completeLoad(a.id)},onScriptError:function(a){var b=I(a);if(!g(b.id))return z(F("scripterror","Script error",a,[b.id]))}}}};j({});aa(j);if(v&&(u=p.head=document.getElementsByTagName("head")[0],A=document.getElementsByTagName("base")[0]))u=p.head=A.parentNode;j.onError=function(b){throw b;};j.load=function(b,c,d){var g=b&&b.config||{},f;if(v)return f=g.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml",
"html:script"):document.createElement("script"),f.type=g.scriptType||"text/javascript",f.charset="utf-8",f.async=!0,f.setAttribute("data-requirecontext",b.contextName),f.setAttribute("data-requiremodule",c),f.attachEvent&&!(f.attachEvent.toString&&f.attachEvent.toString().indexOf("[native code")<0)&&!R?(K=!0,f.attachEvent("onreadystatechange",b.onScriptLoad)):(f.addEventListener("load",b.onScriptLoad,!1),f.addEventListener("error",b.onScriptError,!1)),f.src=d,H=f,A?u.insertBefore(f,A):u.appendChild(f),
H=null,f;else ea&&(importScripts(d),b.completeLoad(c))};v&&M(document.getElementsByTagName("script"),function(b){if(!u)u=b.parentNode;if(s=b.getAttribute("data-main")){if(!r.baseUrl)B=s.split("/"),ba=B.pop(),ca=B.length?B.join("/")+"/":"./",r.baseUrl=ca,s=ba;s=s.replace(da,"");r.deps=r.deps?r.deps.concat(s):[s];return!0}});define=function(b,c,d){var g,f;typeof b!=="string"&&(d=c,c=b,b=null);D(c)||(d=c,c=[]);!c.length&&w(d)&&d.length&&(d.toString().replace(ia,"").replace(ja,function(b,d){c.push(d)}),
c=(d.length===1?["require"]:["require","exports","module"]).concat(c));if(K&&(g=H||ha()))b||(b=g.getAttribute("data-requiremodule")),f=y[g.getAttribute("data-requirecontext")];(f?f.defQueue:O).push([b,c,d])};define.amd={jQuery:!0};j.exec=function(b){return eval(b)};j(r)}})(this);
// tquery.js - https://github.com/jeromeetienne/tquery - MIT License
// vim: ts=4 sts=4 sw=4 expandtab
// -- kriskowal Kris Kowal Copyright (C) 2009-2011 MIT License
// -- tlrobinson Tom Robinson Copyright (C) 2009-2010 MIT License (Narwhal Project)
// -- dantman Daniel Friesen Copyright (C) 2010 XXX TODO License or CLA
// -- fschaefer Florian Schäfer Copyright (C) 2010 MIT License
// -- Gozala Irakli Gozalishvili Copyright (C) 2010 MIT License
// -- kitcambridge Kit Cambridge Copyright (C) 2011 MIT License
// -- kossnocorp Sasha Koss XXX TODO License or CLA
// -- bryanforbes Bryan Forbes XXX TODO License or CLA
// -- killdream Quildreen Motta Copyright (C) 2011 MIT Licence
// -- michaelficarra Michael Ficarra Copyright (C) 2011 3-clause BSD License
// -- sharkbrainguy Gerard Paapu Copyright (C) 2011 MIT License
// -- bbqsrc Brendan Molloy (C) 2011 Creative Commons Zero (public domain)
// -- iwyg XXX TODO License or CLA
// -- DomenicDenicola Domenic Denicola Copyright (C) 2011 MIT License
// -- xavierm02 Montillet Xavier Copyright (C) 2011 MIT License
// -- Raynos Jake Verbaten Copyright (C) 2011 MIT Licence
// -- samsonjs Sami Samhuri Copyright (C) 2010 MIT License
// -- rwldrn Rick Waldron Copyright (C) 2011 MIT License
// -- lexer Alexey Zakharov XXX TODO License or CLA

/*!
    Copyright (c) 2009, 280 North Inc. http://280north.com/
    MIT License. http://github.com/280north/narwhal/blob/master/README.md
*/

(function(e){typeof define=="function"?define("../../../build/tquery-bundle",[],e):e()})(function(){function h(e){try{return Object.defineProperty(e,"sentinel",{}),"sentinel"in e}catch(t){}}Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if(typeof n!="function")throw new TypeError("Function.prototype.bind called on incompatible "+n);var i=r.call(arguments,1),s=function(){if(this instanceof s){var e=function(){};e.prototype=n.prototype;var o=new e,u=n.apply(o,i.concat(r.call(arguments)));return Object(u)===u?u:o}return n.apply(t,i.concat(r.call(arguments)))};return s});var e=Function.prototype.call,t=Array.prototype,n=Object.prototype,r=t.slice,i=e.bind(n.toString),s=e.bind(n.hasOwnProperty),o,u,a,f,l;if(l=s(n,"__defineGetter__"))o=e.bind(n.__defineGetter__),u=e.bind(n.__defineSetter__),a=e.bind(n.__lookupGetter__),f=e.bind(n.__lookupSetter__);Array.isArray||(Array.isArray=function(t){return i(t)=="[object Array]"}),Array.prototype.forEach||(Array.prototype.forEach=function(t){var n=A(this),r=arguments[1],s=-1,o=n.length>>>0;if(i(t)!="[object Function]")throw new TypeError;while(++s<o)s in n&&t.call(r,n[s],s,n)}),Array.prototype.map||(Array.prototype.map=function(t){var n=A(this),r=n.length>>>0,s=Array(r),o=arguments[1];if(i(t)!="[object Function]")throw new TypeError(t+" is not a function");for(var u=0;u<r;u++)u in n&&(s[u]=t.call(o,n[u],u,n));return s}),Array.prototype.filter||(Array.prototype.filter=function(t){var n=A(this),r=n.length>>>0,s=[],o,u=arguments[1];if(i(t)!="[object Function]")throw new TypeError(t+" is not a function");for(var a=0;a<r;a++)a in n&&(o=n[a],t.call(u,o,a,n)&&s.push(o));return s}),Array.prototype.every||(Array.prototype.every=function(t){var n=A(this),r=n.length>>>0,s=arguments[1];if(i(t)!="[object Function]")throw new TypeError(t+" is not a function");for(var o=0;o<r;o++)if(o in n&&!t.call(s,n[o],o,n))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t){var n=A(this),r=n.length>>>0,s=arguments[1];if(i(t)!="[object Function]")throw new TypeError(t+" is not a function");for(var o=0;o<r;o++)if(o in n&&t.call(s,n[o],o,n))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var n=A(this),r=n.length>>>0;if(i(t)!="[object Function]")throw new TypeError(t+" is not a function");if(!r&&arguments.length==1)throw new TypeError("reduce of empty array with no initial value");var s=0,o;if(arguments.length>=2)o=arguments[1];else do{if(s in n){o=n[s++];break}if(++s>=r)throw new TypeError("reduce of empty array with no initial value")}while(!0);for(;s<r;s++)s in n&&(o=t.call(void 0,o,n[s],s,n));return o}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(t){var n=A(this),r=n.length>>>0;if(i(t)!="[object Function]")throw new TypeError(t+" is not a function");if(!r&&arguments.length==1)throw new TypeError("reduceRight of empty array with no initial value");var s,o=r-1;if(arguments.length>=2)s=arguments[1];else do{if(o in n){s=n[o--];break}if(--o<0)throw new TypeError("reduceRight of empty array with no initial value")}while(!0);do o in this&&(s=t.call(void 0,s,n[o],o,n));while(o--);return s}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var n=A(this),r=n.length>>>0;if(!r)return-1;var i=0;arguments.length>1&&(i=k(arguments[1])),i=i>=0?i:Math.max(0,r+i);for(;i<r;i++)if(i in n&&n[i]===t)return i;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(t){var n=A(this),r=n.length>>>0;if(!r)return-1;var i=r-1;arguments.length>1&&(i=Math.min(i,k(arguments[1]))),i=i>=0?i:r-Math.abs(i);for(;i>=0;i--)if(i in n&&t===n[i])return i;return-1}),Object.getPrototypeOf||(Object.getPrototypeOf=function(t){return t.__proto__||(t.constructor?t.constructor.prototype:n)});if(!Object.getOwnPropertyDescriptor){var c="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function(t,r){if(typeof t!="object"&&typeof t!="function"||t===null)throw new TypeError(c+t);if(!s(t,r))return;var i={enumerable:!0,configurable:!0};if(l){var o=t.__proto__;t.__proto__=n;var u=a(t,r),h=f(t,r);t.__proto__=o;if(u||h)return u&&(i.get=u),h&&(i.set=h),i}return i.value=t[r],i}}Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(t){return Object.keys(t)}),Object.create||(Object.create=function(t,n){var r;if(t===null)r={__proto__:null};else{if(typeof t!="object")throw new TypeError("typeof prototype["+typeof t+"] != 'object'");var i=function(){};i.prototype=t,r=new i,r.__proto__=t}return n!==void 0&&Object.defineProperties(r,n),r});if(Object.defineProperty){var p=h({}),d=typeof document=="undefined"||h(document.createElement("div"));if(!p||!d)var v=Object.defineProperty}if(!Object.defineProperty||v){var m="Property description must be an object: ",g="Object.defineProperty called on non-object: ",y="getters & setters can not be defined on this javascript engine";Object.defineProperty=function(t,r,i){if(typeof t!="object"&&typeof t!="function"||t===null)throw new TypeError(g+t);if(typeof i!="object"&&typeof i!="function"||i===null)throw new TypeError(m+i);if(v)try{return v.call(Object,t,r,i)}catch(c){}if(s(i,"value"))if(l&&(a(t,r)||f(t,r))){var h=t.__proto__;t.__proto__=n,delete t[r],t[r]=i.value,t.__proto__=h}else t[r]=i.value;else{if(!l)throw new TypeError(y);s(i,"get")&&o(t,r,i.get),s(i,"set")&&u(t,r,i.set)}return t}}Object.defineProperties||(Object.defineProperties=function(t,n){for(var r in n)s(n,r)&&r!="__proto__"&&Object.defineProperty(t,r,n[r]);return t}),Object.seal||(Object.seal=function(t){return t}),Object.freeze||(Object.freeze=function(t){return t});try{Object.freeze(function(){})}catch(b){Object.freeze=function(t){return function(n){return typeof n=="function"?n:t(n)}}(Object.freeze)}Object.preventExtensions||(Object.preventExtensions=function(t){return t}),Object.isSealed||(Object.isSealed=function(t){return!1}),Object.isFrozen||(Object.isFrozen=function(t){return!1}),Object.isExtensible||(Object.isExtensible=function(t){if(Object(t)!==t)throw new TypeError;var n="";while(s(t,n))n+="?";t[n]=!0;var r=s(t,n);return delete t[n],r});if(!Object.keys){var w=!0,E=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],S=E.length;for(var x in{toString:null})w=!1;Object.keys=function O(e){if(typeof e!="object"&&typeof e!="function"||e===null)throw new TypeError("Object.keys called on a non-object");var O=[];for(var t in e)s(e,t)&&O.push(t);if(w)for(var n=0,r=S;n<r;n++){var i=E[n];s(e,i)&&O.push(i)}return O}}if(!Date.prototype.toISOString||(new Date(-621987552e5)).toISOString().indexOf("-000001")===-1)Date.prototype.toISOString=function(){var t,n,r,i;if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");t=[this.getUTCMonth()+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],i=this.getUTCFullYear(),i=(i<0?"-":i>9999?"+":"")+("00000"+Math.abs(i)).slice(0<=i&&i<=9999?-4:-6),n=t.length;while(n--)r=t[n],r<10&&(t[n]="0"+r);return i+"-"+t.slice(0,2).join("-")+"T"+t.slice(2).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+"Z"};Date.now||(Date.now=function(){return(new Date).getTime()}),Date.prototype.toJSON||(Date.prototype.toJSON=function(t){if(typeof this.toISOString!="function")throw new TypeError("toISOString property is not callable");return this.toISOString()});if(!Date.parse||Date.parse("+275760-09-13T00:00:00.000Z")!==864e13)Date=function(e){var t=function i(t,n,r,s,o,u,a){var f=arguments.length;if(this instanceof e){var l=f==1&&String(t)===t?new e(i.parse(t)):f>=7?new e(t,n,r,s,o,u,a):f>=6?new e(t,n,r,s,o,u):f>=5?new e(t,n,r,s,o):f>=4?new e(t,n,r,s):f>=3?new e(t,n,r):f>=2?new e(t,n):f>=1?new e(t):new e;return l.constructor=i,l}return e.apply(this,arguments)},n=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(?:Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$");for(var r in e)t[r]=e[r];return t.now=e.now,t.UTC=e.UTC,t.prototype=e.prototype,t.prototype.constructor=t,t.parse=function(r){var i=n.exec(r);if(i){i.shift();for(var s=1;s<7;s++)i[s]=+(i[s]||(s<3?1:0)),s==1&&i[s]--;var o=+i.pop(),u=+i.pop(),a=i.pop(),f=0;if(a){if(u>23||o>59)return NaN;f=(u*60+o)*6e4*(a=="+"?-1:1)}var l=+i[0];return 0<=l&&l<=99?(i[0]=l+400,e.UTC.apply(this,i)+f-126227808e5):e.UTC.apply(this,i)+f}return e.parse.apply(this,arguments)},t}(Date);var T="	\n\f\r   ᠎             　\u2028\u2029﻿";if(!String.prototype.trim||T.trim()){T="["+T+"]";var N=new RegExp("^"+T+T+"*"),C=new RegExp(T+T+"*$");String.prototype.trim=function(){if(this===undefined||this===null)throw new TypeError("can't convert "+this+" to object");return String(this).replace(N,"").replace(C,"")}}var k=function(e){return e=+e,e!==e?e=0:e!==0&&e!==1/0&&e!==-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e},L="a"[0]!="a",A=function(e){if(e==null)throw new TypeError("can't convert "+e+" to object");return L&&typeof e=="string"&&e?e.split(""):Object(e)}});var THREE=THREE||{REVISION:"49"};self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array),function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=Date.now(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),THREE.Clock=function(e){this.autoStart=e!==void 0?e:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},THREE.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now(),this.running=!0},THREE.Clock.prototype.stop=function(){this.getElapsedTime(),this.running=!1},THREE.Clock.prototype.getElapsedTime=function(){return this.elapsedTime=this.elapsedTime+this.getDelta()},THREE.Clock.prototype.getDelta=function(){var e=0;this.autoStart&&!this.running&&this.start();if(this.running){var t=Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime=this.elapsedTime+e}return e},THREE.Color=function(e){return e!==void 0&&this.setHex(e),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSV:function(e,t,n){var r,i,s;if(n===0)this.r=this.g=this.b=0;else{r=Math.floor(e*6),i=e*6-r,e=n*(1-t),s=n*(1-t*i),t=n*(1-t*(1-i));switch(r){case 1:this.r=s,this.g=n,this.b=e;break;case 2:this.r=e,this.g=n,this.b=t;break;case 3:this.r=e,this.g=s,this.b=n;break;case 4:this.r=t,this.g=e,this.b=n;break;case 5:this.r=n,this.g=e,this.b=s;break;case 6:case 0:this.r=n,this.g=t,this.b=e}}return this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},lerpSelf:function(e,t){return this.r=this.r+(e.r-this.r)*t,this.g=this.g+(e.g-this.g)*t,this.b=this.b+(e.b-this.b)*t,this},getHex:function(){return Math.floor(this.r*255)<<16^Math.floor(this.g*255)<<8^Math.floor(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this.z=this.z+e.z,this},addScalar:function(e){return this.x=this.x+e,this.y=this.y+e,this.z=this.z+e,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this.z=this.z-e.z,this},multiply:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},multiplySelf:function(e){return this.x=this.x*e.x,this.y=this.y*e.y,this.z=this.z*e.z,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this},divideSelf:function(e){return this.x=this.x/e.x,this.y=this.y/e.y,this.z=this.z/e.z,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e,this.z=this.z/e):this.z=this.y=this.x=0,this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this.z=this.z+(e.z-this.z)*t,this},cross:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},crossSelf:function(e){var t=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-n*e.x,this},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){return(new THREE.Vector3).sub(this,e).lengthSq()},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},getRotationFromMatrix:function(e,t){var n=t?t.x:1,r=t?t.y:1,i=t?t.z:1,s=e.elements[0]/n,o=e.elements[4]/r,n=e.elements[1]/n,r=e.elements[5]/r,u=e.elements[9]/i,a=e.elements[10]/i;return this.y=Math.asin(e.elements[8]/i),i=Math.cos(this.y),Math.abs(i)>1e-5?(this.x=Math.atan2(-u/i,a/i),this.z=Math.atan2(-o/i,s/i)):(this.x=0,this.z=Math.atan2(n,r)),this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),e=this.set(e.elements[8],e.elements[9],e.elements[10]).length();this.x=t,this.y=n,this.z=e},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.Vector4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=r!==void 0?r:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this.z=this.z+e.z,this.w=this.w+e.w,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this.z=this.z-e.z,this.w=this.w-e.w,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e,this.z=this.z/e,this.w=this.w/e):(this.z=this.y=this.x=0,this.w=1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this.z=this.z+(e.z-this.z)*t,this.w=this.w+(e.w-this.w)*t,this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Frustum=function(){this.planes=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4]},THREE.Frustum.prototype.setFromMatrix=function(e){var t,n=this.planes,r=e.elements,e=r[0];t=r[1];var i=r[2],s=r[3],o=r[4],u=r[5],a=r[6],f=r[7],l=r[8],c=r[9],h=r[10],p=r[11],d=r[12],v=r[13],m=r[14],r=r[15];n[0].set(s-e,f-o,p-l,r-d),n[1].set(s+e,f+o,p+l,r+d),n[2].set(s+t,f+u,p+c,r+v),n[3].set(s-t,f-u,p-c,r-v),n[4].set(s-i,f-a,p-h,r-m),n[5].set(s+i,f+a,p+h,r+m);for(e=0;e<6;e++)t=n[e],t.divideScalar(Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z))},THREE.Frustum.prototype.contains=function(e){for(var t=this.planes,n=e.matrixWorld,r=n.elements,n=-e.geometry.boundingSphere.radius*n.getMaxScaleOnAxis(),i=0;i<6;i++){e=t[i].x*r[12]+t[i].y*r[13]+t[i].z*r[14]+t[i].w;if(e<=n)return!1}return!0},THREE.Frustum.__v1=new THREE.Vector3,THREE.Ray=function(e,t){function n(e,t,n){return d.sub(n,e),g=d.dot(t),y=v.add(e,m.copy(t).multiplyScalar(g)),b=n.distanceTo(y)}function r(e,t,n,r){return d.sub(r,t),v.sub(n,t),m.sub(e,t),w=d.dot(d),E=d.dot(v),S=d.dot(m),x=v.dot(v),T=v.dot(m),N=1/(w*x-E*E),C=(x*S-E*T)*N,k=(w*T-E*S)*N,C>=0&&k>=0&&C+k<1}this.origin=e||new THREE.Vector3,this.direction=t||new THREE.Vector3;var i=1e-4;this.setPrecision=function(e){i=e};var s=new THREE.Vector3,o=new THREE.Vector3,u=new THREE.Vector3,a=new THREE.Vector3,f=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector3;this.intersectObject=function(e){var t,d=[];if(e instanceof THREE.Particle){var v=n(this.origin,this.direction,e.matrixWorld.getPosition());if(v>e.scale.x)return[];t={distance:v,point:e.position,face:null,object:e},d.push(t)}else if(e instanceof THREE.Mesh){var v=n(this.origin,this.direction,e.matrixWorld.getPosition()),m=THREE.Frustum.__v1.set(e.matrixWorld.getColumnX().length(),e.matrixWorld.getColumnY().length(),e.matrixWorld.getColumnZ().length());if(v>e.geometry.boundingSphere.radius*Math.max(m.x,Math.max(m.y,m.z)))return d;var g,y,b=e.geometry,w=b.vertices,E;e.matrixRotationWorld.extractRotation(e.matrixWorld),v=0;for(m=b.faces.length;v<m;v++){t=b.faces[v],f.copy(this.origin),l.copy(this.direction),E=e.matrixWorld,c=E.multiplyVector3(c.copy(t.centroid)).subSelf(f),h=e.matrixRotationWorld.multiplyVector3(h.copy(t.normal)),g=l.dot(h);if(!(Math.abs(g)<i)){y=h.dot(c)/g;if(!(y<0)&&(e.doubleSided||(e.flipSided?g>0:g<0))){p.add(f,l.multiplyScalar(y));if(t instanceof THREE.Face3)s=E.multiplyVector3(s.copy(w[t.a])),o=E.multiplyVector3(o.copy(w[t.b])),u=E.multiplyVector3(u.copy(w[t.c])),r(p,s,o,u)&&(t={distance:f.distanceTo(p),point:p.clone(),face:t,object:e},d.push(t));else if(t instanceof THREE.Face4){s=E.multiplyVector3(s.copy(w[t.a])),o=E.multiplyVector3(o.copy(w[t.b])),u=E.multiplyVector3(u.copy(w[t.c])),a=E.multiplyVector3(a.copy(w[t.d]));if(r(p,s,o,a)||r(p,o,u,a))t={distance:f.distanceTo(p),point:p.clone(),face:t,object:e},d.push(t)}}}}}return d},this.intersectObjects=function(e){for(var t=[],n=0,r=e.length;n<r;n++)Array.prototype.push.apply(t,this.intersectObject(e[n]));return t.sort(function(e,t){return e.distance-t.distance}),t};var d=new THREE.Vector3,v=new THREE.Vector3,m=new THREE.Vector3,g,y,b,w,E,S,x,T,N,C,k},THREE.Rectangle=function(){function e(){s=r-t,o=i-n}var t,n,r,i,s,o,u=!0;this.getX=function(){return t},this.getY=function(){return n},this.getWidth=function(){return s},this.getHeight=function(){return o},this.getLeft=function(){return t},this.getTop=function(){return n},this.getRight=function(){return r},this.getBottom=function(){return i},this.set=function(s,o,f,l){u=!1,t=s,n=o,r=f,i=l,e()},this.addPoint=function(s,o){u?(u=!1,t=s,n=o,r=s,i=o):(t=t<s?t:s,n=n<o?n:o,r=r>s?r:s,i=i>o?i:o),e()},this.add3Points=function(s,o,f,l,p,v){u?(u=!1,t=s<f?s<p?s:p:f<p?f:p,n=o<l?o<v?o:v:l<v?l:v,r=s>f?s>p?s:p:f>p?f:p,i=o>l?o>v?o:v:l>v?l:v):(t=s<f?s<p?s<t?s:t:p<t?p:t:f<p?f<t?f:t:p<t?p:t,n=o<l?o<v?o<n?o:n:v<n?v:n:l<v?l<n?l:n:v<n?v:n,r=s>f?s>p?s>r?s:r:p>r?p:r:f>p?f>r?f:r:p>r?p:r,i=o>l?o>v?o>i?o:i:v>i?v:i:l>v?l>i?l:i:v>i?v:i),e()},this.addRectangle=function(s){u?(u=!1,t=s.getLeft(),n=s.getTop(),r=s.getRight(),i=s.getBottom()):(t=t<s.getLeft()?t:s.getLeft(),n=n<s.getTop()?n:s.getTop(),r=r>s.getRight()?r:s.getRight(),i=i>s.getBottom()?i:s.getBottom()),e()},this.inflate=function(s){t-=s,n-=s,r+=s,i+=s,e()},this.minSelf=function(s){t=t>s.getLeft()?t:s.getLeft(),n=n>s.getTop()?n:s.getTop(),r=r<s.getRight()?r:s.getRight(),i=i<s.getBottom()?i:s.getBottom(),e()},this.intersects=function(e){return r<e.getLeft()||t>e.getRight()||i<e.getTop()||n>e.getBottom()?!1:!0},this.empty=function(){u=!0,i=r=n=t=0,e()},this.isEmpty=function(){return u}},THREE.Math={clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0}},THREE.Matrix3=function(){this.elements=new Float32Array(9)},THREE.Matrix3.prototype={constructor:THREE.Matrix3,getInverse:function(e){var t=e.elements,e=t[10]*t[5]-t[6]*t[9],n=-t[10]*t[1]+t[2]*t[9],r=t[6]*t[1]-t[2]*t[5],i=-t[10]*t[4]+t[6]*t[8],s=t[10]*t[0]-t[2]*t[8],o=-t[6]*t[0]+t[2]*t[4],u=t[9]*t[4]-t[5]*t[8],a=-t[9]*t[0]+t[1]*t[8],f=t[5]*t[0]-t[1]*t[4],t=t[0]*e+t[1]*i+t[2]*u;t===0&&console.warn("Matrix3.getInverse(): determinant == 0");var t=1/t,l=this.elements;return l[0]=t*e,l[1]=t*n,l[2]=t*r,l[3]=t*i,l[4]=t*s,l[5]=t*o,l[6]=t*u,l[7]=t*a,l[8]=t*f,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},transposeIntoArray:function(e){var t=this.m;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},THREE.Matrix4=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){this.elements=new Float32Array(16),this.set(e!==void 0?e:1,t||0,n||0,r||0,i||0,s!==void 0?s:1,o||0,u||0,a||0,f||0,l!==void 0?l:1,c||0,h||0,p||0,d||0,v!==void 0?v:1)},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=s,m[9]=o,m[13]=u,m[2]=a,m[6]=f,m[10]=l,m[14]=c,m[3]=h,m[7]=p,m[11]=d,m[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this},lookAt:function(e,t,n){var r=this.elements,i=THREE.Matrix4.__v1,s=THREE.Matrix4.__v2,o=THREE.Matrix4.__v3;return o.sub(e,t).normalize(),o.length()===0&&(o.z=1),i.cross(n,o).normalize(),i.length()===0&&(o.x=o.x+1e-4,i.cross(n,o).normalize()),s.cross(o,i),r[0]=i.x,r[4]=s.x,r[8]=o.x,r[1]=i.y,r[5]=s.y,r[9]=o.y,r[2]=i.z,r[6]=s.z,r[10]=o.z,this},multiply:function(e,t){var n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[4],u=n[8],a=n[12],f=n[1],l=n[5],c=n[9],h=n[13],p=n[2],d=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],n=n[15],w=r[0],E=r[4],S=r[8],x=r[12],T=r[1],N=r[5],C=r[9],k=r[13],L=r[2],A=r[6],O=r[10],M=r[14],_=r[3],D=r[7],P=r[11],r=r[15];return i[0]=s*w+o*T+u*L+a*_,i[4]=s*E+o*N+u*A+a*D,i[8]=s*S+o*C+u*O+a*P,i[12]=s*x+o*k+u*M+a*r,i[1]=f*w+l*T+c*L+h*_,i[5]=f*E+l*N+c*A+h*D,i[9]=f*S+l*C+c*O+h*P,i[13]=f*x+l*k+c*M+h*r,i[2]=p*w+d*T+v*L+m*_,i[6]=p*E+d*N+v*A+m*D,i[10]=p*S+d*C+v*O+m*P,i[14]=p*x+d*k+v*M+m*r,i[3]=g*w+y*T+b*L+n*_,i[7]=g*E+y*N+b*A+n*D,i[11]=g*S+y*C+b*O+n*P,i[15]=g*x+y*k+b*M+n*r,this},multiplySelf:function(e){return this.multiply(this,e)},multiplyToArray:function(e,t,n){var r=this.elements;return this.multiply(e,t),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]=t[0]*e,t[4]=t[4]*e,t[8]=t[8]*e,t[12]=t[12]*e,t[1]=t[1]*e,t[5]=t[5]*e,t[9]=t[9]*e,t[13]=t[13]*e,t[2]=t[2]*e,t[6]=t[6]*e,t[10]=t[10]*e,t[14]=t[14]*e,t[3]=t[3]*e,t[7]=t[7]*e,t[11]=t[11]*e,t[15]=t[15]*e,this},multiplyVector3:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=1/(t[3]*n+t[7]*r+t[11]*i+t[15]);return e.x=(t[0]*n+t[4]*r+t[8]*i+t[12])*s,e.y=(t[1]*n+t[5]*r+t[9]*i+t[13])*s,e.z=(t[2]*n+t[6]*r+t[10]*i+t[14])*s,e},multiplyVector4:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w;return e.x=t[0]*n+t[4]*r+t[8]*i+t[12]*s,e.y=t[1]*n+t[5]*r+t[9]*i+t[13]*s,e.z=t[2]*n+t[6]*r+t[10]*i+t[14]*s,e.w=t[3]*n+t[7]*r+t[11]*i+t[15]*s,e},rotateAxis:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return e.x=n*t[0]+r*t[4]+i*t[8],e.y=n*t[1]+r*t[5]+i*t[9],e.z=n*t[2]+r*t[6]+i*t[10],e.normalize(),e},crossVector:function(e){var t=this.elements,n=new THREE.Vector4;return n.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w,n.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w,n.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w,n.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1,n},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],o=e[5],u=e[9],a=e[13],f=e[2],l=e[6],c=e[10],h=e[14],p=e[3],d=e[7],v=e[11],e=e[15];return i*u*l*p-r*a*l*p-i*o*c*p+n*a*c*p+r*o*h*p-n*u*h*p-i*u*f*d+r*a*f*d+i*s*c*d-t*a*c*d-r*s*h*d+t*u*h*d+i*o*f*v-n*a*f*v-i*s*l*v+t*a*l*v+n*s*h*v-t*o*h*v-r*o*f*e+n*u*f*e+r*s*l*e-t*u*l*e-n*s*c*e+t*o*c*e},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[12],e[13],e[14])},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getColumnX:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[0],e[1],e[2])},getColumnY:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[4],e[5],e[6])},getColumnZ:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[8],e[9],e[10])},getInverse:function(e){var t=this.elements,n=e.elements,r=n[0],i=n[4],s=n[8],o=n[12],u=n[1],a=n[5],f=n[9],l=n[13],c=n[2],h=n[6],p=n[10],d=n[14],v=n[3],m=n[7],g=n[11],n=n[15];return t[0]=f*d*m-l*p*m+l*h*g-a*d*g-f*h*n+a*p*n,t[4]=o*p*m-s*d*m-o*h*g+i*d*g+s*h*n-i*p*n,t[8]=s*l*m-o*f*m+o*a*g-i*l*g-s*a*n+i*f*n,t[12]=o*f*h-s*l*h-o*a*p+i*l*p+s*a*d-i*f*d,t[1]=l*p*v-f*d*v-l*c*g+u*d*g+f*c*n-u*p*n,t[5]=s*d*v-o*p*v+o*c*g-r*d*g-s*c*n+r*p*n,t[9]=o*f*v-s*l*v-o*u*g+r*l*g+s*u*n-r*f*n,t[13]=s*l*c-o*f*c+o*u*p-r*l*p-s*u*d+r*f*d,t[2]=a*d*v-l*h*v+l*c*m-u*d*m-a*c*n+u*h*n,t[6]=o*h*v-i*d*v-o*c*m+r*d*m+i*c*n-r*h*n,t[10]=i*l*v-o*a*v+o*u*m-r*l*m-i*u*n+r*a*n,t[14]=o*a*c-i*l*c-o*u*h+r*l*h+i*u*d-r*a*d,t[3]=f*h*v-a*p*v-f*c*m+u*p*m+a*c*g-u*h*g,t[7]=i*p*v-s*h*v+s*c*m-r*p*m-i*c*g+r*h*g,t[11]=s*a*v-i*f*v-s*u*m+r*f*m+i*u*g-r*a*g,t[15]=i*f*c-s*a*c+s*u*h-r*f*h-i*u*p+r*a*p,this.multiplyScalar(1/e.determinant()),this},setRotationFromEuler:function(e,t){var n=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),r=Math.sin(r),u=Math.cos(i),i=Math.sin(i),a=Math.cos(s),s=Math.sin(s);switch(t){case"YXZ":var f=u*a,l=u*s,c=i*a,h=i*s;n[0]=f+h*r,n[4]=c*r-l,n[8]=o*i,n[1]=o*s,n[5]=o*a,n[9]=-r,n[2]=l*r-c,n[6]=h+f*r,n[10]=o*u;break;case"ZXY":f=u*a,l=u*s,c=i*a,h=i*s,n[0]=f-h*r,n[4]=-o*s,n[8]=c+l*r,n[1]=l+c*r,n[5]=o*a,n[9]=h-f*r,n[2]=-o*i,n[6]=r,n[10]=o*u;break;case"ZYX":f=o*a,l=o*s,c=r*a,h=r*s,n[0]=u*a,n[4]=c*i-l,n[8]=f*i+h,n[1]=u*s,n[5]=h*i+f,n[9]=l*i-c,n[2]=-i,n[6]=r*u,n[10]=o*u;break;case"YZX":f=o*u,l=o*i,c=r*u,h=r*i,n[0]=u*a,n[4]=h-f*s,n[8]=c*s+l,n[1]=s,n[5]=o*a,n[9]=-r*a,n[2]=-i*a,n[6]=l*s+c,n[10]=f-h*s;break;case"XZY":f=o*u,l=o*i,c=r*u,h=r*i,n[0]=u*a,n[4]=-s,n[8]=i*a,n[1]=f*s+h,n[5]=o*a,n[9]=l*s-c,n[2]=c*s-l,n[6]=r*a,n[10]=h*s+f;break;default:f=o*a,l=o*s,c=r*a,h=r*s,n[0]=u*a,n[4]=-u*s,n[8]=i,n[1]=l+c*i,n[5]=f-h*i,n[9]=-r*u,n[2]=h-f*i,n[6]=c+l*i,n[10]=o*u}return this},setRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w,o=n+n,u=r+r,a=i+i,e=n*o,f=n*u,n=n*a,l=r*u,r=r*a,i=i*a,o=s*o,u=s*u,s=s*a;return t[0]=1-(l+i),t[4]=f-s,t[8]=n+u,t[1]=f+s,t[5]=1-(e+i),t[9]=r-o,t[2]=n-u,t[6]=r+o,t[10]=1-(e+l),this},compose:function(e,t,n){var r=this.elements,i=THREE.Matrix4.__m1,s=THREE.Matrix4.__m2;return i.identity(),i.setRotationFromQuaternion(t),s.makeScale(n.x,n.y,n.z),this.multiply(i,s),r[12]=e.x,r[13]=e.y,r[14]=e.z,this},decompose:function(e,t,n){var r=this.elements,i=THREE.Matrix4.__v1,s=THREE.Matrix4.__v2,o=THREE.Matrix4.__v3;return i.set(r[0],r[1],r[2]),s.set(r[4],r[5],r[6]),o.set(r[8],r[9],r[10]),e=e instanceof THREE.Vector3?e:new THREE.Vector3,t=t instanceof THREE.Quaternion?t:new THREE.Quaternion,n=n instanceof THREE.Vector3?n:new THREE.Vector3,n.x=i.length(),n.y=s.length(),n.z=o.length(),e.x=r[12],e.y=r[13],e.z=r[14],r=THREE.Matrix4.__m1,r.copy(this),r.elements[0]=r.elements[0]/n.x,r.elements[1]=r.elements[1]/n.x,r.elements[2]=r.elements[2]/n.x,r.elements[4]=r.elements[4]/n.y,r.elements[5]=r.elements[5]/n.y,r.elements[6]=r.elements[6]/n.y,r.elements[8]=r.elements[8]/n.z,r.elements[9]=r.elements[9]/n.z,r.elements[10]=r.elements[10]/n.z,t.setFromRotationMatrix(r),[e,t,n]},extractPosition:function(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractRotation:function(e){var t=this.elements,e=e.elements,n=THREE.Matrix4.__v1,r=1/n.set(e[0],e[1],e[2]).length(),i=1/n.set(e[4],e[5],e[6]).length(),n=1/n.set(e[8],e[9],e[10]).length();return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,this},translate:function(e){var t=this.elements,n=e.x,r=e.y,e=e.z;return t[12]=t[0]*n+t[4]*r+t[8]*e+t[12],t[13]=t[1]*n+t[5]*r+t[9]*e+t[13],t[14]=t[2]*n+t[6]*r+t[10]*e+t[14],t[15]=t[3]*n+t[7]*r+t[11]*e+t[15],this},rotateX:function(e){var t=this.elements,n=t[4],r=t[5],i=t[6],s=t[7],o=t[8],u=t[9],a=t[10],f=t[11],l=Math.cos(e),e=Math.sin(e);return t[4]=l*n+e*o,t[5]=l*r+e*u,t[6]=l*i+e*a,t[7]=l*s+e*f,t[8]=l*o-e*n,t[9]=l*u-e*r,t[10]=l*a-e*i,t[11]=l*f-e*s,this},rotateY:function(e){var t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[8],u=t[9],a=t[10],f=t[11],l=Math.cos(e),e=Math.sin(e);return t[0]=l*n-e*o,t[1]=l*r-e*u,t[2]=l*i-e*a,t[3]=l*s-e*f,t[8]=l*o+e*n,t[9]=l*u+e*r,t[10]=l*a+e*i,t[11]=l*f+e*s,this},rotateZ:function(e){var t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=Math.cos(e),e=Math.sin(e);return t[0]=l*n+e*o,t[1]=l*r+e*u,t[2]=l*i+e*a,t[3]=l*s+e*f,t[4]=l*o-e*n,t[5]=l*u-e*r,t[6]=l*a-e*i,t[7]=l*f-e*s,this},rotateByAxis:function(e,t){var n=this.elements;if(e.x===1&&e.y===0&&e.z===0)return this.rotateX(t);if(e.x===0&&e.y===1&&e.z===0)return this.rotateY(t);if(e.x===0&&e.y===0&&e.z===1)return this.rotateZ(t);var r=e.x,i=e.y,s=e.z,o=Math.sqrt(r*r+i*i+s*s),r=r/o,i=i/o,s=s/o,o=r*r,u=i*i,a=s*s,f=Math.cos(t),l=Math.sin(t),c=1-f,h=r*i*c,p=r*s*c,c=i*s*c,r=r*l,d=i*l,l=s*l,s=o+(1-o)*f,o=h+l,i=p-d,h=h-l,u=u+(1-u)*f,l=c+r,p=p+d,c=c-r,a=a+(1-a)*f,f=n[0],r=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8],E=n[9],S=n[10],x=n[11];return n[0]=s*f+o*m+i*w,n[1]=s*r+o*g+i*E,n[2]=s*d+o*y+i*S,n[3]=s*v+o*b+i*x,n[4]=h*f+u*m+l*w,n[5]=h*r+u*g+l*E,n[6]=h*d+u*y+l*S,n[7]=h*v+u*b+l*x,n[8]=p*f+c*m+a*w,n[9]=p*r+c*g+a*E,n[10]=p*d+c*y+a*S,n[11]=p*v+c*b+a*x,this},scale:function(e){var t=this.elements,n=e.x,r=e.y,e=e.z;return t[0]=t[0]*n,t[4]=t[4]*r,t[8]=t[8]*e,t[1]=t[1]*n,t[5]=t[5]*r,t[9]=t[9]*e,t[2]=t[2]*n,t[6]=t[6]*r,t[10]=t[10]*e,t[3]=t[3]*n,t[7]=t[7]*r,t[11]=t[11]*e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,o=e.y,u=e.z,a=i*s,f=i*o;return this.set(a*s+n,a*o-r*u,a*u+r*o,0,a*o+r*u,f*o+n,f*u-r*s,0,a*u-r*o,f*u+r*s,i*u*u+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeFrustum:function(e,t,n,r,i,s){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(r-n),o[9]=(r+n)/(r-n),o[13]=0,o[2]=0,o[6]=0,o[10]=-(s+i)/(s-i),o[14]=-2*s*i/(s-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,n,r){var e=n*Math.tan(e*Math.PI/360),i=-e;return this.makeFrustum(i*t,e*t,i,e,n,r)},makeOrthographic:function(e,t,n,r,i,s){var o=this.elements,u=t-e,a=n-r,f=s-i;return o[0]=2/u,o[4]=0,o[8]=0,o[12]=-((t+e)/u),o[1]=0,o[5]=2/a,o[9]=0,o[13]=-((n+r)/a),o[2]=0,o[6]=0,o[10]=-2/f,o[14]=-((s+i)/f),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},THREE.Matrix4.__v1=new THREE.Vector3,THREE.Matrix4.__v2=new THREE.Vector3,THREE.Matrix4.__v3=new THREE.Vector3,THREE.Matrix4.__m1=new THREE.Matrix4,THREE.Matrix4.__m2=new THREE.Matrix4,THREE.Object3D=function(){this.id=THREE.Object3DCount++,this.name="",this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.eulerOrder="XYZ",this.scale=new THREE.Vector3(1,1,1),this.flipSided=this.doubleSided=!1,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixRotationWorld=new THREE.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this._vector=new THREE.Vector3},THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(e){this.matrix.multiply(e,this.matrix),this.scale.getScaleFromMatrix(this.matrix),this.rotation.getRotationFromMatrix(this.matrix,this.scale),this.position.getPositionFromMatrix(this.matrix)},translate:function(e,t){this.matrix.rotateAxis(t),this.position.addSelf(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&this.rotation.getRotationFromMatrix(this.matrix)},add:function(e){if(e===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(e instanceof THREE.Object3D){e.parent!==void 0&&e.parent.remove(e),e.parent=this,this.children.push(e);for(var t=this;t.parent!==void 0;)t=t.parent;t!==void 0&&t instanceof THREE.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(t!==-1){e.parent=void 0,this.children.splice(t,1);for(t=this;t.parent!==void 0;)t=t.parent;t!==void 0&&t instanceof THREE.Scene&&t.__removeObject(e)}},getChildByName:function(e,t){var n,r,i;n=0;for(r=this.children.length;n<r;n++){i=this.children[n];if(i.name===e)return i;if(t){i=i.getChildByName(e,t);if(i!==void 0)return i}}},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z));this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)}},THREE.Object3DCount=0,THREE.Projector=function(){function e(){var e=o[s]=o[s]||new THREE.RenderableObject;return s++,e}function t(){var e=f[a]=f[a]||new THREE.RenderableVertex;return a++,e}function n(e,t){return t.z-e.z}function r(e,t){var n=0,r=1,i=e.z+e.w,s=t.z+t.w,o=-e.z+e.w,u=-t.z+t.w;return i>=0&&s>=0&&o>=0&&u>=0?!0:i<0&&s<0||o<0&&u<0?!1:(i<0?n=Math.max(n,i/(i-s)):s<0&&(r=Math.min(r,i/(i-s))),o<0?n=Math.max(n,o/(o-u)):u<0&&(r=Math.min(r,o/(o-u))),r<n?!1:(e.lerpSelf(t,n),t.lerpSelf(e,1-r),!0))}var i,s,o=[],u,a,f=[],l,c,h=[],p,d=[],v,m,g=[],y,b,w=[],E={objects:[],sprites:[],lights:[],elements:[]},S=new THREE.Vector3,x=new THREE.Vector4,T=new THREE.Matrix4,N=new THREE.Matrix4,C=new THREE.Frustum,k=new THREE.Vector4,L=new THREE.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),T.multiply(t.projectionMatrix,t.matrixWorldInverse),T.multiplyVector3(e),e},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),T.multiply(t.matrixWorld,t.projectionMatrixInverse),T.multiplyVector3(e),e},this.pickingRay=function(e,t){var n;return e.z=-1,n=new THREE.Vector3(e.x,e.y,1),this.unprojectVector(e,t),this.unprojectVector(n,t),n.subSelf(e).normalize(),new THREE.Ray(e,n)},this.projectGraph=function(t,r){s=0,E.objects.length=0,E.sprites.length=0,E.lights.length=0;var o=function(t){if(t.visible!==!1){(t instanceof THREE.Mesh||t instanceof THREE.Line)&&(t.frustumCulled===!1||C.contains(t))?(S.copy(t.matrixWorld.getPosition()),T.multiplyVector3(S),i=e(),i.object=t,i.z=S.z,E.objects.push(i)):t instanceof THREE.Sprite||t instanceof THREE.Particle?(S.copy(t.matrixWorld.getPosition()),T.multiplyVector3(S),i=e(),i.object=t,i.z=S.z,E.sprites.push(i)):t instanceof THREE.Light&&E.lights.push(t);for(var n=0,r=t.children.length;n<r;n++)o(t.children[n])}};return o(t),r&&E.objects.sort(n),E},this.projectScene=function(e,i,s){var o=i.near,S=i.far,O=!1,M,_,D,P,H,B,F,I,R,U,W,X,V,$,Q;b=m=p=c=0,E.elements.length=0,i.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),e.add(i)),e.updateMatrixWorld(),i.matrixWorldInverse.getInverse(i.matrixWorld),T.multiply(i.projectionMatrix,i.matrixWorldInverse),C.setFromMatrix(T),E=this.projectGraph(e,!1),e=0;for(M=E.objects.length;e<M;e++){R=E.objects[e].object,U=R.matrixWorld,a=0;if(R instanceof THREE.Mesh){W=R.geometry,X=R.geometry.materials,P=W.vertices,V=W.faces,$=W.faceVertexUvs,W=R.matrixRotationWorld.extractRotation(U),_=0;for(D=P.length;_<D;_++)u=t(),u.positionWorld.copy(P[_]),U.multiplyVector3(u.positionWorld),u.positionScreen.copy(u.positionWorld),T.multiplyVector4(u.positionScreen),u.positionScreen.x=u.positionScreen.x/u.positionScreen.w,u.positionScreen.y=u.positionScreen.y/u.positionScreen.w,u.visible=u.positionScreen.z>o&&u.positionScreen.z<S;P=0;for(_=V.length;P<_;P++){D=V[P];if(D instanceof THREE.Face3){H=f[D.a],B=f[D.b],F=f[D.c];if(!(H.visible&&B.visible&&F.visible))continue;O=(F.positionScreen.x-H.positionScreen.x)*(B.positionScreen.y-H.positionScreen.y)-(F.positionScreen.y-H.positionScreen.y)*(B.positionScreen.x-H.positionScreen.x)<0;if(!R.doubleSided&&O==R.flipSided)continue;I=h[c]=h[c]||new THREE.RenderableFace3,c++,l=I,l.v1.copy(H),l.v2.copy(B),l.v3.copy(F)}else if(D instanceof THREE.Face4){H=f[D.a],B=f[D.b],F=f[D.c],I=f[D.d];if(!(H.visible&&B.visible&&F.visible&&I.visible))continue;O=(I.positionScreen.x-H.positionScreen.x)*(B.positionScreen.y-H.positionScreen.y)-(I.positionScreen.y-H.positionScreen.y)*(B.positionScreen.x-H.positionScreen.x)<0||(B.positionScreen.x-F.positionScreen.x)*(I.positionScreen.y-F.positionScreen.y)-(B.positionScreen.y-F.positionScreen.y)*(I.positionScreen.x-F.positionScreen.x)<0;if(!R.doubleSided&&O==R.flipSided)continue;Q=d[p]=d[p]||new THREE.RenderableFace4,p++,l=Q,l.v1.copy(H),l.v2.copy(B),l.v3.copy(F),l.v4.copy(I)}l.normalWorld.copy(D.normal),!O&&(R.flipSided||R.doubleSided)&&l.normalWorld.negate(),W.multiplyVector3(l.normalWorld),l.centroidWorld.copy(D.centroid),U.multiplyVector3(l.centroidWorld),l.centroidScreen.copy(l.centroidWorld),T.multiplyVector3(l.centroidScreen),F=D.vertexNormals,H=0;for(B=F.length;H<B;H++)I=l.vertexNormalsWorld[H],I.copy(F[H]),!O&&(R.flipSided||R.doubleSided)&&I.negate(),W.multiplyVector3(I);H=0;for(B=$.length;H<B;H++)if(Q=$[H][P]){F=0;for(I=Q.length;F<I;F++)l.uvs[H][F]=Q[F]}l.material=R.material,l.faceMaterial=D.materialIndex!==null?X[D.materialIndex]:null,l.z=l.centroidScreen.z,E.elements.push(l)}}else if(R instanceof THREE.Line){N.multiply(T,U),P=R.geometry.vertices,H=t(),H.positionScreen.copy(P[0]),N.multiplyVector4(H.positionScreen),U=R.type===THREE.LinePieces?2:1,_=1;for(D=P.length;_<D;_++)H=t(),H.positionScreen.copy(P[_]),N.multiplyVector4(H.positionScreen),(_+1)%U>0||(B=f[a-2],k.copy(H.positionScreen),L.copy(B.positionScreen),r(k,L)&&(k.multiplyScalar(1/k.w),L.multiplyScalar(1/L.w),X=g[m]=g[m]||new THREE.RenderableLine,m++,v=X,v.v1.positionScreen.copy(k),v.v2.positionScreen.copy(L),v.z=Math.max(k.z,L.z),v.material=R.material,E.elements.push(v)))}}e=0;for(M=E.sprites.length;e<M;e++)R=E.sprites[e].object,U=R.matrixWorld,R instanceof THREE.Particle&&(x.set(U.elements[12],U.elements[13],U.elements[14],1),T.multiplyVector4(x),x.z=x.z/x.w,x.z>0&&x.z<1&&(o=w[b]=w[b]||new THREE.RenderableParticle,b++,y=o,y.x=x.x/x.w,y.y=x.y/x.w,y.z=x.z,y.rotation=R.rotation.z,y.scale.x=R.scale.x*Math.abs(y.x-(x.x+i.projectionMatrix.elements[0])/(x.w+i.projectionMatrix.elements[12])),y.scale.y=R.scale.y*Math.abs(y.y-(x.y+i.projectionMatrix.elements[5])/(x.w+i.projectionMatrix.elements[13])),y.material=R.material,E.elements.push(y)));return s&&E.elements.sort(n),E}},THREE.Quaternion=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=r!==void 0?r:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e){var t=Math.PI/360,n=e.x*t,r=e.y*t,i=e.z*t,e=Math.cos(r),r=Math.sin(r),t=Math.cos(-i),i=Math.sin(-i),s=Math.cos(n),n=Math.sin(n),o=e*t,u=r*i;return this.w=o*s-u*n,this.x=o*n+u*s,this.y=r*t*s+e*i*n,this.z=e*i*s-r*t*n,this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this},setFromRotationMatrix:function(e){var t=Math.pow(e.determinant(),1/3);return this.w=Math.sqrt(Math.max(0,t+e.elements[0]+e.elements[5]+e.elements[10]))/2,this.x=Math.sqrt(Math.max(0,t+e.elements[0]-e.elements[5]-e.elements[10]))/2,this.y=Math.sqrt(Math.max(0,t-e.elements[0]+e.elements[5]-e.elements[10]))/2,this.z=Math.sqrt(Math.max(0,t-e.elements[0]-e.elements[5]+e.elements[10]))/2,this.x=e.elements[6]-e.elements[9]<0?-Math.abs(this.x):Math.abs(this.x),this.y=e.elements[8]-e.elements[2]<0?-Math.abs(this.y):Math.abs(this.y),this.z=e.elements[1]-e.elements[4]<0?-Math.abs(this.z):Math.abs(this.z),this.normalize(),this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x=this.x*-1,this.y=this.y*-1,this.z=this.z*-1,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?this.w=this.z=this.y=this.x=0:(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},multiply:function(e,t){return this.x=e.x*t.w+e.y*t.z-e.z*t.y+e.w*t.x,this.y=-e.x*t.z+e.y*t.w+e.z*t.x+e.w*t.y,this.z=e.x*t.y-e.y*t.x+e.z*t.w+e.w*t.z,this.w=-e.x*t.x-e.y*t.y-e.z*t.z+e.w*t.w,this},multiplySelf:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,s=e.x,o=e.y,u=e.z,e=e.w;return this.x=t*e+i*s+n*u-r*o,this.y=n*e+i*o+r*s-t*u,this.z=r*e+i*u+t*o-n*s,this.w=i*e-t*s-n*o-r*u,this},multiplyVector3:function(e,t){t||(t=e);var n=e.x,r=e.y,i=e.z,s=this.x,o=this.y,u=this.z,a=this.w,f=a*n+o*i-u*r,l=a*r+u*n-s*i,c=a*i+s*r-o*n,n=-s*n-o*r-u*i;return t.x=f*a+n*-s+l*-u-c*-o,t.y=l*a+n*-o+c*-s-f*-u,t.z=c*a+n*-u+f*-o-l*-s,t},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)}},THREE.Quaternion.slerp=function(e,t,n,r){var i=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;i<0?(n.w=-t.w,n.x=-t.x,n.y=-t.y,n.z=-t.z,i=-i):n.copy(t);if(Math.abs(i)>=1)return n.w=e.w,n.x=e.x,n.y=e.y,n.z=e.z,n;var s=Math.acos(i),i=Math.sqrt(1-i*i);return Math.abs(i)<.001?(n.w=.5*(e.w+t.w),n.x=.5*(e.x+t.x),n.y=.5*(e.y+t.y),n.z=.5*(e.z+t.z),n):(t=Math.sin((1-r)*s)/i,r=Math.sin(r*s)/i,n.w=e.w*t+n.w*r,n.x=e.x*t+n.x*r,n.y=e.y*t+n.y*r,n.z=e.z*t+n.z*r,n)},THREE.Vertex=function(){console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.")},THREE.Face3=function(e,t,n,r,i,s){this.a=e,this.b=t,this.c=n,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=i instanceof THREE.Color?i:new THREE.Color,this.vertexColors=i instanceof Array?i:[],this.vertexTangents=[],this.materialIndex=s,this.centroid=new THREE.Vector3},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,n;t=0;for(n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();t=0;for(n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();t=0;for(n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Face4=function(e,t,n,r,i,s,o){this.a=e,this.b=t,this.c=n,this.d=r,this.normal=i instanceof THREE.Vector3?i:new THREE.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=s instanceof THREE.Color?s:new THREE.Color,this.vertexColors=s instanceof Array?s:[],this.vertexTangents=[],this.materialIndex=o,this.centroid=new THREE.Vector3},THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var e=new THREE.Face4(this.a,this.b,this.c,this.d);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,n;t=0;for(n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();t=0;for(n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();t=0;for(n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.UV=function(e,t){this.u=e||0,this.v=t||0},THREE.UV.prototype={constructor:THREE.UV,set:function(e,t){return this.u=e,this.v=t,this},copy:function(e){return this.u=e.u,this.v=e.v,this},lerpSelf:function(e,t){return this.u=this.u+(e.u-this.u)*t,this.v=this.v+(e.v-this.v)*t,this},clone:function(){return new THREE.UV(this.u,this.v)}},THREE.Geometry=function(){this.id=THREE.GeometryCount++,this.vertices=[],this.colors=[],this.materials=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.dynamic=this.hasTangents=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){var t=new THREE.Matrix4;t.extractRotation(e);for(var n=0,r=this.vertices.length;n<r;n++)e.multiplyVector3(this.vertices[n]);n=0;for(r=this.faces.length;n<r;n++){var i=this.faces[n];t.multiplyVector3(i.normal);for(var s=0,o=i.vertexNormals.length;s<o;s++)t.multiplyVector3(i.vertexNormals[s]);e.multiplyVector3(i.centroid)}},computeCentroids:function(){var e,t,n;e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n.centroid.set(0,0,0),n instanceof THREE.Face3?(n.centroid.addSelf(this.vertices[n.a]),n.centroid.addSelf(this.vertices[n.b]),n.centroid.addSelf(this.vertices[n.c]),n.centroid.divideScalar(3)):n instanceof THREE.Face4&&(n.centroid.addSelf(this.vertices[n.a]),n.centroid.addSelf(this.vertices[n.b]),n.centroid.addSelf(this.vertices[n.c]),n.centroid.addSelf(this.vertices[n.d]),n.centroid.divideScalar(4))},computeFaceNormals:function(){var e,t,n,r,i,s,o=new THREE.Vector3,u=new THREE.Vector3;e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],r=this.vertices[n.a],i=this.vertices[n.b],s=this.vertices[n.c],o.sub(s,i),u.sub(r,i),o.crossSelf(u),o.isZero()||o.normalize(),n.normal.copy(o)},computeVertexNormals:function(){var e,t,n,r;if(this.__tmpVertices===void 0){r=this.__tmpVertices=Array(this.vertices.length),e=0;for(t=this.vertices.length;e<t;e++)r[e]=new THREE.Vector3;e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n instanceof THREE.Face3?n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:n instanceof THREE.Face4&&(n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else{r=this.__tmpVertices,e=0;for(t=this.vertices.length;e<t;e++)r[e].set(0,0,0)}e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n instanceof THREE.Face3?(r[n.a].addSelf(n.normal),r[n.b].addSelf(n.normal),r[n.c].addSelf(n.normal)):n instanceof THREE.Face4&&(r[n.a].addSelf(n.normal),r[n.b].addSelf(n.normal),r[n.c].addSelf(n.normal),r[n.d].addSelf(n.normal));e=0;for(t=this.vertices.length;e<t;e++)r[e].normalize();e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n instanceof THREE.Face3?(n.vertexNormals[0].copy(r[n.a]),n.vertexNormals[1].copy(r[n.b]),n.vertexNormals[2].copy(r[n.c])):n instanceof THREE.Face4&&(n.vertexNormals[0].copy(r[n.a]),n.vertexNormals[1].copy(r[n.b]),n.vertexNormals[2].copy(r[n.c]),n.vertexNormals[3].copy(r[n.d]))},computeMorphNormals:function(){var e,t,n,r,i;n=0;for(r=this.faces.length;n<r;n++){i=this.faces[n],i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0;for(t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone()}var s=new THREE.Geometry;s.faces=this.faces,e=0;for(t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,u=this.morphNormals[e].vertexNormals,a,f;n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],a=new THREE.Vector3,f=i instanceof THREE.Face3?{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3}:{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3},o.push(a),u.push(f)}o=this.morphNormals[e],s.vertices=this.morphTargets[e].vertices,s.computeFaceNormals(),s.computeVertexNormals(),n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],a=o.faceNormals[n],f=o.vertexNormals[n],a.copy(i.normal),i instanceof THREE.Face3?(f.a.copy(i.vertexNormals[0]),f.b.copy(i.vertexNormals[1]),f.c.copy(i.vertexNormals[2])):(f.a.copy(i.vertexNormals[0]),f.b.copy(i.vertexNormals[1]),f.c.copy(i.vertexNormals[2]),f.d.copy(i.vertexNormals[3]))}n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeTangents:function(){function e(e,t,n,r,i,s,T){u=e.vertices[t],a=e.vertices[n],f=e.vertices[r],l=o[i],c=o[s],h=o[T],p=a.x-u.x,d=f.x-u.x,v=a.y-u.y,m=f.y-u.y,g=a.z-u.z,y=f.z-u.z,b=c.u-l.u,w=h.u-l.u,E=c.v-l.v,S=h.v-l.v,x=1/(b*S-w*E),k.set((S*p-E*d)*x,(S*v-E*m)*x,(S*g-E*y)*x),L.set((b*d-w*p)*x,(b*m-w*v)*x,(b*y-w*g)*x),N[t].addSelf(k),N[n].addSelf(k),N[r].addSelf(k),C[t].addSelf(L),C[n].addSelf(L),C[r].addSelf(L)}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=[],C=[],k=new THREE.Vector3,L=new THREE.Vector3,A=new THREE.Vector3,O=new THREE.Vector3,M=new THREE.Vector3;t=0;for(n=this.vertices.length;t<n;t++)N[t]=new THREE.Vector3,C[t]=new THREE.Vector3;t=0;for(n=this.faces.length;t<n;t++)s=this.faces[t],o=this.faceVertexUvs[0][t],s instanceof THREE.Face3?e(this,s.a,s.b,s.c,0,1,2):s instanceof THREE.Face4&&(e(this,s.a,s.b,s.d,0,1,3),e(this,s.b,s.c,s.d,1,2,3));var _=["a","b","c","d"];t=0;for(n=this.faces.length;t<n;t++){s=this.faces[t];for(r=0;r<s.vertexNormals.length;r++)M.copy(s.vertexNormals[r]),i=s[_[r]],T=N[i],A.copy(T),A.subSelf(M.multiplyScalar(M.dot(T))).normalize(),O.cross(s.vertexNormals[r],T),i=O.dot(C[i]),i=i<0?-1:1,s.vertexTangents[r]=new THREE.Vector4(A.x,A.y,A.z,i)}this.hasTangents=!0},computeBoundingBox:function(){this.boundingBox||(this.boundingBox={min:new THREE.Vector3,max:new THREE.Vector3});if(this.vertices.length>0){var e;e=this.vertices[0],this.boundingBox.min.copy(e),this.boundingBox.max.copy(e);for(var t=this.boundingBox.min,n=this.boundingBox.max,r=1,i=this.vertices.length;r<i;r++)e=this.vertices[r],e.x<t.x?t.x=e.x:e.x>n.x&&(n.x=e.x),e.y<t.y?t.y=e.y:e.y>n.y&&(n.y=e.y),e.z<t.z?t.z=e.z:e.z>n.z&&(n.z=e.z)}else this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){this.boundingSphere||(this.boundingSphere={radius:0});for(var e,t=0,n=0,r=this.vertices.length;n<r;n++)e=this.vertices[n].length(),e>t&&(t=e);this.boundingSphere.radius=t},mergeVertices:function(){var e={},t=[],n=[],r,i=Math.pow(10,4),s,o,u;s=0;for(o=this.vertices.length;s<o;s++)r=this.vertices[s],r=[Math.round(r.x*i),Math.round(r.y*i),Math.round(r.z*i)].join("_"),e[r]===void 0?(e[r]=s,t.push(this.vertices[s]),n[s]=t.length-1):n[s]=n[e[r]];s=0;for(o=this.faces.length;s<o;s++){i=this.faces[s];if(i instanceof THREE.Face3)i.a=n[i.a],i.b=n[i.b],i.c=n[i.c];else if(i instanceof THREE.Face4){i.a=n[i.a],i.b=n[i.b],i.c=n[i.c],i.d=n[i.d],r=[i.a,i.b,i.c,i.d];for(e=3;e>0;e--)if(r.indexOf(i["abcd"[e]])!=e){r.splice(e,1),this.faces[s]=new THREE.Face3(r[0],r[1],r[2]),i=0;for(r=this.faceVertexUvs.length;i<r;i++)(u=this.faceVertexUvs[i][s])&&u.splice(e,1);break}}}return n=this.vertices.length-t.length,this.vertices=t,n}},THREE.GeometryCount=0,THREE.Spline=function(e){function t(e,t,n,r,i,s,o){return e=(n-e)*.5,r=(r-t)*.5,(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t}this.points=e;var n=[],r={x:0,y:0,z:0},i,s,o,u,a,f,l,c,h;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,s=Math.floor(i),o=i-s,n[0]=s===0?s:s-1,n[1]=s,n[2]=s>this.points.length-2?this.points.length-1:s+1,n[3]=s>this.points.length-3?this.points.length-1:s+2,f=this.points[n[0]],l=this.points[n[1]],c=this.points[n[2]],h=this.points[n[3]],u=o*o,a=o*u,r.x=t(f.x,l.x,c.x,h.x,o,u,a),r.y=t(f.y,l.y,c.y,h.y,o,u,a),r.z=t(f.z,l.z,c.z,h.z,o,u,a),r},this.getControlPointsArray=function(){var e,t,n=this.points.length,r=[];for(e=0;e<n;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,n,r,i=t=t=0,s=new THREE.Vector3,o=new THREE.Vector3,u=[],a=0;u[0]=0,e||(e=100),n=this.points.length*e,s.copy(this.points[0]);for(e=1;e<n;e++)t=e/n,r=this.getPoint(t),o.copy(r),a+=o.distanceTo(s),s.copy(r),t=(this.points.length-1)*t,t=Math.floor(t),t!=i&&(u[t]=a,i=t);return u[u.length]=a,{chunks:u,total:a}},this.reparametrizeByArcLength=function(e){var t,n,r,i,s,o,u=[],a=new THREE.Vector3,f=this.getLength();u.push(a.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){n=f.chunks[t]-f.chunks[t-1],o=Math.ceil(e*n/f.total),i=(t-1)/(this.points.length-1),s=t/(this.points.length-1);for(n=1;n<o-1;n++)r=i+n*(1/o)*(s-i),r=this.getPoint(r),u.push(a.copy(r).clone());u.push(a.copy(this.points[t]).clone())}this.points=u}},THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,this.projectionMatrixInverse=new THREE.Matrix4},THREE.Camera.prototype=new THREE.Object3D,THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up),this.rotationAutoUpdate&&this.rotation.getRotationFromMatrix(this.matrix)},THREE.OrthographicCamera=function(e,t,n,r,i,s){THREE.Camera.call(this),this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i!==void 0?i:.1,this.far=s!==void 0?s:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=new THREE.Camera,THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera,THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.PerspectiveCamera=function(e,t,n,r){THREE.Camera.call(this),this.fov=e!==void 0?e:50,this.aspect=t!==void 0?t:1,this.near=n!==void 0?n:.1,this.far=r!==void 0?r:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=new THREE.Camera,THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera,THREE.PerspectiveCamera.prototype.setLens=function(e,t){this.fov=2*Math.atan((t!==void 0?t:24)/(e*2))*(180/Math.PI),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,s){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=r,this.width=i,this.height=s,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(this.fov*Math.PI/360)*this.near,n=-t,r=e*n,e=Math.abs(e*t-r),n=Math.abs(t-n);this.projectionMatrix.makeFrustum(r+this.x*e/this.fullWidth,r+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*n/this.fullHeight,t-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=new THREE.Object3D,THREE.Light.prototype.constructor=THREE.Light,THREE.Light.prototype.supr=THREE.Object3D.prototype,THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(e,t,n){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.target=new THREE.Object3D,this.intensity=t!==void 0?t:1,this.distance=n!==void 0?n:0,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(e,t,n){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,0,0),this.intensity=t!==void 0?t:1,this.distance=n!==void 0?n:0},THREE.PointLight.prototype=new THREE.Light,THREE.PointLight.prototype.constructor=THREE.PointLight,THREE.SpotLight=function(e,t,n,r,i){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.target=new THREE.Object3D,this.intensity=t!==void 0?t:1,this.distance=n!==void 0?n:0,this.angle=r!==void 0?r:Math.PI/2,this.exponent=i!==void 0?i:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.SpotLight.prototype=new THREE.Light,THREE.SpotLight.prototype.constructor=THREE.SpotLight,THREE.Loader=function(e){this.statusDomElement=(this.showStatus=e)?THREE.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){return e=e.split("/"),e.pop(),(e.length<1?".":e.join("/"))+"/"},initMaterials:function(e,t,n){e.materials=[];for(var r=0;r<t.length;++r)e.materials[r]=THREE.Loader.prototype.createMaterial(t[r],n)},hasNormals:function(e){var t,n,r=e.materials.length;for(n=0;n<r;n++){t=e.materials[n];if(t instanceof THREE.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){function n(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e}function r(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))}function i(e,t){var i=new Image;i.onload=function(){if(!n(this.width)||!n(this.height)){var t=r(this.width),i=r(this.height);e.image.width=t,e.image.height=i,e.image.getContext("2d").drawImage(this,0,0,t,i)}else e.image=this;e.needsUpdate=!0},i.crossOrigin=u.crossOrigin,i.src=t}function s(e,n,r,s,o,u){var a=document.createElement("canvas");e[n]=new THREE.Texture(a),e[n].sourceFile=r,s&&(e[n].repeat.set(s[0],s[1]),s[0]!=1&&(e[n].wrapS=THREE.RepeatWrapping),s[1]!=1&&(e[n].wrapT=THREE.RepeatWrapping)),o&&e[n].offset.set(o[0],o[1]),u&&(s={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},s[u[0]]!==void 0&&(e[n].wrapS=s[u[0]]),s[u[1]]!==void 0&&(e[n].wrapT=s[u[1]])),i(e[n],t+"/"+r)}function o(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255}var u=this,a="MeshLambertMaterial",f={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:e.wireframe};if(e.shading){var l=e.shading.toLowerCase();l==="phong"?a="MeshPhongMaterial":l==="basic"&&(a="MeshBasicMaterial")}e.blending!==void 0&&THREE[e.blending]!==void 0&&(f.blending=THREE[e.blending]);if(e.transparent!==void 0||e.opacity<1)f.transparent=e.transparent;return e.depthTest!==void 0&&(f.depthTest=e.depthTest),e.depthWrite!==void 0&&(f.depthWrite=e.depthWrite),e.vertexColors!==void 0&&(e.vertexColors=="face"?f.vertexColors=THREE.FaceColors:e.vertexColors&&(f.vertexColors=THREE.VertexColors)),e.colorDiffuse?f.color=o(e.colorDiffuse):e.DbgColor&&(f.color=e.DbgColor),e.colorSpecular&&(f.specular=o(e.colorSpecular)),e.colorAmbient&&(f.ambient=o(e.colorAmbient)),e.transparency&&(f.opacity=e.transparency),e.specularCoef&&(f.shininess=e.specularCoef),e.mapDiffuse&&t&&s(f,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap),e.mapLight&&t&&s(f,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap),e.mapNormal&&t&&s(f,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap),e.mapSpecular&&t&&s(f,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap),e.mapNormal?(a=THREE.ShaderUtils.lib.normal,l=THREE.UniformsUtils.clone(a.uniforms),l.tNormal.texture=f.normalMap,e.mapNormalFactor&&(l.uNormalScale.value=e.mapNormalFactor),f.map&&(l.tDiffuse.texture=f.map,l.enableDiffuse.value=!0),f.specularMap&&(l.tSpecular.texture=f.specularMap,l.enableSpecular.value=!0),f.lightMap&&(l.tAO.texture=f.lightMap,l.enableAO.value=!0),l.uDiffuseColor.value.setHex(f.color),l.uSpecularColor.value.setHex(f.specular),l.uAmbientColor.value.setHex(f.ambient),l.uShininess.value=f.shininess,f.opacity!==void 0&&(l.uOpacity.value=f.opacity),f=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:l,lights:!0,fog:!0})):f=new THREE[a](f),e.DbgName!==void 0&&(f.name=e.DbgName),f}},THREE.BinaryLoader=function(e){THREE.Loader.call(this,e)},THREE.BinaryLoader.prototype=new THREE.Loader,THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader,THREE.BinaryLoader.prototype.load=function(e,t,n,r){var n=n?n:this.extractUrlBase(e),r=r?r:this.extractUrlBase(e),i=this.showProgress?THREE.Loader.prototype.updateProgress:null;this.onLoadStart(),this.loadAjaxJSON(this,e,t,n,r,i)},THREE.BinaryLoader.prototype.loadAjaxJSON=function(e,t,n,r,i,s){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState==4)if(o.status==200||o.status==0){var u=JSON.parse(o.responseText);e.loadAjaxBuffers(u,n,i,r,s)}else console.error("THREE.BinaryLoader: Couldn't load ["+t+"] ["+o.status+"]")},o.open("GET",t,!0),o.overrideMimeType&&o.overrideMimeType("text/plain; charset=x-user-defined"),o.setRequestHeader("Content-Type","text/plain"),o.send(null)},THREE.BinaryLoader.prototype.loadAjaxBuffers=function(e,t,n,r,i){var s=new XMLHttpRequest,o=n+"/"+e.buffers,u=0;s.onreadystatechange=function(){s.readyState==4?s.status==200||s.status==0?THREE.BinaryLoader.prototype.createBinModel(s.response,t,r,e.materials):console.error("THREE.BinaryLoader: Couldn't load ["+o+"] ["+s.status+"]"):s.readyState==3?i&&(u==0&&(u=s.getResponseHeader("Content-Length")),i({total:u,loaded:s.responseText.length})):s.readyState==2&&(u=s.getResponseHeader("Content-Length"))},s.open("GET",o,!0),s.responseType="arraybuffer",s.send(null)},THREE.BinaryLoader.prototype.createBinModel=function(e,t,n,r){var i=function(t){function w(e){return e%4?4-e%4:0}function E(e,t){return(new Uint8Array(e,t,1))[0]}function S(e,t){return(new Uint32Array(e,t,1))[0]}function x(t,n){var r,i,s,o,u,f,l,c,h=new Uint32Array(e,n,3*t);for(r=0;r<t;r++){i=h[r*3],s=h[r*3+1],o=h[r*3+2],u=_[i*2],i=_[i*2+1],f=_[s*2],l=_[s*2+1],s=_[o*2],c=_[o*2+1],o=A.faceVertexUvs[0];var p=[];p.push(new THREE.UV(u,i)),p.push(new THREE.UV(f,l)),p.push(new THREE.UV(s,c)),o.push(p)}}function T(t,n){var r,i,s,o,u,f,l,c,h,p,d=new Uint32Array(e,n,4*t);for(r=0;r<t;r++){i=d[r*4],s=d[r*4+1],o=d[r*4+2],u=d[r*4+3],f=_[i*2],i=_[i*2+1],l=_[s*2],h=_[s*2+1],c=_[o*2],p=_[o*2+1],o=_[u*2],s=_[u*2+1],u=A.faceVertexUvs[0];var v=[];v.push(new THREE.UV(f,i)),v.push(new THREE.UV(l,h)),v.push(new THREE.UV(c,p)),v.push(new THREE.UV(o,s)),u.push(v)}}function N(t,n,r){for(var i,s,o,u,n=new Uint32Array(e,n,3*t),f=new Uint16Array(e,r,t),r=0;r<t;r++)i=n[r*3],s=n[r*3+1],o=n[r*3+2],u=f[r],A.faces.push(new THREE.Face3(i,s,o,null,null,u))}function C(t,n,r){for(var i,s,o,u,f,n=new Uint32Array(e,n,4*t),l=new Uint16Array(e,r,t),r=0;r<t;r++)i=n[r*4],s=n[r*4+1],o=n[r*4+2],u=n[r*4+3],f=l[r],A.faces.push(new THREE.Face4(i,s,o,u,null,null,f))}function k(t,n,r,i){for(var s,o,u,f,l,c,h,n=new Uint32Array(e,n,3*t),r=new Uint32Array(e,r,3*t),p=new Uint16Array(e,i,t),i=0;i<t;i++){s=n[i*3],o=n[i*3+1],u=n[i*3+2],l=r[i*3],c=r[i*3+1],h=r[i*3+2],f=p[i];var d=M[c*3],v=M[c*3+1];c=M[c*3+2];var m=M[h*3],g=M[h*3+1];h=M[h*3+2],A.faces.push(new THREE.Face3(s,o,u,[new THREE.Vector3(M[l*3],M[l*3+1],M[l*3+2]),new THREE.Vector3(d,v,c),new THREE.Vector3(m,g,h)],null,f))}}function L(t,n,r,i){for(var s,o,u,f,l,c,h,p,d,n=new Uint32Array(e,n,4*t),r=new Uint32Array(e,r,4*t),v=new Uint16Array(e,i,t),i=0;i<t;i++){s=n[i*4],o=n[i*4+1],u=n[i*4+2],f=n[i*4+3],c=r[i*4],h=r[i*4+1],p=r[i*4+2],d=r[i*4+3],l=v[i];var m=M[h*3],g=M[h*3+1];h=M[h*3+2];var y=M[p*3],b=M[p*3+1];p=M[p*3+2];var w=M[d*3],E=M[d*3+1];d=M[d*3+2],A.faces.push(new THREE.Face4(s,o,u,f,[new THREE.Vector3(M[c*3],M[c*3+1],M[c*3+2]),new THREE.Vector3(m,g,h),new THREE.Vector3(y,b,p),new THREE.Vector3(w,E,d)],null,l))}}var n,i,s,o,u,f,l,c,h,p,v,m,g,y,b,A=this,O=0,M=[],_=[],D,P,H;THREE.Geometry.call(this),THREE.Loader.prototype.initMaterials(A,r,t),function(e,t,n){for(var e=new Uint8Array(e,t,n),r="",i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r}(e,O,12),n=E(e,O+12),E(e,O+13),E(e,O+14),E(e,O+15),i=E(e,O+16),s=E(e,O+17),o=E(e,O+18),u=E(e,O+19),f=S(e,O+20),l=S(e,O+20+4),c=S(e,O+20+8),t=S(e,O+20+12),h=S(e,O+20+16),p=S(e,O+20+20),v=S(e,O+20+24),m=S(e,O+20+28),g=S(e,O+20+32),y=S(e,O+20+36),b=S(e,O+20+40),O+=n,n=i*3+u,H=i*4+u,D=t*n,P=h*(n+s*3),i=p*(n+o*3),u=v*(n+s*3+o*3),n=m*H,s=g*(H+s*4),o=y*(H+o*4),O+=function(t){var t=new Float32Array(e,t,f*3),n,r,i,s;for(n=0;n<f;n++)r=t[n*3],i=t[n*3+1],s=t[n*3+2],A.vertices.push(new THREE.Vector3(r,i,s));return f*3*Float32Array.BYTES_PER_ELEMENT}(O),O+=function(t){if(l){var t=new Int8Array(e,t,l*3),n,r,i,s;for(n=0;n<l;n++)r=t[n*3],i=t[n*3+1],s=t[n*3+2],M.push(r/127,i/127,s/127)}return l*3*Int8Array.BYTES_PER_ELEMENT}(O),O+=w(l*3),O+=function(t){if(c){var t=new Float32Array(e,t,c*2),n,r,i;for(n=0;n<c;n++)r=t[n*2],i=t[n*2+1],_.push(r,i)}return c*2*Float32Array.BYTES_PER_ELEMENT}(O),D=O+D+w(t*2),P=D+P+w(h*2),i=P+i+w(p*2),u=i+u+w(v*2),n=u+n+w(m*2),s=n+s+w(g*2),o=s+o+w(y*2),function(e){if(p){var t=e+p*Uint32Array.BYTES_PER_ELEMENT*3;N(p,e,t+p*Uint32Array.BYTES_PER_ELEMENT*3),x(p,t)}}(P),function(e){if(v){var t=e+v*Uint32Array.BYTES_PER_ELEMENT*3,n=t+v*Uint32Array.BYTES_PER_ELEMENT*3;k(v,e,t,n+v*Uint32Array.BYTES_PER_ELEMENT*3),x(v,n)}}(i),function(e){if(y){var t=e+y*Uint32Array.BYTES_PER_ELEMENT*4;C(y,e,t+y*Uint32Array.BYTES_PER_ELEMENT*4),T(y,t)}}(s),function(e){if(b){var t=e+b*Uint32Array.BYTES_PER_ELEMENT*4,n=t+b*Uint32Array.BYTES_PER_ELEMENT*4;L(b,e,t,n+b*Uint32Array.BYTES_PER_ELEMENT*4),T(b,n)}}(o),t&&N(t,O,O+t*Uint32Array.BYTES_PER_ELEMENT*3),function(e){if(h){var t=e+h*Uint32Array.BYTES_PER_ELEMENT*3;k(h,e,t,t+h*Uint32Array.BYTES_PER_ELEMENT*3)}}(D),m&&C(m,u,u+m*Uint32Array.BYTES_PER_ELEMENT*4),function(e){if(g){var t=e+g*Uint32Array.BYTES_PER_ELEMENT*4;L(g,e,t,t+g*Uint32Array.BYTES_PER_ELEMENT*4)}}(n),this.computeCentroids(),this.computeFaceNormals(),THREE.Loader.prototype.hasNormals(this)&&this.computeTangents()};i.prototype=new THREE.Geometry,i.prototype.constructor=i,t(new i(n))},THREE.JSONLoader=function(e){THREE.Loader.call(this,e)},THREE.JSONLoader.prototype=new THREE.Loader,THREE.JSONLoader.prototype.constructor=THREE.JSONLoader,THREE.JSONLoader.prototype.load=function(e,t,n){n=n?n:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,n)},THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,r,i){var s=new XMLHttpRequest,o=0;s.onreadystatechange=function(){if(s.readyState===s.DONE)if(s.status===200||s.status===0){if(s.responseText){var u=JSON.parse(s.responseText);e.createModel(u,n,r)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+s.status+"]");else s.readyState===s.LOADING?i&&(o===0&&(o=s.getResponseHeader("Content-Length")),i({total:o,loaded:s.responseText.length})):s.readyState===s.HEADERS_RECEIVED&&(o=s.getResponseHeader("Content-Length"))},s.open("GET",t,!0),s.overrideMimeType&&s.overrideMimeType("text/plain; charset=x-user-defined"),s.setRequestHeader("Content-Type","text/plain"),s.send(null)},THREE.JSONLoader.prototype.createModel=function(e,t,n){var r=new THREE.Geometry,i=e.scale!==void 0?1/e.scale:1;this.initMaterials(r,e.materials,n),function(t){var n,i,s,o,u,f,l,c,h,p,v,m,g,y,b=e.faces;f=e.vertices;var w=e.normals,E=e.colors,S=0;for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&S++;for(n=0;n<S;n++)r.faceUvs[n]=[],r.faceVertexUvs[n]=[];o=0;for(u=f.length;o<u;)l=new THREE.Vector3,l.x=f[o++]*t,l.y=f[o++]*t,l.z=f[o++]*t,r.vertices.push(l);o=0;for(u=b.length;o<u;){t=b[o++],f=t&1,s=t&2,n=t&4,i=t&8,c=t&16,l=t&32,p=t&64,t&=128,f?(v=new THREE.Face4,v.a=b[o++],v.b=b[o++],v.c=b[o++],v.d=b[o++],f=4):(v=new THREE.Face3,v.a=b[o++],v.b=b[o++],v.c=b[o++],f=3),s&&(s=b[o++],v.materialIndex=s),s=r.faces.length;if(n)for(n=0;n<S;n++)m=e.uvs[n],h=b[o++],y=m[h*2],h=m[h*2+1],r.faceUvs[n][s]=new THREE.UV(y,h);if(i)for(n=0;n<S;n++){m=e.uvs[n],g=[];for(i=0;i<f;i++)h=b[o++],y=m[h*2],h=m[h*2+1],g[i]=new THREE.UV(y,h);r.faceVertexUvs[n][s]=g}c&&(c=b[o++]*3,i=new THREE.Vector3,i.x=w[c++],i.y=w[c++],i.z=w[c],v.normal=i);if(l)for(n=0;n<f;n++)c=b[o++]*3,i=new THREE.Vector3,i.x=w[c++],i.y=w[c++],i.z=w[c],v.vertexNormals.push(i);p&&(l=b[o++],l=new THREE.Color(E[l]),v.color=l);if(t)for(n=0;n<f;n++)l=b[o++],l=new THREE.Color(E[l]),v.vertexColors.push(l);r.faces.push(v)}}(i),function(){var t,n,i,s;if(e.skinWeights){t=0;for(n=e.skinWeights.length;t<n;t+=2)i=e.skinWeights[t],s=e.skinWeights[t+1],r.skinWeights.push(new THREE.Vector4(i,s,0,0))}if(e.skinIndices){t=0;for(n=e.skinIndices.length;t<n;t+=2)i=e.skinIndices[t],s=e.skinIndices[t+1],r.skinIndices.push(new THREE.Vector4(i,s,0,0))}r.bones=e.bones,r.animation=e.animation}(),function(t){if(e.morphTargets!==void 0){var n,i,s,o,u,f;n=0;for(i=e.morphTargets.length;n<i;n++){r.morphTargets[n]={},r.morphTargets[n].name=e.morphTargets[n].name,r.morphTargets[n].vertices=[],u=r.morphTargets[n].vertices,f=e.morphTargets[n].vertices,s=0;for(o=f.length;s<o;s+=3){var l=new THREE.Vector3;l.x=f[s]*t,l.y=f[s+1]*t,l.z=f[s+2]*t,u.push(l)}}}if(e.morphColors!==void 0){n=0;for(i=e.morphColors.length;n<i;n++){r.morphColors[n]={},r.morphColors[n].name=e.morphColors[n].name,r.morphColors[n].colors=[],o=r.morphColors[n].colors,u=e.morphColors[n].colors,t=0;for(s=u.length;t<s;t+=3)f=new THREE.Color(16755200),f.setRGB(u[t],u[t+1],u[t+2]),o.push(f)}}}(i),r.computeCentroids(),r.computeFaceNormals(),this.hasNormals(r)&&r.computeTangents(),t(r)},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){}},THREE.SceneLoader.prototype.constructor=THREE.SceneLoader,THREE.SceneLoader.prototype.load=function(e,t){var n=this,r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState==4)if(r.status==200||r.status==0){var i=JSON.parse(r.responseText);n.createScene(i,t,e)}else console.error("THREE.SceneLoader: Couldn't load ["+e+"] ["+r.status+"]")},r.open("GET",e,!0),r.overrideMimeType&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.setRequestHeader("Content-Type","text/plain"),r.send(null)},THREE.SceneLoader.prototype.createScene=function(e,t,n){function r(e,t){return t=="relativeToHTML"?e:f+"/"+e}function i(){var e;for(h in M.objects)if(!j.objects[h]){g=M.objects[h];if(g.geometry!==void 0){if(k=j.geometries[g.geometry])e=!1,L=j.materials[g.materials[0]],(e=L instanceof THREE.ShaderMaterial)&&k.computeTangents(),E=g.position,S=g.rotation,x=g.quaternion,T=g.scale,y=g.matrix,x=0,g.materials.length==0&&(L=new THREE.MeshFaceMaterial),g.materials.length>1&&(L=new THREE.MeshFaceMaterial),e=new THREE.Mesh(k,L),e.name=h,y?(e.matrixAutoUpdate=!1,e.matrix.set(y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],y[8],y[9],y[10],y[11],y[12],y[13],y[14],y[15])):(e.position.set(E[0],E[1],E[2]),x?(e.quaternion.set(x[0],x[1],x[2],x[3]),e.useQuaternion=!0):e.rotation.set(S[0],S[1],S[2]),e.scale.set(T[0],T[1],T[2])),e.visible=g.visible,e.doubleSided=g.doubleSided,e.castShadow=g.castShadow,e.receiveShadow=g.receiveShadow,j.scene.add(e),j.objects[h]=e}else E=g.position,S=g.rotation,x=g.quaternion,T=g.scale,x=0,e=new THREE.Object3D,e.name=h,e.position.set(E[0],E[1],E[2]),x?(e.quaternion.set(x[0],x[1],x[2],x[3]),e.useQuaternion=!0):e.rotation.set(S[0],S[1],S[2]),e.scale.set(T[0],T[1],T[2]),e.visible=g.visible!==void 0?g.visible:!1,j.scene.add(e),j.objects[h]=e,j.empties[h]=e}}function s(e){return function(t){j.geometries[e]=t,i(),D-=1,a.onLoadComplete(),u()}}function o(e){return function(t){j.geometries[e]=t}}function u(){a.callbackProgress({totalModels:H,totalTextures:B,loadedModels:H-D,loadedTextures:B-P},j),a.onLoadProgress(),D==0&&P==0&&t(j)}var a=this,f=THREE.Loader.prototype.extractUrlBase(n),l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j;M=e,n=new THREE.BinaryLoader,_=new THREE.JSONLoader,P=D=0,j={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{}};if(M.transform){e=M.transform.position,b=M.transform.rotation,N=M.transform.scale,e&&j.scene.position.set(e[0],e[1],e[2]),b&&j.scene.rotation.set(b[0],b[1],b[2]),N&&j.scene.scale.set(N[0],N[1],N[2]);if(e||b||N)j.scene.updateMatrix(),j.scene.updateMatrixWorld()}e=function(){P-=1,u(),a.onLoadComplete()};for(d in M.cameras)N=M.cameras[d],N.type=="perspective"?A=new THREE.PerspectiveCamera(N.fov,N.aspect,N.near,N.far):N.type=="ortho"&&(A=new THREE.OrthographicCamera(N.left,N.right,N.top,N.bottom,N.near,N.far)),E=N.position,b=N.target,N=N.up,A.position.set(E[0],E[1],E[2]),A.target=new THREE.Vector3(b[0],b[1],b[2]),N&&A.up.set(N[0],N[1],N[2]),j.cameras[d]=A;for(p in M.lights)b=M.lights[p],d=b.color!==void 0?b.color:16777215,A=b.intensity!==void 0?b.intensity:1,b.type=="directional"?(E=b.direction,w=new THREE.DirectionalLight(d,A),w.position.set(E[0],E[1],E[2]),w.position.normalize()):b.type=="point"?(E=b.position,w=b.distance,w=new THREE.PointLight(d,A,w),w.position.set(E[0],E[1],E[2])):b.type=="ambient"&&(w=new THREE.AmbientLight(d)),j.scene.add(w),j.lights[p]=w;for(v in M.fogs)p=M.fogs[v],p.type=="linear"?O=new THREE.Fog(0,p.near,p.far):p.type=="exp2"&&(O=new THREE.FogExp2(0,p.density)),N=p.color,O.color.setRGB(N[0],N[1],N[2]),j.fogs[v]=O;j.cameras&&M.defaults.camera&&(j.currentCamera=j.cameras[M.defaults.camera]),j.fogs&&M.defaults.fog&&(j.scene.fog=j.fogs[M.defaults.fog]),N=M.defaults.bgcolor,j.bgColor=new THREE.Color,j.bgColor.setRGB(N[0],N[1],N[2]),j.bgColorAlpha=M.defaults.bgalpha;for(l in M.geometries){v=M.geometries[l];if(v.type=="bin_mesh"||v.type=="ascii_mesh")D+=1,a.onLoadStart()}H=D;for(l in M.geometries)v=M.geometries[l],v.type=="cube"?(k=new THREE.CubeGeometry(v.width,v.height,v.depth,v.segmentsWidth,v.segmentsHeight,v.segmentsDepth,null,v.flipped,v.sides),j.geometries[l]=k):v.type=="plane"?(k=new THREE.PlaneGeometry(v.width,v.height,v.segmentsWidth,v.segmentsHeight),j.geometries[l]=k):v.type=="sphere"?(k=new THREE.SphereGeometry(v.radius,v.segmentsWidth,v.segmentsHeight),j.geometries[l]=k):v.type=="cylinder"?(k=new THREE.CylinderGeometry(v.topRad,v.botRad,v.height,v.radSegs,v.heightSegs),j.geometries[l]=k):v.type=="torus"?(k=new THREE.TorusGeometry(v.radius,v.tube,v.segmentsR,v.segmentsT),j.geometries[l]=k):v.type=="icosahedron"?(k=new THREE.IcosahedronGeometry(v.radius,v.subdivisions),j.geometries[l]=k):v.type=="bin_mesh"?n.load(r(v.url,M.urlBaseType),s(l)):v.type=="ascii_mesh"?_.load(r(v.url,M.urlBaseType),s(l)):v.type=="embedded_mesh"&&(v=M.embeds[v.id],v.metadata=M.metadata,v&&_.createModel(v,o(l),""));for(m in M.textures){l=M.textures[m];if(l.url instanceof Array){P+=l.url.length;for(v=0;v<l.url.length;v++)a.onLoadStart()}else P+=1,a.onLoadStart()}B=P;for(m in M.textures){l=M.textures[m],l.mapping!=void 0&&THREE[l.mapping]!=void 0&&(l.mapping=new THREE[l.mapping]);if(l.url instanceof Array){v=[];for(O=0;O<l.url.length;O++)v[O]=r(l.url[O],M.urlBaseType);v=THREE.ImageUtils.loadTextureCube(v,l.mapping,e)}else v=THREE.ImageUtils.loadTexture(r(l.url,M.urlBaseType),l.mapping,e),THREE[l.minFilter]!=void 0&&(v.minFilter=THREE[l.minFilter]),THREE[l.magFilter]!=void 0&&(v.magFilter=THREE[l.magFilter]),l.repeat&&(v.repeat.set(l.repeat[0],l.repeat[1]),l.repeat[0]!=1&&(v.wrapS=THREE.RepeatWrapping),l.repeat[1]!=1&&(v.wrapT=THREE.RepeatWrapping)),l.offset&&v.offset.set(l.offset[0],l.offset[1]),l.wrap&&(O={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},O[l.wrap[0]]!==void 0&&(v.wrapS=O[l.wrap[0]]),O[l.wrap[1]]!==void 0&&(v.wrapT=O[l.wrap[1]]));j.textures[m]=v}for(c in M.materials){y=M.materials[c];for(C in y.parameters)C=="envMap"||C=="map"||C=="lightMap"?y.parameters[C]=j.textures[y.parameters[C]]:C=="shading"?y.parameters[C]=y.parameters[C]=="flat"?THREE.FlatShading:THREE.SmoothShading:C=="blending"?y.parameters[C]=THREE[y.parameters[C]]?THREE[y.parameters[C]]:THREE.NormalBlending:C=="combine"?y.parameters[C]=y.parameters[C]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation:C=="vertexColors"&&(y.parameters[C]=="face"?y.parameters[C]=THREE.FaceColors:y.parameters[C]&&(y.parameters[C]=THREE.VertexColors));y.parameters.opacity!==void 0&&y.parameters.opacity<1&&(y.parameters.transparent=!0),y.parameters.normalMap?(m=THREE.ShaderUtils.lib.normal,e=THREE.UniformsUtils.clone(m.uniforms),l=y.parameters.color,v=y.parameters.specular,O=y.parameters.ambient,n=y.parameters.shininess,e.tNormal.texture=j.textures[y.parameters.normalMap],y.parameters.normalMapFactor&&(e.uNormalScale.value=y.parameters.normalMapFactor),y.parameters.map&&(e.tDiffuse.texture=y.parameters.map,e.enableDiffuse.value=!0),y.parameters.lightMap&&(e.tAO.texture=y.parameters.lightMap,e.enableAO.value=!0),y.parameters.specularMap&&(e.tSpecular.texture=j.textures[y.parameters.specularMap],e.enableSpecular.value=!0),e.uDiffuseColor.value.setHex(l),e.uSpecularColor.value.setHex(v),e.uAmbientColor.value.setHex(O),e.uShininess.value=n,y.parameters.opacity&&(e.uOpacity.value=y.parameters.opacity),L=new THREE.ShaderMaterial({fragmentShader:m.fragmentShader,vertexShader:m.vertexShader,uniforms:e,lights:!0,fog:!0})):L=new THREE[y.type](y.parameters),j.materials[c]=L}i(),a.callbackSync(j),u()},THREE.Material=function(e){e=e||{},this.id=THREE.MaterialCount++,this.name="",this.opacity=e.opacity!==void 0?e.opacity:1,this.transparent=e.transparent!==void 0?e.transparent:!1,this.blending=e.blending!==void 0?e.blending:THREE.NormalBlending,this.blendSrc=e.blendSrc!==void 0?e.blendSrc:THREE.SrcAlphaFactor,this.blendDst=e.blendDst!==void 0?e.blendDst:THREE.OneMinusSrcAlphaFactor,this.blendEquation=e.blendEquation!==void 0?e.blendEquation:THREE.AddEquation,this.depthTest=e.depthTest!==void 0?e.depthTest:!0,this.depthWrite=e.depthWrite!==void 0?e.depthWrite:!0,this.polygonOffset=e.polygonOffset!==void 0?e.polygonOffset:!1,this.polygonOffsetFactor=e.polygonOffsetFactor!==void 0?e.polygonOffsetFactor:0,this.polygonOffsetUnits=e.polygonOffsetUnits!==void 0?e.polygonOffsetUnits:0,this.alphaTest=e.alphaTest!==void 0?e.alphaTest:0,this.overdraw=e.overdraw!==void 0?e.overdraw:!1,this.needsUpdate=this.visible=!0},THREE.MaterialCount=0,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.AdditiveAlphaBlending=5,THREE.CustomBlending=6,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.LineBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.linewidth=e.linewidth!==void 0?e.linewidth:1,this.linecap=e.linecap!==void 0?e.linecap:"round",this.linejoin=e.linejoin!==void 0?e.linejoin:"round",this.vertexColors=e.vertexColors?e.vertexColors:!1,this.fog=e.fog!==void 0?e.fog:!0},THREE.LineBasicMaterial.prototype=new THREE.Material,THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.MeshBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.map=e.map!==void 0?e.map:null,this.lightMap=e.lightMap!==void 0?e.lightMap:null,this.envMap=e.envMap!==void 0?e.envMap:null,this.combine=e.combine!==void 0?e.combine:THREE.MultiplyOperation,this.reflectivity=e.reflectivity!==void 0?e.reflectivity:1,this.refractionRatio=e.refractionRatio!==void 0?e.refractionRatio:.98,this.fog=e.fog!==void 0?e.fog:!0,this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading,this.wireframe=e.wireframe!==void 0?e.wireframe:!1,this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1,this.wireframeLinecap=e.wireframeLinecap!==void 0?e.wireframeLinecap:"round",this.wireframeLinejoin=e.wireframeLinejoin!==void 0?e.wireframeLinejoin:"round",this.vertexColors=e.vertexColors!==void 0?e.vertexColors:THREE.NoColors,this.skinning=e.skinning!==void 0?e.skinning:!1,this.morphTargets=e.morphTargets!==void 0?e.morphTargets:!1},THREE.MeshBasicMaterial.prototype=new THREE.Material,THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshLambertMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.ambient=e.ambient!==void 0?new THREE.Color(e.ambient):new THREE.Color(16777215),this.emissive=e.emissive!==void 0?new THREE.Color(e.emissive):new THREE.Color(0),this.wrapAround=e.wrapAround!==void 0?e.wrapAround:!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=e.map!==void 0?e.map:null,this.lightMap=e.lightMap!==void 0?e.lightMap:null,this.envMap=e.envMap!==void 0?e.envMap:null,this.combine=e.combine!==void 0?e.combine:THREE.MultiplyOperation,this.reflectivity=e.reflectivity!==void 0?e.reflectivity:1,this.refractionRatio=e.refractionRatio!==void 0?e.refractionRatio:.98,this.fog=e.fog!==void 0?e.fog:!0,this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading,this.wireframe=e.wireframe!==void 0?e.wireframe:!1,this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1,this.wireframeLinecap=e.wireframeLinecap!==void 0?e.wireframeLinecap:"round",this.wireframeLinejoin=e.wireframeLinejoin!==void 0?e.wireframeLinejoin:"round",this.vertexColors=e.vertexColors!==void 0?e.vertexColors:THREE.NoColors,this.skinning=e.skinning!==void 0?e.skinning:!1,this.morphTargets=e.morphTargets!==void 0?e.morphTargets:!1,this.morphNormals=e.morphNormals!==void 0?e.morphNormals:!1},THREE.MeshLambertMaterial.prototype=new THREE.Material,THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshPhongMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.ambient=e.ambient!==void 0?new THREE.Color(e.ambient):new THREE.Color(16777215),this.emissive=e.emissive!==void 0?new THREE.Color(e.emissive):new THREE.Color(0),this.specular=e.specular!==void 0?new THREE.Color(e.specular):new THREE.Color(1118481),this.shininess=e.shininess!==void 0?e.shininess:30,this.metal=e.metal!==void 0?e.metal:!1,this.perPixel=e.perPixel!==void 0?e.perPixel:!1,this.wrapAround=e.wrapAround!==void 0?e.wrapAround:!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=e.map!==void 0?e.map:null,this.lightMap=e.lightMap!==void 0?e.lightMap:null,this.envMap=e.envMap!==void 0?e.envMap:null,this.combine=e.combine!==void 0?e.combine:THREE.MultiplyOperation,this.reflectivity=e.reflectivity!==void 0?e.reflectivity:1,this.refractionRatio=e.refractionRatio!==void 0?e.refractionRatio:.98,this.fog=e.fog!==void 0?e.fog:!0,this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading,this.wireframe=e.wireframe!==void 0?e.wireframe:!1,this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1,this.wireframeLinecap=e.wireframeLinecap!==void 0?e.wireframeLinecap:"round",this.wireframeLinejoin=e.wireframeLinejoin!==void 0?e.wireframeLinejoin:"round",this.vertexColors=e.vertexColors!==void 0?e.vertexColors:THREE.NoColors,this.skinning=e.skinning!==void 0?e.skinning:!1,this.morphTargets=e.morphTargets!==void 0?e.morphTargets:!1,this.morphNormals=e.morphNormals!==void 0?e.morphNormals:!1},THREE.MeshPhongMaterial.prototype=new THREE.Material,THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshDepthMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading,this.wireframe=e.wireframe!==void 0?e.wireframe:!1,this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1},THREE.MeshDepthMaterial.prototype=new THREE.Material,THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=e.shading?e.shading:THREE.FlatShading,this.wireframe=e.wireframe?e.wireframe:!1,this.wireframeLinewidth=e.wireframeLinewidth?e.wireframeLinewidth:1},THREE.MeshNormalMaterial.prototype=new THREE.Material,THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshFaceMaterial=function(){},THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.map=e.map!==void 0?e.map:null,this.size=e.size!==void 0?e.size:1,this.sizeAttenuation=e.sizeAttenuation!==void 0?e.sizeAttenuation:!0,this.vertexColors=e.vertexColors!==void 0?e.vertexColors:!1,this.fog=e.fog!==void 0?e.fog:!0},THREE.ParticleBasicMaterial.prototype=new THREE.Material,THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial,THREE.ParticleCanvasMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.program=e.program!==void 0?e.program:function(){}},THREE.ParticleCanvasMaterial.prototype=new THREE.Material,THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial,THREE.ParticleDOMMaterial=function(e){THREE.Material.call(this),this.domElement=e},THREE.ShaderMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.fragmentShader=e.fragmentShader!==void 0?e.fragmentShader:"void main() {}",this.vertexShader=e.vertexShader!==void 0?e.vertexShader:"void main() {}",this.uniforms=e.uniforms!==void 0?e.uniforms:{},this.attributes=e.attributes,this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading,this.wireframe=e.wireframe!==void 0?e.wireframe:!1,this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1,this.fog=e.fog!==void 0?e.fog:!1,this.lights=e.lights!==void 0?e.lights:!1,this.vertexColors=e.vertexColors!==void 0?e.vertexColors:THREE.NoColors,this.skinning=e.skinning!==void 0?e.skinning:!1,this.morphTargets=e.morphTargets!==void 0?e.morphTargets:!1,this.morphNormals=e.morphNormals!==void 0?e.morphNormals:!1},THREE.ShaderMaterial.prototype=new THREE.Material,THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial,THREE.Texture=function(e,t,n,r,i,s,o,u){this.id=THREE.TextureCount++,this.image=e,this.mapping=t!==void 0?t:new THREE.UVMapping,this.wrapS=n!==void 0?n:THREE.ClampToEdgeWrapping,this.wrapT=r!==void 0?r:THREE.ClampToEdgeWrapping,this.magFilter=i!==void 0?i:THREE.LinearFilter,this.minFilter=s!==void 0?s:THREE.LinearMipMapLinearFilter,this.format=o!==void 0?o:THREE.RGBAFormat,this.type=u!==void 0?u:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.needsUpdate=this.premultiplyAlpha=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var e=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter,this.format,this.type);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e}},THREE.TextureCount=0,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=0,THREE.ClampToEdgeWrapping=1,THREE.MirroredRepeatWrapping=2,THREE.NearestFilter=3,THREE.NearestMipMapNearestFilter=4,THREE.NearestMipMapLinearFilter=5,THREE.LinearFilter=6,THREE.LinearMipMapNearestFilter=7,THREE.LinearMipMapLinearFilter=8,THREE.ByteType=9,THREE.UnsignedByteType=10,THREE.ShortType=11,THREE.UnsignedShortType=12,THREE.IntType=13,THREE.UnsignedIntType=14,THREE.FloatType=15,THREE.AlphaFormat=16,THREE.RGBFormat=17,THREE.RGBAFormat=18,THREE.LuminanceFormat=19,THREE.LuminanceAlphaFormat=20,THREE.DataTexture=function(e,t,n,r,i,s,o,u,a,f){THREE.Texture.call(this,null,s,o,u,a,f,r,i),this.image={data:e,width:t,height:n}},THREE.DataTexture.prototype=new THREE.Texture,THREE.DataTexture.prototype.constructor=THREE.DataTexture,THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture(this.image.data,this.image.width,this.image.height,this.format,this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e},THREE.Particle=function(e){THREE.Object3D.call(this),this.material=e},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t!==void 0?t:new THREE.ParticleBasicMaterial({color:Math.random()*16777215}),this.sortParticles=!1,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius),this.frustumCulled=!1},THREE.ParticleSystem.prototype=new THREE.Object3D,THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem,THREE.Line=function(e,t,n){THREE.Object3D.call(this),this.geometry=e,this.material=t!==void 0?t:new THREE.LineBasicMaterial({color:Math.random()*16777215}),this.type=n!==void 0?n:THREE.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t!==void 0?t:new THREE.MeshBasicMaterial({color:Math.random()*16777215,wireframe:!0});if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var n=0;n<this.geometry.morphTargets.length;n++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[n].name]=n}}},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.supr=THREE.Object3D.prototype,THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return this.morphTargetDictionary[e]!==void 0?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=new THREE.Object3D,THREE.Bone.prototype.constructor=THREE.Bone,THREE.Bone.prototype.supr=THREE.Object3D.prototype,THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix());if(t||this.matrixWorldNeedsUpdate)e?this.skinMatrix.multiply(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0;var n,r=this.children.length;for(n=0;n<r;n++)this.children[n].update(this.skinMatrix,t)},THREE.SkinnedMesh=function(e,t){THREE.Mesh.call(this,e,t),this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[];var n,r,i,s,o,u;if(this.geometry.bones!==void 0){for(n=0;n<this.geometry.bones.length;n++)i=this.geometry.bones[n],s=i.pos,o=i.rotq,u=i.scl,r=this.addBone(),r.name=i.name,r.position.set(s[0],s[1],s[2]),r.quaternion.set(o[0],o[1],o[2],o[3]),r.useQuaternion=!0,u!==void 0?r.scale.set(u[0],u[1],u[2]):r.scale.set(1,1,1);for(n=0;n<this.bones.length;n++)i=this.geometry.bones[n],r=this.bones[n],i.parent===-1?this.add(r):this.bones[i.parent].add(r);this.boneMatrices=new Float32Array(16*this.bones.length),this.pose()}},THREE.SkinnedMesh.prototype=new THREE.Mesh,THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh,THREE.SkinnedMesh.prototype.addBone=function(e){return e===void 0&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1;for(var e=0,t=this.children.length;e<t;e++){var n=this.children[e];n instanceof THREE.Bone?n.update(this.identityMatrix,!1):n.updateMatrixWorld(!0)}for(var t=this.bones.length,n=this.bones,r=this.boneMatrices,e=0;e<t;e++)n[e].skinMatrix.flattenToArrayOffset(r,e*16)},THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e,t=[],n=0;n<this.bones.length;n++){e=this.bones[n];var r=new THREE.Matrix4;r.getInverse(e.skinMatrix),t.push(r),e.skinMatrix.flattenToArrayOffset(this.boneMatrices,n*16)}if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[],this.geometry.skinVerticesB=[];for(e=0;e<this.geometry.skinIndices.length;e++){var n=this.geometry.vertices[e],i=this.geometry.skinIndices[e].x,s=this.geometry.skinIndices[e].y,r=new THREE.Vector3(n.x,n.y,n.z);this.geometry.skinVerticesA.push(t[i].multiplyVector3(r)),r=new THREE.Vector3(n.x,n.y,n.z),this.geometry.skinVerticesB.push(t[s].multiplyVector3(r)),this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y!==1&&(n=(1-(this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y))*.5,this.geometry.skinWeights[e].x=this.geometry.skinWeights[e].x+n,this.geometry.skinWeights[e].y=this.geometry.skinWeights[e].y+n)}}},THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=new THREE.Mesh,THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh,THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,n=e.animations,r=/([a-z]+)(\d+)/,i=0,s=e.morphTargets.length;i<s;i++){var o=e.morphTargets[i].name.match(r);if(o&&o.length>1){o=o[1],n[o]||(n[o]={start:Infinity,end:-Infinity});var u=n[o];i<u.start&&(u.start=i),i>u.end&&(u.end=i),t||(t=o)}}e.firstAnimation=t},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:n}},THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];n?(this.setFrameRange(n.start,n.end),this.duration=1e3*((n.end-n.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time=this.time+this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||this.time<0)this.direction=this.direction*-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)}else this.time=this.time%this.duration,this.time<0&&(this.time=this.time+this.duration);e=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1),e!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[e]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=e),t=this.time%t/t,this.directionBackwards&&(t=1-t),this.morphTargetInfluences[this.currentKeyframe]=t,this.morphTargetInfluences[this.lastKeyframe]=1-t},THREE.Ribbon=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t},THREE.Ribbon.prototype=new THREE.Object3D,THREE.Ribbon.prototype.constructor=THREE.Ribbon,THREE.LOD=function(){THREE.Object3D.call(this),this.LODs=[]},THREE.LOD.prototype=new THREE.Object3D,THREE.LOD.prototype.constructor=THREE.LOD,THREE.LOD.prototype.supr=THREE.Object3D.prototype,THREE.LOD.prototype.addLevel=function(e,t){t===void 0&&(t=0);for(var t=Math.abs(t),n=0;n<this.LODs.length;n++)if(t<this.LODs[n].visibleAtDistance)break;this.LODs.splice(n,0,{visibleAtDistance:t,object3D:e}),this.add(e)},THREE.LOD.prototype.update=function(e){if(this.LODs.length>1){e.matrixWorldInverse.getInverse(e.matrixWorld),e=e.matrixWorldInverse,e=-(e.elements[2]*this.matrixWorld.elements[12]+e.elements[6]*this.matrixWorld.elements[13]+e.elements[10]*this.matrixWorld.elements[14]+e.elements[14]),this.LODs[0].object3D.visible=!0;for(var t=1;t<this.LODs.length;t++){if(!(e>=this.LODs[t].visibleAtDistance))break;this.LODs[t-1].object3D.visible=!1,this.LODs[t].object3D.visible=!0}for(;t<this.LODs.length;t++)this.LODs[t].object3D.visible=!1}},THREE.Sprite=function(e){THREE.Object3D.call(this),this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.map=e.map!==void 0?e.map:new THREE.Texture,this.blending=e.blending!==void 0?e.blending:THREE.NormalBlending,this.blendSrc=e.blendSrc!==void 0?e.blendSrc:THREE.SrcAlphaFactor,this.blendDst=e.blendDst!==void 0?e.blendDst:THREE.OneMinusSrcAlphaFactor,this.blendEquation=e.blendEquation!==void 0?e.blendEquation:THREE.AddEquation,this.useScreenCoordinates=e.useScreenCoordinates!==void 0?e.useScreenCoordinates:!0,this.mergeWith3D=e.mergeWith3D!==void 0?e.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=e.affectedByDistance!==void 0?e.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=e.scaleByViewport!==void 0?e.scaleByViewport:!this.affectedByDistance,this.alignment=e.alignment instanceof THREE.Vector2?e.alignment:THREE.SpriteAlignment.center,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1)},THREE.Sprite.prototype=new THREE.Object3D,THREE.Sprite.prototype.constructor=THREE.Sprite,THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1)this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y);this.matrixWorldNeedsUpdate=!0},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1),THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1),THREE.Scene=function(){THREE.Object3D.call(this),this.overrideMaterial=this.fog=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=new THREE.Object3D,THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light)this.__lights.indexOf(e)===-1&&this.__lights.push(e);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)&&this.__objects.indexOf(e)===-1){this.__objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);t!==-1&&this.__objectsRemoved.splice(t,1)}for(t=0;t<e.children.length;t++)this.__addObject(e.children[t])},THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light){var t=this.__lights.indexOf(e);t!==-1&&this.__lights.splice(t,1)}else e instanceof THREE.Camera||(t=this.__objects.indexOf(e),t!==-1&&(this.__objects.splice(t,1),this.__objectsRemoved.push(e),t=this.__objectsAdded.indexOf(e),t!==-1&&this.__objectsAdded.splice(t,1)));for(t=0;t<e.children.length;t++)this.__removeObject(e.children[t])},THREE.Fog=function(e,t,n){this.color=new THREE.Color(e),this.near=t!==void 0?t:1,this.far=n!==void 0?n:1e3},THREE.FogExp2=function(e,t){this.color=new THREE.Color(e),this.density=t!==void 0?t:25e-5},THREE.DOMRenderer=function(){console.log("THREE.DOMRenderer",THREE.REVISION);var e,t,n,r,i,s,o,u=new THREE.Projector;o=function(e){for(var t=document.documentElement,n=0;n<e.length;n++)if(typeof t.style[e[n]]=="string")return e[n];return null}(["transform","MozTransform","WebkitTransform","msTransform","OTransform"]),this.domElement=document.createElement("div"),this.setSize=function(e,t){n=e,r=t,i=n/2,s=r/2},this.render=function(n,r){var l,c,p,d,v,m;e=u.projectScene(n,r),t=e.elements,l=0;for(c=t.length;l<c;l++)p=t[l],p instanceof THREE.RenderableParticle&&p.material instanceof THREE.ParticleDOMMaterial&&(d=p.material.domElement,v=p.x*i+i-(d.offsetWidth>>1),m=p.y*s+s-(d.offsetHeight>>1),d.style.left=v+"px",d.style.top=m+"px",d.style.zIndex=Math.abs(Math.floor((1-p.z)*r.far/r.near)),o&&(d.style[o]="scale("+p.scale.x*i+","+p.scale.y*s+")"))}},THREE.CanvasRenderer=function(e){function t(e){y!=e&&(v.globalAlpha=y=e)}function n(e){if(b!=e){switch(e){case THREE.NormalBlending:v.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:v.globalCompositeOperation="lighter"}b=e}}function r(e){w!=e&&(v.strokeStyle=w=e)}function i(e){E!=e&&(v.fillStyle=E=e)}console.log("THREE.CanvasRenderer",THREE.REVISION);var e=e||{},s=this,o,u,a,f=new THREE.Projector,l=e.canvas!==void 0?e.canvas:document.createElement("canvas"),c,h,p,d,v=l.getContext("2d"),m=new THREE.Color(0),g=0,y=1,b=0,w=null,E=null,S=null,x=null,T=null,N,C,k,L,A=new THREE.RenderableVertex,O=new THREE.RenderableVertex,M,_,D,P,H,B,j,F,I,q,R,U,z=new THREE.Color,W=new THREE.Color,X=new THREE.Color,V=new THREE.Color,$=new THREE.Color,J=[],K=[],Q,G,Y,Z,et,tt,nt,rt,it,st,ot=new THREE.Rectangle,ut=new THREE.Rectangle,at=new THREE.Rectangle,ft=!1,lt=new THREE.Color,ct=new THREE.Color,ht=new THREE.Color,pt=new THREE.Vector3,dt,vt,mt,gt,yt,bt,e=16;dt=document.createElement("canvas"),dt.width=dt.height=2,vt=dt.getContext("2d"),vt.fillStyle="rgba(0,0,0,1)",vt.fillRect(0,0,2,2),mt=vt.getImageData(0,0,2,2),gt=mt.data,yt=document.createElement("canvas"),yt.width=yt.height=e,bt=yt.getContext("2d"),bt.translate(-e/2,-e/2),bt.scale(e,e),e--,this.domElement=l,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setSize=function(e,t){c=e,h=t,p=Math.floor(c/2),d=Math.floor(h/2),l.width=c,l.height=h,ot.set(-p,-d,p,d),ut.set(-p,-d,p,d),y=1,b=0,T=x=S=E=w=null},this.setClearColor=function(e,t){m.copy(e),g=t!==void 0?t:1,ut.set(-p,-d,p,d)},this.setClearColorHex=function(e,t){m.setHex(e),g=t!==void 0?t:1,ut.set(-p,-d,p,d)},this.clear=function(){v.setTransform(1,0,0,-1,p,d),ut.isEmpty()||(ut.minSelf(ot),ut.inflate(2),g<1&&v.clearRect(Math.floor(ut.getX()),Math.floor(ut.getY()),Math.floor(ut.getWidth()),Math.floor(ut.getHeight())),g>0&&(n(THREE.NormalBlending),t(1),i("rgba("+Math.floor(m.r*255)+","+Math.floor(m.g*255)+","+Math.floor(m.b*255)+","+g+")"),v.fillRect(Math.floor(ut.getX()),Math.floor(ut.getY()),Math.floor(ut.getWidth()),Math.floor(ut.getHeight()))),ut.empty())},this.render=function(e,l){function c(e){var t,n,r,i;lt.setRGB(0,0,0),ct.setRGB(0,0,0),ht.setRGB(0,0,0),t=0;for(n=e.length;t<n;t++)r=e[t],i=r.color,r instanceof THREE.AmbientLight?(lt.r=lt.r+i.r,lt.g=lt.g+i.g,lt.b=lt.b+i.b):r instanceof THREE.DirectionalLight?(ct.r=ct.r+i.r,ct.g=ct.g+i.g,ct.b=ct.b+i.b):r instanceof THREE.PointLight&&(ht.r=ht.r+i.r,ht.g=ht.g+i.g,ht.b=ht.b+i.b)}function h(e,t,n,r){var i,s,o,u,a,f;i=0;for(s=e.length;i<s;i++)o=e[i],u=o.color,o instanceof THREE.DirectionalLight?(a=o.matrixWorld.getPosition(),f=n.dot(a),f<=0||(f*=o.intensity,r.r=r.r+u.r*f,r.g=r.g+u.g*f,r.b=r.b+u.b*f)):o instanceof THREE.PointLight&&(a=o.matrixWorld.getPosition(),f=n.dot(pt.sub(a,t).normalize()),f<=0||(f*=o.distance==0?1:1-Math.min(t.distanceTo(a)/o.distance,1),f!=0&&(f*=o.intensity,r.r=r.r+u.r*f,r.g=r.g+u.g*f,r.b=r.b+u.b*f)))}function m(e,s,o){t(o.opacity),n(o.blending);var u,a,f,l,c,h;o instanceof THREE.ParticleBasicMaterial?o.map&&(l=o.map.image,c=l.width>>1,h=l.height>>1,o=s.scale.x*p,f=s.scale.y*d,u=o*c,a=f*h,at.set(e.x-u,e.y-a,e.x+u,e.y+a),ot.intersects(at)&&(v.save(),v.translate(e.x,e.y),v.rotate(-s.rotation),v.scale(o,-f),v.translate(-c,-h),v.drawImage(l,0,0),v.restore())):o instanceof THREE.ParticleCanvasMaterial&&(u=s.scale.x*p,a=s.scale.y*d,at.set(e.x-u,e.y-a,e.x+u,e.y+a),ot.intersects(at)&&(r(o.color.getContextStyle()),i(o.color.getContextStyle()),v.save(),v.translate(e.x,e.y),v.rotate(-s.rotation),v.scale(u,a),o.program(v),v.restore()))}function g(e,i,s,o){t(o.opacity),n(o.blending),v.beginPath(),v.moveTo(e.positionScreen.x,e.positionScreen.y),v.lineTo(i.positionScreen.x,i.positionScreen.y),v.closePath(),o instanceof THREE.LineBasicMaterial&&(e=o.linewidth,S!=e&&(v.lineWidth=S=e),e=o.linecap,x!=e&&(v.lineCap=x=e),e=o.linejoin,T!=e&&(v.lineJoin=T=e),r(o.color.getContextStyle()),v.stroke(),at.inflate(o.linewidth*2))}function y(e,r,i,o,u,f,c,p){s.info.render.vertices=s.info.render.vertices+3,s.info.render.faces++,t(p.opacity),n(p.blending),M=e.positionScreen.x,_=e.positionScreen.y,D=r.positionScreen.x,P=r.positionScreen.y,H=i.positionScreen.x,B=i.positionScreen.y,w(M,_,D,P,H,B),p instanceof THREE.MeshBasicMaterial?p.map?p.map.mapping instanceof THREE.UVMapping&&(Z=c.uvs[0],St(M,_,D,P,H,B,Z[o].u,Z[o].v,Z[u].u,Z[u].v,Z[f].u,Z[f].v,p.map)):p.envMap?p.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(e=l.matrixWorldInverse,pt.copy(c.vertexNormalsWorld[o]),et=(pt.x*e.elements[0]+pt.y*e.elements[4]+pt.z*e.elements[8])*.5+.5,tt=-(pt.x*e.elements[1]+pt.y*e.elements[5]+pt.z*e.elements[9])*.5+.5,pt.copy(c.vertexNormalsWorld[u]),nt=(pt.x*e.elements[0]+pt.y*e.elements[4]+pt.z*e.elements[8])*.5+.5,rt=-(pt.x*e.elements[1]+pt.y*e.elements[5]+pt.z*e.elements[9])*.5+.5,pt.copy(c.vertexNormalsWorld[f]),it=(pt.x*e.elements[0]+pt.y*e.elements[4]+pt.z*e.elements[8])*.5+.5,st=-(pt.x*e.elements[1]+pt.y*e.elements[5]+pt.z*e.elements[9])*.5+.5,St(M,_,D,P,H,B,et,tt,nt,rt,it,st,p.envMap)):p.wireframe?wt(p.color,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(p.color):p instanceof THREE.MeshLambertMaterial?ft?!p.wireframe&&p.shading==THREE.SmoothShading&&c.vertexNormalsWorld.length==3?(W.r=X.r=V.r=lt.r,W.g=X.g=V.g=lt.g,W.b=X.b=V.b=lt.b,h(a,c.v1.positionWorld,c.vertexNormalsWorld[0],W),h(a,c.v2.positionWorld,c.vertexNormalsWorld[1],X),h(a,c.v3.positionWorld,c.vertexNormalsWorld[2],V),W.r=Math.max(0,Math.min(p.color.r*W.r,1)),W.g=Math.max(0,Math.min(p.color.g*W.g,1)),W.b=Math.max(0,Math.min(p.color.b*W.b,1)),X.r=Math.max(0,Math.min(p.color.r*X.r,1)),X.g=Math.max(0,Math.min(p.color.g*X.g,1)),X.b=Math.max(0,Math.min(p.color.b*X.b,1)),V.r=Math.max(0,Math.min(p.color.r*V.r,1)),V.g=Math.max(0,Math.min(p.color.g*V.g,1)),V.b=Math.max(0,Math.min(p.color.b*V.b,1)),$.r=(X.r+V.r)*.5,$.g=(X.g+V.g)*.5,$.b=(X.b+V.b)*.5,Y=Tt(W,X,V,$),xt(M,_,D,P,H,B,0,0,1,0,0,1,Y)):(z.r=lt.r,z.g=lt.g,z.b=lt.b,h(a,c.centroidWorld,c.normalWorld,z),z.r=Math.max(0,Math.min(p.color.r*z.r,1)),z.g=Math.max(0,Math.min(p.color.g*z.g,1)),z.b=Math.max(0,Math.min(p.color.b*z.b,1)),p.wireframe?wt(z,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(z)):p.wireframe?wt(p.color,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(p.color):p instanceof THREE.MeshDepthMaterial?(Q=l.near,G=l.far,W.r=W.g=W.b=1-Nt(e.positionScreen.z,Q,G),X.r=X.g=X.b=1-Nt(r.positionScreen.z,Q,G),V.r=V.g=V.b=1-Nt(i.positionScreen.z,Q,G),$.r=(X.r+V.r)*.5,$.g=(X.g+V.g)*.5,$.b=(X.b+V.b)*.5,Y=Tt(W,X,V,$),xt(M,_,D,P,H,B,0,0,1,0,0,1,Y)):p instanceof THREE.MeshNormalMaterial&&(z.r=Ct(c.normalWorld.x),z.g=Ct(c.normalWorld.y),z.b=Ct(c.normalWorld.z),p.wireframe?wt(z,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(z))}function b(e,r,i,o,u,f,c,p,d){s.info.render.vertices=s.info.render.vertices+4,s.info.render.faces++,t(p.opacity),n(p.blending),p.map||p.envMap?(y(e,r,o,0,1,3,c,p,d),y(u,i,f,1,2,3,c,p,d)):(M=e.positionScreen.x,_=e.positionScreen.y,D=r.positionScreen.x,P=r.positionScreen.y,H=i.positionScreen.x,B=i.positionScreen.y,j=o.positionScreen.x,F=o.positionScreen.y,I=u.positionScreen.x,q=u.positionScreen.y,R=f.positionScreen.x,U=f.positionScreen.y,p instanceof THREE.MeshBasicMaterial?(E(M,_,D,P,H,B,j,F),p.wireframe?wt(p.color,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(p.color)):p instanceof THREE.MeshLambertMaterial?ft?!p.wireframe&&p.shading==THREE.SmoothShading&&c.vertexNormalsWorld.length==4?(W.r=X.r=V.r=$.r=lt.r,W.g=X.g=V.g=$.g=lt.g,W.b=X.b=V.b=$.b=lt.b,h(a,c.v1.positionWorld,c.vertexNormalsWorld[0],W),h(a,c.v2.positionWorld,c.vertexNormalsWorld[1],X),h(a,c.v4.positionWorld,c.vertexNormalsWorld[3],V),h(a,c.v3.positionWorld,c.vertexNormalsWorld[2],$),W.r=Math.max(0,Math.min(p.color.r*W.r,1)),W.g=Math.max(0,Math.min(p.color.g*W.g,1)),W.b=Math.max(0,Math.min(p.color.b*W.b,1)),X.r=Math.max(0,Math.min(p.color.r*X.r,1)),X.g=Math.max(0,Math.min(p.color.g*X.g,1)),X.b=Math.max(0,Math.min(p.color.b*X.b,1)),V.r=Math.max(0,Math.min(p.color.r*V.r,1)),V.g=Math.max(0,Math.min(p.color.g*V.g,1)),V.b=Math.max(0,Math.min(p.color.b*V.b,1)),$.r=Math.max(0,Math.min(p.color.r*$.r,1)),$.g=Math.max(0,Math.min(p.color.g*$.g,1)),$.b=Math.max(0,Math.min(p.color.b*$.b,1)),Y=Tt(W,X,V,$),w(M,_,D,P,j,F),xt(M,_,D,P,j,F,0,0,1,0,0,1,Y),w(I,q,H,B,R,U),xt(I,q,H,B,R,U,1,0,1,1,0,1,Y)):(z.r=lt.r,z.g=lt.g,z.b=lt.b,h(a,c.centroidWorld,c.normalWorld,z),z.r=Math.max(0,Math.min(p.color.r*z.r,1)),z.g=Math.max(0,Math.min(p.color.g*z.g,1)),z.b=Math.max(0,Math.min(p.color.b*z.b,1)),E(M,_,D,P,H,B,j,F),p.wireframe?wt(z,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(z)):(E(M,_,D,P,H,B,j,F),p.wireframe?wt(p.color,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(p.color)):p instanceof THREE.MeshNormalMaterial?(z.r=Ct(c.normalWorld.x),z.g=Ct(c.normalWorld.y),z.b=Ct(c.normalWorld.z),E(M,_,D,P,H,B,j,F),p.wireframe?wt(z,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(z)):p instanceof THREE.MeshDepthMaterial&&(Q=l.near,G=l.far,W.r=W.g=W.b=1-Nt(e.positionScreen.z,Q,G),X.r=X.g=X.b=1-Nt(r.positionScreen.z,Q,G),V.r=V.g=V.b=1-Nt(o.positionScreen.z,Q,G),$.r=$.g=$.b=1-Nt(i.positionScreen.z,Q,G),Y=Tt(W,X,V,$),w(M,_,D,P,j,F),xt(M,_,D,P,j,F,0,0,1,0,0,1,Y),w(I,q,H,B,R,U),xt(I,q,H,B,R,U,1,0,1,1,0,1,Y)))}function w(e,t,n,r,i,s){v.beginPath(),v.moveTo(e,t),v.lineTo(n,r),v.lineTo(i,s),v.lineTo(e,t),v.closePath()}function E(e,t,n,r,i,s,o,u){v.beginPath(),v.moveTo(e,t),v.lineTo(n,r),v.lineTo(i,s),v.lineTo(o,u),v.lineTo(e,t),v.closePath()}function wt(e,t,n,i){S!=t&&(v.lineWidth=S=t),x!=n&&(v.lineCap=x=n),T!=i&&(v.lineJoin=T=i),r(e.getContextStyle()),v.stroke(),at.inflate(t*2)}function Et(e){i(e.getContextStyle()),v.fill()}function St(e,t,n,r,s,o,u,a,f,l,c,h,p){if(p.image.width!=0){if(p.needsUpdate==1||J[p.id]==void 0){var d=p.wrapS==THREE.RepeatWrapping,m=p.wrapT==THREE.RepeatWrapping;J[p.id]=v.createPattern(p.image,d&&m?"repeat":d&&!m?"repeat-x":!d&&m?"repeat-y":"no-repeat"),p.needsUpdate=!1}i(J[p.id]);var d=p.offset.x/p.repeat.x,m=p.offset.y/p.repeat.y,g=p.image.width*p.repeat.x,y=p.image.height*p.repeat.y,u=(u+d)*g,a=(a+m)*y,n=n-e,r=r-t,s=s-e,o=o-t,f=(f+d)*g-u,l=(l+m)*y-a,c=(c+d)*g-u,h=(h+m)*y-a,d=f*h-c*l;d==0?(K[p.id]===void 0&&(t=document.createElement("canvas"),t.width=p.image.width,t.height=p.image.height,t=t.getContext("2d"),t.drawImage(p.image,0,0),K[p.id]=t.getImageData(0,0,p.image.width,p.image.height).data),t=K[p.id],u=(Math.floor(u)+Math.floor(a)*p.image.width)*4,z.setRGB(t[u]/255,t[u+1]/255,t[u+2]/255),Et(z)):(d=1/d,p=(h*n-l*s)*d,l=(h*r-l*o)*d,n=(f*s-c*n)*d,r=(f*o-c*r)*d,e=e-p*u-n*a,u=t-l*u-r*a,v.save(),v.transform(p,l,n,r,e,u),v.fill(),v.restore())}}function xt(e,t,n,r,i,s,o,u,a,f,l,c,h){var p,d;p=h.width-1,d=h.height-1,o*=p,u*=d,n-=e,r-=t,i-=e,s-=t,a=a*p-o,f=f*d-u,l=l*p-o,c=c*d-u,d=1/(a*c-l*f),p=(c*n-f*i)*d,f=(c*r-f*s)*d,n=(a*i-l*n)*d,r=(a*s-l*r)*d,e=e-p*o-n*u,t=t-f*o-r*u,v.save(),v.transform(p,f,n,r,e,t),v.clip(),v.drawImage(h,0,0),v.restore()}function Tt(e,t,n,r){var i=~~(e.r*255),s=~~(e.g*255),e=~~(e.b*255),o=~~(t.r*255),u=~~(t.g*255),t=~~(t.b*255),a=~~(n.r*255),f=~~(n.g*255),n=~~(n.b*255),l=~~(r.r*255),c=~~(r.g*255),r=~~(r.b*255);return gt[0]=i<0?0:i>255?255:i,gt[1]=s<0?0:s>255?255:s,gt[2]=e<0?0:e>255?255:e,gt[4]=o<0?0:o>255?255:o,gt[5]=u<0?0:u>255?255:u,gt[6]=t<0?0:t>255?255:t,gt[8]=a<0?0:a>255?255:a,gt[9]=f<0?0:f>255?255:f,gt[10]=n<0?0:n>255?255:n,gt[12]=l<0?0:l>255?255:l,gt[13]=c<0?0:c>255?255:c,gt[14]=r<0?0:r>255?255:r,vt.putImageData(mt,0,0),bt.drawImage(dt,0,0),yt}function Nt(e,t,n){return e=(e-t)/(n-t),e*e*(3-2*e)}function Ct(e){return e=(e+1)*.5,e<0?0:e>1?1:e}function kt(e,t){var n=t.x-e.x,r=t.y-e.y,i=n*n+r*r;i!=0&&(i=1/Math.sqrt(i),n*=i,r*=i,t.x=t.x+n,t.y=t.y+r,e.x=e.x-n,e.y=e.y-r)}var Lt,At,Ot,Mt;this.autoClear?this.clear():v.setTransform(1,0,0,-1,p,d),s.info.render.vertices=0,s.info.render.faces=0,o=f.projectScene(e,l,this.sortElements),u=o.elements,a=o.lights,(ft=a.length>0)&&c(a),Lt=0;for(At=u.length;Lt<At;Lt++)Ot=u[Lt],Mt=Ot.material,Mt=Mt instanceof THREE.MeshFaceMaterial?Ot.faceMaterial:Mt,Mt!==void 0&&Mt.visible!==!1&&(at.empty(),Ot instanceof THREE.RenderableParticle?(N=Ot,N.x=N.x*p,N.y=N.y*d,m(N,Ot,Mt,e)):Ot instanceof THREE.RenderableLine?(N=Ot.v1,C=Ot.v2,N.positionScreen.x=N.positionScreen.x*p,N.positionScreen.y=N.positionScreen.y*d,C.positionScreen.x=C.positionScreen.x*p,C.positionScreen.y=C.positionScreen.y*d,at.addPoint(N.positionScreen.x,N.positionScreen.y),at.addPoint(C.positionScreen.x,C.positionScreen.y),ot.intersects(at)&&g(N,C,Ot,Mt,e)):Ot instanceof THREE.RenderableFace3?(N=Ot.v1,C=Ot.v2,k=Ot.v3,N.positionScreen.x=N.positionScreen.x*p,N.positionScreen.y=N.positionScreen.y*d,C.positionScreen.x=C.positionScreen.x*p,C.positionScreen.y=C.positionScreen.y*d,k.positionScreen.x=k.positionScreen.x*p,k.positionScreen.y=k.positionScreen.y*d,Mt.overdraw&&(kt(N.positionScreen,C.positionScreen),kt(C.positionScreen,k.positionScreen),kt(k.positionScreen,N.positionScreen)),at.add3Points(N.positionScreen.x,N.positionScreen.y,C.positionScreen.x,C.positionScreen.y,k.positionScreen.x,k.positionScreen.y),ot.intersects(at)&&y(N,C,k,0,1,2,Ot,Mt,e)):Ot instanceof THREE.RenderableFace4&&(N=Ot.v1,C=Ot.v2,k=Ot.v3,L=Ot.v4,N.positionScreen.x=N.positionScreen.x*p,N.positionScreen.y=N.positionScreen.y*d,C.positionScreen.x=C.positionScreen.x*p,C.positionScreen.y=C.positionScreen.y*d,k.positionScreen.x=k.positionScreen.x*p,k.positionScreen.y=k.positionScreen.y*d,L.positionScreen.x=L.positionScreen.x*p,L.positionScreen.y=L.positionScreen.y*d,A.positionScreen.copy(C.positionScreen),O.positionScreen.copy(L.positionScreen),Mt.overdraw&&(kt(N.positionScreen,C.positionScreen),kt(C.positionScreen,L.positionScreen),kt(L.positionScreen,N.positionScreen),kt(k.positionScreen,A.positionScreen),kt(k.positionScreen,O.positionScreen)),at.addPoint(N.positionScreen.x,N.positionScreen.y),at.addPoint(C.positionScreen.x,C.positionScreen.y),at.addPoint(k.positionScreen.x,k.positionScreen.y),at.addPoint(L.positionScreen.x,L.positionScreen.y),ot.intersects(at)&&b(N,C,k,L,A,O,Ot,Mt,e)),ut.addRectangle(at));v.setTransform(1,0,0,1,0,0)}},THREE.SVGRenderer=function(){function e(e,t,n,r){var i,s,o,u,a,f;i=0;for(s=e.length;i<s;i++)o=e[i],u=o.color,o instanceof THREE.DirectionalLight?(a=o.matrixWorld.getPosition(),f=n.dot(a),f<=0||(f*=o.intensity,r.r=r.r+u.r*f,r.g=r.g+u.g*f,r.b=r.b+u.b*f)):o instanceof THREE.PointLight&&(a=o.matrixWorld.getPosition(),f=n.dot(N.sub(a,t).normalize()),f<=0||(f*=o.distance==0?1:1-Math.min(t.distanceTo(a)/o.distance,1),f!=0&&(f*=o.intensity,r.r=r.r+u.r*f,r.g=r.g+u.g*f,r.b=r.b+u.b*f)))}function t(e){return C[e]==null&&(C[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),M==0&&C[e].setAttribute("shape-rendering","crispEdges")),C[e]}function n(e){return e=(e+1)*.5,e<0?0:e>1?1:e}console.log("THREE.SVGRenderer",THREE.REVISION);var r=this,i,s,o,u=new THREE.Projector,a=document.createElementNS("http://www.w3.org/2000/svg","svg"),f,l,c,h,p,d,v,m,g=new THREE.Rectangle,y=new THREE.Rectangle,b=!1,w=new THREE.Color,E=new THREE.Color,S=new THREE.Color,x=new THREE.Color,T,N=new THREE.Vector3,C=[],k=[],L,A,O,M=1;this.domElement=a,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":M=1;break;case"low":M=0}},this.setSize=function(e,t){f=e,l=t,c=f/2,h=l/2,a.setAttribute("viewBox",-c+" "+ -h+" "+f+" "+l),a.setAttribute("width",f),a.setAttribute("height",l),g.set(-c,-h,c,h)},this.clear=function(){for(;a.childNodes.length>0;)a.removeChild(a.childNodes[0])},this.render=function(f,l){var N,C,_,B;this.autoClear&&this.clear(),r.info.render.vertices=0,r.info.render.faces=0,i=u.projectScene(f,l,this.sortElements),s=i.elements,o=i.lights,O=A=0;if(b=o.length>0){E.setRGB(0,0,0),S.setRGB(0,0,0),x.setRGB(0,0,0),N=0;for(C=o.length;N<C;N++)B=o[N],_=B.color,B instanceof THREE.AmbientLight?(E.r=E.r+_.r,E.g=E.g+_.g,E.b=E.b+_.b):B instanceof THREE.DirectionalLight?(S.r=S.r+_.r,S.g=S.g+_.g,S.b=S.b+_.b):B instanceof THREE.PointLight&&(x.r=x.r+_.r,x.g=x.g+_.g,x.b=x.b+_.b)}N=0;for(C=s.length;N<C;N++){_=s[N],B=_.material,B=B instanceof THREE.MeshFaceMaterial?_.faceMaterial:B;if(B!==void 0&&B.visible!==!1){y.empty();if(_ instanceof THREE.RenderableParticle)p=_,p.x=p.x*c,p.y=p.y*-h;else if(_ instanceof THREE.RenderableLine){p=_.v1,d=_.v2,p.positionScreen.x=p.positionScreen.x*c,p.positionScreen.y=p.positionScreen.y*-h,d.positionScreen.x=d.positionScreen.x*c,d.positionScreen.y=d.positionScreen.y*-h,y.addPoint(p.positionScreen.x,p.positionScreen.y),y.addPoint(d.positionScreen.x,d.positionScreen.y);if(g.intersects(y)){_=p;var F=d,I=O++;k[I]==null&&(k[I]=document.createElementNS("http://www.w3.org/2000/svg","line"),M==0&&k[I].setAttribute("shape-rendering","crispEdges")),L=k[I],L.setAttribute("x1",_.positionScreen.x),L.setAttribute("y1",_.positionScreen.y),L.setAttribute("x2",F.positionScreen.x),L.setAttribute("y2",F.positionScreen.y),B instanceof THREE.LineBasicMaterial&&(L.setAttribute("style","fill: none; stroke: "+B.color.getContextStyle()+"; stroke-width: "+B.linewidth+"; stroke-opacity: "+B.opacity+"; stroke-linecap: "+B.linecap+"; stroke-linejoin: "+B.linejoin),a.appendChild(L))}}else if(_ instanceof THREE.RenderableFace3){p=_.v1,d=_.v2,v=_.v3,p.positionScreen.x=p.positionScreen.x*c,p.positionScreen.y=p.positionScreen.y*-h,d.positionScreen.x=d.positionScreen.x*c,d.positionScreen.y=d.positionScreen.y*-h,v.positionScreen.x=v.positionScreen.x*c,v.positionScreen.y=v.positionScreen.y*-h,y.addPoint(p.positionScreen.x,p.positionScreen.y),y.addPoint(d.positionScreen.x,d.positionScreen.y),y.addPoint(v.positionScreen.x,v.positionScreen.y);if(g.intersects(y)){var F=p,I=d,U=v;r.info.render.vertices=r.info.render.vertices+3,r.info.render.faces++,L=t(A++),L.setAttribute("d","M "+F.positionScreen.x+" "+F.positionScreen.y+" L "+I.positionScreen.x+" "+I.positionScreen.y+" L "+U.positionScreen.x+","+U.positionScreen.y+"z"),B instanceof THREE.MeshBasicMaterial?w.copy(B.color):B instanceof THREE.MeshLambertMaterial?b?(w.r=E.r,w.g=E.g,w.b=E.b,e(o,_.centroidWorld,_.normalWorld,w),w.r=Math.max(0,Math.min(B.color.r*w.r,1)),w.g=Math.max(0,Math.min(B.color.g*w.g,1)),w.b=Math.max(0,Math.min(B.color.b*w.b,1))):w.copy(B.color):B instanceof THREE.MeshDepthMaterial?(T=1-B.__2near/(B.__farPlusNear-_.z*B.__farMinusNear),w.setRGB(T,T,T)):B instanceof THREE.MeshNormalMaterial&&w.setRGB(n(_.normalWorld.x),n(_.normalWorld.y),n(_.normalWorld.z)),B.wireframe?L.setAttribute("style","fill: none; stroke: "+w.getContextStyle()+"; stroke-width: "+B.wireframeLinewidth+"; stroke-opacity: "+B.opacity+"; stroke-linecap: "+B.wireframeLinecap+"; stroke-linejoin: "+B.wireframeLinejoin):L.setAttribute("style","fill: "+w.getContextStyle()+"; fill-opacity: "+B.opacity),a.appendChild(L)}}else if(_ instanceof THREE.RenderableFace4){p=_.v1,d=_.v2,v=_.v3,m=_.v4,p.positionScreen.x=p.positionScreen.x*c,p.positionScreen.y=p.positionScreen.y*-h,d.positionScreen.x=d.positionScreen.x*c,d.positionScreen.y=d.positionScreen.y*-h,v.positionScreen.x=v.positionScreen.x*c,v.positionScreen.y=v.positionScreen.y*-h,m.positionScreen.x=m.positionScreen.x*c,m.positionScreen.y=m.positionScreen.y*-h,y.addPoint(p.positionScreen.x,p.positionScreen.y),y.addPoint(d.positionScreen.x,d.positionScreen.y),y.addPoint(v.positionScreen.x,v.positionScreen.y),y.addPoint(m.positionScreen.x,m.positionScreen.y);if(g.intersects(y)){var F=p,I=d,U=v,W=m;r.info.render.vertices=r.info.render.vertices+4,r.info.render.faces++,L=t(A++),L.setAttribute("d","M "+F.positionScreen.x+" "+F.positionScreen.y+" L "+I.positionScreen.x+" "+I.positionScreen.y+" L "+U.positionScreen.x+","+U.positionScreen.y+" L "+W.positionScreen.x+","+W.positionScreen.y+"z"),B instanceof THREE.MeshBasicMaterial?w.copy(B.color):B instanceof THREE.MeshLambertMaterial?b?(w.r=E.r,w.g=E.g,w.b=E.b,e(o,_.centroidWorld,_.normalWorld,w),w.r=Math.max(0,Math.min(B.color.r*w.r,1)),w.g=Math.max(0,Math.min(B.color.g*w.g,1)),w.b=Math.max(0,Math.min(B.color.b*w.b,1))):w.copy(B.color):B instanceof THREE.MeshDepthMaterial?(T=1-B.__2near/(B.__farPlusNear-_.z*B.__farMinusNear),w.setRGB(T,T,T)):B instanceof THREE.MeshNormalMaterial&&w.setRGB(n(_.normalWorld.x),n(_.normalWorld.y),n(_.normalWorld.z)),B.wireframe?L.setAttribute("style","fill: none; stroke: "+w.getContextStyle()+"; stroke-width: "+B.wireframeLinewidth+"; stroke-opacity: "+B.opacity+"; stroke-linecap: "+B.wireframeLinecap+"; stroke-linejoin: "+B.wireframeLinejoin):L.setAttribute("style","fill: "+w.getContextStyle()+"; fill-opacity: "+B.opacity),a.appendChild(L)}}}}}},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nlVector = normalize( lVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - mPosition.xyz ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvWorldPosition = mPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * modelViewMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\nvec3 transformedNormal = normalMatrix * morphedNormal;\n#else\nvec3 transformedNormal = normalMatrix * normal;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n#ifdef USE_MORPHTARGETS\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( morphed, 1.0 );\n#else\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n#endif\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},THREE.UniformsUtils={merge:function(e){var t,n,r,i={};for(t=0;t<e.length;t++){r=this.clone(e[t]);for(n in r)i[n]=r[n]}return i},clone:function(e){var t,n,r,i={};for(t in e){i[t]={};for(n in e[t])r=e[t][n],i[t][n]=r instanceof THREE.Color||r instanceof THREE.Vector2||r instanceof THREE.Vector3||r instanceof THREE.Vector4||r instanceof THREE.Matrix4||r instanceof THREE.Texture?r.clone():r instanceof Array?r.slice():r}return i}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngle:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalMatrix * normal;\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["varying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif",THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.morphnormal_vertex,"vNormal = transformedNormal;",THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},THREE.WebGLRenderer=function(e){function t(e,t){var n=e.vertices.length,r=t.material;if(r.attributes){e.__webglCustomAttributesList===void 0&&(e.__webglCustomAttributesList=[]);for(var i in r.attributes){var s=r.attributes[i];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=!0;var o=1;s.type==="v2"?o=2:s.type==="v3"?o=3:s.type==="v4"?o=4:s.type==="c"&&(o=3),s.size=o,s.array=new Float32Array(n*o),s.buffer=P.createBuffer(),s.buffer.belongsToAttribute=i,s.needsUpdate=!0}e.__webglCustomAttributesList.push(s)}}}function n(e,t){if(!(!e.material||e.material instanceof THREE.MeshFaceMaterial))return e.material;if(t.materialIndex>=0)return e.geometry.materials[t.materialIndex]}function r(e){return e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial?!1:e&&e.shading!==void 0&&e.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function i(e){return e.map||e.lightMap||e instanceof THREE.ShaderMaterial?!0:!1}function s(e,t,n){var r,i,s,o,u=e.vertices;o=u.length;var a=e.colors,f=a.length,l=e.__vertexArray,c=e.__colorArray,h=e.__sortArray,p=e.verticesNeedUpdate,d=e.colorsNeedUpdate,v=e.__webglCustomAttributesList;if(n.sortParticles){at.copy(ut),at.multiplySelf(n.matrixWorld);for(r=0;r<o;r++)i=u[r],ft.copy(i),at.multiplyVector3(ft),h[r]=[ft.z,r];h.sort(function(e,t){return t[0]-e[0]});for(r=0;r<o;r++)i=u[h[r][1]],s=r*3,l[s]=i.x,l[s+1]=i.y,l[s+2]=i.z;for(r=0;r<f;r++)s=r*3,i=a[h[r][1]],c[s]=i.r,c[s+1]=i.g,c[s+2]=i.b;if(v){a=0;for(f=v.length;a<f;a++){u=v[a];if(u.boundTo===void 0||u.boundTo==="vertices"){s=0,i=u.value.length;if(u.size===1)for(r=0;r<i;r++)o=h[r][1],u.array[r]=u.value[o];else if(u.size===2)for(r=0;r<i;r++)o=h[r][1],o=u.value[o],u.array[s]=o.x,u.array[s+1]=o.y,s+=2;else if(u.size===3)if(u.type==="c")for(r=0;r<i;r++)o=h[r][1],o=u.value[o],u.array[s]=o.r,u.array[s+1]=o.g,u.array[s+2]=o.b,s+=3;else for(r=0;r<i;r++)o=h[r][1],o=u.value[o],u.array[s]=o.x,u.array[s+1]=o.y,u.array[s+2]=o.z,s+=3;else if(u.size===4)for(r=0;r<i;r++)o=h[r][1],o=u.value[o],u.array[s]=o.x,u.array[s+1]=o.y,u.array[s+2]=o.z,u.array[s+3]=o.w,s+=4}}}}else{if(p)for(r=0;r<o;r++)i=u[r],s=r*3,l[s]=i.x,l[s+1]=i.y,l[s+2]=i.z;if(d)for(r=0;r<f;r++)i=a[r],s=r*3,c[s]=i.r,c[s+1]=i.g,c[s+2]=i.b;if(v){a=0;for(f=v.length;a<f;a++){u=v[a];if(u.needsUpdate&&(u.boundTo===void 0||u.boundTo==="vertices")){i=u.value.length,s=0;if(u.size===1)for(r=0;r<i;r++)u.array[r]=u.value[r];else if(u.size===2)for(r=0;r<i;r++)o=u.value[r],u.array[s]=o.x,u.array[s+1]=o.y,s+=2;else if(u.size===3)if(u.type==="c")for(r=0;r<i;r++)o=u.value[r],u.array[s]=o.r,u.array[s+1]=o.g,u.array[s+2]=o.b,s+=3;else for(r=0;r<i;r++)o=u.value[r],u.array[s]=o.x,u.array[s+1]=o.y,u.array[s+2]=o.z,s+=3;else if(u.size===4)for(r=0;r<i;r++)o=u.value[r],u.array[s]=o.x,u.array[s+1]=o.y,u.array[s+2]=o.z,u.array[s+3]=o.w,s+=4}}}}if(p||n.sortParticles)P.bindBuffer(P.ARRAY_BUFFER,e.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,l,t);if(d||n.sortParticles)P.bindBuffer(P.ARRAY_BUFFER,e.__webglColorBuffer),P.bufferData(P.ARRAY_BUFFER,c,t);if(v){a=0;for(f=v.length;a<f;a++){u=v[a];if(u.needsUpdate||n.sortParticles)P.bindBuffer(P.ARRAY_BUFFER,u.buffer),P.bufferData(P.ARRAY_BUFFER,u.array,t)}}}function o(e,t){return t.z-e.z}function u(e,t,n){if(e.length)for(var r=0,i=e.length;r<i;r++)q=B=null,F=I=z=U=K=J=W=-1,ct=!0,e[r].render(t,n,it,st),q=B=null,F=I=z=U=K=J=W=-1,ct=!0}function a(e,t,n,r,i,s,o,u){var a,f,l,c;t?(f=e.length-1,c=t=-1):(f=0,t=e.length,c=1);for(var h=f;h!==t;h+=c){a=e[h];if(a.render){f=a.object,l=a.buffer;if(u)a=u;else{a=a[n];if(!a)continue;o&&D.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst),D.setDepthTest(a.depthTest),D.setDepthWrite(a.depthWrite),g(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}D.setObjectFaces(f),l instanceof THREE.BufferGeometry?D.renderBufferDirect(r,i,s,a,l,f):D.renderBuffer(r,i,s,a,l,f)}}}function f(e,t,n,r,i,s,o){for(var u,a,f=0,l=e.length;f<l;f++){u=e[f],a=u.object;if(a.visible){if(o)u=o;else{u=u[t];if(!u)continue;s&&D.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),D.setDepthTest(u.depthTest),D.setDepthWrite(u.depthWrite),g(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}D.renderImmediateObject(n,r,i,u,a)}}}function l(e,t,n){e.push({buffer:t,object:n,opaque:null,transparent:null})}function c(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function h(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function p(e,t){for(var n=e.length-1;n>=0;n--)e[n].object===t&&e.splice(n,1)}function d(e,t){for(var n=e.length-1;n>=0;n--)e[n]===t&&e.splice(n,1)}function v(e,t,n,r,i){if(!r.program||r.needsUpdate)D.initMaterial(r,t,n,i),r.needsUpdate=!1;if(r.morphTargets&&!i.__webglMorphTargetInfluences){i.__webglMorphTargetInfluences=new Float32Array(D.maxMorphTargets);for(var s=0,o=D.maxMorphTargets;s<o;s++)i.__webglMorphTargetInfluences[s]=0}var u=!1,s=r.program,o=s.uniforms,a=r.uniforms;s!==B&&(P.useProgram(s),B=s,u=!0),r.id!==F&&(F=r.id,u=!0);if(u||e!==q)P.uniformMatrix4fv(o.projectionMatrix,!1,e._projectionMatrixArray),e!==q&&(q=e);if(u){n&&r.fog&&(a.fogColor.value=n.color,n instanceof THREE.Fog?(a.fogNear.value=n.near,a.fogFar.value=n.far):n instanceof THREE.FogExp2&&(a.fogDensity.value=n.density));if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){if(ct){for(var f,l=0,c=0,h=0,p,d,v,m=ht,g=m.directional.colors,y=m.directional.positions,w=m.point.colors,E=m.point.positions,T=m.point.distances,N=m.spot.colors,C=m.spot.positions,k=m.spot.distances,L=m.spot.directions,A=m.spot.angles,O=m.spot.exponents,M=0,_=0,H=0,j=v=0,n=j=0,u=t.length;n<u;n++)f=t[n],f.onlyShadow||(p=f.color,d=f.intensity,v=f.distance,f instanceof THREE.AmbientLight?D.gammaInput?(l+=p.r*p.r,c+=p.g*p.g,h+=p.b*p.b):(l+=p.r,c+=p.g,h+=p.b):f instanceof THREE.DirectionalLight?(v=M*3,D.gammaInput?(g[v]=p.r*p.r*d*d,g[v+1]=p.g*p.g*d*d,g[v+2]=p.b*p.b*d*d):(g[v]=p.r*d,g[v+1]=p.g*d,g[v+2]=p.b*d),lt.copy(f.matrixWorld.getPosition()),lt.subSelf(f.target.matrixWorld.getPosition()),lt.normalize(),y[v]=lt.x,y[v+1]=lt.y,y[v+2]=lt.z,M+=1):f instanceof THREE.PointLight?(j=_*3,D.gammaInput?(w[j]=p.r*p.r*d*d,w[j+1]=p.g*p.g*d*d,w[j+2]=p.b*p.b*d*d):(w[j]=p.r*d,w[j+1]=p.g*d,w[j+2]=p.b*d),p=f.matrixWorld.getPosition(),E[j]=p.x,E[j+1]=p.y,E[j+2]=p.z,T[_]=v,_+=1):f instanceof THREE.SpotLight&&(j=H*3,D.gammaInput?(N[j]=p.r*p.r*d*d,N[j+1]=p.g*p.g*d*d,N[j+2]=p.b*p.b*d*d):(N[j]=p.r*d,N[j+1]=p.g*d,N[j+2]=p.b*d),p=f.matrixWorld.getPosition(),C[j]=p.x,C[j+1]=p.y,C[j+2]=p.z,k[H]=v,lt.copy(p),lt.subSelf(f.target.matrixWorld.getPosition()),lt.normalize(),L[j]=lt.x,L[j+1]=lt.y,L[j+2]=lt.z,A[H]=Math.cos(f.angle),O[H]=f.exponent,H+=1));n=M*3;for(u=g.length;n<u;n++)g[n]=0;n=_*3;for(u=w.length;n<u;n++)w[n]=0;n=H*3;for(u=N.length;n<u;n++)N[n]=0;m.directional.length=M,m.point.length=_,m.spot.length=H,m.ambient[0]=l,m.ambient[1]=c,m.ambient[2]=h,ct=!1}n=ht,a.ambientLightColor.value=n.ambient,a.directionalLightColor.value=n.directional.colors,a.directionalLightDirection.value=n.directional.positions,a.pointLightColor.value=n.point.colors,a.pointLightPosition.value=n.point.positions,a.pointLightDistance.value=n.point.distances,a.spotLightColor.value=n.spot.colors,a.spotLightPosition.value=n.spot.positions,a.spotLightDistance.value=n.spot.distances,a.spotLightDirection.value=n.spot.directions,a.spotLightAngle.value=n.spot.angles,a.spotLightExponent.value=n.spot.exponents}if(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)a.opacity.value=r.opacity,D.gammaInput?a.diffuse.value.copyGammaToLinear(r.color):a.diffuse.value=r.color,(a.map.texture=r.map)&&a.offsetRepeat.value.set(r.map.offset.x,r.map.offset.y,r.map.repeat.x,r.map.repeat.y),a.lightMap.texture=r.lightMap,a.envMap.texture=r.envMap,a.flipEnvMap.value=r.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,a.reflectivity.value=r.reflectivity,a.refractionRatio.value=r.refractionRatio,a.combine.value=r.combine,a.useRefract.value=r.envMap&&r.envMap.mapping instanceof THREE.CubeRefractionMapping;r instanceof THREE.LineBasicMaterial?(a.diffuse.value=r.color,a.opacity.value=r.opacity):r instanceof THREE.ParticleBasicMaterial?(a.psColor.value=r.color,a.opacity.value=r.opacity,a.size.value=r.size,a.scale.value=x.height/2,a.map.texture=r.map):r instanceof THREE.MeshPhongMaterial?(a.shininess.value=r.shininess,D.gammaInput?(a.ambient.value.copyGammaToLinear(r.ambient),a.emissive.value.copyGammaToLinear(r.emissive),a.specular.value.copyGammaToLinear(r.specular)):(a.ambient.value=r.ambient,a.emissive.value=r.emissive,a.specular.value=r.specular),r.wrapAround&&a.wrapRGB.value.copy(r.wrapRGB)):r instanceof THREE.MeshLambertMaterial?(D.gammaInput?(a.ambient.value.copyGammaToLinear(r.ambient),a.emissive.value.copyGammaToLinear(r.emissive)):(a.ambient.value=r.ambient,a.emissive.value=r.emissive),r.wrapAround&&a.wrapRGB.value.copy(r.wrapRGB)):r instanceof THREE.MeshDepthMaterial?(a.mNear.value=e.near,a.mFar.value=e.far,a.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(a.opacity.value=r.opacity);if(i.receiveShadow&&!r._shadowPass&&a.shadowMatrix){u=n=0;for(f=t.length;u<f;u++)l=t[u],l.castShadow&&(l instanceof THREE.SpotLight||l instanceof THREE.DirectionalLight&&!l.shadowCascade)&&(a.shadowMap.texture[n]=l.shadowMap,a.shadowMapSize.value[n]=l.shadowMapSize,a.shadowMatrix.value[n]=l.shadowMatrix,a.shadowDarkness.value[n]=l.shadowDarkness,a.shadowBias.value[n]=l.shadowBias,n++)}t=r.uniformsList,a=0;for(n=t.length;a<n;a++)if(l=s.uniforms[t[a][1]]){u=t[a][0],c=u.type,f=u.value;switch(c){case"i":P.uniform1i(l,f);break;case"f":P.uniform1f(l,f);break;case"v2":P.uniform2f(l,f.x,f.y);break;case"v3":P.uniform3f(l,f.x,f.y,f.z);break;case"v4":P.uniform4f(l,f.x,f.y,f.z,f.w);break;case"c":P.uniform3f(l,f.r,f.g,f.b);break;case"fv1":P.uniform1fv(l,f);break;case"fv":P.uniform3fv(l,f);break;case"v2v":u._array||(u._array=new Float32Array(2*f.length)),c=0;for(h=f.length;c<h;c++)m=c*2,u._array[m]=f[c].x,u._array[m+1]=f[c].y;P.uniform2fv(l,u._array);break;case"v3v":u._array||(u._array=new Float32Array(3*f.length)),c=0;for(h=f.length;c<h;c++)m=c*3,u._array[m]=f[c].x,u._array[m+1]=f[c].y,u._array[m+2]=f[c].z;P.uniform3fv(l,u._array);break;case"v4v":u._array||(u._array=new Float32Array(4*f.length)),c=0;for(h=f.length;c<h;c++)m=c*4,u._array[m]=f[c].x,u._array[m+1]=f[c].y,u._array[m+2]=f[c].z,u._array[m+3]=f[c].w;P.uniform4fv(l,u._array);break;case"m4":u._array||(u._array=new Float32Array(16)),f.flattenToArray(u._array),P.uniformMatrix4fv(l,!1,u._array);break;case"m4v":u._array||(u._array=new Float32Array(16*f.length)),c=0;for(h=f.length;c<h;c++)f[c].flattenToArrayOffset(u._array,c*16);P.uniformMatrix4fv(l,!1,u._array);break;case"t":P.uniform1i(l,f),l=u.texture;if(!l)continue;if(l.image instanceof Array&&l.image.length===6){u=l;if(u.image.length===6)if(u.needsUpdate){u.image.__webglTextureCube||(u.image.__webglTextureCube=P.createTexture()),P.activeTexture(P.TEXTURE0+f),P.bindTexture(P.TEXTURE_CUBE_MAP,u.image.__webglTextureCube),f=[];for(l=0;l<6;l++)c=f,h=l,D.autoScaleCubemaps?(m=u.image[l],y=dt,m.width<=y&&m.height<=y||(w=Math.max(m.width,m.height),g=Math.floor(m.width*y/w),y=Math.floor(m.height*y/w),w=document.createElement("canvas"),w.width=g,w.height=y,w.getContext("2d").drawImage(m,0,0,m.width,m.height,0,0,g,y),m=w)):m=u.image[l],c[h]=m;l=f[0],c=(l.width&l.width-1)===0&&(l.height&l.height-1)===0,h=S(u.format),m=S(u.type),b(P.TEXTURE_CUBE_MAP,u,c);for(l=0;l<6;l++)P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,h,h,m,f[l]);u.generateMipmaps&&c&&P.generateMipmap(P.TEXTURE_CUBE_MAP),u.needsUpdate=!1,u.onUpdate&&u.onUpdate()}else P.activeTexture(P.TEXTURE0+f),P.bindTexture(P.TEXTURE_CUBE_MAP,u.image.__webglTextureCube)}else l instanceof THREE.WebGLRenderTargetCube?(u=l,P.activeTexture(P.TEXTURE0+f),P.bindTexture(P.TEXTURE_CUBE_MAP,u.__webglTexture)):D.setTexture(l,f);break;case"tv":if(!u._array){u._array=[],c=0;for(h=u.texture.length;c<h;c++)u._array[c]=f+c}P.uniform1iv(l,u._array),c=0;for(h=u.texture.length;c<h;c++)(l=u.texture[c])&&D.setTexture(l,u._array[c])}}(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&o.cameraPosition!==null&&(t=e.matrixWorld.getPosition(),P.uniform3f(o.cameraPosition,t.x,t.y,t.z)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&o.viewMatrix!==null&&P.uniformMatrix4fv(o.viewMatrix,!1,e._viewMatrixArray),r.skinning&&P.uniformMatrix4fv(o.boneGlobalMatrices,!1,i.boneMatrices)}return P.uniformMatrix4fv(o.modelViewMatrix,!1,i._modelViewMatrix.elements),o.normalMatrix&&P.uniformMatrix3fv(o.normalMatrix,!1,i._normalMatrix.elements),o.objectMatrix!==null&&P.uniformMatrix4fv(o.objectMatrix,!1,i.matrixWorld.elements),s}function m(e,t){e._modelViewMatrix.multiply(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getInverse(e._modelViewMatrix),e._normalMatrix.transpose()}function g(e,t,n){Q!==e&&(e?P.enable(P.POLYGON_OFFSET_FILL):P.disable(P.POLYGON_OFFSET_FILL),Q=e),e&&(G!==t||Y!==n)&&(P.polygonOffset(t,n),G=t,Y=n)}function y(e,t){var n;return e==="fragment"?n=P.createShader(P.FRAGMENT_SHADER):e==="vertex"&&(n=P.createShader(P.VERTEX_SHADER)),P.shaderSource(n,t),P.compileShader(n),P.getShaderParameter(n,P.COMPILE_STATUS)?n:(console.error(P.getShaderInfoLog(n)),console.error(t),null)}function b(e,t,n){n?(P.texParameteri(e,P.TEXTURE_WRAP_S,S(t.wrapS)),P.texParameteri(e,P.TEXTURE_WRAP_T,S(t.wrapT)),P.texParameteri(e,P.TEXTURE_MAG_FILTER,S(t.magFilter)),P.texParameteri(e,P.TEXTURE_MIN_FILTER,S(t.minFilter))):(P.texParameteri(e,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(e,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),P.texParameteri(e,P.TEXTURE_MAG_FILTER,E(t.magFilter)),P.texParameteri(e,P.TEXTURE_MIN_FILTER,E(t.minFilter)))}function w(e,t){P.bindRenderbuffer(P.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(P.renderbufferStorage(P.RENDERBUFFER,P.DEPTH_COMPONENT16,t.width,t.height),P.framebufferRenderbuffer(P.FRAMEBUFFER,P.DEPTH_ATTACHMENT,P.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(P.renderbufferStorage(P.RENDERBUFFER,P.DEPTH_STENCIL,t.width,t.height),P.framebufferRenderbuffer(P.FRAMEBUFFER,P.DEPTH_STENCIL_ATTACHMENT,P.RENDERBUFFER,e)):P.renderbufferStorage(P.RENDERBUFFER,P.RGBA4,t.width,t.height)}function E(e){switch(e){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return P.NEAREST;default:return P.LINEAR}}function S(e){switch(e){case THREE.RepeatWrapping:return P.REPEAT;case THREE.ClampToEdgeWrapping:return P.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return P.MIRRORED_REPEAT;case THREE.NearestFilter:return P.NEAREST;case THREE.NearestMipMapNearestFilter:return P.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return P.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return P.LINEAR;case THREE.LinearMipMapNearestFilter:return P.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return P.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return P.BYTE;case THREE.UnsignedByteType:return P.UNSIGNED_BYTE;case THREE.ShortType:return P.SHORT;case THREE.UnsignedShortType:return P.UNSIGNED_SHORT;case THREE.IntType:return P.INT;case THREE.UnsignedIntType:return P.UNSIGNED_INT;case THREE.FloatType:return P.FLOAT;case THREE.AlphaFormat:return P.ALPHA;case THREE.RGBFormat:return P.RGB;case THREE.RGBAFormat:return P.RGBA;case THREE.LuminanceFormat:return P.LUMINANCE;case THREE.LuminanceAlphaFormat:return P.LUMINANCE_ALPHA;case THREE.AddEquation:return P.FUNC_ADD;case THREE.SubtractEquation:return P.FUNC_SUBTRACT;case THREE.ReverseSubtractEquation:return P.FUNC_REVERSE_SUBTRACT;case THREE.ZeroFactor:return P.ZERO;case THREE.OneFactor:return P.ONE;case THREE.SrcColorFactor:return P.SRC_COLOR;case THREE.OneMinusSrcColorFactor:return P.ONE_MINUS_SRC_COLOR;case THREE.SrcAlphaFactor:return P.SRC_ALPHA;case THREE.OneMinusSrcAlphaFactor:return P.ONE_MINUS_SRC_ALPHA;case THREE.DstAlphaFactor:return P.DST_ALPHA;case THREE.OneMinusDstAlphaFactor:return P.ONE_MINUS_DST_ALPHA;case THREE.DstColorFactor:return P.DST_COLOR;case THREE.OneMinusDstColorFactor:return P.ONE_MINUS_DST_COLOR;case THREE.SrcAlphaSaturateFactor:return P.SRC_ALPHA_SATURATE}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION);var e=e||{},x=e.canvas!==void 0?e.canvas:document.createElement("canvas"),T=e.precision!==void 0?e.precision:"highp",N=e.alpha!==void 0?e.alpha:!0,C=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,k=e.antialias!==void 0?e.antialias:!1,L=e.stencil!==void 0?e.stencil:!0,A=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,O=e.clearColor!==void 0?new THREE.Color(e.clearColor):new THREE.Color(0),M=e.clearAlpha!==void 0?e.clearAlpha:0,_=e.maxLights!==void 0?e.maxLights:4;this.domElement=x,this.context=null,this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1,this.shadowMapCullFrontFaces=this.shadowMapSoft=this.shadowMapAutoUpdate=!0,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var D=this,P,H=[],B=null,j=null,F=-1,I=null,q=null,R=0,U=-1,z=-1,W=-1,X=-1,V=-1,$=-1,J=-1,K=-1,Q=null,G=null,Y=null,Z=null,et=0,tt=0,nt=0,rt=0,it=0,st=0,ot=new THREE.Frustum,ut=new THREE.Matrix4,at=new THREE.Matrix4,ft=new THREE.Vector4,lt=new THREE.Vector3,ct=!0,ht={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],angles:[],exponents:[]}};P=function(){var e;try{if(!(e=x.getContext("experimental-webgl",{alpha:N,premultipliedAlpha:C,antialias:k,stencil:L,preserveDrawingBuffer:A})))throw"Error creating WebGL context."}catch(t){console.error(t)}return e.getExtension("OES_texture_float")||console.log("THREE.WebGLRenderer: Float textures not supported."),e}(),P.clearColor(0,0,0,1),P.clearDepth(1),P.clearStencil(0),P.enable(P.DEPTH_TEST),P.depthFunc(P.LEQUAL),P.frontFace(P.CCW),P.cullFace(P.BACK),P.enable(P.CULL_FACE),P.enable(P.BLEND),P.blendEquation(P.FUNC_ADD),P.blendFunc(P.SRC_ALPHA,P.ONE_MINUS_SRC_ALPHA),P.clearColor(O.r,O.g,O.b,M),this.context=P;var pt=P.getParameter(P.MAX_VERTEX_TEXTURE_IMAGE_UNITS);P.getParameter(P.MAX_TEXTURE_SIZE);var dt=P.getParameter(P.MAX_CUBE_MAP_TEXTURE_SIZE);this.getContext=function(){return P},this.supportsVertexTextures=function(){return pt>0},this.setSize=function(e,t){x.width=e,x.height=t,this.setViewport(0,0,x.width,x.height)},this.setViewport=function(e,t,n,r){et=e,tt=t,nt=n,rt=r,P.viewport(et,tt,nt,rt)},this.setScissor=function(e,t,n,r){P.scissor(e,t,n,r)},this.enableScissorTest=function(e){e?P.enable(P.SCISSOR_TEST):P.disable(P.SCISSOR_TEST)},this.setClearColorHex=function(e,t){O.setHex(e),M=t,P.clearColor(O.r,O.g,O.b,M)},this.setClearColor=function(e,t){O.copy(e),M=t,P.clearColor(O.r,O.g,O.b,M)},this.getClearColor=function(){return O},this.getClearAlpha=function(){return M},this.clear=function(e,t,n){var r=0;if(e===void 0||e)r|=P.COLOR_BUFFER_BIT;if(t===void 0||t)r|=P.DEPTH_BUFFER_BIT;if(n===void 0||n)r|=P.STENCIL_BUFFER_BIT;P.clear(r)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.deallocateObject=function(e){if(e.__webglInit){e.__webglInit=!1,delete e._modelViewMatrix,delete e._normalMatrix,delete e._normalMatrixArray,delete e._modelViewMatrixArray,delete e._objectMatrixArray;if(e instanceof THREE.Mesh)for(var t in e.geometry.geometryGroups){var n=e.geometry.geometryGroups[t];P.deleteBuffer(n.__webglVertexBuffer),P.deleteBuffer(n.__webglNormalBuffer),P.deleteBuffer(n.__webglTangentBuffer),P.deleteBuffer(n.__webglColorBuffer),P.deleteBuffer(n.__webglUVBuffer),P.deleteBuffer(n.__webglUV2Buffer),P.deleteBuffer(n.__webglSkinVertexABuffer),P.deleteBuffer(n.__webglSkinVertexBBuffer),P.deleteBuffer(n.__webglSkinIndicesBuffer),P.deleteBuffer(n.__webglSkinWeightsBuffer),P.deleteBuffer(n.__webglFaceBuffer),P.deleteBuffer(n.__webglLineBuffer);var r=void 0,i=void 0;if(n.numMorphTargets){r=0;for(i=n.numMorphTargets;r<i;r++)P.deleteBuffer(n.__webglMorphTargetsBuffers[r])}if(n.numMorphNormals){r=0;for(i=n.numMorphNormals;r<i;r++)P.deleteBuffer(n.__webglMorphNormalsBuffers[r])}if(n.__webglCustomAttributesList){r=void 0;for(r in n.__webglCustomAttributesList)P.deleteBuffer(n.__webglCustomAttributesList[r].buffer)}D.info.memory.geometries--}else e instanceof THREE.Ribbon?(e=e.geometry,P.deleteBuffer(e.__webglVertexBuffer),P.deleteBuffer(e.__webglColorBuffer),D.info.memory.geometries--):e instanceof THREE.Line?(e=e.geometry,P.deleteBuffer(e.__webglVertexBuffer),P.deleteBuffer(e.__webglColorBuffer),D.info.memory.geometries--):e instanceof THREE.ParticleSystem&&(e=e.geometry,P.deleteBuffer(e.__webglVertexBuffer),P.deleteBuffer(e.__webglColorBuffer),D.info.memory.geometries--)}},this.deallocateTexture=function(e){e.__webglInit&&(e.__webglInit=!1,P.deleteTexture(e.__webglTexture),D.info.memory.textures--)},this.deallocateRenderTarget=function(e){if(e&&e.__webglTexture){P.deleteTexture(e.__webglTexture);if(e instanceof THREE.WebGLRenderTargetCube)for(var t=0;t<6;t++)P.deleteFramebuffer(e.__webglFramebuffer[t]),P.deleteRenderbuffer(e.__webglRenderbuffer[t]);else P.deleteFramebuffer(e.__webglFramebuffer),P.deleteRenderbuffer(e.__webglRenderbuffer)}},this.updateShadowMap=function(e,t){B=null,F=I=K=J=W=-1,ct=!0,z=U=-1,this.shadowMapPlugin.update(e,t)},this.renderBufferImmediate=function(e,t,n){e.__webglVertexBuffer||(e.__webglVertexBuffer=P.createBuffer()),e.__webglNormalBuffer||(e.__webglNormalBuffer=P.createBuffer()),e.hasPos&&(P.bindBuffer(P.ARRAY_BUFFER,e.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,e.positionArray,P.DYNAMIC_DRAW),P.enableVertexAttribArray(t.attributes.position),P.vertexAttribPointer(t.attributes.position,3,P.FLOAT,!1,0,0));if(e.hasNormal){P.bindBuffer(P.ARRAY_BUFFER,e.__webglNormalBuffer);if(n===THREE.FlatShading){var r,i,s,o,u,a,f,l,c,h,p=e.count*3;for(h=0;h<p;h+=9)n=e.normalArray,r=n[h],i=n[h+1],s=n[h+2],o=n[h+3],a=n[h+4],l=n[h+5],u=n[h+6],f=n[h+7],c=n[h+8],r=(r+o+u)/3,i=(i+a+f)/3,s=(s+l+c)/3,n[h]=r,n[h+1]=i,n[h+2]=s,n[h+3]=r,n[h+4]=i,n[h+5]=s,n[h+6]=r,n[h+7]=i,n[h+8]=s}P.bufferData(P.ARRAY_BUFFER,e.normalArray,P.DYNAMIC_DRAW),P.enableVertexAttribArray(t.attributes.normal),P.vertexAttribPointer(t.attributes.normal,3,P.FLOAT,!1,0,0)}P.drawArrays(P.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,s){if(r.visible!==!1){n=v(e,t,n,r,s),e=n.attributes,t=!1,r=i.id*16777215+n.id*2+(r.wireframe?1:0),r!==I&&(I=r,t=!0);if(s instanceof THREE.Mesh){s=i.offsets,r=0;for(n=s.length;r<n;++r)t&&(P.bindBuffer(P.ARRAY_BUFFER,i.vertexPositionBuffer),P.vertexAttribPointer(e.position,i.vertexPositionBuffer.itemSize,P.FLOAT,!1,0,s[r].index*12),e.normal>=0&&i.vertexNormalBuffer&&(P.bindBuffer(P.ARRAY_BUFFER,i.vertexNormalBuffer),P.vertexAttribPointer(e.normal,i.vertexNormalBuffer.itemSize,P.FLOAT,!1,0,s[r].index*12)),e.uv>=0&&i.vertexUvBuffer&&(i.vertexUvBuffer?(P.bindBuffer(P.ARRAY_BUFFER,i.vertexUvBuffer),P.vertexAttribPointer(e.uv,i.vertexUvBuffer.itemSize,P.FLOAT,!1,0,s[r].index*8),P.enableVertexAttribArray(e.uv)):P.disableVertexAttribArray(e.uv)),e.color>=0&&i.vertexColorBuffer&&(P.bindBuffer(P.ARRAY_BUFFER,i.vertexColorBuffer),P.vertexAttribPointer(e.color,i.vertexColorBuffer.itemSize,P.FLOAT,!1,0,s[r].index*16)),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,i.vertexIndexBuffer)),P.drawElements(P.TRIANGLES,s[r].count,P.UNSIGNED_SHORT,s[r].start*2),D.info.render.calls++,D.info.render.vertices=D.info.render.vertices+s[r].count,D.info.render.faces=D.info.render.faces+s[r].count/3}}},this.renderBuffer=function(e,t,n,r,i,s){if(r.visible!==!1){var o,u,n=v(e,t,n,r,s),t=n.attributes,e=!1,n=i.id*16777215+n.id*2+(r.wireframe?1:0);n!==I&&(I=n,e=!0);if(!r.morphTargets&&t.position>=0)e&&(P.bindBuffer(P.ARRAY_BUFFER,i.__webglVertexBuffer),P.vertexAttribPointer(t.position,3,P.FLOAT,!1,0,0));else if(s.morphTargetBase){n=r.program.attributes,s.morphTargetBase!==-1?(P.bindBuffer(P.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[s.morphTargetBase]),P.vertexAttribPointer(n.position,3,P.FLOAT,!1,0,0)):n.position>=0&&(P.bindBuffer(P.ARRAY_BUFFER,i.__webglVertexBuffer),P.vertexAttribPointer(n.position,3,P.FLOAT,!1,0,0));if(s.morphTargetForcedOrder.length){o=0;var a=s.morphTargetForcedOrder;for(u=s.morphTargetInfluences;o<r.numSupportedMorphTargets&&o<a.length;)P.bindBuffer(P.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[a[o]]),P.vertexAttribPointer(n["morphTarget"+o],3,P.FLOAT,!1,0,0),r.morphNormals&&(P.bindBuffer(P.ARRAY_BUFFER,i.__webglMorphNormalsBuffers[a[o]]),P.vertexAttribPointer(n["morphNormal"+o],3,P.FLOAT,!1,0,0)),s.__webglMorphTargetInfluences[o]=u[a[o]],o++}else{var a=[],f=-1,l=0;u=s.morphTargetInfluences;var c,h=u.length;o=0;for(s.morphTargetBase!==-1&&(a[s.morphTargetBase]=!0);o<r.numSupportedMorphTargets;){for(c=0;c<h;c++)!a[c]&&u[c]>f&&(l=c,f=u[l]);P.bindBuffer(P.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[l]),P.vertexAttribPointer(n["morphTarget"+o],3,P.FLOAT,!1,0,0),r.morphNormals&&(P.bindBuffer(P.ARRAY_BUFFER,i.__webglMorphNormalsBuffers[l]),P.vertexAttribPointer(n["morphNormal"+o],3,P.FLOAT,!1,0,0)),s.__webglMorphTargetInfluences[o]=f,a[l]=1,f=-1,o++}}r.program.uniforms.morphTargetInfluences!==null&&P.uniform1fv(r.program.uniforms.morphTargetInfluences,s.__webglMorphTargetInfluences)}if(e){if(i.__webglCustomAttributesList){o=0;for(u=i.__webglCustomAttributesList.length;o<u;o++)n=i.__webglCustomAttributesList[o],t[n.buffer.belongsToAttribute]>=0&&(P.bindBuffer(P.ARRAY_BUFFER,n.buffer),P.vertexAttribPointer(t[n.buffer.belongsToAttribute],n.size,P.FLOAT,!1,0,0))}t.color>=0&&(P.bindBuffer(P.ARRAY_BUFFER,i.__webglColorBuffer),P.vertexAttribPointer(t.color,3,P.FLOAT,!1,0,0)),t.normal>=0&&(P.bindBuffer(P.ARRAY_BUFFER,i.__webglNormalBuffer),P.vertexAttribPointer(t.normal,3,P.FLOAT,!1,0,0)),t.tangent>=0&&(P.bindBuffer(P.ARRAY_BUFFER,i.__webglTangentBuffer),P.vertexAttribPointer(t.tangent,4,P.FLOAT,!1,0,0)),t.uv>=0&&(i.__webglUVBuffer?(P.bindBuffer(P.ARRAY_BUFFER,i.__webglUVBuffer),P.vertexAttribPointer(t.uv,2,P.FLOAT,!1,0,0),P.enableVertexAttribArray(t.uv)):P.disableVertexAttribArray(t.uv)),t.uv2>=0&&(i.__webglUV2Buffer?(P.bindBuffer(P.ARRAY_BUFFER,i.__webglUV2Buffer),P.vertexAttribPointer(t.uv2,2,P.FLOAT,!1,0,0),P.enableVertexAttribArray(t.uv2)):P.disableVertexAttribArray(t.uv2)),r.skinning&&t.skinVertexA>=0&&t.skinVertexB>=0&&t.skinIndex>=0&&t.skinWeight>=0&&(P.bindBuffer(P.ARRAY_BUFFER,i.__webglSkinVertexABuffer),P.vertexAttribPointer(t.skinVertexA,4,P.FLOAT,!1,0,0),P.bindBuffer(P.ARRAY_BUFFER,i.__webglSkinVertexBBuffer),P.vertexAttribPointer(t.skinVertexB,4,P.FLOAT,!1,0,0),P.bindBuffer(P.ARRAY_BUFFER,i.__webglSkinIndicesBuffer),P.vertexAttribPointer(t.skinIndex,4,P.FLOAT,!1,0,0),P.bindBuffer(P.ARRAY_BUFFER,i.__webglSkinWeightsBuffer),P.vertexAttribPointer(t.skinWeight,4,P.FLOAT,!1,0,0))}s instanceof THREE.Mesh?(r.wireframe?(r=r.wireframeLinewidth,r!==Z&&(P.lineWidth(r),Z=r),e&&P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer),P.drawElements(P.LINES,i.__webglLineCount,P.UNSIGNED_SHORT,0)):(e&&P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer),P.drawElements(P.TRIANGLES,i.__webglFaceCount,P.UNSIGNED_SHORT,0)),D.info.render.calls++,D.info.render.vertices=D.info.render.vertices+i.__webglFaceCount,D.info.render.faces=D.info.render.faces+i.__webglFaceCount/3):s instanceof THREE.Line?(s=s.type===THREE.LineStrip?P.LINE_STRIP:P.LINES,r=r.linewidth,r!==Z&&(P.lineWidth(r),Z=r),P.drawArrays(s,0,i.__webglLineCount),D.info.render.calls++):s instanceof THREE.ParticleSystem?(P.drawArrays(P.POINTS,0,i.__webglParticleCount),D.info.render.calls++,D.info.render.points=D.info.render.points+i.__webglParticleCount):s instanceof THREE.Ribbon&&(P.drawArrays(P.TRIANGLE_STRIP,0,i.__webglVertexCount),D.info.render.calls++)}},this.render=function(e,t,n,r){var i,s,l,c,h=e.__lights,p=e.fog;F=-1,ct=!0,t.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),e.add(t)),this.autoUpdateScene&&e.updateMatrixWorld(),t._viewMatrixArray||(t._viewMatrixArray=new Float32Array(16)),t._projectionMatrixArray||(t._projectionMatrixArray=new Float32Array(16)),t.matrixWorldInverse.getInverse(t.matrixWorld),t.matrixWorldInverse.flattenToArray(t._viewMatrixArray),t.projectionMatrix.flattenToArray(t._projectionMatrixArray),ut.multiply(t.projectionMatrix,t.matrixWorldInverse),ot.setFromMatrix(ut),this.autoUpdateObjects&&this.initWebGLObjects(e),u(this.renderPluginsPre,e,t),D.info.render.calls=0,D.info.render.vertices=0,D.info.render.faces=0,D.info.render.points=0,this.setRenderTarget(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),c=e.__webglObjects,r=0;for(i=c.length;r<i;r++){s=c[r],l=s.object,s.render=!1;if(l.visible&&(!(l instanceof THREE.Mesh||l instanceof THREE.ParticleSystem)||!l.frustumCulled||ot.contains(l))){m(l,t);var d=s,v=d.object,y=d.buffer,b=void 0,b=b=void 0,b=v.material;b instanceof THREE.MeshFaceMaterial?(b=y.materialIndex,b>=0&&(b=v.geometry.materials[b],b.transparent?(d.transparent=b,d.opaque=null):(d.opaque=b,d.transparent=null))):b&&(b.transparent?(d.transparent=b,d.opaque=null):(d.opaque=b,d.transparent=null)),s.render=!0,this.sortObjects&&(l.renderDepth?s.z=l.renderDepth:(ft.copy(l.matrixWorld.getPosition()),ut.multiplyVector3(ft),s.z=ft.z))}}this.sortObjects&&c.sort(o),c=e.__webglObjectsImmediate,r=0;for(i=c.length;r<i;r++)s=c[r],l=s.object,l.visible&&(m(l,t),l=s.object.material,l.transparent?(s.transparent=l,s.opaque=null):(s.opaque=l,s.transparent=null));e.overrideMaterial?(r=e.overrideMaterial,this.setBlending(r.blending,r.blendEquation,r.blendSrc,r.blendDst),this.setDepthTest(r.depthTest),this.setDepthWrite(r.depthWrite),g(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),a(e.__webglObjects,!1,"",t,h,p,!0,r),f(e.__webglObjectsImmediate,"",t,h,p,!1,r)):(this.setBlending(THREE.NormalBlending),a(e.__webglObjects,!0,"opaque",t,h,p,!1),f(e.__webglObjectsImmediate,"opaque",t,h,p,!1),a(e.__webglObjects,!1,"transparent",t,h,p,!0),f(e.__webglObjectsImmediate,"transparent",t,h,p,!0)),u(this.renderPluginsPost,e,t),n&&n.generateMipmaps&&n.minFilter!==THREE.NearestFilter&&n.minFilter!==THREE.LinearFilter&&(n instanceof THREE.WebGLRenderTargetCube?(P.bindTexture(P.TEXTURE_CUBE_MAP,n.__webglTexture),P.generateMipmap(P.TEXTURE_CUBE_MAP),P.bindTexture(P.TEXTURE_CUBE_MAP,null)):(P.bindTexture(P.TEXTURE_2D,n.__webglTexture),P.generateMipmap(P.TEXTURE_2D),P.bindTexture(P.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,n,r,i){var s=v(e,t,n,r,i);I=-1,D.setObjectFaces(i),i.immediateRenderCallback?i.immediateRenderCallback(s,P,ot):i.render(function(e){D.renderBufferImmediate(e,s,r.shading)})},this.initWebGLObjects=function(e){e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);for(;e.__objectsAdded.length;){var o=e.__objectsAdded[0],u=e,a=void 0,f=void 0,v=void 0;if(!o.__webglInit){o.__webglInit=!0,o._modelViewMatrix=new THREE.Matrix4,o._normalMatrix=new THREE.Matrix3;if(o instanceof THREE.Mesh){f=o.geometry;if(f instanceof THREE.Geometry){if(f.geometryGroups===void 0){var m=f,g=void 0,y=void 0,b=void 0,w=void 0,E=void 0,S=void 0,x=void 0,T={},N=m.morphTargets.length,C=m.morphNormals.length;m.geometryGroups={},g=0;for(y=m.faces.length;g<y;g++)b=m.faces[g],w=b.materialIndex,S=w!==void 0?w:-1,T[S]===void 0&&(T[S]={hash:S,counter:0}),x=T[S].hash+"_"+T[S].counter,m.geometryGroups[x]===void 0&&(m.geometryGroups[x]={faces3:[],faces4:[],materialIndex:w,vertices:0,numMorphTargets:N,numMorphNormals:C}),E=b instanceof THREE.Face3?3:4,m.geometryGroups[x].vertices+E>65535&&(T[S].counter=T[S].counter+1,x=T[S].hash+"_"+T[S].counter,m.geometryGroups[x]===void 0&&(m.geometryGroups[x]={faces3:[],faces4:[],materialIndex:w,vertices:0,numMorphTargets:N,numMorphNormals:C})),b instanceof THREE.Face3?m.geometryGroups[x].faces3.push(g):m.geometryGroups[x].faces4.push(g),m.geometryGroups[x].vertices=m.geometryGroups[x].vertices+E;m.geometryGroupsList=[];var k=void 0;for(k in m.geometryGroups)m.geometryGroups[k].id=R++,m.geometryGroupsList.push(m.geometryGroups[k])}for(a in f.geometryGroups){v=f.geometryGroups[a];if(!v.__webglVertexBuffer){var L=v;L.__webglVertexBuffer=P.createBuffer(),L.__webglNormalBuffer=P.createBuffer(),L.__webglTangentBuffer=P.createBuffer(),L.__webglColorBuffer=P.createBuffer(),L.__webglUVBuffer=P.createBuffer(),L.__webglUV2Buffer=P.createBuffer(),L.__webglSkinVertexABuffer=P.createBuffer(),L.__webglSkinVertexBBuffer=P.createBuffer(),L.__webglSkinIndicesBuffer=P.createBuffer(),L.__webglSkinWeightsBuffer=P.createBuffer(),L.__webglFaceBuffer=P.createBuffer(),L.__webglLineBuffer=P.createBuffer();var A=void 0,O=void 0;if(L.numMorphTargets){L.__webglMorphTargetsBuffers=[],A=0;for(O=L.numMorphTargets;A<O;A++)L.__webglMorphTargetsBuffers.push(P.createBuffer())}if(L.numMorphNormals){L.__webglMorphNormalsBuffers=[],A=0;for(O=L.numMorphNormals;A<O;A++)L.__webglMorphNormalsBuffers.push(P.createBuffer())}D.info.memory.geometries++;var M=v,_=o,H=_.geometry,B=M.faces3,j=M.faces4,F=B.length*3+j.length*4,I=B.length*1+j.length*2,q=B.length*3+j.length*4,U=n(_,M),z=i(U),W=r(U),X=U.vertexColors?U.vertexColors:!1;M.__vertexArray=new Float32Array(F*3),W&&(M.__normalArray=new Float32Array(F*3)),H.hasTangents&&(M.__tangentArray=new Float32Array(F*4)),X&&(M.__colorArray=new Float32Array(F*3));if(z){if(H.faceUvs.length>0||H.faceVertexUvs.length>0)M.__uvArray=new Float32Array(F*2);if(H.faceUvs.length>1||H.faceVertexUvs.length>1)M.__uv2Array=new Float32Array(F*2)}_.geometry.skinWeights.length&&_.geometry.skinIndices.length&&(M.__skinVertexAArray=new Float32Array(F*4),M.__skinVertexBArray=new Float32Array(F*4),M.__skinIndexArray=new Float32Array(F*4),M.__skinWeightArray=new Float32Array(F*4)),M.__faceArray=new Uint16Array(I*3),M.__lineArray=new Uint16Array(q*2);var V=void 0,$=void 0;if(M.numMorphTargets){M.__morphTargetsArrays=[],V=0;for($=M.numMorphTargets;V<$;V++)M.__morphTargetsArrays.push(new Float32Array(F*3))}if(M.numMorphNormals){M.__morphNormalsArrays=[],V=0;for($=M.numMorphNormals;V<$;V++)M.__morphNormalsArrays.push(new Float32Array(F*3))}M.__webglFaceCount=I*3,M.__webglLineCount=q*2;if(U.attributes){M.__webglCustomAttributesList===void 0&&(M.__webglCustomAttributesList=[]);var J=void 0;for(J in U.attributes){var K=U.attributes[J],Q={},G;for(G in K)Q[G]=K[G];if(!Q.__webglInitialized||Q.createUniqueBuffers){Q.__webglInitialized=!0;var Y=1;Q.type==="v2"?Y=2:Q.type==="v3"?Y=3:Q.type==="v4"?Y=4:Q.type==="c"&&(Y=3),Q.size=Y,Q.array=new Float32Array(F*Y),Q.buffer=P.createBuffer(),Q.buffer.belongsToAttribute=J,K.needsUpdate=!0,Q.__original=K}M.__webglCustomAttributesList.push(Q)}}M.__inittedArrays=!0,f.verticesNeedUpdate=!0,f.morphTargetsNeedUpdate=!0,f.elementsNeedUpdate=!0,f.uvsNeedUpdate=!0,f.normalsNeedUpdate=!0,f.tangetsNeedUpdate=!0,f.colorsNeedUpdate=!0}}}}else if(o instanceof THREE.Ribbon){f=o.geometry;if(!f.__webglVertexBuffer){var Z=f;Z.__webglVertexBuffer=P.createBuffer(),Z.__webglColorBuffer=P.createBuffer(),D.info.memory.geometries++;var et=f,tt=et.vertices.length;et.__vertexArray=new Float32Array(tt*3),et.__colorArray=new Float32Array(tt*3),et.__webglVertexCount=tt,f.verticesNeedUpdate=!0,f.colorsNeedUpdate=!0}}else if(o instanceof THREE.Line){f=o.geometry;if(!f.__webglVertexBuffer){var nt=f;nt.__webglVertexBuffer=P.createBuffer(),nt.__webglColorBuffer=P.createBuffer(),D.info.memory.geometries++;var rt=f,it=o,st=rt.vertices.length;rt.__vertexArray=new Float32Array(st*3),rt.__colorArray=new Float32Array(st*3),rt.__webglLineCount=st,t(rt,it),f.verticesNeedUpdate=!0,f.colorsNeedUpdate=!0}}else if(o instanceof THREE.ParticleSystem){f=o.geometry;if(!f.__webglVertexBuffer){var ot=f;ot.__webglVertexBuffer=P.createBuffer(),ot.__webglColorBuffer=P.createBuffer(),D.info.geometries++;var ut=f,at=o,ft=ut.vertices.length;ut.__vertexArray=new Float32Array(ft*3),ut.__colorArray=new Float32Array(ft*3),ut.__sortArray=[],ut.__webglParticleCount=ft,t(ut,at),f.verticesNeedUpdate=!0,f.colorsNeedUpdate=!0}}}if(!o.__webglActive){if(o instanceof THREE.Mesh){f=o.geometry;if(f instanceof THREE.BufferGeometry)l(u.__webglObjects,f,o);else for(a in f.geometryGroups)v=f.geometryGroups[a],l(u.__webglObjects,v,o)}else o instanceof THREE.Ribbon||o instanceof THREE.Line||o instanceof THREE.ParticleSystem?(f=o.geometry,l(u.__webglObjects,f,o)):o instanceof THREE.ImmediateRenderObject||o.immediateRenderCallback?u.__webglObjectsImmediate.push({object:o,opaque:null,transparent:null}):o instanceof THREE.Sprite?u.__webglSprites.push(o):o instanceof THREE.LensFlare&&u.__webglFlares.push(o);o.__webglActive=!0}e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){var lt=e.__objectsRemoved[0],ct=e;lt instanceof THREE.Mesh||lt instanceof THREE.ParticleSystem||lt instanceof THREE.Ribbon||lt instanceof THREE.Line?p(ct.__webglObjects,lt):lt instanceof THREE.Sprite?d(ct.__webglSprites,lt):lt instanceof THREE.LensFlare?d(ct.__webglFlares,lt):(lt instanceof THREE.ImmediateRenderObject||lt.immediateRenderCallback)&&p(ct.__webglObjectsImmediate,lt),lt.__webglActive=!1,e.__objectsRemoved.splice(0,1)}for(var ht=0,pt=e.__webglObjects.length;ht<pt;ht++){var dt=e.__webglObjects[ht].object,vt=dt.geometry,mt=void 0,gt=void 0,yt=void 0;if(dt instanceof THREE.Mesh)if(vt instanceof THREE.BufferGeometry)vt.verticesNeedUpdate=!1,vt.elementsNeedUpdate=!1,vt.uvsNeedUpdate=!1,vt.normalsNeedUpdate=!1,vt.colorsNeedUpdate=!1;else{for(var bt=0,wt=vt.geometryGroupsList.length;bt<wt;bt++){mt=vt.geometryGroupsList[bt],yt=n(dt,mt),gt=yt.attributes&&c(yt);if(vt.verticesNeedUpdate||vt.morphTargetsNeedUpdate||vt.elementsNeedUpdate||vt.uvsNeedUpdate||vt.normalsNeedUpdate||vt.colorsNeedUpdate||vt.tangetsNeedUpdate||gt){var Et=mt,St=dt,xt=P.DYNAMIC_DRAW,Tt=!vt.dynamic,Nt=yt;if(Et.__inittedArrays){var Ct=r(Nt),kt=Nt.vertexColors?Nt.vertexColors:!1,Lt=i(Nt),At=Ct===THREE.SmoothShading,Ot=void 0,Mt=void 0,_t=void 0,Dt=void 0,Pt=void 0,Ht=void 0,Bt=void 0,jt=void 0,Ft=void 0,It=void 0,qt=void 0,Rt=void 0,Ut=void 0,zt=void 0,Wt=void 0,Xt=void 0,Vt=void 0,$t=void 0,Jt=void 0,Kt=void 0,Qt=void 0,Gt=void 0,Yt=void 0,Zt=void 0,en=void 0,tn=void 0,nn=void 0,rn=void 0,sn=void 0,on=void 0,un=void 0,an=void 0,fn=void 0,ln=void 0,cn=void 0,hn=void 0,pn=void 0,dn=void 0,vn=void 0,mn=void 0,gn=void 0,yn=void 0,bn=void 0,wn=void 0,En=void 0,Sn=void 0,xn=void 0,Tn=void 0,Nn=void 0,Cn=void 0,kn=void 0,Ln=void 0,An=void 0,On=void 0,Mn=0,_n=0,Dn=0,Pn=0,Hn=0,Bn=0,jn=0,Fn=0,In=0,qn=0,Rn=0,Un=0,zn=void 0,Wn=Et.__vertexArray,Xn=Et.__uvArray,Vn=Et.__uv2Array,$n=Et.__normalArray,Jn=Et.__tangentArray,Kn=Et.__colorArray,Qn=Et.__skinVertexAArray,Gn=Et.__skinVertexBArray,Yn=Et.__skinIndexArray,Zn=Et.__skinWeightArray,er=Et.__morphTargetsArrays,tr=Et.__morphNormalsArrays,nr=Et.__webglCustomAttributesList,rr=void 0,ir=Et.__faceArray,sr=Et.__lineArray,or=St.geometry,ur=or.elementsNeedUpdate,ar=or.uvsNeedUpdate,fr=or.normalsNeedUpdate,lr=or.tangetsNeedUpdate,cr=or.colorsNeedUpdate,hr=or.morphTargetsNeedUpdate,pr=or.vertices,dr=Et.faces3,vr=Et.faces4,mr=or.faces,gr=or.faceVertexUvs[0],yr=or.faceVertexUvs[1],br=or.skinVerticesA,wr=or.skinVerticesB,Er=or.skinIndices,Sr=or.skinWeights,xr=or.morphTargets,Tr=or.morphNormals;if(or.verticesNeedUpdate){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++)Dt=mr[dr[Ot]],Rt=pr[Dt.a],Ut=pr[Dt.b],zt=pr[Dt.c],Wn[_n]=Rt.x,Wn[_n+1]=Rt.y,Wn[_n+2]=Rt.z,Wn[_n+3]=Ut.x,Wn[_n+4]=Ut.y,Wn[_n+5]=Ut.z,Wn[_n+6]=zt.x,Wn[_n+7]=zt.y,Wn[_n+8]=zt.z,_n+=9;Ot=0;for(Mt=vr.length;Ot<Mt;Ot++)Dt=mr[vr[Ot]],Rt=pr[Dt.a],Ut=pr[Dt.b],zt=pr[Dt.c],Wt=pr[Dt.d],Wn[_n]=Rt.x,Wn[_n+1]=Rt.y,Wn[_n+2]=Rt.z,Wn[_n+3]=Ut.x,Wn[_n+4]=Ut.y,Wn[_n+5]=Ut.z,Wn[_n+6]=zt.x,Wn[_n+7]=zt.y,Wn[_n+8]=zt.z,Wn[_n+9]=Wt.x,Wn[_n+10]=Wt.y,Wn[_n+11]=Wt.z,_n+=12;P.bindBuffer(P.ARRAY_BUFFER,Et.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,Wn,xt)}if(hr){Nn=0;for(Cn=xr.length;Nn<Cn;Nn++){Ot=Rn=0;for(Mt=dr.length;Ot<Mt;Ot++)An=dr[Ot],Dt=mr[An],Rt=xr[Nn].vertices[Dt.a],Ut=xr[Nn].vertices[Dt.b],zt=xr[Nn].vertices[Dt.c],kn=er[Nn],kn[Rn]=Rt.x,kn[Rn+1]=Rt.y,kn[Rn+2]=Rt.z,kn[Rn+3]=Ut.x,kn[Rn+4]=Ut.y,kn[Rn+5]=Ut.z,kn[Rn+6]=zt.x,kn[Rn+7]=zt.y,kn[Rn+8]=zt.z,Nt.morphNormals&&(At?(On=Tr[Nn].vertexNormals[An],Kt=On.a,Qt=On.b,Gt=On.c):Gt=Qt=Kt=Tr[Nn].faceNormals[An],Ln=tr[Nn],Ln[Rn]=Kt.x,Ln[Rn+1]=Kt.y,Ln[Rn+2]=Kt.z,Ln[Rn+3]=Qt.x,Ln[Rn+4]=Qt.y,Ln[Rn+5]=Qt.z,Ln[Rn+6]=Gt.x,Ln[Rn+7]=Gt.y,Ln[Rn+8]=Gt.z),Rn+=9;Ot=0;for(Mt=vr.length;Ot<Mt;Ot++)An=vr[Ot],Dt=mr[An],Rt=xr[Nn].vertices[Dt.a],Ut=xr[Nn].vertices[Dt.b],zt=xr[Nn].vertices[Dt.c],Wt=xr[Nn].vertices[Dt.d],kn=er[Nn],kn[Rn]=Rt.x,kn[Rn+1]=Rt.y,kn[Rn+2]=Rt.z,kn[Rn+3]=Ut.x,kn[Rn+4]=Ut.y,kn[Rn+5]=Ut.z,kn[Rn+6]=zt.x,kn[Rn+7]=zt.y,kn[Rn+8]=zt.z,kn[Rn+9]=Wt.x,kn[Rn+10]=Wt.y,kn[Rn+11]=Wt.z,Nt.morphNormals&&(At?(On=Tr[Nn].vertexNormals[An],Kt=On.a,Qt=On.b,Gt=On.c,Yt=On.d):Yt=Gt=Qt=Kt=Tr[Nn].faceNormals[An],Ln=tr[Nn],Ln[Rn]=Kt.x,Ln[Rn+1]=Kt.y,Ln[Rn+2]=Kt.z,Ln[Rn+3]=Qt.x,Ln[Rn+4]=Qt.y,Ln[Rn+5]=Qt.z,Ln[Rn+6]=Gt.x,Ln[Rn+7]=Gt.y,Ln[Rn+8]=Gt.z,Ln[Rn+9]=Yt.x,Ln[Rn+10]=Yt.y,Ln[Rn+11]=Yt.z),Rn+=12;P.bindBuffer(P.ARRAY_BUFFER,Et.__webglMorphTargetsBuffers[Nn]),P.bufferData(P.ARRAY_BUFFER,er[Nn],xt),Nt.morphNormals&&(P.bindBuffer(P.ARRAY_BUFFER,Et.__webglMorphNormalsBuffers[Nn]),P.bufferData(P.ARRAY_BUFFER,tr[Nn],xt))}}if(Sr.length){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++)Dt=mr[dr[Ot]],rn=Sr[Dt.a],sn=Sr[Dt.b],on=Sr[Dt.c],Zn[qn]=rn.x,Zn[qn+1]=rn.y,Zn[qn+2]=rn.z,Zn[qn+3]=rn.w,Zn[qn+4]=sn.x,Zn[qn+5]=sn.y,Zn[qn+6]=sn.z,Zn[qn+7]=sn.w,Zn[qn+8]=on.x,Zn[qn+9]=on.y,Zn[qn+10]=on.z,Zn[qn+11]=on.w,an=Er[Dt.a],fn=Er[Dt.b],ln=Er[Dt.c],Yn[qn]=an.x,Yn[qn+1]=an.y,Yn[qn+2]=an.z,Yn[qn+3]=an.w,Yn[qn+4]=fn.x,Yn[qn+5]=fn.y,Yn[qn+6]=fn.z,Yn[qn+7]=fn.w,Yn[qn+8]=ln.x,Yn[qn+9]=ln.y,Yn[qn+10]=ln.z,Yn[qn+11]=ln.w,hn=br[Dt.a],pn=br[Dt.b],dn=br[Dt.c],Qn[qn]=hn.x,Qn[qn+1]=hn.y,Qn[qn+2]=hn.z,Qn[qn+3]=1,Qn[qn+4]=pn.x,Qn[qn+5]=pn.y,Qn[qn+6]=pn.z,Qn[qn+7]=1,Qn[qn+8]=dn.x,Qn[qn+9]=dn.y,Qn[qn+10]=dn.z,Qn[qn+11]=1,mn=wr[Dt.a],gn=wr[Dt.b],yn=wr[Dt.c],Gn[qn]=mn.x,Gn[qn+1]=mn.y,Gn[qn+2]=mn.z,Gn[qn+3]=1,Gn[qn+4]=gn.x,Gn[qn+5]=gn.y,Gn[qn+6]=gn.z,Gn[qn+7]=1,Gn[qn+8]=yn.x,Gn[qn+9]=yn.y,Gn[qn+10]=yn.z,Gn[qn+11]=1,qn+=12;Ot=0;for(Mt=vr.length;Ot<Mt;Ot++)Dt=mr[vr[Ot]],rn=Sr[Dt.a],sn=Sr[Dt.b],on=Sr[Dt.c],un=Sr[Dt.d],Zn[qn]=rn.x,Zn[qn+1]=rn.y,Zn[qn+2]=rn.z,Zn[qn+3]=rn.w,Zn[qn+4]=sn.x,Zn[qn+5]=sn.y,Zn[qn+6]=sn.z,Zn[qn+7]=sn.w,Zn[qn+8]=on.x,Zn[qn+9]=on.y,Zn[qn+10]=on.z,Zn[qn+11]=on.w,Zn[qn+12]=un.x,Zn[qn+13]=un.y,Zn[qn+14]=un.z,Zn[qn+15]=un.w,an=Er[Dt.a],fn=Er[Dt.b],ln=Er[Dt.c],cn=Er[Dt.d],Yn[qn]=an.x,Yn[qn+1]=an.y,Yn[qn+2]=an.z,Yn[qn+3]=an.w,Yn[qn+4]=fn.x,Yn[qn+5]=fn.y,Yn[qn+6]=fn.z,Yn[qn+7]=fn.w,Yn[qn+8]=ln.x,Yn[qn+9]=ln.y,Yn[qn+10]=ln.z,Yn[qn+11]=ln.w,Yn[qn+12]=cn.x,Yn[qn+13]=cn.y,Yn[qn+14]=cn.z,Yn[qn+15]=cn.w,hn=br[Dt.a],pn=br[Dt.b],dn=br[Dt.c],vn=br[Dt.d],Qn[qn]=hn.x,Qn[qn+1]=hn.y,Qn[qn+2]=hn.z,Qn[qn+3]=1,Qn[qn+4]=pn.x,Qn[qn+5]=pn.y,Qn[qn+6]=pn.z,Qn[qn+7]=1,Qn[qn+8]=dn.x,Qn[qn+9]=dn.y,Qn[qn+10]=dn.z,Qn[qn+11]=1,Qn[qn+12]=vn.x,Qn[qn+13]=vn.y,Qn[qn+14]=vn.z,Qn[qn+15]=1,mn=wr[Dt.a],gn=wr[Dt.b],yn=wr[Dt.c],bn=wr[Dt.d],Gn[qn]=mn.x,Gn[qn+1]=mn.y,Gn[qn+2]=mn.z,Gn[qn+3]=1,Gn[qn+4]=gn.x,Gn[qn+5]=gn.y,Gn[qn+6]=gn.z,Gn[qn+7]=1,Gn[qn+8]=yn.x,Gn[qn+9]=yn.y,Gn[qn+10]=yn.z,Gn[qn+11]=1,Gn[qn+12]=bn.x,Gn[qn+13]=bn.y,Gn[qn+14]=bn.z,Gn[qn+15]=1,qn+=16;qn>0&&(P.bindBuffer(P.ARRAY_BUFFER,Et.__webglSkinVertexABuffer),P.bufferData(P.ARRAY_BUFFER,Qn,xt),P.bindBuffer(P.ARRAY_BUFFER,Et.__webglSkinVertexBBuffer),P.bufferData(P.ARRAY_BUFFER,Gn,xt),P.bindBuffer(P.ARRAY_BUFFER,Et.__webglSkinIndicesBuffer),P.bufferData(P.ARRAY_BUFFER,Yn,xt),P.bindBuffer(P.ARRAY_BUFFER,Et.__webglSkinWeightsBuffer),P.bufferData(P.ARRAY_BUFFER,Zn,xt))}if(cr&&kt){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++)Dt=mr[dr[Ot]],Bt=Dt.vertexColors,jt=Dt.color,Bt.length===3&&kt===THREE.VertexColors?(Zt=Bt[0],en=Bt[1],tn=Bt[2]):tn=en=Zt=jt,Kn[In]=Zt.r,Kn[In+1]=Zt.g,Kn[In+2]=Zt.b,Kn[In+3]=en.r,Kn[In+4]=en.g,Kn[In+5]=en.b,Kn[In+6]=tn.r,Kn[In+7]=tn.g,Kn[In+8]=tn.b,In+=9;Ot=0;for(Mt=vr.length;Ot<Mt;Ot++)Dt=mr[vr[Ot]],Bt=Dt.vertexColors,jt=Dt.color,Bt.length===4&&kt===THREE.VertexColors?(Zt=Bt[0],en=Bt[1],tn=Bt[2],nn=Bt[3]):nn=tn=en=Zt=jt,Kn[In]=Zt.r,Kn[In+1]=Zt.g,Kn[In+2]=Zt.b,Kn[In+3]=en.r,Kn[In+4]=en.g,Kn[In+5]=en.b,Kn[In+6]=tn.r,Kn[In+7]=tn.g,Kn[In+8]=tn.b,Kn[In+9]=nn.r,Kn[In+10]=nn.g,Kn[In+11]=nn.b,In+=12;In>0&&(P.bindBuffer(P.ARRAY_BUFFER,Et.__webglColorBuffer),P.bufferData(P.ARRAY_BUFFER,Kn,xt))}if(lr&&or.hasTangents){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++)Dt=mr[dr[Ot]],Ft=Dt.vertexTangents,Xt=Ft[0],Vt=Ft[1],$t=Ft[2],Jn[jn]=Xt.x,Jn[jn+1]=Xt.y,Jn[jn+2]=Xt.z,Jn[jn+3]=Xt.w,Jn[jn+4]=Vt.x,Jn[jn+5]=Vt.y,Jn[jn+6]=Vt.z,Jn[jn+7]=Vt.w,Jn[jn+8]=$t.x,Jn[jn+9]=$t.y,Jn[jn+10]=$t.z,Jn[jn+11]=$t.w,jn+=12;Ot=0;for(Mt=vr.length;Ot<Mt;Ot++)Dt=mr[vr[Ot]],Ft=Dt.vertexTangents,Xt=Ft[0],Vt=Ft[1],$t=Ft[2],Jt=Ft[3],Jn[jn]=Xt.x,Jn[jn+1]=Xt.y,Jn[jn+2]=Xt.z,Jn[jn+3]=Xt.w,Jn[jn+4]=Vt.x,Jn[jn+5]=Vt.y,Jn[jn+6]=Vt.z,Jn[jn+7]=Vt.w,Jn[jn+8]=$t.x,Jn[jn+9]=$t.y,Jn[jn+10]=$t.z,Jn[jn+11]=$t.w,Jn[jn+12]=Jt.x,Jn[jn+13]=Jt.y,Jn[jn+14]=Jt.z,Jn[jn+15]=Jt.w,jn+=16;P.bindBuffer(P.ARRAY_BUFFER,Et.__webglTangentBuffer),P.bufferData(P.ARRAY_BUFFER,Jn,xt)}if(fr&&Ct){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++){Dt=mr[dr[Ot]],Pt=Dt.vertexNormals,Ht=Dt.normal;if(Pt.length===3&&At)for(wn=0;wn<3;wn++)Sn=Pt[wn],$n[Bn]=Sn.x,$n[Bn+1]=Sn.y,$n[Bn+2]=Sn.z,Bn+=3;else for(wn=0;wn<3;wn++)$n[Bn]=Ht.x,$n[Bn+1]=Ht.y,$n[Bn+2]=Ht.z,Bn+=3}Ot=0;for(Mt=vr.length;Ot<Mt;Ot++){Dt=mr[vr[Ot]],Pt=Dt.vertexNormals,Ht=Dt.normal;if(Pt.length===4&&At)for(wn=0;wn<4;wn++)Sn=Pt[wn],$n[Bn]=Sn.x,$n[Bn+1]=Sn.y,$n[Bn+2]=Sn.z,Bn+=3;else for(wn=0;wn<4;wn++)$n[Bn]=Ht.x,$n[Bn+1]=Ht.y,$n[Bn+2]=Ht.z,Bn+=3}P.bindBuffer(P.ARRAY_BUFFER,Et.__webglNormalBuffer),P.bufferData(P.ARRAY_BUFFER,$n,xt)}if(ar&&gr&&Lt){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++){_t=dr[Ot],Dt=mr[_t],It=gr[_t];if(It!==void 0)for(wn=0;wn<3;wn++)xn=It[wn],Xn[Dn]=xn.u,Xn[Dn+1]=xn.v,Dn+=2}Ot=0;for(Mt=vr.length;Ot<Mt;Ot++){_t=vr[Ot],Dt=mr[_t],It=gr[_t];if(It!==void 0)for(wn=0;wn<4;wn++)xn=It[wn],Xn[Dn]=xn.u,Xn[Dn+1]=xn.v,Dn+=2}Dn>0&&(P.bindBuffer(P.ARRAY_BUFFER,Et.__webglUVBuffer),P.bufferData(P.ARRAY_BUFFER,Xn,xt))}if(ar&&yr&&Lt){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++){_t=dr[Ot],Dt=mr[_t],qt=yr[_t];if(qt!==void 0)for(wn=0;wn<3;wn++)Tn=qt[wn],Vn[Pn]=Tn.u,Vn[Pn+1]=Tn.v,Pn+=2}Ot=0;for(Mt=vr.length;Ot<Mt;Ot++){_t=vr[Ot],Dt=mr[_t],qt=yr[_t];if(qt!==void 0)for(wn=0;wn<4;wn++)Tn=qt[wn],Vn[Pn]=Tn.u,Vn[Pn+1]=Tn.v,Pn+=2}Pn>0&&(P.bindBuffer(P.ARRAY_BUFFER,Et.__webglUV2Buffer),P.bufferData(P.ARRAY_BUFFER,Vn,xt))}if(ur){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++)Dt=mr[dr[Ot]],ir[Hn]=Mn,ir[Hn+1]=Mn+1,ir[Hn+2]=Mn+2,Hn+=3,sr[Fn]=Mn,sr[Fn+1]=Mn+1,sr[Fn+2]=Mn,sr[Fn+3]=Mn+2,sr[Fn+4]=Mn+1,sr[Fn+5]=Mn+2,Fn+=6,Mn+=3;Ot=0;for(Mt=vr.length;Ot<Mt;Ot++)Dt=mr[vr[Ot]],ir[Hn]=Mn,ir[Hn+1]=Mn+1,ir[Hn+2]=Mn+3,ir[Hn+3]=Mn+1,ir[Hn+4]=Mn+2,ir[Hn+5]=Mn+3,Hn+=6,sr[Fn]=Mn,sr[Fn+1]=Mn+1,sr[Fn+2]=Mn,sr[Fn+3]=Mn+3,sr[Fn+4]=Mn+1,sr[Fn+5]=Mn+2,sr[Fn+6]=Mn+2,sr[Fn+7]=Mn+3,Fn+=8,Mn+=4;P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,Et.__webglFaceBuffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,ir,xt),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,Et.__webglLineBuffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,sr,xt)}if(nr){wn=0;for(En=nr.length;wn<En;wn++){rr=nr[wn];if(rr.__original.needsUpdate){Un=0;if(rr.size===1){if(rr.boundTo===void 0||rr.boundTo==="vertices"){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++)Dt=mr[dr[Ot]],rr.array[Un]=rr.value[Dt.a],rr.array[Un+1]=rr.value[Dt.b],rr.array[Un+2]=rr.value[Dt.c],Un+=3;Ot=0;for(Mt=vr.length;Ot<Mt;Ot++)Dt=mr[vr[Ot]],rr.array[Un]=rr.value[Dt.a],rr.array[Un+1]=rr.value[Dt.b],rr.array[Un+2]=rr.value[Dt.c],rr.array[Un+3]=rr.value[Dt.d],Un+=4}else if(rr.boundTo==="faces"){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++)zn=rr.value[dr[Ot]],rr.array[Un]=zn,rr.array[Un+1]=zn,rr.array[Un+2]=zn,Un+=3;Ot=0;for(Mt=vr.length;Ot<Mt;Ot++)zn=rr.value[vr[Ot]],rr.array[Un]=zn,rr.array[Un+1]=zn,rr.array[Un+2]=zn,rr.array[Un+3]=zn,Un+=4}}else if(rr.size===2){if(rr.boundTo===void 0||rr.boundTo==="vertices"){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++)Dt=mr[dr[Ot]],Rt=rr.value[Dt.a],Ut=rr.value[Dt.b],zt=rr.value[Dt.c],rr.array[Un]=Rt.x,rr.array[Un+1]=Rt.y,rr.array[Un+2]=Ut.x,rr.array[Un+3]=Ut.y,rr.array[Un+4]=zt.x,rr.array[Un+5]=zt.y,Un+=6;Ot=0;for(Mt=vr.length;Ot<Mt;Ot++)Dt=mr[vr[Ot]],Rt=rr.value[Dt.a],Ut=rr.value[Dt.b],zt=rr.value[Dt.c],Wt=rr.value[Dt.d],rr.array[Un]=Rt.x,rr.array[Un+1]=Rt.y,rr.array[Un+2]=Ut.x,rr.array[Un+3]=Ut.y,rr.array[Un+4]=zt.x,rr.array[Un+5]=zt.y,rr.array[Un+6]=Wt.x,rr.array[Un+7]=Wt.y,Un+=8}else if(rr.boundTo==="faces"){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++)zt=Ut=Rt=zn=rr.value[dr[Ot]],rr.array[Un]=Rt.x,rr.array[Un+1]=Rt.y,rr.array[Un+2]=Ut.x,rr.array[Un+3]=Ut.y,rr.array[Un+4]=zt.x,rr.array[Un+5]=zt.y,Un+=6;Ot=0;for(Mt=vr.length;Ot<Mt;Ot++)Wt=zt=Ut=Rt=zn=rr.value[vr[Ot]],rr.array[Un]=Rt.x,rr.array[Un+1]=Rt.y,rr.array[Un+2]=Ut.x,rr.array[Un+3]=Ut.y,rr.array[Un+4]=zt.x,rr.array[Un+5]=zt.y,rr.array[Un+6]=Wt.x,rr.array[Un+7]=Wt.y,Un+=8}}else if(rr.size===3){var Nr;Nr=rr.type==="c"?["r","g","b"]:["x","y","z"];if(rr.boundTo===void 0||rr.boundTo==="vertices"){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++)Dt=mr[dr[Ot]],Rt=rr.value[Dt.a],Ut=rr.value[Dt.b],zt=rr.value[Dt.c],rr.array[Un]=Rt[Nr[0]],rr.array[Un+1]=Rt[Nr[1]],rr.array[Un+2]=Rt[Nr[2]],rr.array[Un+3]=Ut[Nr[0]],rr.array[Un+4]=Ut[Nr[1]],rr.array[Un+5]=Ut[Nr[2]],rr.array[Un+6]=zt[Nr[0]],rr.array[Un+7]=zt[Nr[1]],rr.array[Un+8]=zt[Nr[2]],Un+=9;Ot=0;for(Mt=vr.length;Ot<Mt;Ot++)Dt=mr[vr[Ot]],Rt=rr.value[Dt.a],Ut=rr.value[Dt.b],zt=rr.value[Dt.c],Wt=rr.value[Dt.d],rr.array[Un]=Rt[Nr[0]],rr.array[Un+1]=Rt[Nr[1]],rr.array[Un+2]=Rt[Nr[2]],rr.array[Un+3]=Ut[Nr[0]],rr.array[Un+4]=Ut[Nr[1]],rr.array[Un+5]=Ut[Nr[2]],rr.array[Un+6]=zt[Nr[0]],rr.array[Un+7]=zt[Nr[1]],rr.array[Un+8]=zt[Nr[2]],rr.array[Un+9]=Wt[Nr[0]],rr.array[Un+10]=Wt[Nr[1]],rr.array[Un+11]=Wt[Nr[2]],Un+=12}else if(rr.boundTo==="faces"){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++)zt=Ut=Rt=zn=rr.value[dr[Ot]],rr.array[Un]=Rt[Nr[0]],rr.array[Un+1]=Rt[Nr[1]],rr.array[Un+2]=Rt[Nr[2]],rr.array[Un+3]=Ut[Nr[0]],rr.array[Un+4]=Ut[Nr[1]],rr.array[Un+5]=Ut[Nr[2]],rr.array[Un+6]=zt[Nr[0]],rr.array[Un+7]=zt[Nr[1]],rr.array[Un+8]=zt[Nr[2]],Un+=9;Ot=0;for(Mt=vr.length;Ot<Mt;Ot++)Wt=zt=Ut=Rt=zn=rr.value[vr[Ot]],rr.array[Un]=Rt[Nr[0]],rr.array[Un+1]=Rt[Nr[1]],rr.array[Un+2]=Rt[Nr[2]],rr.array[Un+3]=Ut[Nr[0]],rr.array[Un+4]=Ut[Nr[1]],rr.array[Un+5]=Ut[Nr[2]],rr.array[Un+6]=zt[Nr[0]],rr.array[Un+7]=zt[Nr[1]],rr.array[Un+8]=zt[Nr[2]],rr.array[Un+9]=Wt[Nr[0]],rr.array[Un+10]=Wt[Nr[1]],rr.array[Un+11]=Wt[Nr[2]],Un+=12}}else if(rr.size===4)if(rr.boundTo===void 0||rr.boundTo==="vertices"){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++)Dt=mr[dr[Ot]],Rt=rr.value[Dt.a],Ut=rr.value[Dt.b],zt=rr.value[Dt.c],rr.array[Un]=Rt.x,rr.array[Un+1]=Rt.y,rr.array[Un+2]=Rt.z,rr.array[Un+3]=Rt.w,rr.array[Un+4]=Ut.x,rr.array[Un+5]=Ut.y,rr.array[Un+6]=Ut.z,rr.array[Un+7]=Ut.w,rr.array[Un+8]=zt.x,rr.array[Un+9]=zt.y,rr.array[Un+10]=zt.z,rr.array[Un+11]=zt.w,Un+=12;Ot=0;for(Mt=vr.length;Ot<Mt;Ot++)Dt=mr[vr[Ot]],Rt=rr.value[Dt.a],Ut=rr.value[Dt.b],zt=rr.value[Dt.c],Wt=rr.value[Dt.d],rr.array[Un]=Rt.x,rr.array[Un+1]=Rt.y,rr.array[Un+2]=Rt.z,rr.array[Un+3]=Rt.w,rr.array[Un+4]=Ut.x,rr.array[Un+5]=Ut.y,rr.array[Un+6]=Ut.z,rr.array[Un+7]=Ut.w,rr.array[Un+8]=zt.x,rr.array[Un+9]=zt.y,rr.array[Un+10]=zt.z,rr.array[Un+11]=zt.w,rr.array[Un+12]=Wt.x,rr.array[Un+13]=Wt.y,rr.array[Un+14]=Wt.z,rr.array[Un+15]=Wt.w,Un+=16}else if(rr.boundTo==="faces"){Ot=0;for(Mt=dr.length;Ot<Mt;Ot++)zt=Ut=Rt=zn=rr.value[dr[Ot]],rr.array[Un]=Rt.x,rr.array[Un+1]=Rt.y,rr.array[Un+2]=Rt.z,rr.array[Un+3]=Rt.w,rr.array[Un+4]=Ut.x,rr.array[Un+5]=Ut.y,rr.array[Un+6]=Ut.z,rr.array[Un+7]=Ut.w,rr.array[Un+8]=zt.x,rr.array[Un+9]=zt.y,rr.array[Un+10]=zt.z,rr.array[Un+11]=zt.w,Un+=12;Ot=0;for(Mt=vr.length;Ot<Mt;Ot++)Wt=zt=Ut=Rt=zn=rr.value[vr[Ot]],rr.array[Un]=Rt.x,rr.array[Un+1]=Rt.y,rr.array[Un+2]=Rt.z,rr.array[Un+3]=Rt.w,rr.array[Un+4]=Ut.x,rr.array[Un+5]=Ut.y,rr.array[Un+6]=Ut.z,rr.array[Un+7]=Ut.w,rr.array[Un+8]=zt.x,rr.array[Un+9]=zt.y,rr.array[Un+10]=zt.z,rr.array[Un+11]=zt.w,rr.array[Un+12]=Wt.x,rr.array[Un+13]=Wt.y,rr.array[Un+14]=Wt.z,rr.array[Un+15]=Wt.w,Un+=16}P.bindBuffer(P.ARRAY_BUFFER,rr.buffer),P.bufferData(P.ARRAY_BUFFER,rr.array,xt)}}}Tt&&(delete Et.__inittedArrays,delete Et.__colorArray,delete Et.__normalArray,delete Et.__tangentArray,delete Et.__uvArray,delete Et.__uv2Array,delete Et.__faceArray,delete Et.__vertexArray,delete Et.__lineArray,delete Et.__skinVertexAArray,delete Et.__skinVertexBArray,delete Et.__skinIndexArray,delete Et.__skinWeightArray)}}}vt.verticesNeedUpdate=!1,vt.morphTargetsNeedUpdate=!1,vt.elementsNeedUpdate=!1,vt.uvsNeedUpdate=!1,vt.normalsNeedUpdate=!1,vt.colorsNeedUpdate=!1,vt.tangetsNeedUpdate=!1,yt.attributes&&h(yt)}else if(dt instanceof THREE.Ribbon){if(vt.verticesNeedUpdate||vt.colorsNeedUpdate){var Cr=vt,kr=P.DYNAMIC_DRAW,Lr=void 0,Ar=void 0,Or=void 0,Mr=void 0,_r=void 0,Dr=Cr.vertices,Pr=Cr.colors,Hr=Dr.length,Br=Pr.length,jr=Cr.__vertexArray,Fr=Cr.__colorArray,Ir=Cr.colorsNeedUpdate;if(Cr.verticesNeedUpdate){for(Lr=0;Lr<Hr;Lr++)Or=Dr[Lr],Mr=Lr*3,jr[Mr]=Or.x,jr[Mr+1]=Or.y,jr[Mr+2]=Or.z;P.bindBuffer(P.ARRAY_BUFFER,Cr.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,jr,kr)}if(Ir){for(Ar=0;Ar<Br;Ar++)_r=Pr[Ar],Mr=Ar*3,Fr[Mr]=_r.r,Fr[Mr+1]=_r.g,Fr[Mr+2]=_r.b;P.bindBuffer(P.ARRAY_BUFFER,Cr.__webglColorBuffer),P.bufferData(P.ARRAY_BUFFER,Fr,kr)}}vt.verticesNeedUpdate=!1,vt.colorsNeedUpdate=!1}else if(dt instanceof THREE.Line){yt=n(dt,mt),gt=yt.attributes&&c(yt);if(vt.verticesNeedUpdate||vt.colorsNeedUpdate||gt){var qr=vt,Rr=P.DYNAMIC_DRAW,Ur=void 0,zr=void 0,Wr=void 0,Xr=void 0,Vr=void 0,$r=qr.vertices,Jr=qr.colors,Kr=$r.length,Qr=Jr.length,Gr=qr.__vertexArray,Yr=qr.__colorArray,Zr=qr.colorsNeedUpdate,ei=qr.__webglCustomAttributesList,ti=void 0,ni=void 0,ri=void 0,ii=void 0,si=void 0,oi=void 0;if(qr.verticesNeedUpdate){for(Ur=0;Ur<Kr;Ur++)Wr=$r[Ur],Xr=Ur*3,Gr[Xr]=Wr.x,Gr[Xr+1]=Wr.y,Gr[Xr+2]=Wr.z;P.bindBuffer(P.ARRAY_BUFFER,qr.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,Gr,Rr)}if(Zr){for(zr=0;zr<Qr;zr++)Vr=Jr[zr],Xr=zr*3,Yr[Xr]=Vr.r,Yr[Xr+1]=Vr.g,Yr[Xr+2]=Vr.b;P.bindBuffer(P.ARRAY_BUFFER,qr.__webglColorBuffer),P.bufferData(P.ARRAY_BUFFER,Yr,Rr)}if(ei){ti=0;for(ni=ei.length;ti<ni;ti++){oi=ei[ti];if(oi.needsUpdate&&(oi.boundTo===void 0||oi.boundTo==="vertices")){Xr=0,ii=oi.value.length;if(oi.size===1)for(ri=0;ri<ii;ri++)oi.array[ri]=oi.value[ri];else if(oi.size===2)for(ri=0;ri<ii;ri++)si=oi.value[ri],oi.array[Xr]=si.x,oi.array[Xr+1]=si.y,Xr+=2;else if(oi.size===3)if(oi.type==="c")for(ri=0;ri<ii;ri++)si=oi.value[ri],oi.array[Xr]=si.r,oi.array[Xr+1]=si.g,oi.array[Xr+2]=si.b,Xr+=3;else for(ri=0;ri<ii;ri++)si=oi.value[ri],oi.array[Xr]=si.x,oi.array[Xr+1]=si.y,oi.array[Xr+2]=si.z,Xr+=3;else if(oi.size===4)for(ri=0;ri<ii;ri++)si=oi.value[ri],oi.array[Xr]=si.x,oi.array[Xr+1]=si.y,oi.array[Xr+2]=si.z,oi.array[Xr+3]=si.w,Xr+=4;P.bindBuffer(P.ARRAY_BUFFER,oi.buffer),P.bufferData(P.ARRAY_BUFFER,oi.array,Rr)}}}}vt.verticesNeedUpdate=!1,vt.colorsNeedUpdate=!1,yt.attributes&&h(yt)}else dt instanceof THREE.ParticleSystem&&(yt=n(dt,mt),gt=yt.attributes&&c(yt),(vt.verticesNeedUpdate||vt.colorsNeedUpdate||dt.sortParticles||gt)&&s(vt,P.DYNAMIC_DRAW,dt),vt.verticesNeedUpdate=!1,vt.colorsNeedUpdate=!1,yt.attributes&&h(yt))}},this.initMaterial=function(e,t,n,r){var i,s,o;e instanceof THREE.MeshDepthMaterial?o="depth":e instanceof THREE.MeshNormalMaterial?o="normal":e instanceof THREE.MeshBasicMaterial?o="basic":e instanceof THREE.MeshLambertMaterial?o="lambert":e instanceof THREE.MeshPhongMaterial?o="phong":e instanceof THREE.LineBasicMaterial?o="basic":e instanceof THREE.ParticleBasicMaterial&&(o="particle_basic");if(o){var u=THREE.ShaderLib[o];e.uniforms=THREE.UniformsUtils.clone(u.uniforms),e.vertexShader=u.vertexShader,e.fragmentShader=u.fragmentShader}var a,f,l,c,h;a=c=h=u=0;for(f=t.length;a<f;a++)l=t[a],l.onlyShadow||(l instanceof THREE.DirectionalLight&&c++,l instanceof THREE.PointLight&&h++,l instanceof THREE.SpotLight&&u++);h+u+c<=_?(f=c,l=h,c=u):(f=Math.ceil(_*c/(h+c)),c=l=_-f);var p=0,u=0;for(h=t.length;u<h;u++)a=t[u],a.castShadow&&(a instanceof THREE.SpotLight&&p++,a instanceof THREE.DirectionalLight&&!a.shadowCascade&&p++);var d=50;r!==void 0&&r instanceof THREE.SkinnedMesh&&(d=r.bones.length);var v;e:{h=e.fragmentShader,a=e.vertexShader;var u=e.uniforms,t=e.attributes,n={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,vertexColors:e.vertexColors,fog:n,useFog:e.fog,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:d,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:f,maxPointLights:l,maxSpotLights:c,maxShadows:p,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:r&&r.doubleSided},m,r=[];o?r.push(o):(r.push(h),r.push(a));for(m in n)r.push(m),r.push(n[m]);o=r.join(),m=0;for(r=H.length;m<r;m++)if(H[m].code===o){v=H[m].program;break e}m=P.createProgram(),r=["precision "+T+" float;",pt>0?"#define VERTEX_TEXTURES":"",D.gammaInput?"#define GAMMA_INPUT":"",D.gammaOutput?"#define GAMMA_OUTPUT":"",D.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_SHADOWS "+n.maxShadows,"#define MAX_BONES "+n.maxBones,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.vertexColors?"#define USE_COLOR":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals?"#define USE_MORPHNORMALS":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapSoft?"#define SHADOWMAP_SOFT":"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),f=["precision "+T+" float;","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_SHADOWS "+n.maxShadows,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",D.gammaInput?"#define GAMMA_INPUT":"",D.gammaOutput?"#define GAMMA_OUTPUT":"",D.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.vertexColors?"#define USE_COLOR":"",n.metal?"#define METAL":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapSoft?"#define SHADOWMAP_SOFT":"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),P.attachShader(m,y("fragment",f+h)),P.attachShader(m,y("vertex",r+a)),P.linkProgram(m),P.getProgramParameter(m,P.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+P.getProgramParameter(m,P.VALIDATE_STATUS)+", gl error ["+P.getError()+"]"),m.uniforms={},m.attributes={};var g,r=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","boneGlobalMatrices","morphTargetInfluences"];for(g in u)r.push(g);g=r,r=0;for(u=g.length;r<u;r++)h=g[r],m.uniforms[h]=P.getUniformLocation(m,h);r=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(g=0;g<n.maxMorphTargets;g++)r.push("morphTarget"+g);for(g=0;g<n.maxMorphNormals;g++)r.push("morphNormal"+g);for(v in t)r.push(v);v=r,g=0;for(t=v.length;g<t;g++)n=v[g],m.attributes[n]=P.getAttribLocation(m,n);m.id=H.length,H.push({program:m,code:o}),D.info.memory.programs=H.length,v=m}e.program=v,v=e.program.attributes,v.position>=0&&P.enableVertexAttribArray(v.position),v.color>=0&&P.enableVertexAttribArray(v.color),v.normal>=0&&P.enableVertexAttribArray(v.normal),v.tangent>=0&&P.enableVertexAttribArray(v.tangent),e.skinning&&v.skinVertexA>=0&&v.skinVertexB>=0&&v.skinIndex>=0&&v.skinWeight>=0&&(P.enableVertexAttribArray(v.skinVertexA),P.enableVertexAttribArray(v.skinVertexB),P.enableVertexAttribArray(v.skinIndex),P.enableVertexAttribArray(v.skinWeight));if(e.attributes)for(s in e.attributes)v[s]!==void 0&&v[s]>=0&&P.enableVertexAttribArray(v[s]);if(e.morphTargets){e.numSupportedMorphTargets=0,m="morphTarget";for(s=0;s<this.maxMorphTargets;s++)g=m+s,v[g]>=0&&(P.enableVertexAttribArray(v[g]),e.numSupportedMorphTargets++)}if(e.morphNormals){e.numSupportedMorphNormals=0,m="morphNormal";for(s=0;s<this.maxMorphNormals;s++)g=m+s,v[g]>=0&&(P.enableVertexAttribArray(v[g]),e.numSupportedMorphNormals++)}e.uniformsList=[];for(i in e.uniforms)e.uniformsList.push([e.uniforms[i],i])},this.setFaceCulling=function(e,t){e?(!t||t==="ccw"?P.frontFace(P.CCW):P.frontFace(P.CW),e==="back"?P.cullFace(P.BACK):e==="front"?P.cullFace(P.FRONT):P.cullFace(P.FRONT_AND_BACK),P.enable(P.CULL_FACE)):P.disable(P.CULL_FACE)},this.setObjectFaces=function(e){U!==e.doubleSided&&(e.doubleSided?P.disable(P.CULL_FACE):P.enable(P.CULL_FACE),U=e.doubleSided),z!==e.flipSided&&(e.flipSided?P.frontFace(P.CW):P.frontFace(P.CCW),z=e.flipSided)},this.setDepthTest=function(e){J!==e&&(e?P.enable(P.DEPTH_TEST):P.disable(P.DEPTH_TEST),J=e)},this.setDepthWrite=function(e){K!==e&&(P.depthMask(e),K=e)},this.setBlending=function(e,t,n,r){if(e!==W){switch(e){case THREE.NoBlending:P.disable(P.BLEND);break;case THREE.AdditiveBlending:P.enable(P.BLEND),P.blendEquation(P.FUNC_ADD),P.blendFunc(P.SRC_ALPHA,P.ONE);break;case THREE.SubtractiveBlending:P.enable(P.BLEND),P.blendEquation(P.FUNC_ADD),P.blendFunc(P.ZERO,P.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:P.enable(P.BLEND),P.blendEquation(P.FUNC_ADD),P.blendFunc(P.ZERO,P.SRC_COLOR);break;case THREE.CustomBlending:P.enable(P.BLEND);break;default:P.enable(P.BLEND),P.blendEquationSeparate(P.FUNC_ADD,P.FUNC_ADD),P.blendFuncSeparate(P.SRC_ALPHA,P.ONE_MINUS_SRC_ALPHA,P.ONE,P.ONE_MINUS_SRC_ALPHA)}W=e}if(e===THREE.CustomBlending){t!==X&&(P.blendEquation(S(t)),X=t);if(n!==V||r!==$)P.blendFunc(S(n),S(r)),V=n,$=r}else $=V=X=null},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.__webglTexture=P.createTexture(),D.info.memory.textures++),P.activeTexture(P.TEXTURE0+t),P.bindTexture(P.TEXTURE_2D,e.__webglTexture),P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);var n=e.image,r=(n.width&n.width-1)===0&&(n.height&n.height-1)===0,i=S(e.format),s=S(e.type);b(P.TEXTURE_2D,e,r),e instanceof THREE.DataTexture?P.texImage2D(P.TEXTURE_2D,0,i,n.width,n.height,0,i,s,n.data):P.texImage2D(P.TEXTURE_2D,0,i,i,s,e.image),e.generateMipmaps&&r&&P.generateMipmap(P.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else P.activeTexture(P.TEXTURE0+t),P.bindTexture(P.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){e.depthBuffer===void 0&&(e.depthBuffer=!0),e.stencilBuffer===void 0&&(e.stencilBuffer=!0),e.__webglTexture=P.createTexture();var n=(e.width&e.width-1)===0&&(e.height&e.height-1)===0,r=S(e.format),i=S(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],P.bindTexture(P.TEXTURE_CUBE_MAP,e.__webglTexture),b(P.TEXTURE_CUBE_MAP,e,n);for(var s=0;s<6;s++){e.__webglFramebuffer[s]=P.createFramebuffer(),e.__webglRenderbuffer[s]=P.createRenderbuffer(),P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,r,e.width,e.height,0,r,i,null);var o=e,u=P.TEXTURE_CUBE_MAP_POSITIVE_X+s;P.bindFramebuffer(P.FRAMEBUFFER,e.__webglFramebuffer[s]),P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,u,o.__webglTexture,0),w(e.__webglRenderbuffer[s],e)}n&&P.generateMipmap(P.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=P.createFramebuffer(),e.__webglRenderbuffer=P.createRenderbuffer(),P.bindTexture(P.TEXTURE_2D,e.__webglTexture),b(P.TEXTURE_2D,e,n),P.texImage2D(P.TEXTURE_2D,0,r,e.width,e.height,0,r,i,null),r=P.TEXTURE_2D,P.bindFramebuffer(P.FRAMEBUFFER,e.__webglFramebuffer),P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,r,e.__webglTexture,0),w(e.__webglRenderbuffer,e),n&&P.generateMipmap(P.TEXTURE_2D);t?P.bindTexture(P.TEXTURE_CUBE_MAP,null):P.bindTexture(P.TEXTURE_2D,null),P.bindRenderbuffer(P.RENDERBUFFER,null),P.bindFramebuffer(P.FRAMEBUFFER,null)}e?(t=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,n=e.width,e=e.height,i=r=0):(t=null,n=nt,e=rt,r=et,i=tt),t!==j&&(P.bindFramebuffer(P.FRAMEBUFFER,t),P.viewport(r,i,n,e),j=t),it=n,st=e},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(e,t,n){this.width=e,this.height=t,n=n||{},this.wrapS=n.wrapS!==void 0?n.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=n.wrapT!==void 0?n.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=n.magFilter!==void 0?n.magFilter:THREE.LinearFilter,this.minFilter=n.minFilter!==void 0?n.minFilter:THREE.LinearMipMapLinearFilter,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=n.format!==void 0?n.format:THREE.RGBAFormat,this.type=n.type!==void 0?n.type:THREE.UnsignedByteType,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!0,this.generateMipmaps=!0},THREE.WebGLRenderTarget.prototype.clone=function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e},THREE.WebGLRenderTargetCube=function(e,t,n){THREE.WebGLRenderTarget.call(this,e,t,n),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=new THREE.WebGLRenderTarget,THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube,THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.v4=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableObject=function(){this.z=this.object=null},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.material=null},THREE.ColorUtils={adjustHSV:function(e,t,n,r){var i=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(e,i),i.h=THREE.Math.clamp(i.h+t,0,1),i.s=THREE.Math.clamp(i.s+n,0,1),i.v=THREE.Math.clamp(i.v+r,0,1),e.setHSV(i.h,i.s,i.v)},rgbToHsv:function(e,t){var n=e.r,r=e.g,i=e.b,s=Math.max(Math.max(n,r),i),o=Math.min(Math.min(n,r),i);if(o===s)o=n=0;else{var u=s-o,o=u/s,n=(n===s?(r-i)/u:r===s?2+(i-n)/u:4+(n-r)/u)/6;n<0&&(n+=1),n>1&&(n-=1)}return t===void 0&&(t={h:0,s:0,v:0}),t.h=n,t.s=o,t.v=s,t}},THREE.ColorUtils.__hsv={h:0,s:0,v:0},THREE.GeometryUtils={merge:function(e,t){for(var n,r,i=e.vertices.length,s=t instanceof THREE.Mesh?t.geometry:t,o=e.vertices,u=s.vertices,a=e.faces,f=s.faces,l=e.faceVertexUvs[0],c=s.faceVertexUvs[0],h={},p=0;p<e.materials.length;p++)h[e.materials[p].id]=p;t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,r=new THREE.Matrix4,r.extractRotation(n,t.scale));for(var p=0,d=u.length;p<d;p++){var v=u[p].clone();n&&n.multiplyVector3(v),o.push(v)}p=0;for(d=f.length;p<d;p++){var o=f[p],m,g,y=o.vertexNormals,b=o.vertexColors;o instanceof THREE.Face3?m=new THREE.Face3(o.a+i,o.b+i,o.c+i):o instanceof THREE.Face4&&(m=new THREE.Face4(o.a+i,o.b+i,o.c+i,o.d+i)),m.normal.copy(o.normal),r&&r.multiplyVector3(m.normal),u=0;for(v=y.length;u<v;u++)g=y[u].clone(),r&&r.multiplyVector3(g),m.vertexNormals.push(g);m.color.copy(o.color),u=0;for(v=b.length;u<v;u++)g=b[u],m.vertexColors.push(g.clone());o.materialIndex!==void 0&&(u=s.materials[o.materialIndex],v=u.id,b=h[v],b===void 0&&(b=e.materials.length,h[v]=b,e.materials.push(u)),m.materialIndex=b),m.centroid.copy(o.centroid),n&&n.multiplyVector3(m.centroid),a.push(m)}p=0;for(d=c.length;p<d;p++){n=c[p],r=[],u=0;for(v=n.length;u<v;u++)r.push(new THREE.UV(n[u].u,n[u].v));l.push(r)}},clone:function(e){var t=new THREE.Geometry,n,r=e.vertices,i=e.faces,s=e.faceVertexUvs[0];e.materials&&(t.materials=e.materials.slice()),e=0;for(n=r.length;e<n;e++)t.vertices.push(r[e].clone());e=0;for(n=i.length;e<n;e++)t.faces.push(i[e].clone());e=0;for(n=s.length;e<n;e++){for(var r=s[e],i=[],o=0,u=r.length;o<u;o++)i.push(new THREE.UV(r[o].u,r[o].v));t.faceVertexUvs[0].push(i)}return t},randomPointInTriangle:function(e,t,n){var r,i,s,o=new THREE.Vector3,u=THREE.GeometryUtils.__v1;return r=THREE.GeometryUtils.random(),i=THREE.GeometryUtils.random(),r+i>1&&(r=1-r,i=1-i),s=1-r-i,o.copy(e),o.multiplyScalar(r),u.copy(t),u.multiplyScalar(i),o.addSelf(u),u.copy(n),u.multiplyScalar(s),o.addSelf(u),o},randomPointInFace:function(e,t,n){var r,i,s;if(e instanceof THREE.Face3)return r=t.vertices[e.a],i=t.vertices[e.b],s=t.vertices[e.c],THREE.GeometryUtils.randomPointInTriangle(r,i,s);if(e instanceof THREE.Face4){r=t.vertices[e.a],i=t.vertices[e.b],s=t.vertices[e.c];var t=t.vertices[e.d],o;return n?e._area1&&e._area2?(n=e._area1,o=e._area2):(n=THREE.GeometryUtils.triangleArea(r,i,t),o=THREE.GeometryUtils.triangleArea(i,s,t),e._area1=n,e._area2=o):(n=THREE.GeometryUtils.triangleArea(r,i,t),o=THREE.GeometryUtils.triangleArea(i,s,t)),THREE.GeometryUtils.random()*(n+o)<n?THREE.GeometryUtils.randomPointInTriangle(r,i,t):THREE.GeometryUtils.randomPointInTriangle(i,s,t)}},randomPointsInGeometry:function(e,t){function n(e){function t(n,r){if(r<n)return n;var i=n+Math.floor((r-n)/2);return f[i]>e?t(n,i-1):f[i]<e?t(i+1,r):i}return t(0,f.length-1)}var r,i,s=e.faces,o=e.vertices,u=s.length,a=0,f=[],l,c,h,p;for(i=0;i<u;i++)r=s[i],r instanceof THREE.Face3?(l=o[r.a],c=o[r.b],h=o[r.c],r._area=THREE.GeometryUtils.triangleArea(l,c,h)):r instanceof THREE.Face4&&(l=o[r.a],c=o[r.b],h=o[r.c],p=o[r.d],r._area1=THREE.GeometryUtils.triangleArea(l,c,p),r._area2=THREE.GeometryUtils.triangleArea(c,h,p),r._area=r._area1+r._area2),a+=r._area,f[i]=a;r=[];for(i=0;i<t;i++)o=THREE.GeometryUtils.random()*a,o=n(o),r[i]=THREE.GeometryUtils.randomPointInFace(s[o],e,!0);return r},triangleArea:function(e,t,n){var r,i=THREE.GeometryUtils.__v1;return i.sub(e,t),r=i.length(),i.sub(e,n),e=i.length(),i.sub(t,n),n=i.length(),t=.5*(r+e+n),Math.sqrt(t*(t-r)*(t-e)*(t-n))},center:function(e){e.computeBoundingBox();var t=e.boundingBox,n=new THREE.Vector3;return n.add(t.min,t.max),n.multiplyScalar(-0.5),e.applyMatrix((new THREE.Matrix4).makeTranslation(n.x,n.y,n.z)),e.computeBoundingBox(),n},normalizeUVs:function(e){for(var e=e.faceVertexUvs[0],t=0,n=e.length;t<n;t++)for(var r=e[t],i=0,s=r.length;i<s;i++)r[i].u!==1&&(r[i].u=r[i].u-Math.floor(r[i].u)),r[i].v!==1&&(r[i].v=r[i].v-Math.floor(r[i].v))},triangulateQuads:function(e){var t,n,r,i,s=[],o=[],u=[];t=0;for(n=e.faceUvs.length;t<n;t++)o[t]=[];t=0;for(n=e.faceVertexUvs.length;t<n;t++)u[t]=[];t=0;for(n=e.faces.length;t<n;t++){r=e.faces[t];if(r instanceof THREE.Face4){i=r.a;var a=r.b,f=r.c,l=r.d,c=new THREE.Face3,h=new THREE.Face3;c.color.copy(r.color),h.color.copy(r.color),c.materialIndex=r.materialIndex,h.materialIndex=r.materialIndex,c.a=i,c.b=a,c.c=l,h.a=a,h.b=f,h.c=l,r.vertexColors.length===4&&(c.vertexColors[0]=r.vertexColors[0].clone(),c.vertexColors[1]=r.vertexColors[1].clone(),c.vertexColors[2]=r.vertexColors[3].clone(),h.vertexColors[0]=r.vertexColors[1].clone(),h.vertexColors[1]=r.vertexColors[2].clone(),h.vertexColors[2]=r.vertexColors[3].clone()),s.push(c,h),r=0;for(i=e.faceVertexUvs.length;r<i;r++)e.faceVertexUvs[r].length&&(c=e.faceVertexUvs[r][t],a=c[1],f=c[2],l=c[3],c=[c[0].clone(),a.clone(),l.clone()],a=[a.clone(),f.clone(),l.clone()],u[r].push(c,a));r=0;for(i=e.faceUvs.length;r<i;r++)e.faceUvs[r].length&&(a=e.faceUvs[r][t],o[r].push(a,a))}else{s.push(r),r=0;for(i=e.faceUvs.length;r<i;r++)o[r].push(e.faceUvs[r]);r=0;for(i=e.faceVertexUvs.length;r<i;r++)u[r].push(e.faceVertexUvs[r])}}e.faces=s,e.faceUvs=o,e.faceVertexUvs=u,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()},explode:function(e){for(var t=[],n=0,r=e.faces.length;n<r;n++){var i=t.length,s=e.faces[n];if(s instanceof THREE.Face4){var o=s.a,u=s.b,a=s.c,o=e.vertices[o],u=e.vertices[u],a=e.vertices[a],f=e.vertices[s.d];t.push(o.clone()),t.push(u.clone()),t.push(a.clone()),t.push(f.clone()),s.a=i,s.b=i+1,s.c=i+2,s.d=i+3}else o=s.a,u=s.b,a=s.c,o=e.vertices[o],u=e.vertices[u],a=e.vertices[a],t.push(o.clone()),t.push(u.clone()),t.push(a.clone()),s.a=i,s.b=i+1,s.c=i+2}e.vertices=t,delete e.__tmpVertices},tessellate:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E=[],S=[];n=0;for(r=e.faceVertexUvs.length;n<r;n++)S[n]=[];n=0;for(r=e.faces.length;n<r;n++){i=e.faces[n];if(i instanceof THREE.Face3){s=i.a,o=i.b,u=i.c,f=e.vertices[s],l=e.vertices[o],c=e.vertices[u],p=f.distanceTo(l),d=l.distanceTo(c),h=f.distanceTo(c);if(p>t||d>t||h>t){a=e.vertices.length,b=i.clone(),w=i.clone(),p>=d&&p>=h?(f=f.clone(),f.lerpSelf(l,.5),b.a=s,b.b=a,b.c=u,w.a=a,w.b=o,w.c=u,i.vertexNormals.length===3&&(s=i.vertexNormals[0].clone(),s.lerpSelf(i.vertexNormals[1],.5),b.vertexNormals[1].copy(s),w.vertexNormals[0].copy(s)),i.vertexColors.length===3&&(s=i.vertexColors[0].clone(),s.lerpSelf(i.vertexColors[1],.5),b.vertexColors[1].copy(s),w.vertexColors[0].copy(s)),i=0):d>=p&&d>=h?(f=l.clone(),f.lerpSelf(c,.5),b.a=s,b.b=o,b.c=a,w.a=a,w.b=u,w.c=s,i.vertexNormals.length===3&&(s=i.vertexNormals[1].clone(),s.lerpSelf(i.vertexNormals[2],.5),b.vertexNormals[2].copy(s),w.vertexNormals[0].copy(s),w.vertexNormals[1].copy(i.vertexNormals[2]),w.vertexNormals[2].copy(i.vertexNormals[0])),i.vertexColors.length===3&&(s=i.vertexColors[1].clone(),s.lerpSelf(i.vertexColors[2],.5),b.vertexColors[2].copy(s),w.vertexColors[0].copy(s),w.vertexColors[1].copy(i.vertexColors[2]),w.vertexColors[2].copy(i.vertexColors[0])),i=1):(f=f.clone(),f.lerpSelf(c,.5),b.a=s,b.b=o,b.c=a,w.a=a,w.b=o,w.c=u,i.vertexNormals.length===3&&(s=i.vertexNormals[0].clone(),s.lerpSelf(i.vertexNormals[2],.5),b.vertexNormals[2].copy(s),w.vertexNormals[0].copy(s)),i.vertexColors.length===3&&(s=i.vertexColors[0].clone(),s.lerpSelf(i.vertexColors[2],.5),b.vertexColors[2].copy(s),w.vertexColors[0].copy(s)),i=2),E.push(b,w),e.vertices.push(f),s=0;for(o=e.faceVertexUvs.length;s<o;s++)e.faceVertexUvs[s].length&&(f=e.faceVertexUvs[s][n],w=f[0],u=f[1],b=f[2],i===0?(l=w.clone(),l.lerpSelf(u,.5),f=[w.clone(),l.clone(),b.clone()],u=[l.clone(),u.clone(),b.clone()]):i===1?(l=u.clone(),l.lerpSelf(b,.5),f=[w.clone(),u.clone(),l.clone()],u=[l.clone(),b.clone(),w.clone()]):(l=w.clone(),l.lerpSelf(b,.5),f=[w.clone(),u.clone(),l.clone()],u=[l.clone(),u.clone(),b.clone()]),S[s].push(f,u))}else{E.push(i),s=0;for(o=e.faceVertexUvs.length;s<o;s++)S[s].push(e.faceVertexUvs[s][n])}}else{s=i.a,o=i.b,u=i.c,a=i.d,f=e.vertices[s],l=e.vertices[o],c=e.vertices[u],h=e.vertices[a],p=f.distanceTo(l),d=l.distanceTo(c),v=c.distanceTo(h),m=f.distanceTo(h);if(p>t||d>t||v>t||m>t){g=e.vertices.length,y=e.vertices.length+1,b=i.clone(),w=i.clone(),p>=d&&p>=v&&p>=m||v>=d&&v>=p&&v>=m?(p=f.clone(),p.lerpSelf(l,.5),l=c.clone(),l.lerpSelf(h,.5),b.a=s,b.b=g,b.c=y,b.d=a,w.a=g,w.b=o,w.c=u,w.d=y,i.vertexNormals.length===4&&(s=i.vertexNormals[0].clone(),s.lerpSelf(i.vertexNormals[1],.5),o=i.vertexNormals[2].clone(),o.lerpSelf(i.vertexNormals[3],.5),b.vertexNormals[1].copy(s),b.vertexNormals[2].copy(o),w.vertexNormals[0].copy(s),w.vertexNormals[3].copy(o)),i.vertexColors.length===4&&(s=i.vertexColors[0].clone(),s.lerpSelf(i.vertexColors[1],.5),o=i.vertexColors[2].clone(),o.lerpSelf(i.vertexColors[3],.5),b.vertexColors[1].copy(s),b.vertexColors[2].copy(o),w.vertexColors[0].copy(s),w.vertexColors[3].copy(o)),i=0):(p=l.clone(),p.lerpSelf(c,.5),l=h.clone(),l.lerpSelf(f,.5),b.a=s,b.b=o,b.c=g,b.d=y,w.a=y,w.b=g,w.c=u,w.d=a,i.vertexNormals.length===4&&(s=i.vertexNormals[1].clone(),s.lerpSelf(i.vertexNormals[2],.5),o=i.vertexNormals[3].clone(),o.lerpSelf(i.vertexNormals[0],.5),b.vertexNormals[2].copy(s),b.vertexNormals[3].copy(o),w.vertexNormals[0].copy(o),w.vertexNormals[1].copy(s)),i.vertexColors.length===4&&(s=i.vertexColors[1].clone(),s.lerpSelf(i.vertexColors[2],.5),o=i.vertexColors[3].clone(),o.lerpSelf(i.vertexColors[0],.5),b.vertexColors[2].copy(s),b.vertexColors[3].copy(o),w.vertexColors[0].copy(o),w.vertexColors[1].copy(s)),i=1),E.push(b,w),e.vertices.push(p,l),s=0;for(o=e.faceVertexUvs.length;s<o;s++)e.faceVertexUvs[s].length&&(f=e.faceVertexUvs[s][n],w=f[0],u=f[1],b=f[2],f=f[3],i===0?(l=w.clone(),l.lerpSelf(u,.5),c=b.clone(),c.lerpSelf(f,.5),w=[w.clone(),l.clone(),c.clone(),f.clone()],u=[l.clone(),u.clone(),b.clone(),c.clone()]):(l=u.clone(),l.lerpSelf(b,.5),c=f.clone(),c.lerpSelf(w,.5),w=[w.clone(),u.clone(),l.clone(),c.clone()],u=[c.clone(),l.clone(),b.clone(),f.clone()]),S[s].push(w,u))}else{E.push(i),s=0;for(o=e.faceVertexUvs.length;s<o;s++)S[s].push(e.faceVertexUvs[s][n])}}}e.faces=E,e.faceVertexUvs=S}},THREE.GeometryUtils.random=THREE.Math.random16,THREE.GeometryUtils.__v1=new THREE.Vector3,THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,n){var r=new Image,i=new THREE.Texture(r,t);return r.onload=function(){i.needsUpdate=!0,n&&n(this)},r.crossOrigin=this.crossOrigin,r.src=e,i},loadTextureCube:function(e,t,n){var r,i=[],s=new THREE.Texture(i,t),t=i.loadCount=0;for(r=e.length;t<r;++t)i[t]=new Image,i[t].onload=function(){i.loadCount=i.loadCount+1,i.loadCount===6&&(s.needsUpdate=!0),n&&n(this)},i[t].crossOrigin=this.crossOrigin,i[t].src=e[t];return s},getNormalMap:function(e,t){var n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]},t=t|1,r=e.width,i=e.height,s=document.createElement("canvas");s.width=r,s.height=i;var o=s.getContext("2d");o.drawImage(e,0,0);for(var u=o.getImageData(0,0,r,i).data,a=o.createImageData(r,i),f=a.data,l=0;l<r;l++)for(var c=0;c<i;c++){var h=c-1<0?0:c-1,p=c+1>i-1?i-1:c+1,d=l-1<0?0:l-1,v=l+1>r-1?r-1:l+1,m=[],g=[0,0,u[(c*r+l)*4]/255*t];m.push([-1,0,u[(c*r+d)*4]/255*t]),m.push([-1,-1,u[(h*r+d)*4]/255*t]),m.push([0,-1,u[(h*r+l)*4]/255*t]),m.push([1,-1,u[(h*r+v)*4]/255*t]),m.push([1,0,u[(c*r+v)*4]/255*t]),m.push([1,1,u[(p*r+v)*4]/255*t]),m.push([0,1,u[(p*r+l)*4]/255*t]),m.push([-1,1,u[(p*r+d)*4]/255*t]),h=[],d=m.length;for(p=0;p<d;p++){var v=m[p],y=m[(p+1)%d],v=[v[0]-g[0],v[1]-g[1],v[2]-g[2]],y=[y[0]-g[0],y[1]-g[1],y[2]-g[2]];h.push(n([v[1]*y[2]-v[2]*y[1],v[2]*y[0]-v[0]*y[2],v[0]*y[1]-v[1]*y[0]]))}m=[0,0,0];for(p=0;p<h.length;p++)m[0]=m[0]+h[p][0],m[1]=m[1]+h[p][1],m[2]=m[2]+h[p][2];m[0]=m[0]/h.length,m[1]=m[1]/h.length,m[2]=m[2]/h.length,g=(c*r+l)*4,f[g]=(m[0]+1)/2*255|0,f[g+1]=(m[1]+.5)*255|0,f[g+2]=m[2]*255|0,f[g+3]=255}return o.putImageData(a,0,0),s},generateDataTexture:function(e,t,n){for(var r=e*t,i=new Uint8Array(3*r),s=Math.floor(n.r*255),o=Math.floor(n.g*255),n=Math.floor(n.b*255),u=0;u<r;u++)i[u*3]=s,i[u*3+1]=o,i[u*3+2]=n;return e=new THREE.DataTexture(i,e,t,THREE.RGBFormat),e.needsUpdate=!0,e}},THREE.SceneUtils={showHierarchy:function(e,t){THREE.SceneUtils.traverseHierarchy(e,function(e){e.visible=t})},traverseHierarchy:function(e,t){var n,r,i=e.children.length;for(r=0;r<i;r++)n=e.children[r],t(n),THREE.SceneUtils.traverseHierarchy(n,t)},createMultiMaterialObject:function(e,t){var n,r=t.length,i=new THREE.Object3D;for(n=0;n<r;n++){var s=new THREE.Mesh(e,t[n]);i.add(s)}return i},cloneObject:function(e){var t;e instanceof THREE.MorphAnimMesh?(t=new THREE.MorphAnimMesh(e.geometry,e.material),t.duration=e.duration,t.mirroredLoop=e.mirroredLoop,t.time=e.time,t.lastKeyframe=e.lastKeyframe,t.currentKeyframe=e.currentKeyframe,t.direction=e.direction,t.directionBackwards=e.directionBackwards):e instanceof THREE.SkinnedMesh?t=new THREE.SkinnedMesh(e.geometry,e.material):e instanceof THREE.Mesh?t=new THREE.Mesh(e.geometry,e.material):e instanceof THREE.Line?t=new THREE.Line(e.geometry,e.material,e.type):e instanceof THREE.Ribbon?t=new THREE.Ribbon(e.geometry,e.material):e instanceof THREE.ParticleSystem?(t=new THREE.ParticleSystem(e.geometry,e.material),t.sortParticles=e.sortParticles):e instanceof THREE.Particle?t=new THREE.Particle(e.material):e instanceof THREE.Sprite?(t=new THREE.Sprite({}),t.color.copy(e.color),t.map=e.map,t.blending=e.blending,t.useScreenCoordinates=e.useScreenCoordinates,t.mergeWith3D=e.mergeWith3D,t.affectedByDistance=e.affectedByDistance,t.scaleByViewport=e.scaleByViewport,t.alignment=e.alignment,t.rotation3d.copy(e.rotation3d),t.rotation=e.rotation,t.opacity=e.opacity,t.uvOffset.copy(e.uvOffset),t.uvScale.copy(e.uvScale)):e instanceof THREE.LOD?t=new THREE.LOD:e instanceof THREE.MarchingCubes?(t=new THREE.MarchingCubes(e.resolution,e.material),t.field.set(e.field),t.isolation=e.isolation):e instanceof THREE.Object3D&&(t=new THREE.Object3D),t.name=e.name,t.parent=e.parent,t.up.copy(e.up),t.position.copy(e.position),t.rotation instanceof THREE.Vector3&&t.rotation.copy(e.rotation),t.eulerOrder=e.eulerOrder,t.scale.copy(e.scale),t.dynamic=e.dynamic,t.doubleSided=e.doubleSided,t.flipSided=e.flipSided,t.renderDepth=e.renderDepth,t.rotationAutoUpdate=e.rotationAutoUpdate,t.matrix.copy(e.matrix),t.matrixWorld.copy(e.matrixWorld),t.matrixRotationWorld.copy(e.matrixRotationWorld),t.matrixAutoUpdate=e.matrixAutoUpdate,t.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,t.quaternion.copy(e.quaternion),t.useQuaternion=e.useQuaternion,t.boundRadius=e.boundRadius,t.boundRadiusScale=e.boundRadiusScale,t.visible=e.visible,t.castShadow=e.castShadow,t.receiveShadow=e.receiveShadow,t.frustumCulled=e.frustumCulled;for(var n=0;n<e.children.length;n++){var r=THREE.SceneUtils.cloneObject(e.children[n]);t.children[n]=r,r.parent=t}if(e instanceof THREE.LOD)for(n=0;n<e.LODs.length;n++)t.LODs[n]={visibleAtDistance:e.LODs[n].visibleAtDistance,object3D:t.children[n]};return t},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){var r=new THREE.Matrix4;r.getInverse(n.matrixWorld),e.applyMatrix(r),t.remove(e),n.add(e)}},THREE.WebGLRenderer&&(THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nfloat pointDistance = vPointLight[ i ].w;\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalMatrix * normal;\nvTangent = normalMatrix * tangent.xyz;\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( normalize( vNormal.xyz ) * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}}),THREE.BufferGeometry=function(){this.id=THREE.GeometryCount++,this.vertexColorArray=this.vertexUvArray=this.vertexNormalArray=this.vertexPositionArray=this.vertexIndexArray=this.vertexColorBuffer=this.vertexUvBuffer=this.vertexNormalBuffer=this.vertexPositionBuffer=this.vertexIndexBuffer=null,this.dynamic=!1,this.boundingSphere=this.boundingBox=null,this.morphTargets=[]},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,computeBoundingBox:function(){},computeBoundingSphere:function(){}},THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){return this.getPoint(this.getUtoTmapping(e))},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],n,r=this.getPoint(0),i,s=0;t.push(0);for(i=1;i<=e;i++)n=this.getPoint(i/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var n=this.getLengths(),r=0,i=n.length,s;s=t?t:e*n[i-1];for(var o=0,u=i-1,a;o<=u;){r=Math.floor(o+(u-o)/2),a=n[r]-s;if(a<0)o=r+1;else{if(!(a>0)){u=r;break}u=r-1}}return r=u,n[r]==s?r/(i-1):(o=n[r],n=(r+(s-o)/(n[r+1]-o))/(i-1))},THREE.Curve.prototype.getNormalVector=function(e){return e=this.getTangent(e),new THREE.Vector2(-e.y,e.x)},THREE.Curve.prototype.getTangent=function(e){var t=e-1e-4,e=e+1e-4;return t<0&&(t=0),e>1&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().subSelf(t).normalize()},THREE.Curve.prototype.getTangentAt=function(e){return this.getTangent(this.getUtoTmapping(e))},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=new THREE.Curve,THREE.LineCurve.prototype.constructor=THREE.LineCurve,THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().subSelf(this.v1);return t.multiplyScalar(e).addSelf(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(){return this.v2.clone().subSelf(this.v1).normalize()},THREE.QuadraticBezierCurve=function(e,t,n){this.v0=e,this.v1=t,this.v2=n},THREE.QuadraticBezierCurve.prototype=new THREE.Curve,THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve,THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,e)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.CubicBezierCurve=function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},THREE.CubicBezierCurve.prototype=new THREE.Curve,THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve,THREE.CubicBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,e)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.SplineCurve=function(e){this.points=e==void 0?[]:e},THREE.SplineCurve.prototype=new THREE.Curve,THREE.SplineCurve.prototype.constructor=THREE.SplineCurve,THREE.SplineCurve.prototype.getPoint=function(e){var t=new THREE.Vector2,n=[],r=this.points,i;return i=(r.length-1)*e,e=Math.floor(i),i-=e,n[0]=e==0?e:e-1,n[1]=e,n[2]=e>r.length-2?r.length-1:e+1,n[3]=e>r.length-3?r.length-1:e+2,t.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,i),t.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,i),t},THREE.ArcCurve=function(e,t,n,r,i,s){this.aX=e,this.aY=t,this.aRadius=n,this.aStartAngle=r,this.aEndAngle=i,this.aClockwise=s},THREE.ArcCurve.prototype=new THREE.Curve,THREE.ArcCurve.prototype.constructor=THREE.ArcCurve,THREE.ArcCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;return this.aClockwise||(e=1-e),t=this.aStartAngle+e*t,e=this.aX+this.aRadius*Math.cos(t),t=this.aY+this.aRadius*Math.sin(t),new THREE.Vector2(e,t)},THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,n,r,i){var e=(n-e)*.5,r=(r-t)*.5,s=i*i;return(2*t-2*n+e+r)*i*s+(-3*t+3*n-2*e-r)*s+e*i+t}},THREE.Curve.create=function(e,t){return e.prototype=new THREE.Curve,e.prototype.constructor=e,e.prototype.getPoint=t,e},THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.sub(this.v2,this.v1),t.multiplyScalar(e),t.addSelf(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(e){var t,n;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),n=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),e=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,n,e)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},function(e){var t,n;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(t,n,e)}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=e==void 0?[]:e},function(e){var t=new THREE.Vector3,n=[],r=this.points,i,e=(r.length-1)*e;i=Math.floor(e),e-=i,n[0]=i==0?i:i-1,n[1]=i,n[2]=i>r.length-2?r.length-1:i+1,n[3]=i>r.length-3?r.length-1:i+2,i=r[n[0]];var s=r[n[1]],o=r[n[2]],n=r[n[3]];return t.x=THREE.Curve.Utils.interpolate(i.x,s.x,o.x,n.x,e),t.y=THREE.Curve.Utils.interpolate(i.y,s.y,o.y,n.y,e),t.z=THREE.Curve.Utils.interpolate(i.z,s.z,o.z,n.z,e),t}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=e==void 0?[]:e},function(e){var t=new THREE.Vector3,n=[],r=this.points,i;return i=(r.length-0)*e,e=Math.floor(i),i-=e,e+=e>0?0:(Math.floor(Math.abs(e)/r.length)+1)*r.length,n[0]=(e-1)%r.length,n[1]=e%r.length,n[2]=(e+1)%r.length,n[3]=(e+2)%r.length,t.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,i),t.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,i),t.z=THREE.Curve.Utils.interpolate(r[n[0]].z,r[n[1]].z,r[n[2]].z,r[n[3]].z,i),t}),THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=new THREE.Curve,THREE.CurvePath.prototype.constructor=THREE.CurvePath,THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),e=0;e<n.length;){if(n[e]>=t)return t=n[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e=[],t=0,n,r=this.curves.length;for(n=0;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e},THREE.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),t,n,r,i;t=n=Number.NEGATIVE_INFINITY,r=i=Number.POSITIVE_INFINITY;var s,o,u,a;a=new THREE.Vector2,o=0;for(u=e.length;o<u;o++)s=e[o],s.x>t?t=s.x:s.x<r&&(r=s.x),s.y>n?n=s.y:s.y<n&&(i=s.y),a.addSelf(s.x,s.y);return{minX:r,minY:i,maxX:t,maxY:n,centroid:a.divideScalar(u)}},THREE.CurvePath.prototype.createPointsGeometry=function(e){return this.createGeometry(this.getPoints(e,!0))},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){return this.createGeometry(this.getSpacedPoints(e,!0))},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,n=0;n<e.length;n++)t.vertices.push(new THREE.Vector3(e[n].x,e[n].y,0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var n=this.getPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n=this.getSpacedPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var n=this.getBoundingBox(),r,i,s,o,u,a;r=0;for(i=e.length;r<i;r++)s=e[r],o=s.x,u=s.y,a=o/n.maxX,a=t.getUtoTmapping(a,o),o=t.getPoint(a),u=t.getNormalVector(a).multiplyScalar(u),s.x=o.x+u.x,s.y=o.y+u.y;return e},THREE.EventTarget=function(){var e={};this.addEventListener=function(t,n){e[t]==void 0&&(e[t]=[]),e[t].indexOf(n)===-1&&e[t].push(n)},this.dispatchEvent=function(t){for(var n in e[t.type])e[t.type][n](t)},this.removeEventListener=function(t,n){var r=e[t].indexOf(n);r!==-1&&e[t].splice(r,1)}},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=new THREE.Object3D,THREE.Gyroscope.prototype.constructor=THREE.Gyroscope,THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?(this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.rotationWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.rotationObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=new THREE.CurvePath,THREE.Path.prototype.constructor=THREE.Path,THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(e,t){var n=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:n})},THREE.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args;this.curves.push(new THREE.LineCurve(new THREE.Vector2(r[r.length-2],r[r.length-1]),new THREE.Vector2(e,t))),this.actions.push({action:THREE.PathActions.LINE_TO,args:n})},THREE.Path.prototype.quadraticCurveTo=function(e,t,n,r){var i=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args;this.curves.push(new THREE.QuadraticBezierCurve(new THREE.Vector2(s[s.length-2],s[s.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,r))),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:i})},THREE.Path.prototype.bezierCurveTo=function(e,t,n,r,i,s){var o=Array.prototype.slice.call(arguments),u=this.actions[this.actions.length-1].args;this.curves.push(new THREE.CubicBezierCurve(new THREE.Vector2(u[u.length-2],u[u.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,r),new THREE.Vector2(i,s))),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:o})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,n=[new THREE.Vector2(n[n.length-2],n[n.length-1])];Array.prototype.push.apply(n,e),this.curves.push(new THREE.SplineCurve(n)),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,n,r,i,s){var o=Array.prototype.slice.call(arguments),u=this.actions[this.actions.length-1],u=new THREE.ArcCurve(u.x+e,u.y+t,n,r,i,s);this.curves.push(u),u=u.getPoint(s?1:0),o.push(u.x),o.push(u.y),this.actions.push({action:THREE.PathActions.ARC,args:o})},THREE.Path.prototype.absarc=function(e,t,n,r,i,s){var o=Array.prototype.slice.call(arguments),u=new THREE.ArcCurve(e,t,n,r,i,s);this.curves.push(u),u=u.getPoint(s?1:0),o.push(u.x),o.push(u.y),this.actions.push({action:THREE.PathActions.ARC,args:o})},THREE.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],n=0;n<e;n++)t.push(this.getPoint(n/e));return t},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);var e=e||12,n=[],r,i,s,o,u,a,f,l,c,h,p,d,v;r=0;for(i=this.actions.length;r<i;r++){s=this.actions[r],o=s.action,s=s.args;switch(o){case THREE.PathActions.MOVE_TO:n.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.LINE_TO:n.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:u=s[2],a=s[3],c=s[0],h=s[1],n.length>0?(o=n[n.length-1],p=o.x,d=o.y):(o=this.actions[r-1].args,p=o[o.length-2],d=o[o.length-1]);for(s=1;s<=e;s++)v=s/e,o=THREE.Shape.Utils.b2(v,p,c,u),v=THREE.Shape.Utils.b2(v,d,h,a),n.push(new THREE.Vector2(o,v));break;case THREE.PathActions.BEZIER_CURVE_TO:u=s[4],a=s[5],c=s[0],h=s[1],f=s[2],l=s[3],n.length>0?(o=n[n.length-1],p=o.x,d=o.y):(o=this.actions[r-1].args,p=o[o.length-2],d=o[o.length-1]);for(s=1;s<=e;s++)v=s/e,o=THREE.Shape.Utils.b3(v,p,c,f,u),v=THREE.Shape.Utils.b3(v,d,h,l,a),n.push(new THREE.Vector2(o,v));break;case THREE.PathActions.CSPLINE_THRU:o=this.actions[r-1].args,v=[new THREE.Vector2(o[o.length-2],o[o.length-1])],o=e*s[0].length,v=v.concat(s[0]),v=new THREE.SplineCurve(v);for(s=1;s<=o;s++)n.push(v.getPointAt(s/o));break;case THREE.PathActions.ARC:u=s[0],a=s[1],f=s[2],c=s[3],h=!!s[5],l=s[4]-c,p=e*2;for(s=1;s<=p;s++)v=s/p,h||(v=1-v),v=c+v*l,o=u+f*Math.cos(v),v=a+f*Math.sin(v),n.push(new THREE.Vector2(o,v))}}return r=n[n.length-1],Math.abs(r.x-n[0].x)<1e-10&&Math.abs(r.y-n[0].y)<1e-10&&n.splice(n.length-1,1),t&&n.push(n[0]),n},THREE.Path.prototype.transform=function(e,t){return this.getBoundingBox(),this.getWrapPoints(this.getPoints(t),e)},THREE.Path.prototype.nltransform=function(e,t,n,r,i,s){var o=this.getPoints(),u,a,f,l,c;u=0;for(a=o.length;u<a;u++)f=o[u],l=f.x,c=f.y,f.x=e*l+t*c+n,f.y=r*c+i*l+s;return o},THREE.Path.prototype.debug=function(e){var t=this.getBoundingBox();e||(e=document.createElement("canvas"),e.setAttribute("width",t.maxX+100),e.setAttribute("height",t.maxY+100),document.body.appendChild(e)),t=e.getContext("2d"),t.fillStyle="white",t.fillRect(0,0,e.width,e.height),t.strokeStyle="black",t.beginPath();var n,r,i,e=0;for(n=this.actions.length;e<n;e++)r=this.actions[e],i=r.args,r=r.action,r!=THREE.PathActions.CSPLINE_THRU&&t[r].apply(t,i);t.stroke(),t.closePath(),t.strokeStyle="red",r=this.getPoints(),e=0;for(n=r.length;e<n;e++)i=r[e],t.beginPath(),t.arc(i.x,i.y,1.5,0,Math.PI*2,!1),t.stroke(),t.closePath()},THREE.Path.prototype.toShapes=function(){var e,t,n,r,i=[],s=new THREE.Path;e=0;for(t=this.actions.length;e<t;e++)n=this.actions[e],r=n.args,n=n.action,n==THREE.PathActions.MOVE_TO&&s.actions.length!=0&&(i.push(s),s=new THREE.Path),s[n].apply(s,r);s.actions.length!=0&&i.push(s);if(i.length==0)return[];var o;r=[],e=!THREE.Shape.Utils.isClockWise(i[0].getPoints());if(i.length==1)return s=i[0],o=new THREE.Shape,o.actions=s.actions,o.curves=s.curves,r.push(o),r;if(e){o=new THREE.Shape,e=0;for(t=i.length;e<t;e++)s=i[e],THREE.Shape.Utils.isClockWise(s.getPoints())?(o.actions=s.actions,o.curves=s.curves,r.push(o),o=new THREE.Shape):o.holes.push(s)}else{e=0;for(t=i.length;e<t;e++)s=i[e],THREE.Shape.Utils.isClockWise(s.getPoints())?(o&&r.push(o),o=new THREE.Shape,o.actions=s.actions,o.curves=s.curves):o.holes.push(s);r.push(o)}return r},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=new THREE.Path,THREE.Shape.prototype.constructor=THREE.Path,THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)},THREE.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={removeHoles:function(e,t){var n=e.concat(),r=n.concat(),i,s,o,u,a,f,l,c,h,p,d=[];for(a=0;a<t.length;a++){f=t[a],Array.prototype.push.apply(r,f),s=Number.POSITIVE_INFINITY;for(i=0;i<f.length;i++){h=f[i],p=[];for(c=0;c<n.length;c++)l=n[c],l=h.distanceToSquared(l),p.push(l),l<s&&(s=l,o=i,u=c)}i=u-1>=0?u-1:n.length-1,s=o-1>=0?o-1:f.length-1;var v=[f[o],n[u],n[i]];c=THREE.FontUtils.Triangulate.area(v);var m=[f[o],f[s],n[u]];h=THREE.FontUtils.Triangulate.area(m),p=u,l=o,u+=1,o+=-1,u<0&&(u+=n.length),u%=n.length,o<0&&(o+=f.length),o%=f.length,i=u-1>=0?u-1:n.length-1,s=o-1>=0?o-1:f.length-1,v=[f[o],n[u],n[i]],v=THREE.FontUtils.Triangulate.area(v),m=[f[o],f[s],n[u]],m=THREE.FontUtils.Triangulate.area(m),c+h>v+m&&(u=p,o=l,u<0&&(u+=n.length),u%=n.length,o<0&&(o+=f.length),o%=f.length,i=u-1>=0?u-1:n.length-1,s=o-1>=0?o-1:f.length-1),c=n.slice(0,u),h=n.slice(u),p=f.slice(o),l=f.slice(0,o),s=[f[o],f[s],n[u]],d.push([f[o],n[u],n[i]]),d.push(s),n=c.concat(p).concat(l).concat(h)}return{shape:n,isolatedPts:d,allpoints:r}},triangulateShape:function(e,t){var n=THREE.Shape.Utils.removeHoles(e,t),r=n.allpoints,i=n.isolatedPts,n=THREE.FontUtils.Triangulate(n.shape,!1),s,o,u,a,f={};s=0;for(o=r.length;s<o;s++)a=r[s].x+":"+r[s].y,f[a]!==void 0&&console.log("Duplicate point",a),f[a]=s;s=0;for(o=n.length;s<o;s++){u=n[s];for(r=0;r<3;r++)a=u[r].x+":"+u[r].y,a=f[a],a!==void 0&&(u[r]=a)}s=0;for(o=i.length;s<o;s++){u=i[s];for(r=0;r<3;r++)a=u[r].x+":"+u[r].y,a=f[a],a!==void 0&&(u[r]=a)}return n.concat(i)},isClockWise:function(e){return THREE.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}},THREE.TextPath=function(e,t){THREE.Path.call(this),this.parameters=t||{},this.set(e)},THREE.TextPath.prototype.set=function(e,t){t=t||this.parameters,this.text=e;var n=t.curveSegments!==void 0?t.curveSegments:4,r=t.font!==void 0?t.font:"helvetiker",i=t.weight!==void 0?t.weight:"normal",s=t.style!==void 0?t.style:"normal";THREE.FontUtils.size=t.size!==void 0?t.size:100,THREE.FontUtils.divisions=n,THREE.FontUtils.face=r,THREE.FontUtils.weight=i,THREE.FontUtils.style=s},THREE.TextPath.prototype.toShapes=function(){for(var e=THREE.FontUtils.drawText(this.text).paths,t=[],n=0,r=e.length;n<r;n++)Array.prototype.push.apply(t,e[n].toShapes());return t},THREE.AnimationHandler=function(){var e=[],t={},n={update:function(t){for(var n=0;n<e.length;n++)e[n].update(t)},addToUpdate:function(t){e.indexOf(t)===-1&&e.push(t)},removeFromUpdate:function(t){t=e.indexOf(t),t!==-1&&e.splice(t,1)},add:function(e){t[e.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e;if(e.initialized!==!0){for(var n=0;n<e.hierarchy.length;n++){for(var r=0;r<e.hierarchy[n].keys.length;r++){e.hierarchy[n].keys[r].time<0&&(e.hierarchy[n].keys[r].time=0);if(e.hierarchy[n].keys[r].rot!==void 0&&!(e.hierarchy[n].keys[r].rot instanceof THREE.Quaternion)){var i=e.hierarchy[n].keys[r].rot;e.hierarchy[n].keys[r].rot=new THREE.Quaternion(i[0],i[1],i[2],i[3])}}if(e.hierarchy[n].keys.length&&e.hierarchy[n].keys[0].morphTargets!==void 0){i={};for(r=0;r<e.hierarchy[n].keys.length;r++)for(var s=0;s<e.hierarchy[n].keys[r].morphTargets.length;s++){var o=e.hierarchy[n].keys[r].morphTargets[s];i[o]=-1}e.hierarchy[n].usedMorphTargets=i;for(r=0;r<e.hierarchy[n].keys.length;r++){var u={};for(o in i){for(s=0;s<e.hierarchy[n].keys[r].morphTargets.length;s++)if(e.hierarchy[n].keys[r].morphTargets[s]===o){u[o]=e.hierarchy[n].keys[r].morphTargetsInfluences[s];break}s===e.hierarchy[n].keys[r].morphTargets.length&&(u[o]=0)}e.hierarchy[n].keys[r].morphTargetsInfluences=u}}for(r=1;r<e.hierarchy[n].keys.length;r++)e.hierarchy[n].keys[r].time===e.hierarchy[n].keys[r-1].time&&(e.hierarchy[n].keys.splice(r,1),r--);for(r=0;r<e.hierarchy[n].keys.length;r++)e.hierarchy[n].keys[r].index=r}r=parseInt(e.length*e.fps,10),e.JIT={},e.JIT.hierarchy=[];for(n=0;n<e.hierarchy.length;n++)e.JIT.hierarchy.push(Array(r));e.initialized=!0}},get:function(e){if(typeof e=="string")return t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)},parse:function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var n=0;n<e.bones.length;n++)t.push(e.bones[n]);else r(e,t);return t}},r=function(e,t){t.push(e);for(var n=0;n<e.children.length;n++)r(e.children[n],t)};return n.LINEAR=0,n.CATMULLROM=1,n.CATMULLROM_FORWARD=2,n}(),THREE.Animation=function(e,t,n,r){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=n!==void 0?n:THREE.AnimationHandler.LINEAR,this.JITCompile=r!==void 0?r:!0,this.points=[],this.target=new THREE.Vector3},THREE.Animation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=e!==void 0?e:!0,this.currentTime=t!==void 0?t:0;var n,r=this.hierarchy.length,i;for(n=0;n<r;n++){i=this.hierarchy[n],this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD&&(i.useQuaternion=!0),i.matrixAutoUpdate=!0,i.animationCache===void 0&&(i.animationCache={},i.animationCache.prevKey={pos:0,rot:0,scl:0},i.animationCache.nextKey={pos:0,rot:0,scl:0},i.animationCache.originalMatrix=i instanceof THREE.Bone?i.skinMatrix:i.matrix);var s=i.animationCache.prevKey;i=i.animationCache.nextKey,s.pos=this.data.hierarchy[n].keys[0],s.rot=this.data.hierarchy[n].keys[0],s.scl=this.data.hierarchy[n].keys[0],i.pos=this.getNextKeyWith("pos",n,1),i.rot=this.getNextKeyWith("rot",n,1),i.scl=this.getNextKeyWith("scl",n,1)}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.hierarchy.length;e++)this.hierarchy[e].animationCache!==void 0&&(this.hierarchy[e]instanceof THREE.Bone?this.hierarchy[e].skinMatrix=this.hierarchy[e].animationCache.originalMatrix:this.hierarchy[e].matrix=this.hierarchy[e].animationCache.originalMatrix,delete this.hierarchy[e].animationCache)},THREE.Animation.prototype.update=function(e){if(this.isPlaying){var t=["pos","rot","scl"],n,r,i,s,o,u,a,f,l=this.data.JIT.hierarchy,c,h;h=this.currentTime=this.currentTime+e*this.timeScale,c=this.currentTime=this.currentTime%this.data.length,f=parseInt(Math.min(c*this.data.fps,this.data.length*this.data.fps),10);for(var p=0,d=this.hierarchy.length;p<d;p++){e=this.hierarchy[p],a=e.animationCache;if(this.JITCompile&&l[p][f]!==void 0)e instanceof THREE.Bone?(e.skinMatrix=l[p][f],e.matrixAutoUpdate=!1,e.matrixWorldNeedsUpdate=!1):(e.matrix=l[p][f],e.matrixAutoUpdate=!1,e.matrixWorldNeedsUpdate=!0);else{this.JITCompile&&(e instanceof THREE.Bone?e.skinMatrix=e.animationCache.originalMatrix:e.matrix=e.animationCache.originalMatrix);for(var v=0;v<3;v++){n=t[v],o=a.prevKey[n],u=a.nextKey[n];if(u.time<=h){if(c<h){if(!this.loop){this.stop();return}o=this.data.hierarchy[p].keys[0];for(u=this.getNextKeyWith(n,p,1);u.time<c;)o=u,u=this.getNextKeyWith(n,p,u.index+1)}else do o=u,u=this.getNextKeyWith(n,p,u.index+1);while(u.time<c);a.prevKey[n]=o,a.nextKey[n]=u}e.matrixAutoUpdate=!0,e.matrixWorldNeedsUpdate=!0,r=(c-o.time)/(u.time-o.time),i=o[n],s=u[n];if(r<0||r>1)console.log("THREE.Animation.update: Warning! Scale out of bounds:"+r+" on bone "+p),r=r<0?0:1;if(n==="pos"){n=e.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR)n.x=i[0]+(s[0]-i[0])*r,n.y=i[1]+(s[1]-i[1])*r,n.z=i[2]+(s[2]-i[2])*r;else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)this.points[0]=this.getPrevKeyWith("pos",p,o.index-1).pos,this.points[1]=i,this.points[2]=s,this.points[3]=this.getNextKeyWith("pos",p,u.index+1).pos,r=r*.33+.33,i=this.interpolateCatmullRom(this.points,r),n.x=i[0],n.y=i[1],n.z=i[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(r=this.interpolateCatmullRom(this.points,r*1.01),this.target.set(r[0],r[1],r[2]),this.target.subSelf(n),this.target.y=0,this.target.normalize(),r=Math.atan2(this.target.x,this.target.z),e.rotation.set(0,r,0))}else n==="rot"?THREE.Quaternion.slerp(i,s,e.quaternion,r):n==="scl"&&(n=e.scale,n.x=i[0]+(s[0]-i[0])*r,n.y=i[1]+(s[1]-i[1])*r,n.z=i[2]+(s[2]-i[2])*r)}}}if(this.JITCompile&&l[0][f]===void 0){this.hierarchy[0].updateMatrixWorld(!0);for(p=0;p<this.hierarchy.length;p++)l[p][f]=this.hierarchy[p]instanceof THREE.Bone?this.hierarchy[p].skinMatrix.clone():this.hierarchy[p].matrix.clone()}}},THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var n=[],r=[],i,s,o,u,a,f;return i=(e.length-1)*t,s=Math.floor(i),i-=s,n[0]=s===0?s:s-1,n[1]=s,n[2]=s>e.length-2?s:s+1,n[3]=s>e.length-3?s:s+2,s=e[n[0]],u=e[n[1]],a=e[n[2]],f=e[n[3]],n=i*i,o=i*n,r[0]=this.interpolate(s[0],u[0],a[0],f[0],i,n,o),r[1]=this.interpolate(s[1],u[1],a[1],f[1],i,n,o),r[2]=this.interpolate(s[2],u[2],a[2],f[2],i,n,o),r},THREE.Animation.prototype.interpolate=function(e,t,n,r,i,s,o){return e=(n-e)*.5,r=(r-t)*.5,(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t},THREE.Animation.prototype.getNextKeyWith=function(e,t,n){for(var r=this.data.hierarchy[t].keys,n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n<r.length-1?n:r.length-1:n%r.length;n<r.length;n++)if(r[n][e]!==void 0)return r[n];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,n){for(var r=this.data.hierarchy[t].keys,n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+r.length;n>=0;n--)if(r[n][e]!==void 0)return r[n];return this.data.hierarchy[t].keys[r.length-1]},THREE.KeyFrameAnimation=function(e,t,n){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0,this.JITCompile=n!==void 0?n:!0,e=0;for(t=this.hierarchy.length;e<t;e++){var n=this.data.hierarchy[e].sids,r=this.hierarchy[e];if(this.data.hierarchy[e].keys.length&&n){for(var i=0;i<n.length;i++){var s=n[i],o=this.getNextKeyWith(s,e,0);o&&o.apply(s)}r.matrixAutoUpdate=!1,this.data.hierarchy[e].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=e!==void 0?e:!0,this.currentTime=t!==void 0?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var n,r=this.hierarchy.length,i,s;for(n=0;n<r;n++)i=this.hierarchy[n],s=this.data.hierarchy[n],i.useQuaternion=!0,s.animationCache===void 0&&(s.animationCache={},s.animationCache.prevKey=null,s.animationCache.nextKey=null,s.animationCache.originalMatrix=i instanceof THREE.Bone?i.skinMatrix:i.matrix),i=this.data.hierarchy[n].keys,i.length&&(s.animationCache.prevKey=i[0],s.animationCache.nextKey=i[1],this.startTime=Math.min(i[0].time,this.startTime),this.endTime=Math.max(i[i.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],n=this.data.hierarchy[e];if(n.animationCache!==void 0){var r=n.animationCache.originalMatrix;t instanceof THREE.Bone?(r.copy(t.skinMatrix),t.skinMatrix=r):(r.copy(t.matrix),t.matrix=r),delete n.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,n,r,i,s=this.data.JIT.hierarchy,o,u,a;u=this.currentTime=this.currentTime+e*this.timeScale,o=this.currentTime=this.currentTime%this.data.length,o<this.startTimeMs&&(o=this.currentTime=this.startTimeMs+o),i=parseInt(Math.min(o*this.data.fps,this.data.length*this.data.fps),10);if((a=o<u)&&!this.loop){for(var e=0,f=this.hierarchy.length;e<f;e++){var l=this.data.hierarchy[e].keys,s=this.data.hierarchy[e].sids;r=l.length-1,i=this.hierarchy[e];if(l.length){for(l=0;l<s.length;l++)o=s[l],(u=this.getPrevKeyWith(o,e,r))&&u.apply(o);this.data.hierarchy[e].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}this.stop()}else if(!(o<this.startTime)){e=0;for(f=this.hierarchy.length;e<f;e++){r=this.hierarchy[e],t=this.data.hierarchy[e];var l=t.keys,c=t.animationCache;if(this.JITCompile&&s[e][i]!==void 0)r instanceof THREE.Bone?(r.skinMatrix=s[e][i],r.matrixWorldNeedsUpdate=!1):(r.matrix=s[e][i],r.matrixWorldNeedsUpdate=!0);else if(l.length){this.JITCompile&&c&&(r instanceof THREE.Bone?r.skinMatrix=c.originalMatrix:r.matrix=c.originalMatrix),t=c.prevKey,n=c.nextKey;if(t&&n){if(n.time<=u){if(a&&this.loop){t=l[0];for(n=l[1];n.time<o;)t=n,n=l[t.index+1]}else if(!a)for(var h=l.length-1;n.time<o&&n.index!==h;)t=n,n=l[t.index+1];c.prevKey=t,c.nextKey=n}n.time>=o?t.interpolate(n,o):t.interpolate(n,n.time)}this.data.hierarchy[e].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&s[0][i]===void 0){this.hierarchy[0].updateMatrixWorld(!0);for(e=0;e<this.hierarchy.length;e++)s[e][i]=this.hierarchy[e]instanceof THREE.Bone?this.hierarchy[e].skinMatrix.clone():this.hierarchy[e].matrix.clone()}}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,n){t=this.data.hierarchy[t].keys;for(n%=t.length;n<t.length;n++)if(t[n].hasTarget(e))return t[n];return t[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,n){t=this.data.hierarchy[t].keys;for(n=n>=0?n:n+t.length;n>=0;n--)if(t[n].hasTarget(e))return t[n];return t[t.length-1]},THREE.CubeCamera=function(e,t,n){THREE.Object3D.call(this);var r=new THREE.PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new THREE.Vector3(1,0,0)),this.add(r);var i=new THREE.PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new THREE.Vector3(-1,0,0)),this.add(i);var s=new THREE.PerspectiveCamera(90,1,e,t);s.up.set(0,0,1),s.lookAt(new THREE.Vector3(0,1,0)),this.add(s);var o=new THREE.PerspectiveCamera(90,1,e,t);o.up.set(0,0,-1),o.lookAt(new THREE.Vector3(0,-1,0)),this.add(o);var u=new THREE.PerspectiveCamera(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new THREE.Vector3(0,0,1)),this.add(u);var a=new THREE.PerspectiveCamera(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new THREE.Vector3(0,0,-1)),this.add(a),this.renderTarget=new THREE.WebGLRenderTargetCube(n,n,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){var n=this.renderTarget,l=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,r,n),n.activeCubeFace=1,e.render(t,i,n),n.activeCubeFace=2,e.render(t,s,n),n.activeCubeFace=3,e.render(t,o,n),n.activeCubeFace=4,e.render(t,u,n),n.generateMipmaps=l,n.activeCubeFace=5,e.render(t,a,n)}},THREE.CubeCamera.prototype=new THREE.Object3D,THREE.CubeCamera.prototype.constructor=THREE.CubeCamera,THREE.CombinedCamera=function(e,t,n,r,i,s,o){THREE.Camera.call(this),this.fov=n,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,s,o),this.cameraP=new THREE.PerspectiveCamera(n,e/t,r,i),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=new THREE.Camera,THREE.CombinedCamera.prototype.constructor=THREE.CombinedCamera,THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPersepectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPersepectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPersepectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPersepectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t){var n=2*Math.atan((t!==void 0?t:24)/(e*2))*(180/Math.PI);return this.setFov(n),n},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPersepectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.FirstPersonControls=function(e,t){function n(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.target=new THREE.Vector3(0,0,0),this.domElement=t!==void 0?t:document,this.movementSpeed=1,this.lookSpeed=.005,this.noFly=!1,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0,this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1,this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1)),this.onMouseDown=function(e){this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation();if(this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){e.preventDefault(),e.stopPropagation();if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(e){var t=0;if(!this.freeze){this.heightSpeed?(t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin,this.autoSpeedFactor=e*t*this.heightCoef):this.autoSpeedFactor=0,t=e*this.movementSpeed,(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t),e*=this.lookSpeed,this.activeLook||(e=0),this.lon=this.lon+this.mouseX*e,this.lookVertical&&(this.lat=this.lat-this.mouseY*e),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180;var t=this.target,n=this.object.position;t.x=n.x+100*Math.sin(this.phi)*Math.cos(this.theta),t.y=n.y+100*Math.cos(this.phi),t.z=n.z+100*Math.sin(this.phi)*Math.sin(this.theta),t=1,this.constrainVertical&&(t=Math.PI/(this.verticalMax-this.verticalMin)),this.lon=this.lon+this.mouseX*e,this.lookVertical&&(this.lat=this.lat-this.mouseY*e*t),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180,this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)),t=this.target,n=this.object.position,t.x=n.x+100*Math.sin(this.phi)*Math.cos(this.theta),t.y=n.y+100*Math.cos(this.phi),t.z=n.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(t)}},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",n(this,this.onMouseMove),!1),this.domElement.addEventListener("mousedown",n(this,this.onMouseDown),!1),this.domElement.addEventListener("mouseup",n(this,this.onMouseUp),!1),this.domElement.addEventListener("keydown",n(this,this.onKeyDown),!1),this.domElement.addEventListener("keyup",n(this,this.onKeyUp),!1)},THREE.PathControls=function(e,t){function n(e){return(e*=2)<1?.5*e*e:-0.5*(--e*(e-2)-1)}function r(e,t){return function(){t.apply(e,arguments)}}function i(e,t,n,r){var i={name:n,fps:.6,length:r,hierarchy:[]},s,o=t.getControlPointsArray(),u=t.getLength(),a=o.length,f=0;s=a-1,t={parent:-1,keys:[]},t.keys[0]={time:0,pos:o[0],rot:[0,0,0,1],scl:[1,1,1]},t.keys[s]={time:r,pos:o[s],rot:[0,0,0,1],scl:[1,1,1]};for(s=1;s<a-1;s++)f=r*u.chunks[s]/u.total,t.keys[s]={time:f,pos:o[s]};return i.hierarchy[0]=t,THREE.AnimationHandler.add(i),new THREE.Animation(e,n,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function s(e,t){var n,r,i=new THREE.Geometry;for(n=0;n<e.points.length*t;n++)r=n/(e.points.length*t),r=e.getPoint(r),i.vertices[n]=new THREE.Vector3(r.x,r.y,r.z);return i}this.object=e,this.domElement=t!==void 0?t:document,this.id="PathControls"+THREE.PathControlsIdCounter++,this.duration=1e4,this.waypoints=[],this.useConstantSpeed=!0,this.resamplingCoef=50,this.debugPath=new THREE.Object3D,this.debugDummy=new THREE.Object3D,this.animationParent=new THREE.Object3D,this.lookSpeed=.005,this.lookHorizontal=this.lookVertical=!0,this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.target=new THREE.Object3D,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0,this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));var o=Math.PI*2,u=Math.PI/180;this.update=function(e){var t;this.lookHorizontal&&(this.lon=this.lon+this.mouseX*this.lookSpeed*e),this.lookVertical&&(this.lat=this.lat-this.mouseY*this.lookSpeed*e),this.lon=Math.max(0,Math.min(360,this.lon)),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*u,this.theta=this.lon*u,e=this.phi%o,this.phi=e>=0?e:e+o,t=this.verticalAngleMap.srcRange,e=this.verticalAngleMap.dstRange,t=THREE.Math.mapLinear(this.phi,t[0],t[1],e[0],e[1]);var r=e[1]-e[0];this.phi=n((t-e[0])/r)*r+e[0],t=this.horizontalAngleMap.srcRange,e=this.horizontalAngleMap.dstRange,t=THREE.Math.mapLinear(this.theta,t[0],t[1],e[0],e[1]),r=e[1]-e[0],this.theta=n((t-e[0])/r)*r+e[0],e=this.target.position,e.x=100*Math.sin(this.phi)*Math.cos(this.theta),e.y=100*Math.cos(this.phi),e.z=100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(this.target.position)},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.init=function(){this.spline=new THREE.Spline,this.spline.initFromArray(this.waypoints),this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var e=new THREE.MeshLambertMaterial({color:30719}),t=new THREE.MeshLambertMaterial({color:65280}),n=new THREE.CubeGeometry(10,10,20),o=new THREE.CubeGeometry(2,2,10);this.animationParent=new THREE.Mesh(n,e),e=new THREE.Mesh(o,t),e.position.set(0,10,0),this.animation=i(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.object),this.animationParent.add(this.target),this.animationParent.add(e)}else this.animation=i(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object);if(this.createDebugPath){var e=this.debugPath,t=this.spline,o=s(t,10),n=s(t,10),u=new THREE.LineBasicMaterial({color:16711680,linewidth:3}),o=new THREE.Line(o,u),n=new THREE.ParticleSystem(n,new THREE.ParticleBasicMaterial({color:16755200,size:3}));o.scale.set(1,1,1),e.add(o),n.scale.set(1,1,1),e.add(n);for(var o=new THREE.SphereGeometry(1,16,8),u=new THREE.MeshBasicMaterial({color:65280}),a=0;a<t.points.length;a++)n=new THREE.Mesh(o,u),n.position.copy(t.points[a]),e.add(n)}this.domElement.addEventListener("mousemove",r(this,this.onMouseMove),!1)}},THREE.PathControlsIdCounter=0,THREE.FlyControls=function(e,t){function n(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.domElement=t!==void 0?t:document,t&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=1,this.rollSpeed=.005,this.autoForward=this.dragToLook=!1,this.object.useQuaternion=!0,this.tmpQuaternion=new THREE.Quaternion,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new THREE.Vector3(0,0,0),this.rotationVector=new THREE.Vector3(0,0,0),this.handleEvent=function(e){typeof this[e.type]=="function"&&this[e.type](e)},this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(e.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}},this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),n=t.size[0]/2,r=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this.moveState.pitchDown=(e.pageY-t.offset[1]-r)/r,this.updateRotationVector()}},this.mouseup=function(e){e.preventDefault(),e.stopPropagation();if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()},this.update=function(e){var t=e*this.movementSpeed,e=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*e,this.rotationVector.y*e,this.rotationVector.z*e,1).normalize(),this.object.quaternion.multiplySelf(this.tmpQuaternion),this.object.matrix.setPosition(this.object.position),this.object.matrix.setRotationFromQuaternion(this.object.quaternion),this.object.matrixWorldNeedsUpdate=!0},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement.addEventListener("mousemove",n(this,this.mousemove),!1),this.domElement.addEventListener("mousedown",n(this,this.mousedown),!1),this.domElement.addEventListener("mouseup",n(this,this.mouseup),!1),this.domElement.addEventListener("keydown",n(this,this.keydown),!1),this.domElement.addEventListener("keyup",n(this,this.keyup),!1),this.updateMovementVector(),this.updateRotationVector()},THREE.RollControls=function(e,t){this.object=e,this.domElement=t!==void 0?t:document,this.mouseLook=!0,this.autoForward=!1,this.rollSpeed=this.movementSpeed=this.lookSpeed=1,this.constrainVertical=[-0.9,.9],this.object.matrixAutoUpdate=!1,this.forward=new THREE.Vector3(0,0,1),this.roll=0;var n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3,s=new THREE.Matrix4,o=!1,u=1,a=0,f=0,l=0,c=0,h=0,p=window.innerWidth/2,d=window.innerHeight/2;this.update=function(e){if(this.mouseLook){var t=e*this.lookSpeed;this.rotateHorizontally(t*c),this.rotateVertically(t*h)}t=e*this.movementSpeed,this.object.translateZ(-t*(a>0||this.autoForward&&!(a<0)?1:a)),this.object.translateX(t*f),this.object.translateY(t*l),o&&(this.roll=this.roll+this.rollSpeed*e*u),this.forward.y>this.constrainVertical[1]?(this.forward.y=this.constrainVertical[1],this.forward.normalize()):this.forward.y<this.constrainVertical[0]&&(this.forward.y=this.constrainVertical[0],this.forward.normalize()),i.copy(this.forward),r.set(0,1,0),n.cross(r,i).normalize(),r.cross(i,n).normalize(),this.object.matrix.elements[0]=n.x,this.object.matrix.elements[4]=r.x,this.object.matrix.elements[8]=i.x,this.object.matrix.elements[1]=n.y,this.object.matrix.elements[5]=r.y,this.object.matrix.elements[9]=i.y,this.object.matrix.elements[2]=n.z,this.object.matrix.elements[6]=r.z,this.object.matrix.elements[10]=i.z,s.identity(),s.elements[0]=Math.cos(this.roll),s.elements[4]=-Math.sin(this.roll),s.elements[1]=Math.sin(this.roll),s.elements[5]=Math.cos(this.roll),this.object.matrix.multiplySelf(s),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.elements[12]=this.object.position.x,this.object.matrix.elements[13]=this.object.position.y,this.object.matrix.elements[14]=this.object.position.z},this.translateX=function(e){this.object.position.x=this.object.position.x+this.object.matrix.elements[0]*e,this.object.position.y=this.object.position.y+this.object.matrix.elements[1]*e,this.object.position.z=this.object.position.z+this.object.matrix.elements[2]*e},this.translateY=function(e){this.object.position.x=this.object.position.x+this.object.matrix.elements[4]*e,this.object.position.y=this.object.position.y+this.object.matrix.elements[5]*e,this.object.position.z=this.object.position.z+this.object.matrix.elements[6]*e},this.translateZ=function(e){this.object.position.x=this.object.position.x-this.object.matrix.elements[8]*e,this.object.position.y=this.object.position.y-this.object.matrix.elements[9]*e,this.object.position.z=this.object.position.z-this.object.matrix.elements[10]*e},this.rotateHorizontally=function(e){n.set(this.object.matrix.elements[0],this.object.matrix.elements[1],this.object.matrix.elements[2]),n.multiplyScalar(e),this.forward.subSelf(n),this.forward.normalize()},this.rotateVertically=function(e){r.set(this.object.matrix.elements[4],this.object.matrix.elements[5],this.object.matrix.elements[6]),r.multiplyScalar(e),this.forward.addSelf(r),this.forward.normalize()},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(e){c=(e.clientX-p)/window.innerWidth,h=(e.clientY-d)/window.innerHeight},!1),this.domElement.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation();switch(e.button){case 0:a=1;break;case 2:a=-1}},!1),this.domElement.addEventListener("mouseup",function(e){e.preventDefault(),e.stopPropagation();switch(e.button){case 0:a=0;break;case 2:a=0}},!1),this.domElement.addEventListener("keydown",function(e){switch(e.keyCode){case 38:case 87:a=1;break;case 37:case 65:f=-1;break;case 40:case 83:a=-1;break;case 39:case 68:f=1;break;case 81:o=!0,u=1;break;case 69:o=!0,u=-1;break;case 82:l=1;break;case 70:l=-1}},!1),this.domElement.addEventListener("keyup",function(e){switch(e.keyCode){case 38:case 87:a=0;break;case 37:case 65:f=0;break;case 40:case 83:a=0;break;case 39:case 68:f=0;break;case 81:o=!1;break;case 69:o=!1;break;case 82:l=0;break;case 70:l=0}},!1)},THREE.TrackballControls=function(e,t){THREE.EventTarget.call(this);var n=this;this.object=e,this.domElement=t!==void 0?t:document,this.enabled=!0,this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=Infinity,this.keys=[65,83,68],this.target=new THREE.Vector3;var r=new THREE.Vector3,i=!1,s=-1,o=new THREE.Vector3,u=new THREE.Vector3,a=new THREE.Vector3,f=new THREE.Vector2,l=new THREE.Vector2,c=new THREE.Vector2,h=new THREE.Vector2,p={type:"change"};this.handleEvent=function(e){typeof this[e.type]=="function"&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new THREE.Vector2((e-n.screen.offsetLeft)/n.radius*.5,(t-n.screen.offsetTop)/n.radius*.5)},this.getMouseProjectionOnBall=function(e,t){var r=new THREE.Vector3((e-n.screen.width*.5-n.screen.offsetLeft)/n.radius,(n.screen.height*.5+n.screen.offsetTop-t)/n.radius,0),i=r.length();return i>1?r.normalize():r.z=Math.sqrt(1-i*i),o.copy(n.object.position).subSelf(n.target),i=n.object.up.clone().setLength(r.y),i.addSelf(n.object.up.clone().crossSelf(o).setLength(r.x)),i.addSelf(o.setLength(r.z)),i},this.rotateCamera=function(){var e=Math.acos(u.dot(a)/u.length()/a.length());if(e){var t=(new THREE.Vector3).cross(u,a).normalize(),r=new THREE.Quaternion,e=e*n.rotateSpeed;r.setFromAxisAngle(t,-e),r.multiplyVector3(o),r.multiplyVector3(n.object.up),r.multiplyVector3(a),n.staticMoving?u=a:(r.setFromAxisAngle(t,e*(n.dynamicDampingFactor-1)),r.multiplyVector3(u))}},this.zoomCamera=function(){var e=1+(l.y-f.y)*n.zoomSpeed;e!==1&&e>0&&(o.multiplyScalar(e),n.staticMoving?f=l:f.y=f.y+(l.y-f.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=h.clone().subSelf(c);if(e.lengthSq()){e.multiplyScalar(o.length()*n.panSpeed);var t=o.clone().crossSelf(n.object.up).setLength(e.x);t.addSelf(n.object.up.clone().setLength(e.y)),n.object.position.addSelf(t),n.target.addSelf(t),n.staticMoving?c=h:c.addSelf(e.sub(h,c).multiplyScalar(n.dynamicDampingFactor))}},this.checkDistances=function(){if(!n.noZoom||!n.noPan)n.object.position.lengthSq()>n.maxDistance*n.maxDistance&&n.object.position.setLength(n.maxDistance),o.lengthSq()<n.minDistance*n.minDistance&&n.object.position.add(n.target,o.setLength(n.minDistance))},this.update=function(){o.copy(n.object.position).subSelf(n.target),n.noRotate||n.rotateCamera(),n.noZoom||n.zoomCamera(),n.noPan||n.panCamera(),n.object.position.add(n.target,o),n.checkDistances(),n.object.lookAt(n.target),r.distanceTo(n.object.position)>0&&(n.dispatchEvent(p),r.copy(n.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(e){n.enabled&&(i&&(u=a=n.getMouseProjectionOnBall(e.clientX,e.clientY),f=l=n.getMouseOnScreen(e.clientX,e.clientY),c=h=n.getMouseOnScreen(e.clientX,e.clientY),i=!1),s!==-1&&(s===0&&!n.noRotate?a=n.getMouseProjectionOnBall(e.clientX,e.clientY):s===1&&!n.noZoom?l=n.getMouseOnScreen(e.clientX,e.clientY):s===2&&!n.noPan&&(h=n.getMouseOnScreen(e.clientX,e.clientY))))},!1),this.domElement.addEventListener("mousedown",function(e){n.enabled&&(e.preventDefault(),e.stopPropagation(),s===-1&&(s=e.button,s===0&&!n.noRotate?u=a=n.getMouseProjectionOnBall(e.clientX,e.clientY):s===1&&!n.noZoom?f=l=n.getMouseOnScreen(e.clientX,e.clientY):this.noPan||(c=h=n.getMouseOnScreen(e.clientX,e.clientY))))},!1),this.domElement.addEventListener("mouseup",function(e){n.enabled&&(e.preventDefault(),e.stopPropagation(),s=-1)},!1),window.addEventListener("keydown",function(e){n.enabled&&s===-1&&(e.keyCode===n.keys[0]&&!n.noRotate?s=0:e.keyCode===n.keys[1]&&!n.noZoom?s=1:e.keyCode===n.keys[2]&&!n.noPan&&(s=2),s!==-1&&(i=!0))},!1),window.addEventListener("keyup",function(){n.enabled&&s!==-1&&(s=-1)},!1)},THREE.CubeGeometry=function(e,t,n,r,i,s,o,u){function a(e,t,n,o,u,a,l,c){var h,p=r||1,d=i||1,v=u/2,m=a/2,g=f.vertices.length;if(e==="x"&&t==="y"||e==="y"&&t==="x")h="z";else if(e==="x"&&t==="z"||e==="z"&&t==="x")h="y",d=s||1;else if(e==="z"&&t==="y"||e==="y"&&t==="z")h="x",p=s||1;var y=p+1,b=d+1,w=u/p,E=a/d,S=new THREE.Vector3;S[h]=l>0?1:-1;for(u=0;u<b;u++)for(a=0;a<y;a++){var x=new THREE.Vector3;x[e]=(a*w-v)*n,x[t]=(u*E-m)*o,x[h]=l,f.vertices.push(x)}for(u=0;u<d;u++)for(a=0;a<p;a++)e=new THREE.Face4(a+y*u+g,a+y*(u+1)+g,a+1+y*(u+1)+g,a+1+y*u+g),e.normal.copy(S),e.vertexNormals.push(S.clone(),S.clone(),S.clone(),S.clone()),e.materialIndex=c,f.faces.push(e),f.faceVertexUvs[0].push([new THREE.UV(a/p,u/d),new THREE.UV(a/p,(u+1)/d),new THREE.UV((a+1)/p,(u+1)/d),new THREE.UV((a+1)/p,u/d)])}THREE.Geometry.call(this);var f=this,l=e/2,c=t/2,h=n/2,p,d,v,m,g,y;if(o!==void 0){if(o instanceof Array)this.materials=o;else{this.materials=[];for(p=0;p<6;p++)this.materials.push(o)}p=0,m=1,d=2,g=3,v=4,y=5}else this.materials=[];this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(u!=void 0)for(var b in u)this.sides[b]!==void 0&&(this.sides[b]=u[b]);this.sides.px&&a("z","y",-1,-1,n,t,l,p),this.sides.nx&&a("z","y",1,-1,n,t,-l,m),this.sides.py&&a("x","z",1,1,e,n,c,d),this.sides.ny&&a("x","z",1,-1,e,n,-c,g),this.sides.pz&&a("x","y",1,-1,e,t,h,v),this.sides.nz&&a("x","y",-1,-1,e,t,-h,y),this.computeCentroids(),this.mergeVertices()},THREE.CubeGeometry.prototype=new THREE.Geometry,THREE.CubeGeometry.prototype.constructor=THREE.CubeGeometry,THREE.CylinderGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this);var e=e!==void 0?e:20,t=t!==void 0?t:20,n=n!==void 0?n:100,o=n/2,r=r||8,i=i||1,u,a,f=[],l=[];for(a=0;a<=i;a++){var c=[],h=[],p=a/i,d=p*(t-e)+e;for(u=0;u<=r;u++){var v=u/r,m=new THREE.Vector3;m.x=d*Math.sin(v*Math.PI*2),m.y=-p*n+o,m.z=d*Math.cos(v*Math.PI*2),this.vertices.push(m),c.push(this.vertices.length-1),h.push(new THREE.UV(v,p))}f.push(c),l.push(h)}n=(t-e)/n;for(u=0;u<r;u++){e!==0?(c=this.vertices[f[0][u]].clone(),h=this.vertices[f[0][u+1]].clone()):(c=this.vertices[f[1][u]].clone(),h=this.vertices[f[1][u+1]].clone()),c.setY(Math.sqrt(c.x*c.x+c.z*c.z)*n).normalize(),h.setY(Math.sqrt(h.x*h.x+h.z*h.z)*n).normalize();for(a=0;a<i;a++){var p=f[a][u],d=f[a+1][u],v=f[a+1][u+1],m=f[a][u+1],g=c.clone(),y=c.clone(),b=h.clone(),w=h.clone(),E=l[a][u].clone(),S=l[a+1][u].clone(),x=l[a+1][u+1].clone(),T=l[a][u+1].clone();this.faces.push(new THREE.Face4(p,d,v,m,[g,y,b,w])),this.faceVertexUvs[0].push([E,S,x,T])}}if(!s&&e>0){this.vertices.push(new THREE.Vector3(0,o,0));for(u=0;u<r;u++)p=f[0][u],d=f[0][u+1],v=this.vertices.length-1,g=new THREE.Vector3(0,1,0),y=new THREE.Vector3(0,1,0),b=new THREE.Vector3(0,1,0),E=l[0][u].clone(),S=l[0][u+1].clone(),x=new THREE.UV(S.u,0),this.faces.push(new THREE.Face3(p,d,v,[g,y,b])),this.faceVertexUvs[0].push([E,S,x])}if(!s&&t>0){this.vertices.push(new THREE.Vector3(0,-o,0));for(u=0;u<r;u++)p=f[a][u+1],d=f[a][u],v=this.vertices.length-1,g=new THREE.Vector3(0,-1,0),y=new THREE.Vector3(0,-1,0),b=new THREE.Vector3(0,-1,0),E=l[a][u+1].clone(),S=l[a][u].clone(),x=new THREE.UV(S.u,1),this.faces.push(new THREE.Face3(p,d,v,[g,y,b])),this.faceVertexUvs[0].push([E,S,x])}this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=new THREE.Geometry,THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry,THREE.ExtrudeGeometry=function(e,t){typeof e!="undefined"&&(THREE.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=new THREE.Geometry,THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry,THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var n=e.length,r=0;r<n;r++)this.addShape(e[r],t)},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function n(e,t,n){return t||console.log("die"),t.clone().multiplyScalar(n).addSelf(e)}function r(e,t,n){var r=THREE.ExtrudeGeometry.__v1,i=THREE.ExtrudeGeometry.__v2,s=THREE.ExtrudeGeometry.__v3,o=THREE.ExtrudeGeometry.__v4,u=THREE.ExtrudeGeometry.__v5,a=THREE.ExtrudeGeometry.__v6;return r.set(e.x-t.x,e.y-t.y),i.set(e.x-n.x,e.y-n.y),r=r.normalize(),i=i.normalize(),s.set(-r.y,r.x),o.set(i.y,-i.x),u.copy(e).addSelf(s),a.copy(e).addSelf(o),u.equals(a)?o.clone():(u.copy(t).addSelf(s),a.copy(n).addSelf(o),s=r.dot(o),o=a.subSelf(u).dot(o),s===0&&(console.log("Either infinite or no solutions!"),o===0?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),o/=s,o<0?(t=Math.atan2(t.y-e.y,t.x-e.x),e=Math.atan2(n.y-e.y,n.x-e.x),t>e&&(e+=Math.PI*2),n=(t+e)/2,e=-Math.cos(n),n=-Math.sin(n),new THREE.Vector2(e,n)):r.multiplyScalar(o).addSelf(u).subSelf(e).clone())}function i(n,r){var i,s;for(I=n.length;--I>=0;){i=I,s=I-1,s<0&&(s=n.length-1);for(var o=0,u=h+l*2,o=0;o<u;o++){var a=B*o,f=B*(o+1),c=r+i+a,a=r+s+a,p=r+s+f,f=r+i+f,d=n,v=o,m=u,c=c+k,a=a+k,p=p+k,f=f+k;C.faces.push(new THREE.Face4(c,a,p,f,null,null,y)),c=z.generateSideWallUV(C,e,d,t,c,a,p,f,v,m),C.faceVertexUvs[0].push(c)}}}function s(e,t,n){C.vertices.push(new THREE.Vector3(e,t,n))}function o(n,r,i,s){n+=k,r+=k,i+=k,C.faces.push(new THREE.Face3(n,r,i,null,null,g)),n=s?z.generateBottomUV(C,e,t,n,r,i):z.generateTopUV(C,e,t,n,r,i),C.faceVertexUvs[0].push(n)}var u=t.amount!==void 0?t.amount:100,a=t.bevelThickness!==void 0?t.bevelThickness:6,f=t.bevelSize!==void 0?t.bevelSize:a-2,l=t.bevelSegments!==void 0?t.bevelSegments:3,c=t.bevelEnabled!==void 0?t.bevelEnabled:!0,h=t.steps!==void 0?t.steps:1,p=t.bendPath,d=t.extrudePath,v,m=!1,g=t.material,y=t.extrudeMaterial,b,w,E,S;d&&(v=d.getSpacedPoints(h),m=!0,c=!1,b=new THREE.TubeGeometry.FrenetFrames(d,h,!1),w=new THREE.Vector3,E=new THREE.Vector3,S=new THREE.Vector3),c||(f=a=l=0);var x,T,N,C=this,k=this.vertices.length;p&&e.addWrapPath(p);var d=e.extractPoints(),p=d.shape,L=d.holes;if(d=!THREE.Shape.Utils.isClockWise(p)){p=p.reverse(),T=0;for(N=L.length;T<N;T++)x=L[T],THREE.Shape.Utils.isClockWise(x)&&(L[T]=x.reverse());d=!1}var A=THREE.Shape.Utils.triangulateShape(p,L),O=p;T=0;for(N=L.length;T<N;T++)x=L[T],p=p.concat(x);var M,_,D,P,H,B=p.length,j,F=A.length,d=[],I=0;D=O.length,M=D-1;for(_=I+1;I<D;I++,M++,_++)M===D&&(M=0),_===D&&(_=0),d[I]=r(O[I],O[M],O[_]);var q=[],R,U=d.concat();T=0;for(N=L.length;T<N;T++){x=L[T],R=[],I=0,D=x.length,M=D-1;for(_=I+1;I<D;I++,M++,_++)M===D&&(M=0),_===D&&(_=0),R[I]=r(x[I],x[M],x[_]);q.push(R),U=U.concat(R)}for(M=0;M<l;M++){D=M/l,P=a*(1-D),_=f*Math.sin(D*Math.PI/2),I=0;for(D=O.length;I<D;I++)H=n(O[I],d[I],_),s(H.x,H.y,-P);T=0;for(N=L.length;T<N;T++){x=L[T],R=q[T],I=0;for(D=x.length;I<D;I++)H=n(x[I],R[I],_),s(H.x,H.y,-P)}}_=f;for(I=0;I<B;I++)H=c?n(p[I],U[I],_):p[I],m?(E.copy(b.normals[0]).multiplyScalar(H.x),w.copy(b.binormals[0]).multiplyScalar(H.y),S.copy(v[0]).addSelf(E).addSelf(w),s(S.x,S.y,S.z)):s(H.x,H.y,0);for(D=1;D<=h;D++)for(I=0;I<B;I++)H=c?n(p[I],U[I],_):p[I],m?(E.copy(b.normals[D]).multiplyScalar(H.x),w.copy(b.binormals[D]).multiplyScalar(H.y),S.copy(v[D]).addSelf(E).addSelf(w),s(S.x,S.y,S.z)):s(H.x,H.y,u/h*D);for(M=l-1;M>=0;M--){D=M/l,P=a*(1-D),_=f*Math.sin(D*Math.PI/2),I=0;for(D=O.length;I<D;I++)H=n(O[I],d[I],_),s(H.x,H.y,u+P);T=0;for(N=L.length;T<N;T++){x=L[T],R=q[T],I=0;for(D=x.length;I<D;I++)H=n(x[I],R[I],_),m?s(H.x,H.y+v[h-1].y,v[h-1].x+P):s(H.x,H.y,u+P)}}var z=THREE.ExtrudeGeometry.WorldUVGenerator;(function(){if(c){var e;e=B*0;for(I=0;I<F;I++)j=A[I],o(j[2]+e,j[1]+e,j[0]+e,!0);e=h+l*2,e=B*e;for(I=0;I<F;I++)j=A[I],o(j[0]+e,j[1]+e,j[2]+e,!1)}else{for(I=0;I<F;I++)j=A[I],o(j[2],j[1],j[0],!0);for(I=0;I<F;I++)j=A[I],o(j[0]+B*h,j[1]+B*h,j[2]+B*h,!1)}})(),function(){var e=0;i(O,e),e+=O.length,T=0;for(N=L.length;T<N;T++)x=L[T],i(x,e),e+=x.length}()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,n,r,i,s){return t=e.vertices[i].x,i=e.vertices[i].y,n=e.vertices[s].x,s=e.vertices[s].y,[new THREE.UV(e.vertices[r].x,1-e.vertices[r].y),new THREE.UV(t,1-i),new THREE.UV(n,1-s)]},generateBottomUV:function(e,t,n,r,i,s){return this.generateTopUV(e,t,n,r,i,s)},generateSideWallUV:function(e,t,n,r,i,s,o,u){var t=e.vertices[i].x,n=e.vertices[i].y,i=e.vertices[i].z,r=e.vertices[s].x,a=e.vertices[s].y,s=e.vertices[s].z,f=e.vertices[o].x,l=e.vertices[o].y,o=e.vertices[o].z,c=e.vertices[u].x,h=e.vertices[u].y,e=e.vertices[u].z;return Math.abs(n-a)<.01?[new THREE.UV(t,i),new THREE.UV(r,s),new THREE.UV(f,o),new THREE.UV(c,e)]:[new THREE.UV(n,i),new THREE.UV(a,s),new THREE.UV(l,o),new THREE.UV(h,e)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.LatheGeometry=function(e,t,n){THREE.Geometry.call(this);for(var t=t||12,n=n||2*Math.PI,r=[],i=(new THREE.Matrix4).makeRotationZ(n/t),s=0;s<e.length;s++)r[s]=e[s].clone(),this.vertices.push(r[s]);for(var o=t+1,n=0;n<o;n++)for(s=0;s<r.length;s++)r[s]=i.multiplyVector3(r[s].clone()),this.vertices.push(r[s]);for(n=0;n<t;n++){r=0;for(i=e.length;r<i-1;r++)this.faces.push(new THREE.Face4(n*i+r,(n+1)%o*i+r,(n+1)%o*i+(r+1)%i,n*i+(r+1)%i)),this.faceVertexUvs[0].push([new THREE.UV(1-n/t,r/i),new THREE.UV(1-(n+1)/t,r/i),new THREE.UV(1-(n+1)/t,(r+1)/i),new THREE.UV(1-n/t,(r+1)/i)])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=new THREE.Geometry,THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry,THREE.PlaneGeometry=function(e,t,n,r){THREE.Geometry.call(this);for(var i=e/2,s=t/2,n=n||1,r=r||1,o=n+1,u=r+1,a=e/n,f=t/r,l=new THREE.Vector3(0,1,0),e=0;e<u;e++)for(t=0;t<o;t++)this.vertices.push(new THREE.Vector3(t*a-i,0,e*f-s));for(e=0;e<r;e++)for(t=0;t<n;t++)i=new THREE.Face4(t+o*e,t+o*(e+1),t+1+o*(e+1),t+1+o*e),i.normal.copy(l),i.vertexNormals.push(l.clone(),l.clone(),l.clone(),l.clone()),this.faces.push(i),this.faceVertexUvs[0].push([new THREE.UV(t/n,e/r),new THREE.UV(t/n,(e+1)/r),new THREE.UV((t+1)/n,(e+1)/r),new THREE.UV((t+1)/n,e/r)]);this.computeCentroids()},THREE.PlaneGeometry.prototype=new THREE.Geometry,THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry,THREE.SphereGeometry=function(e,t,n,r,i,s,o){THREE.Geometry.call(this);var e=e||50,r=r!==void 0?r:0,i=i!==void 0?i:Math.PI*2,s=s!==void 0?s:0,o=o!==void 0?o:Math.PI,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),u,a,f=[],l=[];for(a=0;a<=n;a++){var c=[],h=[];for(u=0;u<=t;u++){var p=u/t,d=a/n,v=new THREE.Vector3;v.x=-e*Math.cos(r+p*i)*Math.sin(s+d*o),v.y=e*Math.cos(s+d*o),v.z=e*Math.sin(r+p*i)*Math.sin(s+d*o),this.vertices.push(v),c.push(this.vertices.length-1),h.push(new THREE.UV(p,d))}f.push(c),l.push(h)}for(a=0;a<n;a++)for(u=0;u<t;u++){var r=f[a][u+1],i=f[a][u],s=f[a+1][u],o=f[a+1][u+1],c=this.vertices[r].clone().normalize(),h=this.vertices[i].clone().normalize(),p=this.vertices[s].clone().normalize(),d=this.vertices[o].clone().normalize(),v=l[a][u+1].clone(),m=l[a][u].clone(),g=l[a+1][u].clone(),y=l[a+1][u+1].clone();Math.abs(this.vertices[r].y)==e?(this.faces.push(new THREE.Face3(r,s,o,[c,p,d])),this.faceVertexUvs[0].push([v,g,y])):Math.abs(this.vertices[s].y)==e?(this.faces.push(new THREE.Face3(r,i,s,[c,h,p])),this.faceVertexUvs[0].push([v,m,g])):(this.faces.push(new THREE.Face4(r,i,s,o,[c,h,p,d])),this.faceVertexUvs[0].push([v,m,g,y]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere={radius:e}},THREE.SphereGeometry.prototype=new THREE.Geometry,THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry,THREE.TextGeometry=function(e,t){var n=(new THREE.TextPath(e,t)).toShapes();t.amount=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1);if(t.bend){var r=n[n.length-1].getBoundingBox().maxX;t.bendPath=new THREE.QuadraticBezierCurve(new THREE.Vector2(0,0),new THREE.Vector2(r/2,120),new THREE.Vector2(r,0))}THREE.ExtrudeGeometry.call(this,n,t)},THREE.TextGeometry.prototype=new THREE.ExtrudeGeometry,THREE.TextGeometry.prototype.constructor=THREE.TextGeometry,THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(e){for(var t=this.getFace(),n=this.size/t.resolution,r=0,i=(""+e).split(""),s=i.length,o=[],e=0;e<s;e++){var u=new THREE.Path,u=this.extractGlyphPoints(i[e],t,n,r,u),r=r+u.offset;o.push(u.path)}return{paths:o,offset:r/2}},extractGlyphPoints:function(e,t,n,r,i){var s=[],o,u,a,f,l,c,h,p,d,v,m,g=t.glyphs[e]||t.glyphs["?"];if(g){if(g.o){t=g._cachedOutline||(g._cachedOutline=g.o.split(" ")),f=t.length;for(e=0;e<f;){a=t[e++];switch(a){case"m":a=t[e++]*n+r,l=t[e++]*n,s.push(new THREE.Vector2(a,l)),i.moveTo(a,l);break;case"l":a=t[e++]*n+r,l=t[e++]*n,s.push(new THREE.Vector2(a,l)),i.lineTo(a,l);break;case"q":a=t[e++]*n+r,l=t[e++]*n,p=t[e++]*n+r,d=t[e++]*n,i.quadraticCurveTo(p,d,a,l);if(o=s[s.length-1]){c=o.x,h=o.y,o=1;for(u=this.divisions;o<=u;o++){var y=o/u,b=THREE.Shape.Utils.b2(y,c,p,a),y=THREE.Shape.Utils.b2(y,h,d,l);s.push(new THREE.Vector2(b,y))}}break;case"b":a=t[e++]*n+r,l=t[e++]*n,p=t[e++]*n+r,d=t[e++]*-n,v=t[e++]*n+r,m=t[e++]*-n,i.bezierCurveTo(a,l,p,d,v,m);if(o=s[s.length-1]){c=o.x,h=o.y,o=1;for(u=this.divisions;o<=u;o++)y=o/u,b=THREE.Shape.Utils.b3(y,c,p,v,a),y=THREE.Shape.Utils.b3(y,h,d,m,l),s.push(new THREE.Vector2(b,y))}}}}return{offset:g.ha*n,points:s,path:i}}}},function(e){var t=function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return n*.5};return e.Triangulate=function(e,n){var r=e.length;if(r<3)return null;var i=[],s=[],o=[],u,a,f;if(t(e)>0)for(a=0;a<r;a++)s[a]=a;else for(a=0;a<r;a++)s[a]=r-1-a;var l=2*r;for(a=r-1;r>2;){if(l--<=0){console.log("Warning, unable to triangulate polygon!");break}u=a,r<=u&&(u=0),a=u+1,r<=a&&(a=0),f=a+1,r<=f&&(f=0);var c;e:{c=e;var h=u,p=a,d=f,v=r,m=s,g=void 0,y=void 0,w=void 0,E=void 0,S=void 0,x=void 0,T=void 0,N=void 0,C=void 0,y=c[m[h]].x,w=c[m[h]].y,E=c[m[p]].x,S=c[m[p]].y,x=c[m[d]].x,T=c[m[d]].y;if(1e-10>(E-y)*(T-w)-(S-w)*(x-y))c=!1;else{for(g=0;g<v;g++)if(g!=h&&g!=p&&g!=d){var N=c[m[g]].x,C=c[m[g]].y,k=void 0,L=void 0,A=void 0,O=void 0,M=void 0,_=void 0,D=void 0,P=void 0,H=void 0,B=void 0,j=void 0,F=void 0,k=A=M=void 0,k=x-E,L=T-S,A=y-x,O=w-T,M=E-y,_=S-w,D=N-y,P=C-w,H=N-E,B=C-S,j=N-x,F=C-T,k=k*B-L*H,M=M*P-_*D,A=A*F-O*j;if(k>=0&&A>=0&&M>=0){c=!1;break e}}c=!0}}if(c){i.push([e[s[u]],e[s[a]],e[s[f]]]),o.push([s[u],s[a],s[f]]),u=a;for(f=a+1;f<r;u++,f++)s[u]=s[f];r--,l=2*r}}return n?o:i},e.Triangulate.area=t,e}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.TorusGeometry=function(e,t,n,r,i){THREE.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.segmentsR=n||8,this.segmentsT=r||6,this.arc=i||Math.PI*2,i=new THREE.Vector3,e=[],t=[];for(n=0;n<=this.segmentsR;n++)for(r=0;r<=this.segmentsT;r++){var s=r/this.segmentsT*this.arc,o=n/this.segmentsR*Math.PI*2;i.x=this.radius*Math.cos(s),i.y=this.radius*Math.sin(s);var u=new THREE.Vector3;u.x=(this.radius+this.tube*Math.cos(o))*Math.cos(s),u.y=(this.radius+this.tube*Math.cos(o))*Math.sin(s),u.z=this.tube*Math.sin(o),this.vertices.push(u),e.push(new THREE.UV(r/this.segmentsT,1-n/this.segmentsR)),t.push(u.clone().subSelf(i).normalize())}for(n=1;n<=this.segmentsR;n++)for(r=1;r<=this.segmentsT;r++){var i=(this.segmentsT+1)*n+r-1,s=(this.segmentsT+1)*(n-1)+r-1,o=(this.segmentsT+1)*(n-1)+r,u=(this.segmentsT+1)*n+r,a=new THREE.Face4(i,s,o,u,[t[i],t[s],t[o],t[u]]);a.normal.addSelf(t[i]),a.normal.addSelf(t[s]),a.normal.addSelf(t[o]),a.normal.addSelf(t[u]),a.normal.normalize(),this.faces.push(a),this.faceVertexUvs[0].push([e[i].clone(),e[s].clone(),e[o].clone(),e[u].clone()])}this.computeCentroids()},THREE.TorusGeometry.prototype=new THREE.Geometry,THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry,THREE.TorusKnotGeometry=function(e,t,n,r,i,s,o){function u(e,t,n,r,i,s){var o=Math.cos(e);return Math.cos(t),t=Math.sin(e),e=n/r*e,n=Math.cos(e),o=i*(2+n)*.5*o,t=i*(2+n)*t*.5,i=s*i*Math.sin(e)*.5,new THREE.Vector3(o,t,i)}THREE.Geometry.call(this),this.radius=e||200,this.tube=t||40,this.segmentsR=n||64,this.segmentsT=r||8,this.p=i||2,this.q=s||3,this.heightScale=o||1,this.grid=Array(this.segmentsR),n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3;for(e=0;e<this.segmentsR;++e){this.grid[e]=Array(this.segmentsT);for(t=0;t<this.segmentsT;++t){var a=e/this.segmentsR*2*this.p*Math.PI,o=t/this.segmentsT*2*Math.PI,s=u(a,o,this.q,this.p,this.radius,this.heightScale),a=u(a+.01,o,this.q,this.p,this.radius,this.heightScale);n.sub(a,s),r.add(a,s),i.cross(n,r),r.cross(i,n),i.normalize(),r.normalize(),a=-this.tube*Math.cos(o),o=this.tube*Math.sin(o),s.x=s.x+(a*r.x+o*i.x),s.y=s.y+(a*r.y+o*i.y),s.z=s.z+(a*r.z+o*i.z),this.grid[e][t]=this.vertices.push(new THREE.Vector3(s.x,s.y,s.z))-1}}for(e=0;e<this.segmentsR;++e)for(t=0;t<this.segmentsT;++t){var i=(e+1)%this.segmentsR,s=(t+1)%this.segmentsT,n=this.grid[e][t],r=this.grid[i][t],i=this.grid[i][s],s=this.grid[e][s],o=new THREE.UV(e/this.segmentsR,t/this.segmentsT),a=new THREE.UV((e+1)/this.segmentsR,t/this.segmentsT),f=new THREE.UV((e+1)/this.segmentsR,(t+1)/this.segmentsT),l=new THREE.UV(e/this.segmentsR,(t+1)/this.segmentsT);this.faces.push(new THREE.Face4(n,r,i,s)),this.faceVertexUvs[0].push([o,a,f,l])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=new THREE.Geometry,THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry,THREE.TubeGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=n||1,this.segmentsRadius=r||8,this.closed=i||!1,s&&(this.debug=new THREE.Object3D),this.grid=[];var o,u,s=this.segments+1,a,f,l,c=new THREE.Vector3,h,p,d,t=new THREE.TubeGeometry.FrenetFrames(e,t,i);h=t.tangents,p=t.normals,d=t.binormals,this.tangents=h,this.normals=p,this.binormals=d;for(t=0;t<s;t++){this.grid[t]=[],r=t/(s-1),l=e.getPointAt(r),r=h[t],o=p[t],u=d[t],this.debug&&(this.debug.add(new THREE.ArrowHelper(r,l,n,255)),this.debug.add(new THREE.ArrowHelper(o,l,n,16711680)),this.debug.add(new THREE.ArrowHelper(u,l,n,65280)));for(r=0;r<this.segmentsRadius;r++)a=r/this.segmentsRadius*2*Math.PI,f=-this.radius*Math.cos(a),a=this.radius*Math.sin(a),c.copy(l),c.x=c.x+(f*o.x+a*u.x),c.y=c.y+(f*o.y+a*u.y),c.z=c.z+(f*o.z+a*u.z),this.grid[t][r]=this.vertices.push(new THREE.Vector3(c.x,c.y,c.z))-1}for(t=0;t<this.segments;t++)for(r=0;r<this.segmentsRadius;r++)s=i?(t+1)%this.segments:t+1,c=(r+1)%this.segmentsRadius,e=this.grid[t][r],n=this.grid[s][r],s=this.grid[s][c],c=this.grid[t][c],h=new THREE.UV(t/this.segments,r/this.segmentsRadius),p=new THREE.UV((t+1)/this.segments,r/this.segmentsRadius),d=new THREE.UV((t+1)/this.segments,(r+1)/this.segmentsRadius),o=new THREE.UV(t/this.segments,(r+1)/this.segmentsRadius),this.faces.push(new THREE.Face4(e,n,s,c)),this.faceVertexUvs[0].push([h,p,d,o]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=new THREE.Geometry,THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry,THREE.TubeGeometry.FrenetFrames=function(e,t,n){new THREE.Vector3;var r=new THREE.Vector3;new THREE.Vector3;var i=[],s=[],o=[],u=new THREE.Vector3,a=new THREE.Matrix4,t=t+1,f,l,c;this.tangents=i,this.normals=s,this.binormals=o;for(f=0;f<t;f++)l=f/(t-1),i[f]=e.getTangentAt(l),i[f].normalize();s[0]=new THREE.Vector3,o[0]=new THREE.Vector3,e=Number.MAX_VALUE,f=Math.abs(i[0].x),l=Math.abs(i[0].y),c=Math.abs(i[0].z),f<=e&&(e=f,r.set(1,0,0)),l<=e&&(e=l,r.set(0,1,0)),c<=e&&r.set(0,0,1),u.cross(i[0],r).normalize(),s[0].cross(i[0],u),o[0].cross(i[0],s[0]);for(f=1;f<t;f++)s[f]=s[f-1].clone(),o[f]=o[f-1].clone(),u.cross(i[f-1],i[f]),u.length()>1e-4&&(u.normalize(),r=Math.acos(i[f-1].dot(i[f])),a.makeRotationAxis(u,r).multiplyVector3(s[f])),o[f].cross(i[f],s[f]);if(n){r=Math.acos(s[0].dot(s[t-1])),r/=t-1,i[0].dot(u.cross(s[0],s[t-1]))>0&&(r=-r);for(f=1;f<t;f++)a.makeRotationAxis(i[f],r*f).multiplyVector3(s[f]),o[f].cross(i[f],s[f])}},THREE.PolyhedronGeometry=function(e,t,n,r){function i(e){var t=e.normalize().clone();t.index=a.vertices.push(t)-1;var n=Math.atan2(e.z,-e.x)/2/Math.PI+.5,e=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5;return t.uv=new THREE.UV(n,e),t}function s(e,t,n,r){r<1?(r=new THREE.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]),r.centroid.addSelf(e).addSelf(t).addSelf(n).divideScalar(3),r.normal=r.centroid.clone().normalize(),a.faces.push(r),r=Math.atan2(r.centroid.z,-r.centroid.x),a.faceVertexUvs[0].push([u(e.uv,e,r),u(t.uv,t,r),u(n.uv,n,r)])):(r-=1,s(e,o(e,t),o(e,n),r),s(o(e,t),t,o(t,n),r),s(o(e,n),o(t,n),n,r),s(o(e,t),o(t,n),o(e,n),r))}function o(e,t){c[e.index]||(c[e.index]=[]),c[t.index]||(c[t.index]=[]);var n=c[e.index][t.index];return n===void 0&&(c[e.index][t.index]=c[t.index][e.index]=n=i((new THREE.Vector3).add(e,t).divideScalar(2))),n}function u(e,t,n){return n<0&&e.u===1&&(e=new THREE.UV(e.u-1,e.v)),t.x===0&&t.z===0&&(e=new THREE.UV(n/2/Math.PI+.5,e.v)),e}THREE.Geometry.call(this);for(var n=n||1,r=r||0,a=this,f=0,l=e.length;f<l;f++)i(new THREE.Vector3(e[f][0],e[f][1],e[f][2]));for(var c=[],e=this.vertices,f=0,l=t.length;f<l;f++)s(e[t[f][0]],e[t[f][1]],e[t[f][2]],r);this.mergeVertices(),f=0;for(l=this.vertices.length;f<l;f++)this.vertices[f].multiplyScalar(n);this.computeCentroids(),this.boundingSphere={radius:n}},THREE.PolyhedronGeometry.prototype=new THREE.Geometry,THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry,THREE.IcosahedronGeometry=function(e,t){var n=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[[-1,n,0],[1,n,0],[-1,-n,0],[1,-n,0],[0,-1,n],[0,1,n],[0,-1,-n],[0,1,-n],[n,0,-1],[n,0,1],[-n,0,-1],[-n,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],e,t)},THREE.IcosahedronGeometry.prototype=new THREE.Geometry,THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry,THREE.OctahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],e,t)},THREE.OctahedronGeometry.prototype=new THREE.Geometry,THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry,THREE.TetrahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],e,t)},THREE.TetrahedronGeometry.prototype=new THREE.Geometry,THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry,THREE.ParametricGeometry=function(e,t,n,r){THREE.Geometry.call(this);var i=this.vertices,s=this.faces,o=this.faceVertexUvs[0],r=r===void 0?!1:r,u,a,f,l,c=t+1;for(u=0;u<=n;u++){l=u/n;for(a=0;a<=t;a++)f=a/t,f=e(f,l),i.push(f)}var h,p,d,v;for(u=0;u<n;u++)for(a=0;a<t;a++)e=u*c+a,i=u*c+a+1,l=(u+1)*c+a,f=(u+1)*c+a+1,h=new THREE.UV(u/t,a/n),p=new THREE.UV(u/t,(a+1)/n),d=new THREE.UV((u+1)/t,a/n),v=new THREE.UV((u+1)/t,(a+1)/n),r?(s.push(new THREE.Face3(e,i,l)),s.push(new THREE.Face3(i,f,l)),o.push([h,p,d]),o.push([p,v,d])):(s.push(new THREE.Face4(e,i,f,l)),o.push([h,p,d,v]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=new THREE.Geometry,THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry,THREE.AxisHelper=function(){THREE.Object3D.call(this);var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3),e.vertices.push(new THREE.Vector3(0,100,0));var t=new THREE.CylinderGeometry(0,5,25,5,1),n;n=new THREE.Line(e,new THREE.LineBasicMaterial({color:16711680})),n.rotation.z=-Math.PI/2,this.add(n),n=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:16711680})),n.position.x=100,n.rotation.z=-Math.PI/2,this.add(n),n=new THREE.Line(e,new THREE.LineBasicMaterial({color:65280})),this.add(n),n=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:65280})),n.position.y=100,this.add(n),n=new THREE.Line(e,new THREE.LineBasicMaterial({color:255})),n.rotation.x=Math.PI/2,this.add(n),n=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:255})),n.position.z=100,n.rotation.x=Math.PI/2,this.add(n)},THREE.AxisHelper.prototype=new THREE.Object3D,THREE.AxisHelper.prototype.constructor=THREE.AxisHelper,THREE.ArrowHelper=function(e,t,n,r){THREE.Object3D.call(this),r===void 0&&(r=16776960),n===void 0&&(n=20);var i=new THREE.Geometry;i.vertices.push(new THREE.Vector3(0,0,0)),i.vertices.push(new THREE.Vector3(0,1,0)),this.line=new THREE.Line(i,new THREE.LineBasicMaterial({color:r})),this.add(this.line),i=new THREE.CylinderGeometry(0,.05,.25,5,1),this.cone=new THREE.Mesh(i,new THREE.MeshBasicMaterial({color:r})),this.cone.position.set(0,1,0),this.add(this.cone),t instanceof THREE.Vector3&&(this.position=t),this.setDirection(e),this.setLength(n)},THREE.ArrowHelper.prototype=new THREE.Object3D,THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper,THREE.ArrowHelper.prototype.setDirection=function(e){var t=(new THREE.Vector3(0,1,0)).crossSelf(e),e=Math.acos((new THREE.Vector3(0,1,0)).dot(e.clone().normalize()));this.matrix=(new THREE.Matrix4).makeRotationAxis(t.normalize(),e),this.rotation.getRotationFromMatrix(this.matrix,this.scale)},THREE.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},THREE.CameraHelper=function(e){function t(e,t,r){n(e,r),n(t,r)}function n(e,t){r.lineGeometry.vertices.push(new THREE.Vector3),r.lineGeometry.colors.push(new THREE.Color(t)),r.pointMap[e]===void 0&&(r.pointMap[e]=[]),r.pointMap[e].push(r.lineGeometry.vertices.length-1)}THREE.Object3D.call(this);var r=this;this.lineGeometry=new THREE.Geometry,this.lineMaterial=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),this.pointMap={},t("n1","n2",16755200),t("n2","n4",16755200),t("n4","n3",16755200),t("n3","n1",16755200),t("f1","f2",16755200),t("f2","f4",16755200),t("f4","f3",16755200),t("f3","f1",16755200),t("n1","f1",16755200),t("n2","f2",16755200),t("n3","f3",16755200),t("n4","f4",16755200),t("p","n1",16711680),t("p","n2",16711680),t("p","n3",16711680),t("p","n4",16711680),t("u1","u2",43775),t("u2","u3",43775),t("u3","u1",43775),t("c","t",16777215),t("p","c",3355443),t("cn1","cn2",3355443),t("cn3","cn4",3355443),t("cf1","cf2",3355443),t("cf3","cf4",3355443),this.camera=e,this.update(e),this.lines=new THREE.Line(this.lineGeometry,this.lineMaterial,THREE.LinePieces),this.add(this.lines)},THREE.CameraHelper.prototype=new THREE.Object3D,THREE.CameraHelper.prototype.constructor=THREE.CameraHelper,THREE.CameraHelper.prototype.update=function(){function e(e,n,r,i){THREE.CameraHelper.__v.set(n,r,i),THREE.CameraHelper.__projector.unprojectVector(THREE.CameraHelper.__v,THREE.CameraHelper.__c),e=t.pointMap[e];if(e!==void 0){n=0;for(r=e.length;n<r;n++)t.lineGeometry.vertices[e[n]].copy(THREE.CameraHelper.__v)}}var t=this;THREE.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-0.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),this.lineGeometry.verticesNeedUpdate=!0},THREE.CameraHelper.__projector=new THREE.Projector,THREE.CameraHelper.__v=new THREE.Vector3,THREE.CameraHelper.__c=new THREE.Camera,THREE.SubdivisionModifier=function(e){this.subdivisions=e===void 0?1:e,this.useOldVertexColors=!1,this.supportUVs=!0,this.debug=!1},THREE.SubdivisionModifier.prototype.constructor=THREE.SubdivisionModifier,THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-->0;)this.smooth(e)},THREE.SubdivisionModifier.prototype.smooth=function(e){function t(){h.debug&&console.log.apply(console,arguments)}function n(){console&&console.log.apply(console,arguments)}function r(e,n,r,i,o,u,a){var f=new THREE.Face4(e,n,r,i,null,o.color,o.material);if(h.useOldVertexColors){f.vertexColors=[];for(var p,d,v,m=0;m<4;m++){v=u[m],p=new THREE.Color,p.setRGB(0,0,0);for(var g=0;g<v.length;g++)d=o.vertexColors[v[g]-1],p.r=p.r+d.r,p.g=p.g+d.g,p.b=p.b+d.b;p.r=p.r/v.length,p.g=p.g/v.length,p.b=p.b/v.length,f.vertexColors[m]=p}}l.push(f),h.supportUVs&&(o=[s(e,""),s(n,a),s(r,a),s(i,a)],o[0]?o[1]?o[2]?o[3]?c.push(o):t("d :( ",i+":"+a):t("c :( ",r+":"+a):t("b :( ",n+":"+a):t("a :( ",e+":"+a))}function i(e,t){return Math.min(e,t)+"_"+Math.max(e,t)}function s(e,r){var i=e+":"+r,s=y[i];return s?s:(e>=b&&e<b+d.length?t("face pt"):t("edge pt"),n("warning, UV not found for",i),null)}function o(e,t,r){var i=e+":"+t;i in y?n("dup vertexNo",e,"oldFaceNo",t,"value",r,"key",i,y[i]):y[i]=r}function u(e,t){A[e]===void 0&&(A[e]=[]),A[e].push(t)}function a(e,t,n){O[e]===void 0&&(O[e]={}),O[e][t]=n}var f=[],l=[],c=[],h=this,p=e.vertices,d=e.faces,f=p.concat(),v=[],m={},g={},y={},b=p.length,w,E,S,x,T,N=e.faceVertexUvs[0],C;t("originalFaces, uvs, originalVerticesLength",d.length,N.length,b);if(h.supportUVs){w=0;for(E=N.length;w<E;w++){S=0;for(x=N[w].length;S<x;S++)C=d[w]["abcd".charAt(S)],o(C,w,N[w][S])}}N.length==0&&(h.supportUVs=!1),w=0;for(T in y)w++;w||(h.supportUVs=!1,t("no uvs")),t("-- Original Faces + Vertices UVs completed",y,"vs",N.length),w=0;for(E=d.length;w<E;w++)T=d[w],v.push(T.centroid),f.push(T.centroid),h.supportUVs&&(N=new THREE.UV,T instanceof THREE.Face3?(N.u=s(T.a,w).u+s(T.b,w).u+s(T.c,w).u,N.v=s(T.a,w).v+s(T.b,w).v+s(T.c,w).v,N.u=N.u/3,N.v=N.v/3):T instanceof THREE.Face4&&(N.u=s(T.a,w).u+s(T.b,w).u+s(T.c,w).u+s(T.d,w).u,N.v=s(T.a,w).v+s(T.b,w).v+s(T.c,w).v+s(T.d,w).v,N.u=N.u/4,N.v=N.v/4),o(b+w,"",N));t("-- added UVs for new Faces",y),E=function(e){function t(e,t){u[e]===void 0&&(u[e]=[]),u[e].push(t)}var n,r,s,o,u={};n=0;for(r=e.faces.length;n<r;n++)s=e.faces[n],s instanceof THREE.Face3?(o=i(s.a,s.b),t(o,n),o=i(s.b,s.c),t(o,n),o=i(s.c,s.a),t(o,n)):s instanceof THREE.Face4&&(o=i(s.a,s.b),t(o,n),o=i(s.b,s.c),t(o,n),o=i(s.c,s.d),t(o,n),o=i(s.d,s.a),t(o,n));return u}(e),C=0;var k,L,A={},O={};for(w in E){N=E[w],k=w.split("_"),L=k[0],k=k[1],u(L,[L,k]),u(k,[L,k]),S=0;for(x=N.length;S<x;S++)T=N[S],a(L,T,w),a(k,T,w);N.length<2&&(g[w]=!0)}t("vertexEdgeMap",A,"vertexFaceMap",O);for(w in E)N=E[w],T=N[0],x=N[1],k=w.split("_"),L=k[0],k=k[1],N=new THREE.Vector3,g[w]?(N.addSelf(p[L]),N.addSelf(p[k]),N.multiplyScalar(.5)):(N.addSelf(v[T]),N.addSelf(v[x]),N.addSelf(p[L]),N.addSelf(p[k]),N.multiplyScalar(.25)),m[w]=b+d.length+C,f.push(N),C++,h.supportUVs&&(N=new THREE.UV,N.u=s(L,T).u+s(k,T).u,N.v=s(L,T).v+s(k,T).v,N.u=N.u/2,N.v=N.v/2,o(m[w],T,N),g[w]||(N=new THREE.UV,N.u=s(L,x).u+s(k,x).u,N.v=s(L,x).v+s(k,x).v,N.u=N.u/2,N.v=N.v/2,o(m[w],x,N)));t("-- Step 2 done");var M,_;x=["123","12","2","23"],k=["123","23","3","31"];var D=["123","31","1","12"],P=["1234","12","2","23"],H=["1234","23","3","34"],B=["1234","34","4","41"],j=["1234","41","1","12"];w=0;for(E=v.length;w<E;w++)T=d[w],N=b+w,T instanceof THREE.Face3?(C=i(T.a,T.b),L=i(T.b,T.c),M=i(T.c,T.a),r(N,m[C],T.b,m[L],T,x,w),r(N,m[L],T.c,m[M],T,k,w),r(N,m[M],T.a,m[C],T,D,w)):T instanceof THREE.Face4?(C=i(T.a,T.b),L=i(T.b,T.c),M=i(T.c,T.d),_=i(T.d,T.a),r(N,m[C],T.b,m[L],T,P,w),r(N,m[L],T.c,m[M],T,H,w),r(N,m[M],T.d,m[_],T,B,w),r(N,m[_],T.a,m[C],T,j,w)):t("face should be a face!",T);m=new THREE.Vector3,T=new THREE.Vector3,w=0;for(E=p.length;w<E;w++)if(A[w]!==void 0){m.set(0,0,0),T.set(0,0,0),L=new THREE.Vector3(0,0,0),N=0;for(S in O[w])m.addSelf(v[S]),N++;x=0,C=A[w].length;for(S=0;S<C;S++)g[i(A[w][S][0],A[w][S][1])]&&x++;if(x!=2){m.divideScalar(N);for(S=0;S<C;S++)N=A[w][S],N=p[N[0]].clone().addSelf(p[N[1]]).divideScalar(2),T.addSelf(N);T.divideScalar(C),L.addSelf(p[w]),L.multiplyScalar(C-3),L.addSelf(m),L.addSelf(T.multiplyScalar(2)),L.divideScalar(C),f[w]=L}}e.vertices=f,e.faces=l,e.faceVertexUvs[0]=c,delete e.__tmpVertices,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals()},THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(){}},THREE.ImmediateRenderObject.prototype=new THREE.Object3D,THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject,THREE.LensFlare=function(e,t,n,r,i){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,e!==void 0&&this.add(e,t,n,r,i)},THREE.LensFlare.prototype=new THREE.Object3D,THREE.LensFlare.prototype.constructor=THREE.LensFlare,THREE.LensFlare.prototype.supr=THREE.Object3D.prototype,THREE.LensFlare.prototype.add=function(e,t,n,r,i,s){t===void 0&&(t=-1),n===void 0&&(n=0),s===void 0&&(s=1),i===void 0&&(i=new THREE.Color(16777215)),r===void 0&&(r=THREE.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:s,color:i,blending:r})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length,n,r=-this.positionScreen.x*2,i=-this.positionScreen.y*2;for(e=0;e<t;e++)n=this.lensFlares[e],n.x=this.positionScreen.x+r*n.distance,n.y=this.positionScreen.y+i*n.distance,n.wantedRotation=n.x*Math.PI*.25,n.rotation=n.rotation+(n.wantedRotation-n.rotation)*.25},THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length;this.createAnimation("__default",0,n-1,n/1),this.setAnimationWeight("__default",1)},THREE.MorphBlendMesh.prototype=new THREE.Mesh,THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh,THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,n,r){t={startFrame:t,endFrame:n,length:n-t+1,fps:r,duration:(n-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t=/([a-z]+)(\d+)/,n,r={},i=this.geometry,s=0,o=i.morphTargets.length;s<o;s++){var u=i.morphTargets[s].name.match(t);if(u&&u.length>1){var a=u[1];r[a]||(r[a]={start:Infinity,end:-Infinity}),u=r[a],s<u.start&&(u.start=s),s>u.end&&(u.end=s),n||(n=a)}}for(a in r)u=r[a],this.createAnimation(a,u.start,u.end,e);this.firstAnimation=n},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){if(e=this.animationsMap[e])e.direction=1,e.directionBackwards=!1},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){if(e=this.animationsMap[e])e.direction=-1,e.directionBackwards=!0},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];n&&(n.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;if(e=this.animationsMap[e])t=e.time;return t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;if(e=this.animationsMap[e])t=e.duration;return t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){if(e=this.animationsMap[e])e.active=!1},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,n=this.animationsList.length;t<n;t++){var r=this.animationsList[t];if(r.active){var i=r.duration/r.length;r.time=r.time+r.direction*e;if(r.mirroredLoop){if(r.time>r.duration||r.time<0)r.direction=r.direction*-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)}else r.time=r.time%r.duration,r.time<0&&(r.time=r.time+r.duration);var s=r.startFrame+THREE.Math.clamp(Math.floor(r.time/i),0,r.length-1),o=r.weight;s!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*o,this.morphTargetInfluences[s]=0,r.lastFrame=r.currentFrame,r.currentFrame=s),i=r.time%i/i,r.directionBackwards&&(i=1-i),this.morphTargetInfluences[r.currentFrame]=i*o,this.morphTargetInfluences[r.lastFrame]=(1-i)*o}}},THREE.LensFlarePlugin=function(){function e(e){var n=t.createProgram(),r=t.createShader(t.FRAGMENT_SHADER),i=t.createShader(t.VERTEX_SHADER);return t.shaderSource(r,e.fragmentShader),t.shaderSource(i,e.vertexShader),t.compileShader(r),t.compileShader(i),t.attachShader(n,r),t.attachShader(n,i),t.linkProgram(n),n}var t,n,r,i,s,o,u,a,f,l,c,h,p;this.init=function(v){t=v.context,n=v,r=new Float32Array(16),i=new Uint16Array(6),v=0,r[v++]=-1,r[v++]=-1,r[v++]=0,r[v++]=0,r[v++]=1,r[v++]=-1,r[v++]=1,r[v++]=0,r[v++]=1,r[v++]=1,r[v++]=1,r[v++]=1,r[v++]=-1,r[v++]=1,r[v++]=0,r[v++]=1,v=0,i[v++]=0,i[v++]=1,i[v++]=2,i[v++]=0,i[v++]=2,i[v++]=3,s=t.createBuffer(),o=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),u=t.createTexture(),a=t.createTexture(),t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(f=!1,l=e(THREE.ShaderFlares.lensFlare)):(f=!0,l=e(THREE.ShaderFlares.lensFlareVertexTexture)),c={},h={},c.vertex=t.getAttribLocation(l,"position"),c.uv=t.getAttribLocation(l,"uv"),h.renderType=t.getUniformLocation(l,"renderType"),h.map=t.getUniformLocation(l,"map"),h.occlusionMap=t.getUniformLocation(l,"occlusionMap"),h.opacity=t.getUniformLocation(l,"opacity"),h.color=t.getUniformLocation(l,"color"),h.scale=t.getUniformLocation(l,"scale"),h.rotation=t.getUniformLocation(l,"rotation"),h.screenPosition=t.getUniformLocation(l,"screenPosition"),p=!1},this.render=function(e,r,i,d){var e=e.__webglFlares,v=e.length;if(v){var y=new THREE.Vector3,w=d/i,E=i*.5,S=d*.5,x=16/d,T=new THREE.Vector2(x*w,x),N=new THREE.Vector3(1,1,0),C=new THREE.Vector2(1,1),L=h,x=c;t.useProgram(l),p||(t.enableVertexAttribArray(c.vertex),t.enableVertexAttribArray(c.uv),p=!0),t.uniform1i(L.occlusionMap,0),t.uniform1i(L.map,1),t.bindBuffer(t.ARRAY_BUFFER,s),t.vertexAttribPointer(x.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(x.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.disable(t.CULL_FACE),t.depthMask(!1);var A,O,M,_,D;for(A=0;A<v;A++){x=16/d,T.set(x*w,x),_=e[A],y.set(_.matrixWorld.elements[12],_.matrixWorld.elements[13],_.matrixWorld.elements[14]),r.matrixWorldInverse.multiplyVector3(y),r.projectionMatrix.multiplyVector3(y),N.copy(y),C.x=N.x*E+E,C.y=N.y*S+S;if(f||C.x>0&&C.x<i&&C.y>0&&C.y<d){t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,u),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,C.x-8,C.y-8,16,16,0),t.uniform1i(L.renderType,0),t.uniform2f(L.scale,T.x,T.y),t.uniform3f(L.screenPosition,N.x,N.y,N.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,C.x-8,C.y-8,16,16,0),t.uniform1i(L.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,u),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),_.positionScreen.copy(N),_.customUpdateCallback?_.customUpdateCallback(_):_.updateLensFlares(),t.uniform1i(L.renderType,2),t.enable(t.BLEND),O=0;for(M=_.lensFlares.length;O<M;O++)D=_.lensFlares[O],D.opacity>.001&&D.scale>.001&&(N.x=D.x,N.y=D.y,N.z=D.z,x=D.size*D.scale/d,T.x=x*w,T.y=x,t.uniform3f(L.screenPosition,N.x,N.y,N.z),t.uniform2f(L.scale,T.x,T.y),t.uniform1f(L.rotation,D.rotation),t.uniform1f(L.opacity,D.opacity),t.uniform3f(L.color,D.color.r,D.color.g,D.color.b),n.setBlending(D.blending,D.blendEquation,D.blendSrc,D.blendDst),n.setTexture(D.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}}t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){var e,t,n,r,i=new THREE.Frustum,s=new THREE.Matrix4,o=new THREE.Vector3,u=new THREE.Vector3;this.init=function(i){e=i.context,t=i;var i=THREE.ShaderLib.depthRGBA,s=THREE.UniformsUtils.clone(i.uniforms);n=new THREE.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:s}),r=new THREE.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:s,morphTargets:!0}),n._shadowPass=!0,r._shadowPass=!0},this.render=function(e,n){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,n)},this.update=function(l,p){var v,m,y,w,E,S,x,T,N,C=[];w=0,e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),t.shadowMapCullFrontFaces?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0),v=0;for(m=l.__lights.length;v<m;v++){y=l.__lights[v];if(y.castShadow)if(y instanceof THREE.DirectionalLight&&y.shadowCascade)for(E=0;E<y.shadowCascadeCount;E++){var k;if(y.shadowCascadeArray[E])k=y.shadowCascadeArray[E];else{N=y,x=E,k=new THREE.DirectionalLight,k.isVirtual=!0,k.onlyShadow=!0,k.castShadow=!0,k.shadowCameraNear=N.shadowCameraNear,k.shadowCameraFar=N.shadowCameraFar,k.shadowCameraLeft=N.shadowCameraLeft,k.shadowCameraRight=N.shadowCameraRight,k.shadowCameraBottom=N.shadowCameraBottom,k.shadowCameraTop=N.shadowCameraTop,k.shadowCameraVisible=N.shadowCameraVisible,k.shadowDarkness=N.shadowDarkness,k.shadowBias=N.shadowCascadeBias[x],k.shadowMapWidth=N.shadowCascadeWidth[x],k.shadowMapHeight=N.shadowCascadeHeight[x],k.pointsWorld=[],k.pointsFrustum=[],T=k.pointsWorld,S=k.pointsFrustum;for(var L=0;L<8;L++)T[L]=new THREE.Vector3,S[L]=new THREE.Vector3;T=N.shadowCascadeNearZ[x],N=N.shadowCascadeFarZ[x],S[0].set(-1,-1,T),S[1].set(1,-1,T),S[2].set(-1,1,T),S[3].set(1,1,T),S[4].set(-1,-1,N),S[5].set(1,-1,N),S[6].set(-1,1,N),S[7].set(1,1,N),k.originalCamera=p,S=new THREE.Gyroscope,S.position=y.shadowCascadeOffset,S.add(k),S.add(k.target),p.add(S),y.shadowCascadeArray[E]=k,console.log("Created virtualLight",k)}x=y,T=E,N=x.shadowCascadeArray[T],N.position.copy(x.position),N.target.position.copy(x.target.position),N.lookAt(N.target),N.shadowCameraVisible=x.shadowCameraVisible,N.shadowDarkness=x.shadowDarkness,N.shadowBias=x.shadowCascadeBias[T],S=x.shadowCascadeNearZ[T],x=x.shadowCascadeFarZ[T],N=N.pointsFrustum,N[0].z=S,N[1].z=S,N[2].z=S,N[3].z=S,N[4].z=x,N[5].z=x,N[6].z=x,N[7].z=x,C[w]=k,w++}else C[w]=y,w++}v=0;for(m=C.length;v<m;v++){y=C[v],y.shadowMap||(y.shadowMap=new THREE.WebGLRenderTarget(y.shadowMapWidth,y.shadowMapHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),y.shadowMapSize=new THREE.Vector2(y.shadowMapWidth,y.shadowMapHeight),y.shadowMatrix=new THREE.Matrix4);if(!y.shadowCamera){if(y instanceof THREE.SpotLight)y.shadowCamera=new THREE.PerspectiveCamera(y.shadowCameraFov,y.shadowMapWidth/y.shadowMapHeight,y.shadowCameraNear,y.shadowCameraFar);else{if(!(y instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}y.shadowCamera=new THREE.OrthographicCamera(y.shadowCameraLeft,y.shadowCameraRight,y.shadowCameraTop,y.shadowCameraBottom,y.shadowCameraNear,y.shadowCameraFar)}l.add(y.shadowCamera),t.autoUpdateScene&&l.updateMatrixWorld()}y.shadowCameraVisible&&!y.cameraHelper&&(y.cameraHelper=new THREE.CameraHelper(y.shadowCamera),y.shadowCamera.add(y.cameraHelper));if(y.isVirtual&&k.originalCamera==p){E=p,w=y.shadowCamera,S=y.pointsFrustum,N=y.pointsWorld,o.set(Infinity,Infinity,Infinity),u.set(-Infinity,-Infinity,-Infinity);for(x=0;x<8;x++)T=N[x],T.copy(S[x]),THREE.ShadowMapPlugin.__projector.unprojectVector(T,E),w.matrixWorldInverse.multiplyVector3(T),T.x<o.x&&(o.x=T.x),T.x>u.x&&(u.x=T.x),T.y<o.y&&(o.y=T.y),T.y>u.y&&(u.y=T.y),T.z<o.z&&(o.z=T.z),T.z>u.z&&(u.z=T.z);w.left=o.x,w.right=u.x,w.top=u.y,w.bottom=o.y,w.updateProjectionMatrix()}w=y.shadowMap,S=y.shadowMatrix,E=y.shadowCamera,E.position.copy(y.matrixWorld.getPosition()),E.lookAt(y.target.matrixWorld.getPosition()),E.updateMatrixWorld(),E.matrixWorldInverse.getInverse(E.matrixWorld),y.cameraHelper&&(y.cameraHelper.lines.visible=y.shadowCameraVisible),y.shadowCameraVisible&&y.cameraHelper.update(),S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiplySelf(E.projectionMatrix),S.multiplySelf(E.matrixWorldInverse),E._viewMatrixArray||(E._viewMatrixArray=new Float32Array(16)),E._projectionMatrixArray||(E._projectionMatrixArray=new Float32Array(16)),E.matrixWorldInverse.flattenToArray(E._viewMatrixArray),E.projectionMatrix.flattenToArray(E._projectionMatrixArray),s.multiply(E.projectionMatrix,E.matrixWorldInverse),i.setFromMatrix(s),t.setRenderTarget(w),t.clear(),N=l.__webglObjects,y=0;for(w=N.length;y<w;y++)x=N[y],S=x.object,x.render=!1,S.visible&&S.castShadow&&(!(S instanceof THREE.Mesh)||!S.frustumCulled||i.contains(S))&&(S._modelViewMatrix.multiply(E.matrixWorldInverse,S.matrixWorld),x.render=!0);y=0;for(w=N.length;y<w;y++)x=N[y],x.render&&(S=x.object,x=x.buffer,T=S.customDepthMaterial?S.customDepthMaterial:S.geometry.morphTargets.length?r:n,x instanceof THREE.BufferGeometry?t.renderBufferDirect(E,l.__lights,null,T,x,S):t.renderBuffer(E,l.__lights,null,T,x,S));N=l.__webglObjectsImmediate,y=0;for(w=N.length;y<w;y++)x=N[y],S=x.object,S.visible&&S.castShadow&&(S._modelViewMatrix.multiply(E.matrixWorldInverse,S.matrixWorld),t.renderImmediateObject(E,l.__lights,null,n,S))}v=t.getClearColor(),m=t.getClearAlpha(),e.clearColor(v.r,v.g,v.b,m),e.enable(e.BLEND),t.shadowMapCullFrontFaces&&e.cullFace(e.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){function e(e,t){return t.z-e.z}var t,n,r,i,s,o,u,a,f,l;this.init=function(e){t=e.context,n=e,r=new Float32Array(16),i=new Uint16Array(6),e=0,r[e++]=-1,r[e++]=-1,r[e++]=0,r[e++]=1,r[e++]=1,r[e++]=-1,r[e++]=1,r[e++]=1,r[e++]=1,r[e++]=1,r[e++]=1,r[e++]=0,r[e++]=-1,r[e++]=1,r[e++]=0,e=r[e++]=0,i[e++]=0,i[e++]=1,i[e++]=2,i[e++]=0,i[e++]=2,i[e++]=3,s=t.createBuffer(),o=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW);var e=THREE.ShaderSprite.sprite,p=t.createProgram(),v=t.createShader(t.FRAGMENT_SHADER),m=t.createShader(t.VERTEX_SHADER);t.shaderSource(v,e.fragmentShader),t.shaderSource(m,e.vertexShader),t.compileShader(v),t.compileShader(m),t.attachShader(p,v),t.attachShader(p,m),t.linkProgram(p),u=p,a={},f={},a.position=t.getAttribLocation(u,"position"),a.uv=t.getAttribLocation(u,"uv"),f.uvOffset=t.getUniformLocation(u,"uvOffset"),f.uvScale=t.getUniformLocation(u,"uvScale"),f.rotation=t.getUniformLocation(u,"rotation"),f.scale=t.getUniformLocation(u,"scale"),f.alignment=t.getUniformLocation(u,"alignment"),f.color=t.getUniformLocation(u,"color"),f.map=t.getUniformLocation(u,"map"),f.opacity=t.getUniformLocation(u,"opacity"),f.useScreenCoordinates=t.getUniformLocation(u,"useScreenCoordinates"),f.affectedByDistance=t.getUniformLocation(u,"affectedByDistance"),f.screenPosition=t.getUniformLocation(u,"screenPosition"),f.modelViewMatrix=t.getUniformLocation(u,"modelViewMatrix"),f.projectionMatrix=t.getUniformLocation(u,"projectionMatrix"),l=!1},this.render=function(r,i,p,d){var r=r.__webglSprites,v=r.length;if(v){var m=a,y=f,w=d/p,p=p*.5,E=d*.5,S=!0;t.useProgram(u),l||(t.enableVertexAttribArray(m.position),t.enableVertexAttribArray(m.uv),l=!0),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.depthMask(!0),t.bindBuffer(t.ARRAY_BUFFER,s),t.vertexAttribPointer(m.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(m.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.uniformMatrix4fv(y.projectionMatrix,!1,i._projectionMatrixArray),t.activeTexture(t.TEXTURE0),t.uniform1i(y.map,0);for(var x,T=[],m=0;m<v;m++)x=r[m],x.visible&&x.opacity!==0&&(x.useScreenCoordinates?x.z=-x.position.z:(x._modelViewMatrix.multiply(i.matrixWorldInverse,x.matrixWorld),x.z=-x._modelViewMatrix.elements[14]));r.sort(e);for(m=0;m<v;m++)x=r[m],x.visible&&x.opacity!==0&&x.map&&x.map.image&&x.map.image.width&&(x.useScreenCoordinates?(t.uniform1i(y.useScreenCoordinates,1),t.uniform3f(y.screenPosition,(x.position.x-p)/p,(E-x.position.y)/E,Math.max(0,Math.min(1,x.position.z)))):(t.uniform1i(y.useScreenCoordinates,0),t.uniform1i(y.affectedByDistance,x.affectedByDistance?1:0),t.uniformMatrix4fv(y.modelViewMatrix,!1,x._modelViewMatrix.elements)),i=x.map.image.width/(x.scaleByViewport?d:1),T[0]=i*w*x.scale.x,T[1]=i*x.scale.y,t.uniform2f(y.uvScale,x.uvScale.x,x.uvScale.y),t.uniform2f(y.uvOffset,x.uvOffset.x,x.uvOffset.y),t.uniform2f(y.alignment,x.alignment.x,x.alignment.y),t.uniform1f(y.opacity,x.opacity),t.uniform3f(y.color,x.color.r,x.color.g,x.color.b),t.uniform1f(y.rotation,x.rotation),t.uniform2fv(y.scale,T),x.mergeWith3D&&!S?(t.enable(t.DEPTH_TEST),S=!0):!x.mergeWith3D&&S&&(t.disable(t.DEPTH_TEST),S=!1),n.setBlending(x.blending,x.blendEquation,x.blendSrc,x.blendDst),n.setTexture(x.map,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var e,t,n,r,i=new THREE.Frustum,s=new THREE.Matrix4;this.init=function(i){e=i.context,t=i;var i=THREE.ShaderLib.depthRGBA,s=THREE.UniformsUtils.clone(i.uniforms);n=new THREE.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:s}),r=new THREE.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:s,morphTargets:!0}),n._shadowPass=!0,r._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(o,u){var l,h,p,v,m,g;e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),t.autoUpdateScene&&o.updateMatrixWorld(),u._viewMatrixArray||(u._viewMatrixArray=new Float32Array(16)),u._projectionMatrixArray||(u._projectionMatrixArray=new Float32Array(16)),u.matrixWorldInverse.getInverse(u.matrixWorld),u.matrixWorldInverse.flattenToArray(u._viewMatrixArray),u.projectionMatrix.flattenToArray(u._projectionMatrixArray),s.multiply(u.projectionMatrix,u.matrixWorldInverse),i.setFromMatrix(s),t.setRenderTarget(this.renderTarget),t.clear(),g=o.__webglObjects,l=0;for(h=g.length;l<h;l++)p=g[l],m=p.object,p.render=!1,m.visible&&(!(m instanceof THREE.Mesh)||!m.frustumCulled||i.contains(m))&&(m._modelViewMatrix.multiply(u.matrixWorldInverse,m.matrixWorld),p.render=!0);l=0;for(h=g.length;l<h;l++)p=g[l],p.render&&(m=p.object,p=p.buffer,t.setObjectFaces(m),v=m.customDepthMaterial?m.customDepthMaterial:m.geometry.morphTargets.length?r:n,p instanceof THREE.BufferGeometry?t.renderBufferDirect(u,o.__lights,null,v,p,m):t.renderBuffer(u,o.__lights,null,v,p,m));g=o.__webglObjectsImmediate,l=0;for(h=g.length;l<h;l++)p=g[l],m=p.object,m.visible&&m.castShadow&&(m._modelViewMatrix.multiply(u.matrixWorldInverse,m.matrixWorld),t.renderImmediateObject(u,o.__lights,null,n,m));l=t.getClearColor(),h=t.getClearAlpha(),e.clearColor(l.r,l.g,l.b,h),e.enable(e.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},THREE.ShaderSprite={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"precision mediump float;\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"}};var tQuery=function(e,t){if(arguments.length===2&&(arguments[0]instanceof THREE.Geometry||arguments[0]instanceof tQuery.Geometry)&&(arguments[1]instanceof THREE.Material||arguments[1]instanceof tQuery.Material)){var n=arguments[0]instanceof tQuery.Geometry?arguments[0].get(0):arguments[0],r=arguments[1]instanceof tQuery.Material?arguments[1].get(0):arguments[1],i=new THREE.Mesh(n,r);return tQuery(i)}var s=Array.isArray(e)?e[0]:e;return s instanceof THREE.Mesh&&tQuery.Mesh?new tQuery.Mesh(e):s instanceof THREE.DirectionalLight&&tQuery.DirectionalLight?new tQuery.DirectionalLight(e):s instanceof THREE.AmbientLight&&tQuery.AmbientLight?new tQuery.AmbientLight(e):s instanceof THREE.Light&&tQuery.Light?new tQuery.Light(e):s instanceof THREE.Object3D&&tQuery.Object3D?new tQuery.Object3D(e):s instanceof THREE.Geometry&&tQuery.Geometry?new tQuery.Geometry(e):s instanceof THREE.Material&&tQuery.Material?new tQuery.Material(e):typeof s=="string"&&tQuery.Object3D?new tQuery.Object3D(e,t):(console.assert(!1,"unsupported type"),undefined)};tQuery.VERSION="r49.1",tQuery.data=function(e,t,n,r){return console.assert(e,"invalid parameters"),console.assert(typeof t=="string","invalid parameters"),e._tqData=e._tqData||{},r&&console.assert(e._tqData[t]===undefined,"This key already exists "+t),n&&(e._tqData[t]=n),e._tqData[t]},tQuery.removeData=function(e,t,n){if(t instanceof Array){t.forEach(function(t){tQuery.removeData(e,t)});return}console.assert(typeof t=="string"),n&&console.assert(e._tqData[t]!==undefined,"This key doesnt already exists "+t),delete e._tqData[t]},tQuery.each=function(e,t){for(var n=0;n<e.length;n++){var r=t(e[n]);if(r===!1)return!1}return!0},tQuery.inherit=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.parent=t.prototype,e.prototype.constructor=e},tQuery.extend=function(e,t){var n={};return t&&Object.keys(t).forEach(function(e){n[e]=t[e]}),e&&Object.keys(e).forEach(function(t){n[t]=e[t]}),n},tQuery._pluginsOn=function(e,t,n){t=t||e.prototype||e,n=n||"",e["register"+n]=function(e,n){if(t[e])throw new Error("Conflict! Already method called: "+e);t[e]=n},e["unregister"+n]=function(e){if(t.hasOwnProperty(e)===!1)throw new Error("Plugin not found: "+e);delete t[e]},e["registered"+n]=function(e){return t.hasOwnProperty(e)===!0}},tQuery.pluginsInstanceOn=function(e){return tQuery._pluginsOn(e)},tQuery.pluginsStaticOn=function(e){return tQuery._pluginsOn(e,e,"Static")},tQuery.pluginsOn=function(e,t){return console.warn("tQuery.pluginsOn is obsolete. prefere .pluginsInstanceOn, .pluginsStaticOn"),console.trace(),tQuery._pluginsOn(e,t)},tQuery.pluginsOn(tQuery,tQuery),tQuery.mixinAttributes=function(e,t){e.prototype._attrProps=tQuery.extend(e.prototype._attrProps,t),e.prototype.attr=function(e,t){e instanceof Object&&t===undefined?Object.keys(e).forEach(function(t){this.attr(t,e[t])}.bind(this)):typeof e=="string"?console.assert(Object.keys(this._attrProps).indexOf(e)!==-1,"invalid property name:"+e):console.assert(!1,"invalid parameter");if(t!==undefined){var n=this._attrProps[e];return t=n(t),this.each(function(n){n[e]=t}),this}if(this.length===0)return undefined;var r=this.get(0);return r[e]},Object.keys(t).forEach(function(t){e.prototype[t]=function(e){return this.attr(t,e)}}.bind(this))},tQuery.Flow=function(){var e,t=[],n=setTimeout(function(){n=null,e._next()},0);return e={destroy:function(){n&&clearTimeout(n)},par:function(n,r){return(r||!(t[t.length-1]instanceof Array))&&t.push([]),t[t.length-1].push(n),e},seq:function(t){return e.par(t,!0)},_next:function(n,r){var i=[],s=[],o=t.shift()||[],u=o.length,a=u==1;o&&o.forEach(function(t,o){t(function(t,n){i[o]=t,s[o]=n,--u==0&&e._next(a?i[0]:i,a?s[0]:s)},n,r)})}}},tQuery.MicroeventMixin=function(e){var t=function(e,t){return this._events===undefined&&(this._events={}),this._events[e]=this._events[e]||[],this._events[e].push(t),t},n=function(e,t){this._events===undefined&&(this._events={});if(e in this._events==0)return;this._events[e].splice(this._events[e].indexOf(t),1)},r=function(e){this._events===undefined&&(this._events={});if(this._events[e]===undefined)return;var t=this._events[e].slice();for(var n=0;n<t.length;n++)t[n].apply(this,Array.prototype.slice.call(arguments,1))};e.bind=t,e.unbind=n,e.trigger=r,e.addEventListener=function(e,t){return this.bind(e,t),this},e.removeEventListener=function(e,t){return this.unbind(e,t),this},e.dispatchEvent=function(e){return this.trigger.apply(this,arguments),this}},tQuery.convert={},tQuery.convert.toThreeColor=function(e){return arguments.length===1&&typeof e=="number"?new THREE.Color(e):arguments.length===1&&e instanceof THREE.Color?e:(console.assert(!1,"invalid parameter"),undefined)},tQuery.convert.toNumber=function(e){return arguments.length===1&&typeof e=="number"?e:(console.assert(!1,"invalid parameter"),undefined)},tQuery.convert.toNumberZeroToOne=function(e){return arguments.length===1&&typeof e=="number"?(e=Math.min(e,1),e=Math.max(e,0),e):(console.assert(!1,"invalid parameter"),undefined)},tQuery.convert.toInteger=function(e){return arguments.length===1&&typeof e=="number"?(e=Math.floor(e),e):(console.assert(!1,"invalid parameter"),undefined)},tQuery.convert.identity=function(e){return e},tQuery.convert.toBoolean=function(e){return arguments.length===1&&typeof e=="boolean"?e:(console.assert(!1,"invalid parameter"),undefined)},tQuery.convert.toString=function(e){return arguments.length===1&&typeof e=="string"?e:(console.assert(!1,"invalid parameter"),undefined)},tQuery.convert.toTexture=function(e){if(arguments.length===1&&e instanceof THREE.Texture)return e;if(arguments.length===1&&typeof e=="string")return THREE.ImageUtils.loadTexture(e);if(arguments.length===1&&(e instanceof Image||e instanceof HTMLCanvasElement)){var t=new THREE.Texture(e);return t.needsUpdate=!0,t}return console.assert(!1,"invalid parameter"),undefined},tQuery.Node=function(e){e instanceof Array?this._lists=e:e?this._lists=[e]:this._lists=[],this.length=this._lists.length},tQuery.Node.prototype.get=function(e){return e===undefined?this._lists:(console.assert(this._lists[e],"element not defined"),this._lists[e])},tQuery.Node.prototype.each=function(e){return tQuery.each(this._lists,e)},tQuery.Node.prototype.back=function(e){return e===undefined?this._back:(this._back=e,this)},tQuery.Node.prototype.data=function(e,t){return t?(this.each(function(n){tQuery.data(n,e,t)}),this):this.length>0?tQuery.data(this.get(0),e):(console.assert(this.length===0),undefined)},tQuery.Node.prototype.removeData=function(e){return this.each(function(t){tQuery.removeData(t,e)}),this},tQuery.Object3D=function(e,t){typeof e=="string"&&(e=tQuery.Object3D._select(e,t)),tQuery.Object3D.parent.constructor.call(this,e),this._lists.forEach(function(e){console.assert(e instanceof THREE.Object3D)})},tQuery.inherit(tQuery.Object3D,tQuery.Node),tQuery.pluginsInstanceOn(tQuery.Object3D),tQuery.mixinAttributes(tQuery.Object3D,{eulerOrder:tQuery.convert.toString,doubleSided:tQuery.convert.toBoolean,flipSided:tQuery.convert.toBoolean,rotationAutoUpdate:tQuery.convert.toBoolean,matrixAutoUpdate:tQuery.convert.toBoolean,matrixWorldNeedsUpdate:tQuery.convert.toBoolean,useQuaternion:tQuery.convert.toBoolean,visible:tQuery.convert.toBoolean,receiveShadow:tQuery.convert.toBoolean,castShadow:tQuery.convert.toBoolean}),tQuery.Object3D.prototype.traverseHierarchy=function(e){return this.each(function(t){THREE.SceneUtils.traverseHierarchy(t,function(t){e(t)})}),this},tQuery.Object3D.prototype.geometry=function(e){var t=[];return this.each(function(e){t.push(e.geometry)}),(new tQuery.Geometry(t)).back(this)},tQuery.Object3D.prototype.material=function(){var e=[];return this.each(function(t){e.push(t.material)}),new tQuery.Material(e)},tQuery.Object3D.prototype.clone=function(){var e=[];return this._lists.forEach(function(t){var n=THREE.SceneUtils.cloneObject(t);e.push(n)}),tQuery(e)},tQuery.Object3D.prototype.addTo=function(e){return console.assert(e instanceof tQuery.World||e instanceof tQuery.Object3D||e instanceof THREE.Object3D),this.each(function(t){e.add(t)}.bind(this)),this},tQuery.Object3D.prototype.removeFrom=function(e){return console.assert(e instanceof tQuery.World||e instanceof tQuery.Object3D),this.each(function(t){e.remove(t)}.bind(this)),this},tQuery.Object3D.prototype.add=function(e){return e instanceof tQuery.Object3D?this.each(function(t){e.each(function(e){t.add(e)})}.bind(this)):e instanceof THREE.Object3D?this.each(function(t){t.add(e)}):console.assert(!1,"invalid parameter"),this},tQuery.Object3D.prototype.remove=function(e){return console.assert(e instanceof tQuery.Object3D),this.each(function(t){e.each(function(e){t.remove(e)})}.bind(this)),this},tQuery.Object3D.prototype.id=function(e){console.assert(this.length<=1,"tQuery.Object3D.id used on multi-elements");if(e!==undefined){if(this.length>0){var t=this.get(0);t._tqId=e}return this}if(this.length>0){var t=this.get(0);return t._tqId}return undefined},tQuery.Object3D.prototype.addClass=function(e){return this.each(function(t){t._tqClasses=t._tqClasses||"";if(tQuery.Object3D._hasClassOne(t,e))return;t._tqClasses+=" "+e}.bind(this)),this},tQuery.Object3D.prototype.removeClass=function(e){return this.each(function(t){tQuery.Object3D._removeClassOne(t,e)}.bind(this)),this},tQuery.Object3D.prototype.hasClass=function(e){var t=this.each(function(t){t._tqClasses=t._tqClasses||"";var n=tQuery.Object3D._hasClassOne(t,e);return n?!1:!0}.bind(this));return t?!1:!0},tQuery.Object3D._hasClassOne=function(e,t){if(e._tqClasses===undefined)return!1;var n=e._tqClasses,r=new RegExp("(^| |	)+("+t+")($| |	)+");return n.match(r)?!0:!1},tQuery.Object3D._removeClassOne=function(e,t){if(e._tqClasses===undefined)return;var n=new RegExp("(^| |	)("+t+")($| |	)");e._tqClasses=e._tqClasses.replace(n," ")},tQuery.Object3D._select=function(e,t){t=t||tQuery.world.tScene(),t instanceof tQuery.Object3D&&(t=t.get(0));var n=e.split(" ").filter(function(e){return e.length>0});console.assert(t instanceof THREE.Object3D);var r=[];return t.children.forEach(function(e){var t=this._crawls(e,n);r=r.concat(t)}.bind(this)),r},tQuery.Object3D._crawls=function(e,t){var n=[];console.assert(t.length>=1);var r=this._selectItemMatch(e,t[0]),i=r?t.slice(1):t;return i.length===0?[e]:(e.children.forEach(function(e){var t=this._crawls(e,i);n=n.concat(t)}.bind(this)),n)},tQuery.Object3D._selectableGeometries=Object.keys(THREE).filter(function(e){return e.match(/.+Geometry$/)}).map(function(e){return e.replace(/Geometry$/,"").toLowerCase()}),tQuery.Object3D._selectableLights=Object.keys(THREE).filter(function(e){return e.match(/.+Light$/)}).map(function(e){return e.replace(/Light$/,"").toLowerCase()}),tQuery.Object3D._selectableClasses=["mesh","light"],tQuery.Object3D._selectItemMatch=function(e,t){console.assert(e instanceof THREE.Object3D),console.assert(typeof t=="string");var n=t.match(new RegExp("([^.#]+|.[^.#]+|#[^.#]+)","g")),r=tQuery.each(n,function(t){var n=t.charAt(0),r=t.slice(1);if(n==="."){var i=tQuery.Object3D._hasClassOne(e,r);return i?!0:!1}if(n==="#")return e._tqId===r?!0:!1;if(t==="*")return!0;if(this._selectableGeometries.indexOf(t)!==-1){var s=e.geometry,o=t.charAt(0).toUpperCase()+t.slice(1)+"Geometry";return s instanceof THREE[o]}if(this._selectableLights.indexOf(t)!==-1){var o=t.charAt(0).toUpperCase()+t.slice(1)+"Light";return e instanceof THREE[o]}if(this._selectableClasses.indexOf(t)!==-1){var o=t.charAt(0).toUpperCase()+t.slice(1);return e instanceof THREE[o]}return console.assert(!1,"invalid selector: "+t),!0}.bind(this));return r?!0:!1},tQuery.Geometry=function(e){tQuery.Geometry.parent.constructor.call(this,e),this._lists.forEach(function(e){console.assert(e instanceof THREE.Geometry)})},tQuery.inherit(tQuery.Geometry,tQuery.Node),tQuery.pluginsInstanceOn(tQuery.Geometry),tQuery.mixinAttributes(tQuery.Geometry,{hasTangents:tQuery.convert.toBoolean,dynamic:tQuery.convert.toBoolean}),tQuery.Material=function(e){tQuery.Material.parent.constructor.call(this,e),this._lists.forEach(function(e){console.assert(e instanceof THREE.Material)})},tQuery.inherit(tQuery.Material,tQuery.Node),tQuery.pluginsInstanceOn(tQuery.Material),tQuery.mixinAttributes(tQuery.Material,{opacity:tQuery.convert.toNumber,transparent:tQuery.convert.toBoolean}),tQuery.Light=function(e){tQuery.Light.parent.constructor.call(this,e),this._lists.forEach(function(e){console.assert(e instanceof THREE.Light)})},tQuery.inherit(tQuery.Light,tQuery.Object3D),tQuery.pluginsInstanceOn(tQuery.Light),tQuery.mixinAttributes(tQuery.Light,{color:tQuery.convert.toThreeColor}),tQuery.Mesh=function(e){var t=tQuery.Mesh.parent;t.constructor.call(this,e),this._lists.forEach(function(e){console.assert(e instanceof THREE.Mesh)})},tQuery.inherit(tQuery.Mesh,tQuery.Object3D),tQuery.pluginsInstanceOn(tQuery.Mesh),tQuery.Mesh.prototype.material=function(e){var t=tQuery.Mesh.parent;return e==undefined?t.material.call(this):(this.each(function(t){t.material=e}),this)},tQuery.World=function(e){e=e||{},e=tQuery.extend(e,{renderW:window.innerWidth,renderH:window.innerHeight,webGLNeeded:!0,autoRendering:!0,scene:null,camera:null,renderer:null}),this._opts=e,console.assert(!tQuery.word),tQuery.world=this,this._autoRendering=!0,this._scene=e.scene||new THREE.Scene,e.camera?this._camera=e.camera:(this._camera=new THREE.PerspectiveCamera(35,e.renderW/e.renderH,.01,1e4),this._camera.position.set(0,0,3),this._scene.add(this._camera)),this._loop=new tQuery.Loop,this._loop.hookOnRender(this._$loopCb=function(){this.render()}.bind(this));if(e.renderer)this._renderer=e.renderer;else if(tQuery.World.hasWebGL())this._renderer=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});else{if(!!e.webGLNeeded)throw this._addGetWebGLMessage(),new Error("WebGL required and not available");this._renderer=new THREE.CanvasRenderer}this._renderer.setClearColorHex(12303291,1),this._renderer.setSize(e.renderW,e.renderH)},tQuery.pluginsInstanceOn(tQuery.World),tQuery.MicroeventMixin(tQuery.World.prototype),tQuery.World.prototype.destroy=function(){this.trigger("destroy"),this._loop.unhookOnRender(this._$loopCb),this._loop.destroy(),this.removeCameraControls();var e=this._renderer.domElement.parentElement;e&&e.removeChild(this._renderer.domElement),tQuery.world===this&&(tQuery.world=null)},tQuery.World._hasWebGL=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}(),tQuery.World.hasWebGL=function(){return tQuery.World._hasWebGL},tQuery.World.prototype._addGetWebGLMessage=function(e){e=e||document.body;var t=document.createElement("div");t.style.fontFamily="monospace",t.style.fontSize="13px",t.style.textAlign="center",t.style.background="#eee",t.style.color="#000",t.style.padding="1em",t.style.width="475px",t.style.margin="5em auto 0",t.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/">here</a>.'].join("\n"),e.appendChild(t)},tQuery.World.prototype.setCameraControls=function(e){return this.hasCameraControls()&&this.removeCameraControls(),this._cameraControls=e,this},tQuery.World.prototype.getCameraControls=function(){return this._cameraControls},tQuery.World.prototype.removeCameraControls=function(){return this.hasCameraControls()===!1?this:(this._cameraControls=undefined,this)},tQuery.World.prototype.hasCameraControls=function(){return this._cameraControls!==undefined?!0:!1},tQuery.World.prototype.add=function(e){return e instanceof tQuery.Object3D?e.each(function(e){this._scene.add(e)}.bind(this)):e instanceof THREE.Object3D?this._scene.add(e):console.assert(!1,"invalid type"),this},tQuery.World.prototype.remove=function(e){return e instanceof tQuery.Object3D?e.each(function(e){this._scene.remove(e)}.bind(this)):e instanceof THREE.Object3D?this._scene.remove(e):console.assert(!1,"invalid type"),this},tQuery.World.prototype.appendTo=function(e){return e.appendChild(this._renderer.domElement),this},tQuery.World.prototype.start=function(){return this._loop.start(),this},tQuery.World.prototype.stop=function(){return this._loop.stop(),this},tQuery.World.prototype.loop=function(){return this._loop},tQuery.World.prototype.tRenderer=function(){return this._renderer},tQuery.World.prototype.tScene=function(){return this._scene},tQuery.World.prototype.tCamera=function(){return this._camera},tQuery.World.prototype.renderer=function(){return console.trace(),console.warn("world.renderer() is ovbslete, use .tRenderer() instead"),this._renderer},tQuery.World.prototype.camera=function(){return console.trace(),console.warn("world.camera() is obsolete, use .tCamerar() instead"),this._camera},tQuery.World.prototype.scene=function(){return console.trace(),console.warn("world.scene() is obsolete, use .tScene() instead"),this._scene},tQuery.World.prototype.get=function(){return this._scene},tQuery.World.prototype.autoRendering=function(e){return e===undefined?this._autoRendering:(this._autoRendering=e,this)},tQuery.World.prototype.render=function(){this.hasCameraControls()&&this._cameraControls.update(),this._autoRendering&&this._renderer.render(this._scene,this._camera)},tQuery.Loop=function(){this._hooks=[],this._lastTime=null},tQuery.pluginsInstanceOn(tQuery.Loop),tQuery.Loop.prototype.destroy=function(){this.stop()},tQuery.Loop.prototype.start=function(){return this._timerId&&this.stop(),this._timerId=requestAnimationFrame(this._onAnimationFrame.bind(this)),this},tQuery.Loop.prototype.stop=function(){return cancelAnimationFrame(this._timerId),this._timerId=null,this},tQuery.Loop.prototype._onAnimationFrame=function(e){this._timerId=requestAnimationFrame(this._onAnimationFrame.bind(this));var t=e/1e3;this._lastTime||(this._lastTime=t-1/60);var n=t-this._lastTime;this._lastTime=t;for(var r=0;r<=this._hooks.length;r++){if(this._hooks[r]===undefined)continue;var i=this._hooks[r].slice(0);for(var s=0;s<i.length;s++)i[s](n,t)}},tQuery.Loop.prototype.PRE_RENDER=20,tQuery.Loop.prototype.ON_RENDER=50,tQuery.Loop.prototype.POST_RENDER=80,tQuery.Loop.prototype.hook=function(e,t){return typeof e=="function"&&(t=e,e=this.PRE_RENDER),this._hooks[e]=this._hooks[e]||[],console.assert(this._hooks[e].indexOf(t)===-1),this._hooks[e].push(t),t},tQuery.Loop.prototype.unhook=function(e,t){typeof e=="function"&&(t=e,e=this.PRE_RENDER);var n=this._hooks[e].indexOf(t);return console.assert(n!==-1),this._hooks[e].splice(n,1),this._hooks[e].length===0&&delete this._hooks[e],this},tQuery.Loop.prototype.hookPreRender=function(e){return this.hook(this.PRE_RENDER,e)},tQuery.Loop.prototype.hookOnRender=function(e){return this.hook(this.ON_RENDER,e)},tQuery.Loop.prototype.hookPostRender=function(e){return this.hook(this.POST_RENDER,e)},tQuery.Loop.prototype.unhookPreRender=function(e){return this.unhook(this.PRE_RENDER,e)},tQuery.Loop.prototype.unhookOnRender=function(e){return this.unhook(this.ON_RENDER,e)},tQuery.Loop.prototype.unhookPostRender=function(e){return this.unhook(this.POST_RENDER,e)},tQuery.register("createWorld",function(e){return new tQuery.World(e)}),tQuery.register("createObject3D",function(){var e=new THREE.Object3D;return tQuery(e)}),tQuery.register("createLoop",function(e){return new tQuery.Loop(e)}),tQuery.register("createDirectionalLight",function(){var e=new THREE.DirectionalLight;return new tQuery.DirectionalLight([e])}),tQuery.register("createSpotLight",function(){var e=new THREE.SpotLight;return new tQuery.SpotLight([e])}),tQuery.register("createPointLight",function(){var e=new THREE.PointLight;return new tQuery.PointLight([e])}),tQuery.register("createAmbientLight",function(){var e=new THREE.AmbientLight;return new tQuery.AmbientLight([e])}),tQuery.register("defaultObject3DMaterial",new THREE.MeshNormalMaterial),tQuery.Geometry.prototype.toMesh=function(e){var t=[];return this.each(function(n){e=e||tQuery.defaultObject3DMaterial;var r=new THREE.Mesh(n,e);t.push(r)}),new tQuery.Mesh(t)},tQuery.register("createCube",function(){var e=THREE.CubeGeometry,t=[1,1,1];return this._createMesh(e,t,arguments)}),tQuery.register("createTorus",function(){var e=THREE.TorusGeometry,t=[.35,.15];return this._createMesh(e,t,arguments)}),tQuery.register("createVector3",function(){return new THREE.Vector3}),tQuery.register("createSphere",function(){var e=THREE.SphereGeometry,t=[.5,32,16];return this._createMesh(e,t,arguments)}),tQuery.register("createPlane",function(){var e=THREE.PlaneGeometry,t=[1,1,16,16];return this._createMesh(e,t,arguments)}),tQuery.register("createCylinder",function(){var e=THREE.CylinderGeometry,t=[.5,.5,1,16,4];return this._createMesh(e,t,arguments)}),tQuery.register("_createMesh",function(e,t,n){n=Array.prototype.slice.call(n);var r=tQuery.defaultObject3DMaterial;n.length&&n[n.length-1]instanceof THREE.Material&&(r=n.pop());var i=function(e,t,n,r,i,s,o,u,a){return console.assert(arguments.length<=9),new e(t,n,r,i,s,o,u,a)};n.length===0&&(n=t.slice()),n.unshift(e);var s=i.apply(this,n);s.dynamic=!0;var o=new THREE.Mesh(s,r);return tQuery(o)}),tQuery.register("createAxis",function(){var e=new THREE.AxisHelper;return e.scale.multiplyScalar(.01),tQuery(e)}),tQuery.AmbientLight=function(e){tQuery.AmbientLight.parent.constructor.call(this,e),this._lists.forEach(function(e){console.assert(e instanceof THREE.AmbientLight)})},tQuery.inherit(tQuery.AmbientLight,tQuery.Light),tQuery.pluginsInstanceOn(tQuery.AmbientLight),tQuery.DirectionalLight=function(e){tQuery.DirectionalLight.parent.constructor.call(this,e),this._lists.forEach(function(e){console.assert(e instanceof THREE.DirectionalLight)})},tQuery.inherit(tQuery.DirectionalLight,tQuery.Light),tQuery.pluginsInstanceOn(tQuery.DirectionalLight),tQuery.mixinAttributes(tQuery.DirectionalLight,{intensity:tQuery.convert.toNumber,distance:tQuery.convert.toNumber,shadowDarkness:tQuery.convert.toNumberZeroToOne,shadowBias:tQuery.convert.toNumber,shadowMapWidth:tQuery.convert.toInteger,shadowMapHeight:tQuery.convert.toInteger,shadowCameraRight:tQuery.convert.toNumber,shadowCameraLeft:tQuery.convert.toNumber,shadowCameraTop:tQuery.convert.toNumber,shadowCameraBottom:tQuery.convert.toNumber,shadowCameraVisible:tQuery.convert.toBoolean,shadowCameraNear:tQuery.convert.toNumber,shadowCameraFar:tQuery.convert.toNumber}),tQuery.PointLight=function(e){tQuery.PointLight.parent.constructor.call(this,e),this._lists.forEach(function(e){console.assert(e instanceof THREE.PointLight)})},tQuery.inherit(tQuery.PointLight,tQuery.Light),tQuery.pluginsInstanceOn(tQuery.PointLight),tQuery.mixinAttributes(tQuery.PointLight,{intensity:tQuery.convert.toNumber,distance:tQuery.convert.toNumber}),tQuery.SpotLight=function(e){tQuery.SpotLight.parent.constructor.call(this,e),this._lists.forEach(function(e){console.assert(e instanceof THREE.SpotLight)})},tQuery.inherit(tQuery.SpotLight,tQuery.Light),tQuery.pluginsInstanceOn(tQuery.SpotLight),tQuery.mixinAttributes(tQuery.SpotLight,{intensity:tQuery.convert.toNumber,distance:tQuery.convert.toNumber,shadowDarkness:tQuery.convert.toNumberZeroToOne,shadowBias:tQuery.convert.toNumber,shadowMapWidth:tQuery.convert.toInteger,shadowMapHeight:tQuery.convert.toInteger,shadowCameraRight:tQuery.convert.toNumber,shadowCameraLeft:tQuery.convert.toNumber,shadowCameraTop:tQuery.convert.toNumber,shadowCameraBottom:tQuery.convert.toNumber,shadowCameraVisible:tQuery.convert.toBoolean}),function(){tQuery.Geometry.register("computeAll",function(){return this.each(function(e){e.computeBoundingBox(),e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals()}),this}),tQuery.Geometry.register("scaleBy",function(e){return typeof e=="number"&&arguments.length===1?e=new THREE.Vector3(e,e,e):typeof e=="number"&&arguments.length===3&&(e=new THREE.Vector3(arguments[0],arguments[1],arguments[2])),console.assert(e instanceof THREE.Vector3,"Geometry.vector3 parameter error"),this.each(function(t){for(var n=0;n<t.vertices.length;n++){var r=t.vertices[n];r.multiplySelf(e)}t.verticesNeedUpdate=!0,t.computeBoundingBox()}),this}),tQuery.Geometry.register("size",function(){console.assert(this.length<=1);if(this.length===0)return undefined;var e=this.get(0),t=new THREE.Vector3;return t.x=e.boundingBox.max.x-e.boundingBox.min.x,t.y=e.boundingBox.max.y-e.boundingBox.min.y,t.z=e.boundingBox.max.z-e.boundingBox.min.z,t}),tQuery.Geometry.register("normalize",function(){return this.each(function(e){var t=tQuery(e),n=t.size();n.x>=n.y&&n.x>=n.z?t.zoom(1/n.x):n.y>=n.x&&n.y>=n.z?t.zoom(1/n.y):t.zoom(1/n.z)}),this}),tQuery.Geometry.register("middlePoint",function(){console.assert(this.length<=1);if(this.length===0)return undefined;var e=this.get(0),t=new THREE.Vector3;return t.x=(e.boundingBox.max.x+e.boundingBox.min.x)/2,t.y=(e.boundingBox.max.y+e.boundingBox.min.y)/2,t.z=(e.boundingBox.max.z+e.boundingBox.min.z)/2,t}),tQuery.Geometry.register("translate",function(e){return typeof e=="number"&&arguments.length===3&&(e=new THREE.Vector3(arguments[0],arguments[1],arguments[2])),console.assert(e instanceof THREE.Vector3,"Geometry.translate parameter error"),this.each(function(t){for(var n=0;n<t.vertices.length;n++){var r=t.vertices[n];r.addSelf(e)}t.verticesNeedUpdate=!0,t.computeBoundingBox()}),this}),tQuery.Geometry.register("rotate",function(e,t){typeof e=="number"&&arguments.length===3&&(e=new THREE.Vector3(arguments[0],arguments[1],arguments[2])),console.assert(e instanceof THREE.Vector3,"Geometry.rotate parameter error"),t=t||"XYZ";var n=new THREE.Matrix4;return n.setRotationFromEuler(e,t),this.each(function(e){e.applyMatrix(n),e.verticesNeedUpdate=!0,e.computeBoundingBox()}),this}),tQuery.Geometry.register("center",function(e,t,n){return this.each(function(r){var i=tQuery(r),s=i.middlePoint().negate();return e&&(s.x=0),t&&(s.y=0),n&&(s.z=0),i.translate(s)}),this}),tQuery.Geometry.register("smooth",function(e){var t=new THREE.SubdivisionModifier(e);return this.each(function(e){t.modify(e),e.verticesNeedUpdate=!0,e.computeBoundingBox()}),this}),tQuery.Geometry.register("translateX",function(e){return this.translate(e,0,0)}),tQuery.Geometry.register("translateY",function(e){return this.translate(0,e,0)}),tQuery.Geometry.register("translateZ",function(e){return this.translate(0,0,e)}),tQuery.Geometry.register("rotateX",function(e){return this.rotate(e,0,0)}),tQuery.Geometry.register("rotateY",function(e){return this.rotate(0,e,0)}),tQuery.Geometry.register("rotateZ",function(e){return this.rotate(0,0,e)}),tQuery.Geometry.register("scaleXBy",function(e){return this.scaleBy(e,1,1)}),tQuery.Geometry.register("scaleYBy",function(e){return this.scaleBy(1,e,1)}),tQuery.Geometry.register("scaleZBy",function(e){return this.scaleBy(1,1,e)}),tQuery.Geometry.register("zoom",function(e){return this.scaleBy(e)}),tQuery.Geometry.register("zoomX",function(e){return this.zoom(e,1,1)}),tQuery.Geometry.register("zoomY",function(e){return this.zoom(1,e,1)}),tQuery.Geometry.register("zoomZ",function(e){return this.zoom(1,1,e)})}(),function(){tQuery.Object3D.register("scale",function(e){return typeof e=="number"&&arguments.length===1?e=new THREE.Vector3(e,e,e):typeof e=="number"&&arguments.length===3&&(e=new THREE.Vector3(arguments[0],arguments[1],arguments[2])),console.assert(e instanceof THREE.Vector3,"Geometry.scale parameter error"),this.each(function(t){t.scale.copy(e)}),this}),tQuery.Object3D.register("position",function(e){return typeof e=="number"&&arguments.length===3&&(e=new THREE.Vector3(arguments[0],arguments[1],arguments[2])),console.assert(e instanceof THREE.Vector3,"Object3D.position parameter error"),this.each(function(t){t.position.copy(e)}),this}),tQuery.Object3D.register("rotation",function(e){return typeof e=="number"&&arguments.length===3&&(e=new THREE.Vector3(arguments[0],arguments[1],arguments[2])),console.assert(e instanceof THREE.Vector3,"Object3D.rotation parameter error"),this.each(function(t){t.rotation.copy(e)}),this}),tQuery.Object3D.register("translate",function(e){return typeof e=="number"&&arguments.length===3&&(e=new THREE.Vector3(arguments[0],arguments[1],arguments[2])),console.assert(e instanceof THREE.Vector3,"Object3D.translate parameter error"),this.each(function(t){t.position.addSelf(e)}),this}),tQuery.Object3D.register("rotate",function(e){return typeof e=="number"&&arguments.length===3&&(e=new THREE.Vector3(arguments[0],arguments[1],arguments[2])),console.assert(e instanceof THREE.Vector3,"Object3D.rotate parameter error"),this.each(function(t){t.rotation.addSelf(e)}),this}),tQuery.Object3D.register("scaleBy",function(e){return typeof e=="number"&&arguments.length===1?e=new THREE.Vector3(e,e,e):typeof e=="number"&&arguments.length===3&&(e=new THREE.Vector3(arguments[0],arguments[1],arguments[2])),console.assert(e instanceof THREE.Vector3,"Object3D.rotate parameter error"),this.each(function(t){t.scale.multiplySelf(e)}),this}),tQuery.Object3D.register("translateX",function(e){return this.translate(e,0,0)}),tQuery.Object3D.register("translateY",function(e){return this.translate(0,e,0)}),tQuery.Object3D.register("translateZ",function(e){return this.translate(0,0,e)}),tQuery.Object3D.register("rotateX",function(e){return this.rotate(e,0,0)}),tQuery.Object3D.register("rotateY",function(e){return this.rotate(0,e,0)}),tQuery.Object3D.register("rotateZ",function(e){return this.rotate(0,0,e)}),tQuery.Object3D.register("scaleXBy",function(e){return this.scaleBy(e,1,1)}),tQuery.Object3D.register("scaleYBy",function(e){return this.scaleBy(1,e,1)}),tQuery.Object3D.register("scaleZBy",function(e){return this.scaleBy(1,1,e)}),tQuery.Object3D.register("zoom",function(e){return this.scaleBy(e)}),tQuery.Object3D.register("zoomX",function(e){return this.zoom(e,1,1)}),tQuery.Object3D.register("zoomY",function(e){return this.zoom(1,e,1)}),tQuery.Object3D.register("zoomZ",function(e){return this.zoom(1,1,e)})}(),tQuery.World.register("fullpage",function(){return console.log("world.fullpage() is obsolete. use world.boilerplate() instead."),this.boilerplate()}),tQuery.World.register("boilerplate",function(e){var t=document.body;return t.style.margin="0",t.style.padding="0",t.style.overflow="hidden",this.appendTo(t),this._renderer.setSize(t.offsetWidth,t.offsetHeight),this.addBoilerplate(e),this}),tQuery.World.register("pageTitle",function(e){if(typeof e=="string")var e=document.querySelector(e);return console.assert(e instanceof HTMLElement),e.style.position="absolute",e.style.width="100%",e.style.textAlign="center",e.style.fontWeight="bolder",e.style.fontColor="white",e.style.paddingTop="0.5em",e.style.fontFamily="arial",this}),tQuery.World.register("addBoilerplate",function(e){var t=this;console.assert(this.hasBoilerplate()!==!0),e=tQuery.extend(e,{stats:!0,cameraControls:!0,windowResize:!0,screenshot:!0,fullscreen:!0});var n={};this.tRenderer().domElement.style.display="block",tQuery.data(this,"_boilerplateCtx",n);var r=this.tCamera(),i=this.tRenderer();return e.stats&&(n.stats=new Stats,n.stats.domElement.style.position="absolute",n.stats.domElement.style.bottom="0px",i.domElement.parentNode&&i.domElement.parentNode.appendChild(n.stats.domElement),n.loopStats=function(){n.stats.update()},this.loop().hook(n.loopStats)),e.cameraControls&&(n.cameraControls=new THREEx.DragPanControls(r),this.setCameraControls(n.cameraControls)),e.windowResize&&(n.windowResize=THREEx.WindowResize.bind(i,r)),e.screenshot&&(n.screenshot=THREEx.Screenshot.bindKey(i)),e.fullscreen&&THREEx.FullScreen.available()&&(n.fullscreen=THREEx.FullScreen.bindKey()),n._$onDestroy=this.bind("destroy",function(){if(this.hasBoilerplate()===!1)return;this.removeBoilerplate()}),this}),tQuery.World.register("hasBoilerplate",function(){var e=tQuery.data(this,"_boilerplateCtx");return e===undefined?!1:!0}),tQuery.World.register("removeBoilerplate",function(){var e=tQuery.data(this,"_boilerplateCtx");if(e===undefined)return this;tQuery.removeData(this,"_boilerplateCtx"),this.unbind("destroy",this._$onDestroy),e.stats&&document.body.removeChild(e.stats.domElement),e.stats&&this.loop().unhook(e.loopStats),e.cameraControls&&this.removeCameraControls(),e.windowResize&&e.windowResize.stop(),e.screenshot&&e.screenshot.unbind(),e.fullscreen&&e.fullscreen.unbind()});var THREEx=THREEx||{};THREEx.WindowResize=function(e,t){var n=function(){e.setSize(window.innerWidth,window.innerHeight),t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix()};return window.addEventListener("resize",n,!1),{stop:function(){window.removeEventListener("resize",n)}}},THREEx.WindowResize.bind=function(e,t){return THREEx.WindowResize(e,t)};var THREEx=THREEx||{};(function(){var e=function(e,t){t=t||"image/png";var n=e.domElement.toDataURL(t);return n},t=function(e,t,n,r){var i=function(e,t,n,r){var i=r/n;return n>=e&&i<=1?(n=e,r=e*i):r>=t&&(r=t,n=t/i),{width:n,height:r}},s=function(e,t){return function(){return e.apply(t,arguments)}},o=s(function(){var e=document.createElement("canvas");e.width=t,e.height=n;var s=e.getContext("2d");s.fillStyle="black",s.fillRect(0,0,e.width,e.height);var o=i(e.width,e.height,u.width,u.height),a=(e.width-o.width)/2,f=(e.height-o.height)/2;s.drawImage(u,a,f,o.width,o.height);var l="image/png",c=e.toDataURL(l);r&&r(c)},this),u=new Image;u.onload=o,u.src=e},n=function(e,n){n=n||{};var r=n.charCode||"p".charCodeAt(0),i=n.width,s=n.height,o=n.callback||function(e){window.open(e,"name-"+Math.random())},u=function(e,t){return function(){return e.apply(t,arguments)}},a=u(function(n){if(n.which!==r)return;var u=this.toDataURL(e);i===undefined&&s===undefined?o(u):t(u,i,s,o)},this);return document.addEventListener("keypress",a,!1),{unbind:function(){document.removeEventListener("keypress",a,!1)}}};THREEx.Screenshot={toDataURL:e,bindKey:n}})();var THREEx=THREEx||{};THREEx.FullScreen=THREEx.FullScreen||{},THREEx.FullScreen.available=function(){return this._hasWebkitFullScreen||this._hasMozFullScreen},THREEx.FullScreen.activated=function(){if(this._hasWebkitFullScreen)return document.webkitIsFullScreen;if(this._hasMozFullScreen)return document.mozFullScreen;console.assert(!1)},THREEx.FullScreen.request=function(e){e=e||document.body,this._hasWebkitFullScreen?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):this._hasMozFullScreen?e.mozRequestFullScreen():console.assert(!1)},THREEx.FullScreen.cancel=function(){this._hasWebkitFullScreen?document.webkitCancelFullScreen():this._hasMozFullScreen?document.mozCancelFullScreen():console.assert(!1)},THREEx.FullScreen._hasWebkitFullScreen="webkitCancelFullScreen"in document?!0:!1,THREEx.FullScreen._hasMozFullScreen="mozCancelFullScreen"in document?!0:!1,THREEx.FullScreen.bindKey=function(e){e=e||{};var t=e.charCode||"f".charCodeAt(0),n=e.dblclick!==undefined?e.dblclick:!1,r=e.element,i=function(){THREEx.FullScreen.activated()?THREEx.FullScreen.cancel():THREEx.FullScreen.request(r)},s=function(e,t){return function(){return e.apply(t,arguments)}},o=s(function(e){if(e.which!==t)return;i()},this);return document.addEventListener("keypress",o,!1),n&&document.addEventListener("dblclick",i,!1),{unbind:function(){document.removeEventListener("keypress",o,!1),n&&document.removeEventListener("dblclick",i,!1)}}};var THREEx=THREEx||{};THREEx.DragPanControls=function(e,t){this._object=e,this._domElement=t||document,this.target=new THREE.Vector3(0,0,0),this.speedX=.03,this.speedY=.03,this.rangeX=-40,this.rangeY=40,this._mouseX=0,this._mouseY=0;var n=this;this._$onMouseMove=function(){n._onMouseMove.apply(n,arguments)},this._$onTouchStart=function(){n._onTouchStart.apply(n,arguments)},this._$onTouchMove=function(){n._onTouchMove.apply(n,arguments)},this._domElement.addEventListener("mousemove",this._$onMouseMove,!1),this._domElement.addEventListener("touchstart",this._$onTouchStart,!1),this._domElement.addEventListener("touchmove",this._$onTouchMove,!1)},THREEx.DragPanControls.prototype.destroy=function(){this._domElement.removeEventListener("mousemove",this._$onMouseMove,!1),this._domElement.removeEventListener("touchstart",this._$onTouchStart,!1),this._domElement.removeEventListener("touchmove",this._$onTouchMove,!1)},THREEx.DragPanControls.prototype.update=function(e){this._object.position.x+=(this._mouseX*this.rangeX-this._object.position.x)*this.speedX,this._object.position.y+=(this._mouseY*this.rangeY-this._object.position.y)*this.speedY,this._object.lookAt(this.target)},THREEx.DragPanControls.prototype._onMouseMove=function(e){this._mouseX=e.clientX/window.innerWidth-.5,this._mouseY=e.clientY/window.innerHeight-.5},THREEx.DragPanControls.prototype._onTouchStart=function(e){if(e.touches.length!=1)return;this._mouseX=e.touches[0].pageX/window.innerWidth-.5,this._mouseY=e.touches[0].pageY/window.innerHeight-.5},THREEx.DragPanControls.prototype._onTouchMove=function(e){if(e.touches.length!=1)return;e.preventDefault(),this._mouseX=e.touches[0].pageX/window.innerWidth-.5,this._mouseY=e.touches[0].pageY/window.innerHeight-.5};var Stats=function(){var e,t,n=0,r=0,i=Date.now(),s=i,o=i,u=0,a=1e3,f=0,l,c,h,p=[[16,16,48],[0,255,255]],d=0,v=1e3,m=0,g,y,b,w=[[16,48,16],[0,255,0]];e=document.createElement("div"),e.style.cursor="pointer",e.style.width="80px",e.style.opacity="0.9",e.style.zIndex="10001",e.addEventListener("mousedown",function(e){e.preventDefault(),n=(n+1)%2,n==0?(l.style.display="block",g.style.display="none"):(l.style.display="none",g.style.display="block")},!1),l=document.createElement("div"),l.style.textAlign="left",l.style.lineHeight="1.2em",l.style.backgroundColor="rgb("+Math.floor(p[0][0]/2)+","+Math.floor(p[0][1]/2)+","+Math.floor(p[0][2]/2)+")",l.style.padding="0 0 3px 3px",e.appendChild(l),c=document.createElement("div"),c.style.fontFamily="Helvetica, Arial, sans-serif",c.style.fontSize="9px",c.style.color="rgb("+p[1][0]+","+p[1][1]+","+p[1][2]+")",c.style.fontWeight="bold",c.innerHTML="FPS",l.appendChild(c),h=document.createElement("div"),h.style.position="relative",h.style.width="74px",h.style.height="30px",h.style.backgroundColor="rgb("+p[1][0]+","+p[1][1]+","+p[1][2]+")";for(l.appendChild(h);h.children.length<74;)t=document.createElement("span"),t.style.width="1px",t.style.height="30px",t.style.cssFloat="left",t.style.backgroundColor="rgb("+p[0][0]+","+p[0][1]+","+p[0][2]+")",h.appendChild(t);g=document.createElement("div"),g.style.textAlign="left",g.style.lineHeight="1.2em",g.style.backgroundColor="rgb("+Math.floor(w[0][0]/2)+","+Math.floor(w[0][1]/2)+","+Math.floor(w[0][2]/2)+")",g.style.padding="0 0 3px 3px",g.style.display="none",e.appendChild(g),y=document.createElement("div"),y.style.fontFamily="Helvetica, Arial, sans-serif",y.style.fontSize="9px",y.style.color="rgb("+w[1][0]+","+w[1][1]+","+w[1][2]+")",y.style.fontWeight="bold",y.innerHTML="MS",g.appendChild(y),b=document.createElement("div"),b.style.position="relative",b.style.width="74px",b.style.height="30px",b.style.backgroundColor="rgb("+w[1][0]+","+w[1][1]+","+w[1][2]+")";for(g.appendChild(b);b.children.length<74;)t=document.createElement("span"),t.style.width="1px",t.style.height=Math.random()*30+"px",t.style.cssFloat="left",t.style.backgroundColor="rgb("+w[0][0]+","+w[0][1]+","+w[0][2]+")",b.appendChild(t);return{domElement:e,update:function(){i=Date.now(),d=i-s,v=Math.min(v,d),m=Math.max(m,d),y.textContent=d+" MS ("+v+"-"+m+")";var e=Math.min(30,30-d/200*30);b.appendChild(b.firstChild).style.height=e+"px",s=i,r++,i>o+1e3&&(u=Math.round(r*1e3/(i-o)),a=Math.min(a,u),f=Math.max(f,u),c.textContent=u+" FPS ("+a+"-"+f+")",e=Math.min(30,30-u/100*30),h.appendChild(h.firstChild).style.height=e+"px",o=i,r=0)}}};require(["../../../build/tquery-bundle"],function(){var e=tQuery.createWorld().boilerplate().start();tQuery.createTorus().addTo(e)}),define("main",function(){})